import{f as E,a as I}from"../chunks/DYbKDSXk.js";import{au as W,p as Q,a as H,c as U,s as x,r as N,t as Y}from"../chunks/DlUVEpaU.js";import{i as G}from"../chunks/C6jlbT71.js";import{s as X}from"../chunks/vpaS6ag4.js";import"../chunks/vmZ8CxnS.js";import{B as z,D as $}from"../chunks/CReqLTTF.js";import{k as j,m as l,o as T,p as J,q as Z,v as C,r as R,t as L,x as D,b as F,y as h,z as g,A as q,B as M,C as S,D as V,E as K}from"../chunks/0o8OGYDl.js";import{c as e0}from"../chunks/B6Foiicm.js";import{h as t0}from"../chunks/CHgWMm4e.js";const a0=!0,I0=Object.freeze(Object.defineProperty({__proto__:null,prerender:a0},Symbol.toStringTag,{value:"Module"}));var n0=E('<h3>About CatDex</h3> <p>Category Decentralized Exchange is a protocol to exchange assets using orders stored on non-fungible token commitments.</p> <p>More information about <a href="https://bitcoincashresearch.org/t/catdex-a-token-category-authorized-decentralized-exchange/1480" rel="nofollow">the contract.</a></p>',1);function o0(B){var e=n0();W(4),I(B,e)}const s0="https://libauth.org/schemas/wallet-template-v0.schema.json",c0="CatDex: a bi-directional limit order CashToken exchange.",i0="CatDex",r0={covenant:{description:`A CatDex blackboard contract holds limit orders and token treads for trading. 


Anyone may spend a mutable order NFT to trade some or all of the quantity specified from any output held by the exchange.  


Features:


  - Bidirectional limit order exchange.
  - ZERO commission trades*.
  - Partial order fulfillment.
  - Cash bids for assets not held.
  - Allows total liquidation of token assets.
  - Minting NFT holder may easily withdraw, cancel, or rebalance orders.
  - Many orders may be written in a single transaction. 
  - All orders are discoverable via electrumX/smallIndex
  - *Transactions must pay standard fees to miners.


Order Commitments:


  Orders are listed on mutable NFT commitments like so
   
     byte16(LE)<quantity>   number of tokens remaining in order
     byte16(LE)<price>      price in token units per coin


  - Buy orders are positive (+)
  - Sell orders are negative (-)
  - Price MUST be expressed in raw token units per coin (100,000,000 sats)
  - CatDex has no concept of display decimal metadata 
 
Transaction Building Modes:


  Administration Mode
  
     Transactions with a minting NFT may withdraw all outputs from the contract.
  
     Auth Baton    input[0] -> output[0]     - Authenticating NFT (minting)
                   input[i] -> output[*]     - Unrestricted spending


  Order Mode
  
    In "Order mode" outputs are submitted in pairs, with both the record for the order
    and the cash value moving on the even "foot" and the tokens trading on the odd "foot".
    
    orderThread    input[even] -> output[even]  - Order NFT of category (mutable)
    assetThread    input[odd]  -> output[odd]   - Tread for asset traded.


Note: 


  The exchange owner(s) holds the minting NFT baton(s), which authorizes spending funds from the exchange.
`,name:"CatDex Blackboard",scripts:["unlock","lock"],variables:{auth_category:{description:"The CashToken Category for orders and authentication.",name:"Authentication Token Category",type:"WalletData"},asset_category:{description:"The CashToken Category Token ID of the asset being traded",name:"Asset Token Category",type:"WalletData"}}},wallet:{description:"Standard p2pkh wallet controlling the exchange minting NFT baton",name:"Exchange Owner",scripts:["wallet_unlock","wallet_lock"],variables:{key:{description:"The private key that controls this wallet.",name:"Key",type:"HdKey"}}}},d0=JSON.parse('{"base":{"data":{"bytecode":{"auth_category":"0xefbe00000000000000000000000000000000000000000000000000000000efbe","asset_category":"0x2c06f3b2565d0818a8e41f58beff5918d5dbdc64b11ee8ad474e499751cde07f"}},"description":"","name":"Base Scenario"},"excise_sell_order_baton":{"description":"Buy using a sell order.","extends":"base","name":"Use sell order (baton tread)","transaction":{"inputs":[{"unlockingBytecode":["slot"]},{},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10400,"token":{"category":"beef00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"0000000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":0,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":9600,"token":{"amount":20,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}}],"version":2},"sourceOutputs":[{"lockingBytecode":["slot"],"valueSatoshis":10000,"token":{"category":"beef00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":20}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000}]},"excise_sell_order_asset":{"description":"Test buying an asset using a sell order.","extends":"base","name":"Use sell order to buy (asset tread)","transaction":{"inputs":[{},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10400,"token":{"category":"beef00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"0000000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":0,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":9600,"token":{"amount":20,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}}],"version":2},"sourceOutputs":[{"valueSatoshis":10000,"token":{"category":"beef00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":20}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000}]},"overbuy_order_baton":{"description":"Test that overbuying a sell order should fail.","extends":"base","name":"FAIL: overbuy sell order (baton tread)","transaction":{"inputs":[{"unlockingBytecode":["slot"]},{},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10800,"token":{"category":"beef00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"1400000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":0,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":9200,"token":{"amount":40,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}}],"version":2},"sourceOutputs":[{"lockingBytecode":["slot"],"valueSatoshis":10000,"token":{"category":"beef00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":40}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000}]},"overbuy_order_asset":{"description":"Test that overbuying a sell order should fail.","extends":"base","name":"FAIL: overbuy sell order (asset tread)","transaction":{"inputs":[{},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10800,"token":{"category":"beef00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"1400000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":0,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":9200,"token":{"amount":40,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}}],"version":2},"sourceOutputs":[{"valueSatoshis":10000,"token":{"category":"beef00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":40}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000}]},"misexcise_sell_order_asset":{"description":"Test that selling to a sell order should fail.","extends":"base","name":"FAIL: selling into sell order (asset tread)","transaction":{"inputs":[{},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10800,"token":{"category":"beef00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"3c00000000000000000000000000008000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":60,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10800}],"version":2},"sourceOutputs":[{"valueSatoshis":10000,"token":{"category":"beef00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":20}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":40}}]},"excise_buy_order_baton":{"description":"Test selling an asset using a buy order.","extends":"base","name":"Use buy order to sell tokens","transaction":{"inputs":[{"unlockingBytecode":["slot"]},{},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10000,"token":{"category":"beef00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"0000000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":20,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10400}],"version":2},"sourceOutputs":[{"lockingBytecode":["slot"],"valueSatoshis":10400,"token":{"category":"beef00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000000000943577000000000000000000000000","capability":"mutable"}}},{"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":0}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":20}}]},"excise_buy_order_asset":{"description":"Test selling an asset to a buy order.","extends":"base","name":"Use buy order to sell tokens","transaction":{"inputs":[{},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10000,"token":{"category":"beef00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"0000000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":20,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10400}],"version":2},"sourceOutputs":[{"valueSatoshis":10400,"token":{"category":"beef00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000000000943577000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":0}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":20}}]},"create":{"description":"Create an order book","name":"Create Orderbook","transaction":{"inputs":[{"unlockingBytecode":["slot"]},{},{}],"outputs":[{"lockingBytecode":"76a9141cb0e414e168062d46cc0e5799c71e3e4b3028cf88ac","token":{"category":"4ebdbcc129f3cd5759a5d3b76b908bf91f86666cd19793b1a48807fc7f11016c","amount":0,"nft":{"commitment":"0adf","capability":"minting"}},"valueSatoshis":1000},{"lockingBytecode":"aa202e84afbcdb5951e8d159969a2325f72abe0d62f686793e8283118d6e1fdd96e987","token":{"category":"4ebdbcc129f3cd5759a5d3b76b908bf91f86666cd19793b1a48807fc7f11016c","amount":0,"nft":{"commitment":"20a1070000000000000000000000008014000000000000000000000000000000","capability":"mutable"}},"valueSatoshis":800},{"lockingBytecode":"aa202e84afbcdb5951e8d159969a2325f72abe0d62f686793e8283118d6e1fdd96e987","token":{"category":"35c5f1fe73b627b70e11f8297eea49a0f074f33b201c37e7c21ff6027a84a795","amount":0},"valueSatoshis":800},{"lockingBytecode":"aa202e84afbcdb5951e8d159969a2325f72abe0d62f686793e8283118d6e1fdd96e987","token":{"category":"4ebdbcc129f3cd5759a5d3b76b908bf91f86666cd19793b1a48807fc7f11016c","amount":0,"nft":{"commitment":"a086010000000000000000000000000014000000000000000000000000000000","capability":"mutable"}},"valueSatoshis":800},{"lockingBytecode":"aa202e84afbcdb5951e8d159969a2325f72abe0d62f686793e8283118d6e1fdd96e987","token":{"category":"35c5f1fe73b627b70e11f8297eea49a0f074f33b201c37e7c21ff6027a84a795","amount":100000},"valueSatoshis":800},{"lockingBytecode":"76a9141cb0e414e168062d46cc0e5799c71e3e4b3028cf88ac","token":{"category":"35c5f1fe73b627b70e11f8297eea49a0f074f33b201c37e7c21ff6027a84a795","amount":2099999999900000},"valueSatoshis":800},{"lockingBytecode":"76a9141cb0e414e168062d46cc0e5799c71e3e4b3028cf88ac","valueSatoshis":100093052}],"version":2},"sourceOutputs":[{"lockingBytecode":["slot"],"valueSatoshis":1000,"token":{"category":"4ebdbcc129f3cd5759a5d3b76b908bf91f86666cd19793b1a48807fc7f11016c","nft":{"commitment":"0x0adf","capability":"minting"}}},{"lockingBytecode":"76a9141cb0e414e168062d46cc0e5799c71e3e4b3028cf88ac","valueSatoshis":100097016},{"lockingBytecode":"76a9141cb0e414e168062d46cc0e5799c71e3e4b3028cf88ac","valueSatoshis":1000,"token":{"category":"35c5f1fe73b627b70e11f8297eea49a0f074f33b201c37e7c21ff6027a84a795","amount":2100000000000000}}]},"withdraw":{"description":"Withdraw accumulated principal and tokens","extends":"base","name":"Withdraw","transaction":{"inputs":[{"unlockingBytecode":{"script":"wallet_unlock"}},{"unlockingBytecode":["slot"]}],"outputs":[{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":800,"token":{"category":"beef00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"minting"}}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":100000000,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":100000000}}],"version":2},"sourceOutputs":[{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":800,"token":{"category":"beef00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"minting"}}},{"lockingBytecode":["slot"],"valueSatoshis":100000000,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":100000000}}]},"clear":{"data":{"bytecode":{"auth_category":"0x5263006eccd92d7dadbdced311b08e08f940c9c09fe09445d5789d8bd3d6c9aa","asset_category":"0xe9556bdf407a8bb7122ea1a04c8acfeb9ab9c2cb3682288114263ad2237851c6"}},"description":"Clear an order book","name":"Clear Orderbook","transaction":{"inputs":[{"unlockingBytecode":{"script":"wallet_unlock"}},{"unlockingBytecode":{"script":"unlock"}},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"unlock"}},{"unlockingBytecode":{"script":"unlock"}},{"unlockingBytecode":{"script":"wallet_unlock"}},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"wallet_lock"},"token":{"category":"aac9d6d38b9d78d54594e09fc0c940f9088eb011d3cebdad7d2dd9cc6e006352","amount":0,"nft":{"commitment":"0x1234","capability":"minting"}},"valueSatoshis":1000},{"lockingBytecode":{"script":["copy"]},"token":{"category":"c6517823d23a261481288236cbc2b99aebcf8a4ca0a12e12b78b7a40df6b55e9","amount":2100000000000000},"valueSatoshis":800},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":100094709}]},"sourceOutputs":[{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":1000,"token":{"category":"aac9d6d38b9d78d54594e09fc0c940f9088eb011d3cebdad7d2dd9cc6e006352","amount":0,"nft":{"commitment":"1234","capability":"minting"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":10000800,"token":{"category":"aac9d6d38b9d78d54594e09fc0c940f9088eb011d3cebdad7d2dd9cc6e006352","amount":0,"nft":{"commitment":"20a1070000000000000000000000008014000000000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800},{"valueSatoshis":800,"token":{"category":"aac9d6d38b9d78d54594e09fc0c940f9088eb011d3cebdad7d2dd9cc6e006352","amount":0,"nft":{"commitment":"a086010000000000000000000000000014000000000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"category":"c6517823d23a261481288236cbc2b99aebcf8a4ca0a12e12b78b7a40df6b55e9","amount":100000}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":90093052},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":800,"token":{"category":"c6517823d23a261481288236cbc2b99aebcf8a4ca0a12e12b78b7a40df6b55e9","amount":2099999999900000}}]}}'),l0={unlock:{fails:["overbuy_order_asset","overbuy_order_baton","misexcise_sell_order_asset"],passes:["clear","excise_buy_order_baton","excise_buy_order_asset","excise_sell_order_baton","excise_sell_order_asset","withdraw"],name:"Swap or Administer",script:"",unlocks:"lock"},wallet_unlock:{passes:["create"],name:"Wallet Unlock",script:"<key.schnorr_signature.all_outputs> <key.public_key>",unlocks:"wallet_lock"},wallet_lock:{lockingType:"standard",name:"Wallet Lock",script:"OP_DUP OP_HASH160 <$(<key.public_key> OP_HASH160)> OP_EQUALVERIFY OP_CHECKSIG"},lock:{lockingType:"p2sh32",name:"CatDex Blackboard",script:`// CatDex - A token category authorized decentralized exchange
//
// 2025-11-22 Pre-alpha, pre-audit
//
// Trade fungible tokens at fixed prices based on orders expressed in NFT commitments

<asset_category> <auth_category>

// pragma cashscript ^0.10.0;
// contract CatDex(bytes32 authCat, bytes32 assetCat){

    // function swap(){
    
        // If the first input has a minting baton (owner),
        //   the spending of outputs is unrestricted. 
        OP_0 OP_UTXOTOKENCATEGORY OP_OVER OP_2 OP_CAT OP_EQUAL OP_IF 
        // if(tx.inputs[0].tokenCategory == authCat + 0x02){
            // pass 
        // }

        // If the order input (even input) is a mutable auth Baton ... 
        OP_ELSE    
        // else{
            // Push the index of this order baton to the stack
            OP_INPUTINDEX OP_INPUTINDEX OP_2 OP_MOD OP_SUB 
            // int orderIndex = this.activeInputIndex - (this.activeInputIndex % 2);  

            // Require the order is mutable
            OP_DUP OP_UTXOTOKENCATEGORY OP_2 OP_PICK OP_1 OP_CAT OP_EQUALVERIFY 
            // require(tx.inputs[orderIndex].tokenCategory == authCat + 0x01 );

            // Require the mutable baton returns
            OP_DUP OP_OUTPUTTOKENCATEGORY OP_2 OP_PICK OP_1 OP_CAT OP_EQUALVERIFY 
            // require(tx.outputs[orderIndex].tokenCategory == authCat + 0x01);

            // Require the order baton be passed back to the contract
            OP_DUP OP_OUTPUTBYTECODE OP_OVER OP_UTXOBYTECODE OP_EQUALVERIFY 
            // require(tx.outputs[orderIndex].lockingBytecode == 
            //          tx.inputs[orderIndex].lockingBytecode);

            // Get the next index of the asset thread
            OP_DUP OP_1ADD 
            // int assetIndex = orderIndex + 1; 

            // Require the asset thread be sent at the current contract
            OP_DUP OP_OUTPUTBYTECODE OP_OVER OP_OUTPUTBYTECODE OP_EQUALVERIFY 
            // require(tx.outputs[assetIndex].lockingBytecode == 
            //         tx.outputs[assetIndex].lockingBytecode);                 
                        
            // if the amount of tokens is greater than zero,
            OP_DUP OP_OUTPUTTOKENAMOUNT OP_0 OP_GREATERTHAN OP_IF 
            // if(tx.outputs[assetIndex].tokenAmount > 0){
              // require the asset output contain token category specified by the order
              OP_DUP OP_OUTPUTTOKENCATEGORY OP_4 OP_PICK OP_EQUALVERIFY 
            //   require(tx.outputs[assetIndex].tokenCategory == assetCat);
            // } 
            OP_ENDIF 

            // Parse the order data from the NFT commitment
            OP_OVER OP_UTXOTOKENCOMMITMENT OP_16 OP_SPLIT 
            // bytes quantityBin, bytes priceBin = 
            //               tx.inputs[orderIndex].nftCommitment.split(16);

            OP_OVER OP_BIN2NUM 
            // int orderQuantity = int(quantityBin);  

            OP_OVER OP_BIN2NUM 
            // int price = int(priceBin);

            // Get the amount of the token traded
            OP_4 OP_PICK OP_OUTPUTTOKENAMOUNT OP_5 OP_PICK OP_UTXOTOKENAMOUNT OP_SUB 
            // int tradeQuantity = tx.outputs[assetIndex].tokenAmount - 
            //                      tx.inputs[assetIndex].tokenAmount;

            // Verify new authCat order baton NFT commitment
            OP_2 OP_PICK OP_OVER OP_SUB OP_16 OP_NUM2BIN OP_2 OP_PICK OP_16 OP_NUM2BIN OP_CAT 
            // bytes32 nextCommitment = bytes16(orderQuantity-tradeQuantity) + bytes16(price);

            // Require updating order baton
            OP_7 OP_PICK OP_OUTPUTTOKENCOMMITMENT OP_OVER OP_EQUALVERIFY 
            // require(tx.outputs[orderIndex].nftCommitment == nextCommitment);

            // require the sign of the quantity traded is matches the order sign  
            OP_OVER OP_0 OP_GREATERTHAN OP_4 OP_PICK OP_0 OP_GREATERTHAN OP_EQUAL OP_VERIFY
            // require((tradeQuantity > 0 == orderQuantity > 0)); 

            // require the amount traded be less than (or equal to) the quantity available
            OP_OVER OP_ABS OP_4 OP_PICK OP_ABS OP_LESSTHANOREQUAL OP_VERIFY 
            // require(abs(tradeQuantity) <= abs(orderQuantity));

            // Verify the value returned with the order exceeds the quantity traded times the price.
            OP_7 OP_PICK OP_OUTPUTVALUE OP_8 OP_PICK OP_UTXOVALUE OP_SUB
            OP_2OVER OP_SWAP OP_MUL <100_000_000> OP_DIV OP_NEGATE OP_NUMEQUALVERIFY 
            // require((tx.outputs[orderIndex].value - tx.inputs[orderIndex].value) == -(tradeQuantity*price/100_000_000));
            //
        // } 
        OP_2DROP OP_2DROP OP_2DROP OP_2DROP 
    // } 
    OP_ENDIF 
// } 
OP_2DROP OP_1`}},u0=["BCH_2024_05","BCH_2025_05"],f0={$schema:s0,description:c0,name:i0,entities:r0,scenarios:d0,scripts:l0,supported:u0},p0="@unspent/catdex",b0={name:p0};class m0{static USER_AGENT=b0.name;static PROTOCOL_IDENTIFIER="U3X";static tokenAware=!0;static template=f0;static compiler=j(this.template);static vm=e0();static getLockingBytecode(e,t){typeof e=="string"&&(e=l(T(e))),typeof t=="string"&&(t=l(T(t)));const a=this.compiler.generateBytecode({data:{bytecode:{auth_category:e,asset_category:t}},scriptId:"lock"});if(!a.success)throw new Error("Failed to generate bytecode, script: , "+JSON.stringify(a,null,"  "));return a.bytecode}static getScriptHash(e,t,a=!0){return J(this.getLockingBytecode(e,t),a)}static getAddress(e,t,a="bitcoincash"){return Z(this.getLockingBytecode(e,t),a,this.tokenAware)}static getSourceOutput(e,t,a){return{lockingBytecode:this.getLockingBytecode(e,t),valueSatoshis:BigInt(a.value),token:a.token_data?{category:l(a.token_data.category),amount:BigInt(a.token_data.amount),nft:a.token_data.nft?{commitment:l(a.token_data.nft.commitment),capability:a.token_data.nft.capability}:void 0}:void 0}}static parseNFT(e){let t=C(e.slice(0,16),{requireMinimalEncoding:!1}),a=C(e.slice(-16),{requireMinimalEncoding:!1});return{amount:BigInt(t),price:BigInt(a)}}static encodeNFT(e){return new Uint8Array([...R(L(e.amount),16),...R(L(e.price),16)])}static getInput(e,t,a){return typeof e=="string"&&(e=l(T(e))),typeof t=="string"&&(t=l(T(t))),{outpointIndex:a.tx_pos,outpointTransactionHash:l(a.tx_hash),sequenceNumber:0,unlockingBytecode:{data:{bytecode:{auth_category:e,asset_category:t}},compiler:this.compiler,script:"unlock",valueSatoshis:BigInt(a.value),token:a.token_data?{category:l(a.token_data.category),amount:BigInt(a.token_data.amount),nft:a.token_data.nft?{commitment:l(a.token_data.nft.commitment),capability:a.token_data.nft.capability}:void 0}:void 0}}}static getOutput(e,t,a,n){return{lockingBytecode:this.getLockingBytecode(e,t),valueSatoshis:BigInt(a.value)+n,token:{category:l(a.token_data.category),amount:BigInt(a.token_data?.amount)-BigInt(n)}}}static orderRequestToOutputs(e,t,a){let n=this.getLockingBytecode(e,t);typeof e=="string"&&(e=l(e)),typeof t=="string"&&(t=l(t));let c=800n,i=0n;a.amount<0&&(c+=BigInt(a.price*-a.amount)),a.amount>0&&(i+=BigInt(a.amount));const o=this.encodeNFT(a);return[{lockingBytecode:n,valueSatoshis:c,token:{category:e,amount:0n,nft:{commitment:o,capability:"mutable"}}},{lockingBytecode:this.getLockingBytecode(e,t),valueSatoshis:800n,token:{category:t,amount:i}}]}static getWalletSourceOutput(e,t,a=0){return{lockingBytecode:t?t0({addressIndex:a,hdPrivateKey:t,throwErrors:!0}):Uint8Array.from(Array(33)),valueSatoshis:BigInt(e.value),token:e.token_data?{category:l(e.token_data.category),amount:BigInt(e.token_data.amount),nft:e.token_data.nft?{commitment:l(e.token_data.nft.commitment),capability:e.token_data.nft.capability}:void 0}:void 0}}static getWalletInput(e,t,a=0){let n=t?{compiler:this.compiler,data:{hdKeys:{addressIndex:a,hdPrivateKeys:{wallet:t}}},script:"wallet_unlock",valueSatoshis:BigInt(e.value),token:e.token_data?{category:l(e.token_data.category),amount:BigInt(e.token_data.amount),nft:e.token_data.nft?{commitment:l(e.token_data.nft.commitment),capability:e.token_data.nft.capability}:void 0}:void 0}:Uint8Array.from(Array());return{outpointIndex:e.tx_pos,outpointTransactionHash:l(e.tx_hash),sequenceNumber:0,unlockingBytecode:n}}static getAuthWalletOutput(e,t,a=0){return{lockingBytecode:t?{compiler:this.compiler,data:{hdKeys:{addressIndex:a,hdPublicKeys:{wallet:D(t).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:BigInt(e.value),token:e.token_data?{category:l(e.token_data.category),amount:BigInt(e.token_data.amount),nft:e.token_data.nft?{commitment:l(e.token_data.nft.commitment),capability:e.token_data.nft.capability}:void 0}:void 0}}static getChangeOutput(e,t,a,n,c=0){return a&&typeof a!="string"&&(a=F(a)),{lockingBytecode:n?{compiler:this.compiler,data:{hdKeys:{addressIndex:c,hdPublicKeys:{wallet:D(n).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:e,token:t>0&&a?{category:l(a),amount:t}:void 0}}static getAuthLayers(e,t,a=0){let n=[],c=[],i=[];return i.push(this.getWalletSourceOutput(e,t,a)),n.push(this.getWalletInput(e,t,a)),c.push(this.getAuthWalletOutput(e,t,a)),{inputs:n,outputs:c,sourceOutputs:i}}static setBlackBoardLayers(e,t,a,n,c=[]){let i=[],o=[];return i.push(...a.map(s=>this.getInput(e,t,s))),c.push(...a.map(s=>this.getSourceOutput(e,t,s))),o.push(...n.map(s=>this.orderRequestToOutputs(e,t,s)).flat(1)),{inputs:i,outputs:o,sourceOutputs:c}}static getBlackBoardLayers(e,t,a=[]){let n=[],c=[];if(e.filter(s=>Math.sign(Number(s.amount))==Math.sign(Number(t))),e.length==0)throw Error("no orders left, maximum recursion depth reached.");const i=t>0?(s,d)=>s.price-d.price:(s,d)=>s.price+d.price;e.sort(i);const o=e.shift();if(n.push(this.getInput(o.authCategory,o.assetCategory,o.orderUtxo)),a.push(this.getSourceOutput(o.authCategory,o.assetCategory,o.orderUtxo)),n.push(this.getInput(o.authCategory,o.assetCategory,o.assetUtxo)),a.push(this.getSourceOutput(o.authCategory,o.assetCategory,o.assetUtxo)),o.amount<t)c.push(this.getOutput(o.authCategory,o.assetCategory,o.assetUtxo,t)),c.push(this.getOutput(o.authCategory,o.assetCategory,o.assetUtxo,t));else{t<0&&t<-o.amount&&(c.push(this.getOutput(o.authCategory,o.assetCategory,o.assetUtxo,-t)),t+=o.amount);let s=this.getBlackBoardLayers([...e],t,[...a]);n.push(...s.inputs),c.push(...s.outputs),a=s.sourceOutputs}return{inputs:n,outputs:c,sourceOutputs:a}}static getWalletInputs(e,t,a,n,c=[]){let i=[],o=[];if(n&&typeof n!="string"&&(n=F(n)),n?e=e.filter(r=>r.token_data&&r.token_data?.category==n):e=e.filter(r=>!r.token_data),e.length==0)throw Error("no wallet utxos left, maximum recursion depth reached.");const s=Math.floor(Math.random()*e.length),d=e[s];e.splice(s,1),i.push(this.getWalletInput(d,a)),c.push(this.getWalletSourceOutput(d,a));let f=h(c),u=g(c,n);if(n&&u<t||!n&&f<t){let r=this.getWalletInputs([...e],t,a,n,[...c]);i.push(...r.inputs),o.push(...r.outputs),c=r.sourceOutputs}return{inputs:i,outputs:o,sourceOutputs:c}}static getWalletLayers(e,t,a,n,c){let i=q(t.outputs),o=h(a),s=i-o,d=M(t.outputs,e),f=g(a,e),u=d-f;const r=this.getWalletInputs(n,s,c),y=this.getWalletInputs(n,u,c,e);t.inputs.push(...r.inputs),a.push(...r.sourceOutputs),t.inputs.push(...y.inputs),a.push(...y.sourceOutputs),i=q(t.outputs),o=h(a);let p=o-i;d=M(t.outputs,e),f=g(a,e);let b=f-d;return b>0&&(t.outputs.push(this.getChangeOutput(800n,b,e,c)),p-=800n),t.outputs.push(this.getChangeOutput(p,0n,void 0,c)),t}static administer(e,t,a,n,c,i,o=0,s=1){let u={locktime:0,version:2,inputs:[],outputs:[]},r=e.token_data.category;const y=this.getAuthLayers(e,i,o);u.inputs.push(...y.inputs),u.outputs.push(...y.outputs);let p=y.sourceOutputs;const b=this.setBlackBoardLayers(r,t,a,n);u.inputs.push(...b.inputs),u.outputs.push(...b.outputs),p.push(...b.sourceOutputs),u=this.getWalletLayers(t,u,p,c,i);let m=S(u);if(!m.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(m.errors,null,"  "));const _=V(m.transaction,s),O=u.outputs.length-1;if(u.outputs[O].valueSatoshis=u.outputs[O].valueSatoshis-_,m=S(u),!m.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(m.errors,null,"  "));const k=m.transaction,P=K(k,p,{maximumTokenCommitmentLength:40});if(P!==!0&&s>0)throw P;let v=this.vm.verify({sourceOutputs:p,transaction:k}),w=h(p)-h(k.outputs);w>5e3&&(v=`Excessive fees ${w}`),g(p,t)==0n&&(v="Error checking token input");let A=g(p,t)-g(k.outputs,t);return A!==0n&&(v=`Swapping should not create destroy tokens, token difference: ${A}`),{sourceOutputs:p,transaction:k,verify:v}}static swap(e,t,a,n,c=1){const i=[],o=[];let s=[];t[0].orderUtxo.token_data?.category;let d=t[0].assetUtxo.token_data?.category,f={locktime:0,version:2,inputs:i,outputs:o};a=a.filter(P=>P.token_data.category==d||!P.token_data);let u=this.getBlackBoardLayers(t,e,s);f.inputs.push(...u.inputs),f.outputs.push(...u.outputs),s=u.sourceOutputs,f=this.getWalletLayers(d,f,s,a,n);let r=S(f);if(!r.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(r.errors,null,"  "));const y=V(r.transaction,c),p=f.outputs.length-1;if(f.outputs[p].valueSatoshis=f.outputs[p].valueSatoshis-y,r=S(f),!r.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(r.errors,null,"  "));const b=r.transaction,m=K(b,s,{maximumTokenCommitmentLength:40});if(m!==!0&&c>0)throw m;let _=this.vm.verify({sourceOutputs:s,transaction:b}),O=h(s)-h(b.outputs);O>5e3&&(_=`Excessive fees ${O}`),g(s,d)==0n&&(_="Error checking token input");let k=g(s,d)-g(b.outputs,d);return k!==0n&&(_=`Swapping should not create destroy tokens, token difference: ${k}`),{sourceOutputs:s,transaction:b,verify:_}}}var g0=E('<img alt="Disconnected"/>'),y0=E('<section><div class="status svelte-1jejjaq"><!> <!></div> <!></section>');function E0(B,e){Q(e,!0);var t=y0(),a=U(t),n=U(a);z(n,{get template(){return m0.template}});var c=x(n,2);{var i=s=>{var d=g0();Y(()=>X(d,"src",$)),I(s,d)};G(c,s=>{s(i,!1)})}N(a);var o=x(a,2);o0(o),N(t),I(B,t),H()}export{E0 as component,I0 as universal};
//# sourceMappingURL=6.Wsnynttg.js.map
