{"version":3,"file":"9.QTerOyQH.js","sources":["../../../../../../src/routes/dutch/+page.ts","../../../../../../../dutch/out/index.js","../../../../../../src/routes/dutch/+page.svelte"],"sourcesContent":["export const prerender = true;","import template from './template.v3.json' with { type: \"json\" };\nimport packageInfo from '../package.json' with { type: \"json\" };\nimport { binToHex, createVirtualMachineBch, encodeTransactionBch, generateTransaction, hexToBin, verifyTransactionTokens, bigIntToVmNumber } from '@bitauth/libauth';\nimport { getAddress, getLibauthCompiler, getScriptHash, numToVm, } from '@unspent/tau';\nexport default class Dutch {\n    static USER_AGENT = packageInfo.name;\n    static PROTOCOL_IDENTIFIER = \"U3A\";\n    static tokenAware = true;\n    static template = template;\n    static compiler = getLibauthCompiler(this.template);\n    static vm = createVirtualMachineBch();\n    static dataToBytecode(data) {\n        return {\n            \"open\": numToVm(data.locktime),\n            \"recipient\": hexToBin(data.recipient)\n        };\n    }\n    static getLockingBytecode(open, recipient) {\n        if (typeof recipient == \"string\")\n            recipient = hexToBin(recipient);\n        const lockingBytecodeResult = this.compiler.generateBytecode({\n            data: {\n                \"bytecode\": {\n                    \"open\": bigIntToVmNumber(BigInt(open)),\n                    \"recipient\": recipient\n                }\n            },\n            scriptId: 'lock'\n        });\n        if (!lockingBytecodeResult.success)\n            throw new Error('Failed to generate bytecode, script: , ' + JSON.stringify(lockingBytecodeResult, null, '  '));\n        return lockingBytecodeResult.bytecode;\n    }\n    /**\n     * Get cashaddress\n     *\n     * @param open - opening ask.\n     * @param recipient - locking bytecode receiving funds.\n     * @param reversed - whether to reverse the hash.\n     * @throws {Error} if transaction generation fails.\n     * @returns a cashaddress.\n     */\n    static getScriptHash(open, recipient, reversed = true) {\n        return getScriptHash(this.getLockingBytecode(open, recipient), reversed);\n    }\n    /**\n     * Get cashaddress\n     *\n     * @param open - opening ask.\n     * @param recipient - locking bytecode receiving funds.\n     * @param prefix - cashaddress prefix.\n     * @throws {Error} if transaction generation fails.\n     * @returns a cashaddress.\n     */\n    static getAddress(open, recipient, prefix = \"bitcoincash\") {\n        return getAddress(this.getLockingBytecode(open, recipient), prefix, this.tokenAware);\n    }\n    static getSourceOutput(open, recipient, utxo) {\n        return {\n            lockingBytecode: this.getLockingBytecode(open, recipient),\n            valueSatoshis: BigInt(utxo.value)\n        };\n    }\n    static getInput(open, recipient, utxo) {\n        if (typeof recipient == \"string\")\n            recipient = hexToBin(recipient);\n        return {\n            outpointIndex: utxo.tx_pos,\n            outpointTransactionHash: hexToBin(utxo.tx_hash),\n            sequenceNumber: utxo.value,\n            unlockingBytecode: {\n                data: {\n                    \"bytecode\": {\n                        \"open\": bigIntToVmNumber(BigInt(open)),\n                        \"recipient\": recipient\n                    }\n                },\n                compiler: this.compiler,\n                script: 'unlock',\n                valueSatoshis: BigInt(utxo.value),\n            },\n        };\n    }\n    /**\n     * Get source outputs, transform contract & wallet outpoints for spending verification.\n     *\n     * @param contractUtxo - contract outputs to use as input.\n     * @param walletUtxo - wallet outputs to use as input.\n     * @param key - private key to sign transaction wallet inputs.\n     *\n     * @returns a transaction template.\n     */\n    static getSourceOutputs(open, recipient, valueUtxos) {\n        const sourceOutputs = [];\n        sourceOutputs.push(...valueUtxos.map((u) => this.getSourceOutput(open, recipient, u)));\n        return sourceOutputs;\n    }\n    /**\n     * Drop expired records.\n     *\n     * @param data - The parameters of the locktime contract.\n     * @param valueUtxos[] - contract records to drop.\n     *\n     * @throws {Error} if transaction generation fails.\n     * @returns a transaction template.\n     */\n    static bid(open, recipient, utxo) {\n        const inputs = [];\n        const outputs = [];\n        let config = {\n            locktime: 0,\n            version: 2,\n            inputs,\n            outputs\n        };\n        config.inputs.push(this.getInput(open, recipient, utxo));\n        //config.outputs.push(this.getOutput(open, recipient));\n        let result = generateTransaction(config);\n        if (!result.success)\n            throw new Error('generate transaction failed!, errors: ' + JSON.stringify(result.errors, null, '  '));\n        const sourceOutputs = [this.getSourceOutput(open, recipient, utxo)];\n        const transaction = result.transaction;\n        const tokenValidationResult = verifyTransactionTokens(transaction, sourceOutputs, { maximumTokenCommitmentLength: 40 });\n        if (tokenValidationResult !== true)\n            throw tokenValidationResult;\n        let verify = this.vm.verify({\n            sourceOutputs: sourceOutputs,\n            transaction: transaction,\n        });\n        if (typeof verify == \"string\")\n            throw verify;\n        return binToHex(encodeTransactionBch(transaction));\n    }\n}\n//# sourceMappingURL=index.js.map","<script lang=\"ts\">\n\timport Readme from './README.md';\n\n\timport BitauthLink from '$lib/BitauthLink.svelte';\n\timport CONNECTED from '$lib/images/connected.svg';\n\timport DISCONNECTED from '$lib/images/disconnected.svg';\n\n\timport Dutch from '@unspent/dutch';\n\n\tlet connectionStatus = $state('');\n</script>\n\n<section>\n\t<div class=\"status\">\n\t\t<BitauthLink template={Dutch.template} />\n\t\t{#if connectionStatus == 'CONNECTED'}\n\t\t\t<img src={CONNECTED} alt={connectionStatus} />\n\t\t{:else}\n\t\t\t<img src={DISCONNECTED} alt=\"Disconnected\" />\n\t\t{/if}\n\t</div>\n\n\t<Readme />\n</section>\n\n<style>\n\t.status {\n\t\ttext-align: end;\n\t}\n</style>\n"],"names":["prerender","Dutch","packageInfo","template","getLibauthCompiler","createVirtualMachineBch","data","numToVm","hexToBin","open","recipient","lockingBytecodeResult","bigIntToVmNumber","reversed","getScriptHash","prefix","getAddress","utxo","valueUtxos","sourceOutputs","u","config","result","generateTransaction","transaction","tokenValidationResult","verifyTransactionTokens","verify","binToHex","encodeTransactionBch","DISCONNECTED","$$render","alternate"],"mappings":"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"}