import{f as C,a as b,c as F0,t as Y0}from"../chunks/DIGK3fbx.js";import"../chunks/D2hU0Bvh.js";import{o as xt,a as Wt}from"../chunks/gevkG0Tn.js";import{v as J0,u as Q0,al as Ht,O as Et,i as Pt,a6 as Nt,aF as Ut,h as Lt,a0 as At,p as Dt,c as o,t as U,D as s,a as $t,n as T,C as g,s as i,K as j,r as c,f as Z}from"../chunks/D9HGzNEp.js";import{d as Mt,s as w}from"../chunks/DLwNFu-O.js";import{i as W}from"../chunks/CKOgfgCC.js";import{e as Z0,i as tt}from"../chunks/Clu73D2-.js";import{b as Vt,s as k,r as qt}from"../chunks/8RjDFi4k.js";import{p as et,i as zt}from"../chunks/C7cq5RI_.js";import{r as Kt}from"../chunks/B3x9nJtb.js";import{b as h0}from"../chunks/C4jED5RM.js";import{a as at,$ as st}from"../chunks/CQVT_UhJ.js";import{I as Rt,T as Xt,W as Gt,B as jt}from"../chunks/BgdkrN9n.js";import{i as M,j as Ft,k as Yt,l as lt,m as Jt,p as nt,t as r0,s as E0,a as m0,q as rt,r as Qt,v as Zt,B as te,x as ee,y as ae,z as ot,A as ct,C as se,D as ne}from"../chunks/DRpJvx58.js";import{h as re,g as oe}from"../chunks/DTryOclj.js";import{T as ce}from"../chunks/Dym7hIGf.js";function ie(n){var t=Ht,e=Et;J0(null),Q0(null);try{return n()}finally{J0(t),Q0(e)}}function le(n,t,e,p=e){n.addEventListener(t,()=>ie(e));const r=n.__on_r;r?n.__on_r=()=>{r(),p(!0)}:n.__on_r=()=>p(!0),Vt()}function de(n,t,e=t){var p=Pt();le(n,"input",r=>{var l=r?n.defaultValue:n.value;if(l=P0(n)?N0(l):l,e(l),p&&l!==(l=t())){var m=n.selectionStart,u=n.selectionEnd;n.value=l??"",u!==null&&(n.selectionStart=m,n.selectionEnd=Math.min(u,n.value.length))}}),(Lt&&n.defaultValue!==n.value||Nt(t)==null&&n.value)&&e(P0(n)?N0(n.value):n.value),Ut(()=>{var r=t();P0(n)&&r===N0(n.value)||n.type==="date"&&!r&&!n.value||r!==n.value&&(n.value=r??"")})}function P0(n){var t=n.type;return t==="number"||t==="range"}function N0(n){return n===""?null:+n}const sa=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),pe="data:image/svg+xml,%3csvg%20version='1.1'%20viewBox='0%200%2016%2016'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='a'%20x1='4.54e-7'%20x2='16'%20y1='8'%20y2='8'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23feccf2'%20offset='0'/%3e%3cstop%20stop-color='%23ffda95'%20offset='1'/%3e%3c/linearGradient%3e%3c/defs%3e%3ccircle%20cx='8'%20cy='8'%20r='8'%20fill='url(%23a)'%20stroke-width='0'/%3e%3ccircle%20cx='8'%20cy='8'%20r='6'%20fill='%2394ff94'%20stroke-width='0'/%3e%3cpath%20d='m7.96%201.07a6.93%206.93%200%200%200-6.89%206.93%206.93%206.93%200%200%200%206.93%206.93%206.93%206.93%200%200%200%206.93-6.93%206.93%206.93%200%200%200-6.93-6.93%206.93%206.93%200%200%200-0.0371%200zm-0.244%201.94%200.00391%200.00586c0.00188%200.00188%200.0847%200.303%200.186%200.67%200.101%200.366%200.186%200.668%200.189%200.67%200.00188%200.00284%200.0377-2.72e-4%200.082-0.00781%200.392-0.0697%200.847-0.0893%201.11-0.0488%200.633%200.0979%201.02%200.413%201.21%200.998%200.185%200.557%200.0921%201.02-0.283%201.41l-0.0684%200.0723h0.111c0.78%200%201.27%200.37%201.47%201.12%200.122%200.443%200.127%200.856%200.0137%201.2-0.0386%200.119-0.129%200.295-0.205%200.402-0.137%200.193-0.392%200.418-0.656%200.576-0.261%200.156-0.711%200.356-1.02%200.455-0.0282%200.0094-0.0548%200.0196-0.0586%200.0234-0.00376%200.0028%200.067%200.272%200.156%200.598%200.0904%200.327%200.174%200.633%200.187%200.68l0.0234%200.0859-0.402%200.109c-0.22%200.0603-0.405%200.109-0.41%200.109-0.00565%200-0.0918-0.299-0.191-0.666-0.101-0.367-0.183-0.669-0.184-0.67-9.58e-4%20-0.0019-0.136%200.0328-0.299%200.0762-0.163%200.0433-0.31%200.0822-0.326%200.0859-0.0169%200.0028-0.0312%200.012-0.0312%200.0176%200%200.0104%200.015%200.064%200.244%200.896%200.0669%200.244%200.121%200.443%200.119%200.445-9.58e-4%209.58e-4%20-0.185%200.0522-0.408%200.113l-0.404%200.111-0.00977-0.0293c-0.00565-0.016-0.0594-0.209-0.121-0.43-0.184-0.671-0.246-0.895-0.25-0.9-0.00284-0.0019-0.373%200.0977-0.826%200.221-0.453%200.123-0.824%200.224-0.826%200.223-0.00284-0.0028-0.105-0.98-0.105-1.01%200-0.016%200.00573-0.0226%200.0293-0.0273%200.0706-0.0132%200.527-0.136%200.592-0.16%200.0951-0.0358%200.17-0.109%200.191-0.184%200.0264-0.0894%200.0211-0.146-0.0391-0.367-0.0311-0.112-0.132-0.474-0.223-0.805-0.0913-0.331-0.225-0.816-0.297-1.08-0.0716-0.262-0.182-0.663-0.246-0.891-0.0631-0.228-0.132-0.484-0.154-0.57-0.0235-0.0857-0.0542-0.173-0.0684-0.197-0.0414-0.0725-0.105-0.13-0.18-0.166-0.0631-0.032-0.0782-0.0362-0.16-0.0391-0.126-0.00565-0.22%200.015-0.691%200.152-0.0763%200.0217-0.113%200.029-0.115%200.0215-0.00659-0.0188-0.232-0.849-0.234-0.857%200-0.00376%200.0827-0.0313%200.184-0.0586%200.101-0.0282%200.468-0.13%200.818-0.227%200.349-0.096%200.639-0.178%200.643-0.18%200.00376-0.00284-0.0765-0.304-0.178-0.67-0.101-0.365-0.18-0.67-0.178-0.674%200.00188-0.00565%200.0254-0.0149%200.0527-0.0215%200.0282-0.00753%200.208-0.0587%200.402-0.111%200.194-0.0537%200.355-0.0956%200.355-0.0938%209.58e-4%209.42e-4%200.083%200.295%200.182%200.654%200.0998%200.36%200.182%200.656%200.184%200.658%200.00188%200.00188%200.13-0.0329%200.285-0.0781%200.154-0.0452%200.298-0.0862%200.322-0.0938%200.033-0.00942%200.041-0.0161%200.0391-0.0293-0.00188-0.0104-0.081-0.301-0.176-0.648-0.0951-0.346-0.174-0.635-0.174-0.641%200-0.00847%200.809-0.235%200.816-0.229zm0.404%202.43c-0.214%200.00565-0.377%200.0308-0.641%200.0977-0.161%200.0395-0.572%200.159-0.58%200.168-0.00376%200.00376%200.117%200.456%200.404%201.5%200.0226%200.0819%200.0442%200.139%200.0508%200.139%200.00565%200%200.0846-0.0194%200.174-0.043%200.619-0.162%200.957-0.303%201.22-0.51%200.0913-0.0716%200.15-0.135%200.211-0.227%200.0565-0.0857%200.0826-0.153%200.102-0.262%200.0179-0.106%200.00619-0.221-0.0371-0.348-0.096-0.287-0.291-0.446-0.621-0.502-0.0772-0.0122-0.133-0.0145-0.281-0.00977l-0.00195-0.00391zm0.963%202.4c-0.239%200.00911-0.522%200.0561-0.854%200.141-0.213%200.0546-0.654%200.185-0.654%200.195%200%200.00376%200.109%200.408%200.244%200.898s0.246%200.892%200.246%200.895c0%200.00942%200.0198%200.0059%200.219-0.0469%200.874-0.229%201.35-0.443%201.63-0.74%200.0876-0.0923%200.123-0.142%200.168-0.238%200.0508-0.106%200.0655-0.174%200.0645-0.297%200-0.199-0.0736-0.394-0.201-0.529-0.187-0.199-0.465-0.292-0.861-0.277h-0.00195z'%20fill='%23800000'/%3e%3c/svg%3e",ue="data:image/svg+xml,%3csvg%20version='1.1'%20viewBox='0%200%2016%2016'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3clinearGradient%20id='a'%20x1='4.54e-7'%20x2='16'%20y1='8'%20y2='8'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23ccfed8'%20offset='0'/%3e%3cstop%20stop-color='%2395baff'%20offset='1'/%3e%3c/linearGradient%3e%3c/defs%3e%3cg%3e%3ccircle%20cx='8'%20cy='8'%20r='8'%20fill='url(%23a)'%20stroke-width='0'/%3e%3ccircle%20cx='8'%20cy='8'%20r='6'%20fill='%23ffa5bf'%20stroke-width='0'/%3e%3cpath%20d='m7.96%201.07a6.93%206.93%200%200%200-6.89%206.93%206.93%206.93%200%200%200%206.93%206.93%206.93%206.93%200%200%200%206.93-6.93%206.93%206.93%200%200%200-6.93-6.93%206.93%206.93%200%200%200-0.0371%200zm-0.244%201.94%200.00391%200.00586c0.00188%200.00188%200.0847%200.303%200.186%200.67%200.101%200.366%200.186%200.668%200.189%200.67%200.00188%200.00284%200.0377-2.72e-4%200.082-0.00781%200.392-0.0697%200.847-0.0893%201.11-0.0488%200.633%200.0979%201.02%200.413%201.21%200.998%200.185%200.557%200.0921%201.02-0.283%201.41l-0.0684%200.0723h0.111c0.78%200%201.27%200.37%201.47%201.12%200.122%200.443%200.127%200.856%200.0137%201.2-0.0386%200.119-0.129%200.295-0.205%200.402-0.137%200.193-0.392%200.418-0.656%200.576-0.261%200.156-0.711%200.356-1.02%200.455-0.0282%200.0094-0.0548%200.0196-0.0586%200.0234-0.00376%200.0028%200.067%200.272%200.156%200.598%200.0904%200.327%200.174%200.633%200.187%200.68l0.0234%200.0859-0.402%200.109c-0.22%200.0603-0.405%200.109-0.41%200.109-0.00565%200-0.0918-0.299-0.191-0.666-0.101-0.367-0.183-0.669-0.184-0.67-9.58e-4%20-0.0019-0.136%200.0328-0.299%200.0762-0.163%200.0433-0.31%200.0822-0.326%200.0859-0.0169%200.0028-0.0312%200.012-0.0312%200.0176%200%200.0104%200.015%200.064%200.244%200.896%200.0669%200.244%200.121%200.443%200.119%200.445-9.58e-4%209.58e-4%20-0.185%200.0522-0.408%200.113l-0.404%200.111-0.00977-0.0293c-0.00565-0.016-0.0594-0.209-0.121-0.43-0.184-0.671-0.246-0.895-0.25-0.9-0.00284-0.0019-0.373%200.0977-0.826%200.221-0.453%200.123-0.824%200.224-0.826%200.223-0.00284-0.0028-0.105-0.98-0.105-1.01%200-0.016%200.00573-0.0226%200.0293-0.0273%200.0706-0.0132%200.527-0.136%200.592-0.16%200.0951-0.0358%200.17-0.109%200.191-0.184%200.0264-0.0894%200.0211-0.146-0.0391-0.367-0.0311-0.112-0.132-0.474-0.223-0.805-0.0913-0.331-0.225-0.816-0.297-1.08-0.0716-0.262-0.182-0.663-0.246-0.891-0.0631-0.228-0.132-0.484-0.154-0.57-0.0235-0.0857-0.0542-0.173-0.0684-0.197-0.0414-0.0725-0.105-0.13-0.18-0.166-0.0631-0.032-0.0782-0.0362-0.16-0.0391-0.126-0.00565-0.22%200.015-0.691%200.152-0.0763%200.0217-0.113%200.029-0.115%200.0215-0.00659-0.0188-0.232-0.849-0.234-0.857%200-0.00376%200.0827-0.0313%200.184-0.0586%200.101-0.0282%200.468-0.13%200.818-0.227%200.349-0.096%200.639-0.178%200.643-0.18%200.00376-0.00284-0.0765-0.304-0.178-0.67-0.101-0.365-0.18-0.67-0.178-0.674%200.00188-0.00565%200.0254-0.0149%200.0527-0.0215%200.0282-0.00753%200.208-0.0587%200.402-0.111%200.194-0.0537%200.355-0.0956%200.355-0.0938%209.58e-4%209.42e-4%200.083%200.295%200.182%200.654%200.0998%200.36%200.182%200.656%200.184%200.658%200.00188%200.00188%200.13-0.0329%200.285-0.0781%200.154-0.0452%200.298-0.0862%200.322-0.0938%200.033-0.00942%200.041-0.0161%200.0391-0.0293-0.00188-0.0104-0.081-0.301-0.176-0.648-0.0951-0.346-0.174-0.635-0.174-0.641%200-0.00847%200.809-0.235%200.816-0.229zm0.404%202.43c-0.214%200.00565-0.377%200.0308-0.641%200.0977-0.161%200.0395-0.572%200.159-0.58%200.168-0.00376%200.00376%200.117%200.456%200.404%201.5%200.0226%200.0819%200.0442%200.139%200.0508%200.139%200.00565%200%200.0846-0.0194%200.174-0.043%200.619-0.162%200.957-0.303%201.22-0.51%200.0913-0.0716%200.15-0.135%200.211-0.227%200.0565-0.0857%200.0826-0.153%200.102-0.262%200.0179-0.106%200.00619-0.221-0.0371-0.348-0.096-0.287-0.291-0.446-0.621-0.502-0.0772-0.0122-0.133-0.0145-0.281-0.00977l-0.00195-0.00391zm0.963%202.4c-0.239%200.00911-0.522%200.0561-0.854%200.141-0.213%200.0546-0.654%200.185-0.654%200.195%200%200.00376%200.109%200.408%200.244%200.898%200.135%200.49%200.246%200.892%200.246%200.895%200%200.00942%200.0198%200.0059%200.219-0.0469%200.874-0.229%201.35-0.443%201.63-0.74%200.0876-0.0923%200.123-0.142%200.168-0.238%200.0508-0.106%200.0655-0.174%200.0645-0.297%200-0.199-0.0736-0.394-0.201-0.529-0.187-0.199-0.465-0.292-0.861-0.277h-0.00195z'%20fill='%234c7e7c'/%3e%3c/g%3e%3c/svg%3e",he="https://libauth.org/schemas/wallet-template-v0.schema.json",ve=`Wrapped BCH 
 https://gitlab.com/dagurval/wrapped-cash`,fe="Wrapped",ge={covenant:{description:"Wrapped BCH (WBCH) represents an equal amount of Bitcoin Cash (BCH), transforming it into a CashToken format on the Bitcoin Cash blockchain. This enables BCH to be used as a CashToken in smart contracts and decentralized applications on the Bitcoin Cash blockchain.",name:"Wrapped BCH Vault",scripts:["unlock"]},wallet:{description:"",name:"Unnamed Entity",scripts:["wallet_unlock","wallet_lock"],variables:{key:{description:"The private key that controls this wallet.",name:"Key",type:"HdKey"}}}},_e={inline:{description:"",name:"Swap thread",transaction:{inputs:[{unlockingBytecode:["slot"]}],outputs:[{lockingBytecode:{script:"lock"}}],version:2},sourceOutputs:[{lockingBytecode:["slot"]}]},swap:{description:"",name:"Swap WBCH for BCH",transaction:{inputs:[{unlockingBytecode:["slot"]},{unlockingBytecode:{script:"wallet_unlock"}}],outputs:[{lockingBytecode:{script:"lock"},valueSatoshis:2e3,token:{category:"ff4d6e4b90aa8158d39c5dc874fd9411af1ac3b5ed6f354755e8362a0d02c6b3",amount:98e3}},{lockingBytecode:{script:"wallet_lock"},valueSatoshis:1e3,token:{category:"ff4d6e4b90aa8158d39c5dc874fd9411af1ac3b5ed6f354755e8362a0d02c6b3",amount:1e3}}],locktime:0,version:2},sourceOutputs:[{lockingBytecode:["slot"],valueSatoshis:1e3,token:{category:"ff4d6e4b90aa8158d39c5dc874fd9411af1ac3b5ed6f354755e8362a0d02c6b3",amount:99e3}},{lockingBytecode:{script:"wallet_lock"},valueSatoshis:2e3}]}},me={unlock:{passes:["swap"],name:"Swap Wrapped BCH",script:"// empty",unlocks:"lock"},wallet_unlock:{name:"Wallet Unlock",script:"<key.schnorr_signature.all_outputs> <key.public_key>",unlocks:"wallet_lock"},lock:{lockingType:"p2sh32",name:"Wrapped BCH Covenant",script:`// pragma cashscript ^0.9.0;

// Wrap BCH as tokens
//
// Transaction form:
//      Inputs: 00-covenant
//      Outputs: 00-covenant
//
// Author: Dagur Valberg Johannsson <dagurval@pvv.ntnu.no>
// License: MIT

// contract WrapBCH() {

//     function wrapOrUnwrap() {
//         // Enforce that this contract lives on
           OP_INPUTINDEX OP_OUTPUTBYTECODE OP_INPUTINDEX OP_UTXOBYTECODE OP_EQUALVERIFY 
//         require(tx.outputs[this.activeInputIndex].lockingBytecode
//              == tx.inputs[this.activeInputIndex].lockingBytecode);

           // The token category must not change.
           OP_INPUTINDEX OP_OUTPUTTOKENCATEGORY OP_INPUTINDEX OP_UTXOTOKENCATEGORY OP_EQUALVERIFY 
//         require(tx.outputs[this.activeInputIndex].tokenCategory
//              == tx.inputs[this.activeInputIndex].tokenCategory);

           // The sum of tokens and sats in must equal the sum of tokena and sats out.
           OP_INPUTINDEX OP_UTXOTOKENAMOUNT OP_INPUTINDEX OP_UTXOVALUE OP_ADD 
           OP_INPUTINDEX OP_OUTPUTTOKENAMOUNT OP_INPUTINDEX OP_OUTPUTVALUE OP_ADD OP_NUMEQUAL
//         require(tx.inputs[this.activeInputIndex].tokenAmount + tx.inputs[this.activeInputIndex].value
//             == tx.outputs[this.activeInputIndex].tokenAmount + tx.outputs[this.activeInputIndex].value);
//     }
// }
`},wallet_lock:{lockingType:"standard",name:"Wallet Lock",script:"OP_DUP OP_HASH160 <$(<key.public_key> OP_HASH160)> OP_EQUALVERIFY OP_CHECKSIG"}},ke=["BCH_2023_05"],be={$schema:he,description:ve,name:fe,entities:ge,scenarios:_e,scripts:me,supported:ke},ye="@unspent/wrap",we={name:ye},U0=M("ff4d6e4b90aa8158d39c5dc874fd9411af1ac3b5ed6f354755e8362a0d02c6b3"),Be=M("bb61cd7a6c8a3a3742d965dc7ac73c1117382a5c8930b68338deb881f75c0214");class k0{static USER_AGENT=we.name;static tokenAware=!0;static template=be;static compiler=Ft(this.template);static vm=Yt();static getLockingBytecode(t={}){const e=this.compiler.generateBytecode({data:t,scriptId:"lock"});if(!e.success)throw new Error("Failed to generate bytecode, script: , "+JSON.stringify(e,null,"  "));return e.bytecode}static getScriptHash(t=!0){return lt(this.getLockingBytecode(),t)}static getAddress(t="bitcoincash"){return Jt(this.getLockingBytecode(),t,this.tokenAware)}static getSourceOutput(t){return{lockingBytecode:this.getLockingBytecode(),valueSatoshis:BigInt(t.value),token:{category:M(t.token_data.category),amount:BigInt(t.token_data?.amount)}}}static getInput(t){return{outpointIndex:t.tx_pos,outpointTransactionHash:M(t.tx_hash),sequenceNumber:0,unlockingBytecode:{compiler:this.compiler,script:"unlock"}}}static getOutput(t,e){return{lockingBytecode:{compiler:this.compiler,script:"lock"},valueSatoshis:BigInt(t.value)+e,token:{category:M(t.token_data.category),amount:BigInt(t.token_data?.amount)-BigInt(e)}}}static getWalletSourceOutput(t,e){return{lockingBytecode:e?re({addressIndex:0,hdPrivateKey:e}):Uint8Array.from(Array(33)),valueSatoshis:BigInt(t.value),token:t.token_data?{category:M(t.token_data.category),amount:BigInt(t.token_data?.amount)}:void 0}}static getWalletInput(t,e,p=0){let r=e?{compiler:this.compiler,data:{hdKeys:{addressIndex:p,hdPrivateKeys:{wallet:e}}},script:"wallet_unlock",valueSatoshis:BigInt(t.value)}:Uint8Array.from(Array());return t.token_data&&(r.token={amount:BigInt(t.token_data.amount),category:M(t.token_data.category)}),{outpointIndex:t.tx_pos,outpointTransactionHash:M(t.tx_hash),sequenceNumber:0,unlockingBytecode:r}}static getWrappedOutput(t,e,p=0,r=U0){return{lockingBytecode:e?{compiler:this.compiler,data:{hdKeys:{addressIndex:p,hdPublicKeys:{wallet:nt(e).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:800n,token:{category:r,amount:t}}}static getChangeOutput(t,e,p=0){return{lockingBytecode:e?{compiler:this.compiler,data:{hdKeys:{addressIndex:p,hdPublicKeys:{wallet:nt(e).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:t}}static getSourceOutputs(t,e,p){const r=[];return r.push(this.getSourceOutput(t)),r.push(...e.map(l=>this.getWalletSourceOutput(l,p))),r}static getVaultLayers(t,e,p,r=[]){let l=[],m=[];if(t=t.filter(y=>y.token_data?.category==r0(p)),e<0&&(t=t.filter(y=>y.value>800)),t.length==0)throw Error("no vault utxos left, maximum recursion depth reached.");const u=Math.floor(Math.random()*t.length),f=t[u];if(t.splice(u,1),l.push(this.getInput(f)),r.push(this.getSourceOutput(f)),e<0&&-f?.value<e||e>0&&BigInt(f?.token_data?.amount)>e)m.push(this.getOutput(f,BigInt(e)));else{e<0&&e<-(f?.value-800)&&(m.push(this.getOutput(f,-BigInt(f?.value-800))),e+=f?.value-800);let y=this.getVaultLayers([...t],e,p,[...r]);l.push(...y.inputs),m.push(...y.outputs),r=y.sourceOutputs}return{inputs:l,outputs:m,sourceOutputs:r}}static getWalletLayers(t,e,p,r,l=[]){let m=[],u=[];if(e>0&&(t=t.filter(_=>!_.token_data)),e<0&&(t=t.filter(_=>_.token_data?.category==r0(r))),t.length==0)throw Error("no wallet utxos left, maximum recursion depth reached.");const f=Math.floor(Math.random()*t.length),y=t[f];t.splice(f,1),m.push(this.getWalletInput(y,p)),l.push(this.getWalletSourceOutput(y,p));let h=E0(l),H=m0(l,r0(r));if(e<0&&H>=-e||e>0&&h>e){e>0&&u.push(this.getWrappedOutput(e,p,0,r)),e<0&&u.push(this.getWrappedOutput(H+e,p,0,r));let _=h-(e+800n);u.push(this.getChangeOutput(_,p))}else{let _=this.getWalletLayers([...t],e,p,r,[...l]);m.push(..._.inputs),u.push(..._.outputs),l=_.sourceOutputs}return{inputs:m,outputs:u,sourceOutputs:l}}static swap(t,e,p,r,l,m=1){const u=[],f=[];let y=l?M(l):U0,h={locktime:0,version:2,inputs:u,outputs:f};p=p.filter(a0=>a0.token_data?.category==l||!a0.token_data);let H=this.getVaultLayers([...e],t,y);h.inputs.push(...H.inputs),h.outputs.push(...H.outputs);let _=H.sourceOutputs,t0=this.getWalletLayers([...p],BigInt(t),r,y);h.inputs.push(...t0.inputs),h.outputs.push(...t0.outputs),_.push(...t0.sourceOutputs);let E=rt(h);if(!E.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(E.errors,null,"  "));const e0=Qt(E.transaction,m),F=h.outputs.length-1;if(h.outputs[F].valueSatoshis=h.outputs[F].valueSatoshis-e0,E=rt(h),!E.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(E.errors,null,"  "));const V=E.transaction,q=Zt(V,_);if(q!==!0&&m>0)throw q;let P=this.vm.verify({sourceOutputs:_,transaction:V}),L=E0(_)-E0(V.outputs);L>5e3&&(P=`Excessive fees ${L}`),m0(_,l)==0n&&(P="Error checking token input");let o0=m0(_,l)-m0(V.outputs,l);return o0!==0n&&(P=`Swapping should not create destroy tokens, token difference: ${o0}`),{sourceOutputs:_,transaction:V,verify:P}}}var Te=C('<h1>About Wrapped BCH</h1> <p>Wrapped Bitcoin Cash (WBCH) are fungible CashTokens redeemable 1:1 for Bitcoin Cash.</p> <p><a href="https://wrapped.cash" rel="nofollow">Wrapped BCH (WBCH)</a> was created by Dagur Valberg Johannsson in <a href="https://bitcoincashresearch.org/t/wbch-bch-wrapped-as-cash-token/1196" rel="nofollow">November 2023</a>.</p> <p>All 21M WBCH minted were sent to an immutable vault contract as 21 outputs, each with 1M WBCH.</p> <p>The Wrapped BCH contract enforces three conditions:</p> <ol><li>The token id MUST not change.</li> <li>An output being spent from the contract MUST return to the contract.</li> <li>The sum of tokens and sats <em>in</em> MUST equal the sum of tokens and satoshis <em>out</em>.</li></ol> <p>These three rules ensure that when tokens are spent from the contract, each must swap an equal amount of Bitcoin Cash in a corresponding output.</p> <p>Notice how WBCH token category (id) isn’t in the contract rules? That’s right. The contract will enforce a 1:1 peg with any token, not just “official” WBCH tokens.</p> <p>Anyone may send any fungible token to the contract, but that doesn’t make it WBCH. So there is one more <strong>important</strong> condition needed to make the Wrapped BCH fair.  Dagur minted a fungible token with 21M tokens (8 decimals) and sent the entire supply to the vault contract.</p> <p>To <strong>verify</strong> that WBCH is fair, we can lookup the pre-genesis transaction:</p> <p><a href="https://explorer.salemkode.com/tx/ff4d6e4b90aa8158d39c5dc874fd9411af1ac3b5ed6f354755e8362a0d02c6b3" rel="nofollow">WBCH pre-genesis transactoin</a></p> <p>… the first output was the coin used to mint all WBCH tokens.</p> <p>The minting transaction was in the next transaction:</p> <p><a href="https://explorer.salemkode.com/tx/110dc94c0aa1a4c60ff4738eeee7f931d8f11086190281f43cf3330419d918c8" rel="nofollow">WBCH minting transaction</a></p> <p>The minting transaction created one wrapped satoshi for every bitcoin (cash) satoshi.</p> <p>Given the total minted supply of 21 WBCH sats, we do NOT need to do forensic blockchain analysis or prove a chain of custody of each token from genesis to the WBCH vault, we can just check that the total balance of WBCH on the vault is equal to the total supply of the fungible token, minus BCH locked on WBCH outputs.</p>',1);function Ce(n){var t=Te();At(30),b(n,t)}var it=Kt(()=>jt),Oe=C("<img/>"),Ie=C('<img alt="Disconnected"/>'),Se=(n,t)=>t(),xe=(n,t,e)=>t(s(e)),We=C('<div class="swap svelte-5fcp3n"><div class="svelte-5fcp3n"><!></div></div> <div class="swap svelte-5fcp3n"><button class="svelte-5fcp3n">Broadcast</button></div>',1),He=C(' <img width="15" alt="wbchLogo"/>',1),Ee=C('<tr class="svelte-5fcp3n"><td class="sats svelte-5fcp3n"> <img width="15" alt="bchLogo"/></td><td class="sats svelte-5fcp3n"><!></td></tr>'),Pe=C('<h4>Wallet Unspent Transaction Outputs (coins)</h4> <table><thead class="svelte-5fcp3n"><tr class="header svelte-5fcp3n"><td class="svelte-5fcp3n">BCH</td><td class="svelte-5fcp3n">WBCH</td></tr><tr class="units svelte-5fcp3n"><td class="r svelte-5fcp3n">sats</td><td class="r svelte-5fcp3n">sats</td></tr></thead><tbody class="svelte-5fcp3n"><!><tr style="border-top: solid thin;" class="svelte-5fcp3n"><td class="r svelte-5fcp3n"><b> </b> <img width="15" alt="bchLogo"/></td><td class="r svelte-5fcp3n"><b> </b> <img width="15" alt="wbchLogo"/></td></tr></tbody></table>',1),Ne=(n,t)=>t(),Ue=C('<p>No connection ?</p> <div class="swap svelte-5fcp3n"><button class="svelte-5fcp3n">Reconnect</button></div>',1),Le=C("<p>Wallet has no coins or wrapped coins to swap?</p>"),Ae=C('<tr class="svelte-5fcp3n"><td class="sats svelte-5fcp3n"> <img width="15" alt="bchLogo"/></td><td class="sats svelte-5fcp3n"> <img width="15" alt="wbchLogo"/></td></tr>'),De=C('<h4> </h4> <table><thead class="svelte-5fcp3n"><tr class="header svelte-5fcp3n"><td class="svelte-5fcp3n">BCH</td><td class="svelte-5fcp3n">WBCH</td></tr><tr class="units svelte-5fcp3n"><td class="r svelte-5fcp3n">sats</td><td class="r svelte-5fcp3n">sats</td></tr></thead><tbody class="svelte-5fcp3n"><!><tr style="border-top: solid thin;" class="svelte-5fcp3n"><td class="r svelte-5fcp3n"><b> </b> <img width="15" alt="bchLogo"/></td><td class="r svelte-5fcp3n"><b> </b> <img width="15" alt="wbchLogo"/></td></tr></tbody></table>',1),$e=C("<p>... getting wrapped vault threads.</p>"),Me=C('<section><div class="status svelte-5fcp3n"><!> <!></div> <h1>Wrap Bitcoin Cash as a CashToken</h1> <div class="swap svelte-5fcp3n"><div class="svelte-5fcp3n"><img width="50"/> <br/> <b> </b></div> <div class="svelte-5fcp3n"><img width="50"/> <br/> <b> </b></div></div> <div class="swap svelte-5fcp3n"><input style="width:100%;" type="range" step="1000" class="svelte-5fcp3n"/></div> <!> <!> <div class="grid"><!></div> <div class="grid"><!></div> <!></section>');function na(n,t){Dt(t,!1);let e=T(""),p=T(""),r=T(void 0),l=T(!1),m=T(void 0),u=T([]),f=T([]),y="",h,H="",_="",t0=T(0n),E=T(0),e0=T(0n),F=T(0);H=k0.getScriptHash();let V="";const q=et.url.hostname=="vox.cash";let P=q?ue:pe,L=q?r0(U0):r0(Be),o0=q?"BCH":"tBCH",a0=q?"WBCH":"tWBCH",L0=q?"bch.imaginary.cash":"chipnet.bch.ninja",A0=new Set,z=T(0),c0,b0=T("");const dt=function(a){a.method==="blockchain.scripthash.subscribe"?a.params[1]!==V&&(V=a.params[1],g(e,st[h.status]),g(z,0),$0(),D0()):console.log(a)},D0=async function(){let a=await h.request("blockchain.scripthash.listunspent",_,"include_tokens");if(a instanceof Error)throw a;let d=new Set(a.map(v=>`${v.tx_hash}":"${v.tx_pos}`));(s(f).length==0||A0.intersection(d).size==0)&&g(f,a),g(F,ot(s(f),!0)),g(e0,ct(s(f),L))},$0=async function(){let a=await h.request("blockchain.scripthash.listunspent",H,"include_tokens");if(a instanceof Error)throw a;let d=new Set(a.map(v=>`${v.tx_hash}":"${v.tx_pos}`));(s(u).length==0||A0.intersection(d).size==0)&&g(u,a),g(u,s(u).filter(v=>v.token_data&&v.token_data.category==L)),g(E,ot(s(u),!0)),g(t0,ct(s(u),L))},pt=async function(a){let d=await h.request("blockchain.transaction.broadcast",a);if(d instanceof Error)throw g(e,st[h.status]),d},ut=function(){try{let a=k0.swap(s(z),s(u),s(f),y,L);g(r,a.transaction),g(m,a.sourceOutputs),g(p,r0(ee(s(r)))),g(l,a.verify===!0),a.verify===!0&&g(b0,"")}catch(a){g(r,void 0),g(m,void 0),g(p,""),g(l,!1),g(b0,a)}},ht=async function(){await h.connect()};xt(async()=>{const a=et.url.hostname!=="vox.cash";it(it().StorageProvider=Rt),c0=a?await Xt.named("vox"):await Gt.named("vox"),y=oe(c0.mnemonic,c0.derivationPath.slice(0,-2),c0.isTestnet);let d=ae(c0.getDepositAddress());if(typeof d=="string")throw d;_=lt(d.bytecode),h=new at("unspent/wrap","1.4.1",L0),await h.connect(),h.on("notification",dt),await h.subscribe("blockchain.scripthash.subscribe",H),$0(),D0()}),Wt(async()=>{await new at(k0.USER_AGENT,"1.4.1",L0).disconnect()}),zt();var y0=Me(),w0=o(y0),M0=o(w0);{var vt=a=>{var d=Oe();U(()=>{k(d,"src",se),k(d,"alt",s(e))}),b(a,d)},ft=a=>{var d=Ie();U(()=>k(d,"src",ne)),b(a,d)};W(M0,a=>{s(e)=="CONNECTED"?a(vt):a(ft,!1)})}var gt=i(M0,2);te(gt,{get template(){return k0.template}}),c(w0);var B0=i(w0,4),T0=o(B0),C0=o(T0),V0=i(C0,3),q0=i(V0),_t=o(q0,!0);c(q0),c(T0);var z0=i(T0,2),O0=o(z0),K0=i(O0,3),R0=i(K0),mt=o(R0,!0);c(R0),c(z0),c(B0);var I0=i(B0,2),i0=o(I0);qt(i0),i0.__change=[Se,ut],c(I0);var X0=i(I0,2);{var kt=a=>{var d=We(),v=Z(d),A=o(v),B=o(A);{var O=I=>{var D=Y0();U($=>w(D,`place: ${$??""} sats`),[()=>s(z).toLocaleString()],j),b(I,D)},S=(I,D)=>{{var $=K=>{var R=Y0();U(J=>w(R,`redeem: ${J??""} wrapped sats`),[()=>(-s(z)).toLocaleString()],j),b(K,R)};W(I,K=>{s(z)<0&&K($)},D)}};W(B,I=>{s(z)>0?I(O):I(S,!1)})}c(A),c(v);var x=i(v,2),Y=o(x);Y.__click=[xe,pt,p],c(x),b(a,d)};W(X0,a=>{s(r)&&s(l)&&a(kt)})}var G0=i(X0,2);{var bt=a=>{ce(a,{get transaction(){return s(r)},get sourceOutputs(){return s(m)}})};W(G0,a=>{s(r)&&a(bt)})}var j0=i(G0),S0=i(j0),yt=o(S0);{var wt=a=>{var d=Pe(),v=i(Z(d),2),A=i(o(v)),B=o(A);Z0(B,1,()=>s(f),tt,(J,N)=>{var s0=F0(),X=Z(s0);{var v0=l0=>{var d0=Ee(),Q=o(d0),n0=o(Q),p0=i(n0);c(Q);var u0=i(Q),W0=o(u0);{var f0=G=>{var g0=He(),_0=Z(g0),H0=i(_0);U(St=>{w(_0,`${St??""} `),k(H0,"src",P)},[()=>Number(s(N).token_data.amount).toLocaleString()],j),b(G,g0)};W(W0,G=>{s(N).token_data&&G(f0)})}c(u0),c(d0),U(G=>{w(n0,`${G??""} `),k(p0,"src",h0)},[()=>Number(s(N).value-800).toLocaleString()],j),b(l0,d0)};W(X,l0=>{(s(N).token_data&&s(N).token_data.category==L||!s(N).token_data)&&l0(v0)})}b(J,s0)});var O=i(B),S=o(O),x=o(S),Y=o(x,!0);c(x);var I=i(x,2);c(S);var D=i(S),$=o(D),K=o($,!0);c($);var R=i($,2);c(D),c(O),c(A),c(v),U((J,N)=>{w(Y,J),k(I,"src",h0),w(K,N),k(R,"src",P)},[()=>s(F).toLocaleString(),()=>Number(s(e0)).toLocaleString()],j),b(a,d)},Bt=(a,d)=>{{var v=B=>{var O=Ue(),S=i(Z(O),2),x=o(S);x.__click=[Ne,ht],c(S),b(B,O)},A=B=>{var O=Le();b(B,O)};W(a,B=>{s(e)!="CONNECTED"?B(v):B(A,!1)},d)}};W(yt,a=>{s(f).length>0?a(wt):a(Bt,!1)})}c(S0);var x0=i(S0,2),Tt=o(x0);{var Ct=a=>{var d=De(),v=Z(d),A=o(v);c(v);var B=i(v,2),O=i(o(B)),S=o(O);Z0(S,1,()=>s(u),tt,(s0,X)=>{var v0=F0(),l0=Z(v0);{var d0=Q=>{var n0=Ae(),p0=o(n0),u0=o(p0),W0=i(u0);c(p0);var f0=i(p0),G=o(f0),g0=i(G);c(f0),c(n0),U((_0,H0)=>{w(u0,`${_0??""} `),k(W0,"src",h0),w(G,`${H0??""} `),k(g0,"src",P)},[()=>Number(s(X).value-800).toLocaleString(),()=>Number(s(X).token_data.amount).toLocaleString()],j),b(Q,n0)};W(l0,Q=>{s(X).token_data&&s(X).token_data.category==L&&Q(d0)})}b(s0,v0)});var x=i(S),Y=o(x),I=o(Y),D=o(I,!0);c(I);var $=i(I,2);c(Y);var K=i(Y),R=o(K),J=o(R,!0);c(R);var N=i(R,2);c(K),c(x),c(O),c(B),U((s0,X)=>{w(A,`${a0} Vault Threads`),w(D,s0),k($,"src",h0),w(J,X),k(N,"src",P)},[()=>s(E).toLocaleString(),()=>Number(s(t0)).toLocaleString()],j),b(a,d)},Ot=a=>{var d=$e();b(a,d)};W(Tt,a=>{s(u).length>0?a(Ct):a(Ot,!1)})}c(x0);var It=i(x0,2);Ce(It),c(y0),U((a,d,v)=>{k(C0,"src",h0),k(C0,"alt",o0),w(V0,` ${a??""} `),w(_t,o0),k(O0,"src",P),k(O0,"alt",a0),w(K0,` ${d??""} `),w(mt,a0),k(i0,"min",v),k(i0,"max",s(F)-2e3),w(j0,` ${s(b0)??""} `)},[()=>s(F).toLocaleString(),()=>s(e0).toLocaleString(),()=>Number(-s(e0))],j),de(i0,()=>s(z),a=>g(z,a)),b(n,y0),$t()}Mt(["change","click"]);export{na as component,sa as universal};
//# sourceMappingURL=9.DI9BKeVL.js.map
