import{f as m,a as _,t as Ze}from"../chunks/DTc5U4eY.js";import{o as C0,a as N0}from"../chunks/_R59KZhj.js";import{e as r0,P as R0,aM as q0,aN as D0,p as wt,aA as _e,f as re,s as c,c as d,r as o,I as t,t as V,a as Bt,af as L0,aB as S,ao as be,ak as f,ay as z0}from"../chunks/CQU5mOuk.js";import{l as M0,s as N,d as j0,h as F0}from"../chunks/CF3aPdyL.js";import{i as C}from"../chunks/CZ0rTjPC.js";import{e as de,i as ue}from"../chunks/CbL2L94E.js";import{r as je,s as se}from"../chunks/-rOGAMhN.js";import{a as ht,b as kt}from"../chunks/Oj09dCTU.js";import{s as $e}from"../chunks/DBDCTY7c.js";import{g as H0}from"../chunks/DmsRn8JN.js";import{p as V0}from"../chunks/D9gdW5AE.js";import{a as W0}from"../chunks/DbZRqWAN.js";import{q as ie,D as Z,g as K0,h as U,d as i0,e as Y0,b as Ae,J as Kt,K as Yt,t as Qt,B as Gt,H as Xt,L as Jt,f as et,C as Zt,v as $t,p as Ot,j as Q0,n as xt,s as e0,k as t0,l as G0}from"../chunks/BQUio51k.js";/* empty css                */import{c as X0}from"../chunks/q36Eg1F8.js";import{s as J0}from"../chunks/CXfu__Ha.js";import{B as c0,t as l0}from"../chunks/B2Xzehbr.js";import{i as Z0,l as $0}from"../chunks/Bt3MikUi.js";/* empty css                */import{T as Ge}from"../chunks/otdWaXgM.js";import{h as ea,I as ta,B as aa,W as na,T as oa,g as sa,b as ra,N as a0}from"../chunks/BTBIn4-B.js";import{B as ia,t as ca}from"../chunks/B-JAlK32.js";import"../chunks/CuzQ0eOn.js";import{c as la}from"../chunks/DGwzT_kg.js";import{S as tt}from"../chunks/zv45hi4S.js";import{B as da}from"../chunks/BzLj6JBc.js";import{C as ua}from"../chunks/B7hCbxZp.js";import{D as va}from"../chunks/DMvn4Q5j.js";import{$ as fa,a as n0}from"../chunks/BDt1pbpk.js";function d0(b,e,a){if(b.multiple){if(e==null)return;if(!R0(e))return q0();for(var n of b.options)n.selected=e.includes(Xe(n));return}for(n of b.options){var s=Xe(n);if(D0(s,e)){n.selected=!0;return}}(!a||e!==void 0)&&(b.selectedIndex=-1)}function pa(b,e){r0(()=>{var a=new MutationObserver(()=>{var n=b.__value;d0(b,n)});return a.observe(b,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{a.disconnect()}})}function ba(b,e,a=e){var n=!0;M0(b,"change",s=>{var r=s?"[selected]":":checked",p;if(b.multiple)p=[].map.call(b.querySelectorAll(r),Xe);else{var l=b.querySelector(r)??b.querySelector("option:not([disabled])");p=l&&Xe(l)}a(p)}),r0(()=>{var s=e();if(d0(b,s,n),n&&s===void 0){var r=b.querySelector(":checked");r!==null&&(s=Xe(r),a(s))}b.__value=s,n=!1}),pa(b)}function Xe(b){return"__value"in b?b.__value:b.value}var _a=m("<i> </i>"),ya=m("<i>0</i>"),ma=m('<tr class="svelte-1oaaxak"><td class="r sats svelte-1oaaxak"> </td><td class="r sats svelte-1oaaxak"><!></td></tr>'),ga=m("<i> </i>"),ha=m("<i>0</i>"),ka=m('<tr class="svelte-1oaaxak"><td class="r sats svelte-1oaaxak"> </td><td class="r sats svelte-1oaaxak"><!></td></tr>'),Oa=m(' <br/> <div class="twoUp svelte-1oaaxak"><div class="svelte-1oaaxak"><h4>Inputs</h4> <table class="svelte-1oaaxak"><thead class="r svelte-1oaaxak"><tr class="svelte-1oaaxak"><td class="svelte-1oaaxak">Sats</td><td class="svelte-1oaaxak">Tokens</td></tr></thead><tbody class="svelte-1oaaxak"></tbody><tfoot class="svelte-1oaaxak"><tr><td class="r svelte-1oaaxak"> </td><td class="r svelte-1oaaxak"><i> </i></td></tr></tfoot></table></div> <div class="svelte-1oaaxak"><h4>Outputs</h4> <table class="svelte-1oaaxak"><thead class="r svelte-1oaaxak"><tr class="svelte-1oaaxak"><td class="svelte-1oaaxak">Sats</td><td class="svelte-1oaaxak">Tokens</td></tr></thead><tbody class="svelte-1oaaxak"></tbody><tfoot class="svelte-1oaaxak"><tr><td class="r svelte-1oaaxak"> </td><td class="r svelte-1oaaxak"><i> </i></td></tr></tfoot></table></div></div> <h4>Difference</h4> <table class="svelte-1oaaxak"><thead class="r svelte-1oaaxak"><tr class="svelte-1oaaxak"><td class="svelte-1oaaxak">Sats</td><td class="svelte-1oaaxak">Tokens</td></tr></thead><tfoot class="svelte-1oaaxak"><tr><td class="r svelte-1oaaxak"> </td><td class="r svelte-1oaaxak"><i> </i></td></tr></tfoot></table>',1);function xa(b,e){wt(e,!0),_e();var a=Oa(),n=re(a),s=c(n,2),r=c(s),p=d(r),l=c(d(p),2),u=c(d(l));de(u,21,()=>e.sourceOutputs,ue,(ye,ae)=>{var R=ma(),q=d(R),xe=d(q,!0);o(q);var ee=c(q),we=d(ee);{var Fe=M=>{var Q=_a(),He=d(Q,!0);o(Q),V(Be=>N(He,Be),[()=>t(ae).token.amount.toLocaleString()]),_(M,Q)},Ce=M=>{var Q=ya();_(M,Q)};C(we,M=>{t(ae).token?M(Fe):M(Ce,!1)})}o(ee),o(R),V(M=>N(xe,M),[()=>t(ae).valueSatoshis.toLocaleString()]),_(ye,R)}),o(u);var x=c(u),B=d(x),y=d(B),w=d(y,!0);o(y);var g=c(y),P=d(g),j=d(P,!0);o(P),o(g),o(B),o(x),o(l),o(p);var A=c(p,2),D=c(d(A),2),I=c(d(D));de(I,21,()=>e.transaction.outputs,ue,(ye,ae)=>{var R=ka(),q=d(R),xe=d(q,!0);o(q);var ee=c(q),we=d(ee);{var Fe=M=>{var Q=ga(),He=d(Q,!0);o(Q),V(Be=>N(He,Be),[()=>t(ae).token.amount.toLocaleString()]),_(M,Q)},Ce=M=>{var Q=ha();_(M,Q)};C(we,M=>{t(ae).token?M(Fe):M(Ce,!1)})}o(ee),o(R),V(M=>N(xe,M),[()=>t(ae).valueSatoshis.toLocaleString()]),_(ye,R)}),o(I);var L=c(I),Y=d(L),z=d(Y),ce=d(z,!0);o(z);var le=c(z),ve=d(le),Ue=d(ve,!0);o(ve),o(le),o(Y),o(L),o(D),o(A),o(r);var ge=c(r,4),he=c(d(ge)),ke=d(he),fe=d(ke),$=d(fe);o(fe);var Oe=c(fe),Je=d(Oe),nt=d(Je);o(Je),o(Oe),o(ke),o(he),o(ge),V((ye,ae,R,q,xe,ee)=>{N(n,`Locktime: ${e.transaction.locktime??""}`),N(s,` Version: ${e.transaction.version??""} `),N(w,ye),N(j,ae),N(ce,R),N(Ue,q),N($,`Fee:
				${xe??""}`),N(nt,`Burned:
					${ee??""}`)},[()=>ie(e.sourceOutputs).toLocaleString(),()=>Z(e.sourceOutputs,e.category).toLocaleString(),()=>ie(e.transaction.outputs).toLocaleString(),()=>Z(e.transaction.outputs,e.category).toLocaleString(),()=>(ie(e.sourceOutputs)-ie(e.transaction.outputs)).toLocaleString(),()=>(Z(e.sourceOutputs,e.category)-Z(e.transaction.outputs,e.category)).toLocaleString()]),_(b,a),Bt()}const wa=!0,Ba=({params:b,url:e})=>({asset:e.searchParams.get("asset")}),Zn=Object.freeze(Object.defineProperty({__proto__:null,load:Ba,prerender:wa},Symbol.toStringTag,{value:"Module"}));var Pa=m('<div class="auth svelte-2vt4ng"><!></div> <div class="price svelte-2vt4ng"> </div> <div class="quantity svelte-2vt4ng"> <!></div>',1),Ta=m('<div><div class="post svelte-2vt4ng"><div class="balance svelte-2vt4ng"><div class="order svelte-2vt4ng"><!></div></div></div></div>');function at(b,e){wt(e,!0);let a=L0(()=>e.quantity>0);e.isMainnet?c0:l0;var n=Ta(),s=d(n),r=d(s),p=d(r),l=d(p);{var u=x=>{var B=Pa(),y=re(B),w=d(y);Ge(w,{size:20,get category(){return e.orderUtxo.token_data.category}}),o(y);var g=c(y,2),P=d(g,!0);o(g);var j=c(g,2),A=d(j),D=c(A);Ge(D,{size:20,get category(){return e.assetCategory},get isMainnet(){return e.isMainnet}}),o(j),V((I,L)=>{N(P,I),N(A,`${L??""} `)},[()=>Number(e.price).toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:6}),()=>Number(e.quantity).toLocaleString(void 0,{}).padStart(12)]),_(x,B)};C(l,x=>{e.orderUtxo&&x(u)})}o(p),o(r),o(s),o(n),V(()=>J0(n,1,X0(["container",{bid:t(a)}]),"svelte-2vt4ng")),_(b,n),Bt()}var Sa=m('<h3>About CatDex</h3> <p>Category Decentralized Exchange is a protocol to exchange assets using orders stored on non-fungible token commitments.</p> <p>More information about <a href="https://bitcoincashresearch.org/t/catdex-a-token-category-authorized-decentralized-exchange/1480" rel="nofollow">the contract.</a></p>',1);function Ia(b){var e=Sa();_e(4),_(b,e)}const Ea="https://libauth.org/schemas/wallet-template-v0.schema.json",Aa="CatDex: a bi-directional limit order CashToken exchange.",Ua="CatDex",Ca={covenant:{description:`A CatDex blackboard contract holds limit orders and token treads for trading. 


Anyone may spend a mutable order NFT to trade some or all of the quantity specified from any output held by the exchange.  


Features:


  - Bidirectional limit order exchange.
  - ZERO commission trades*.
  - Partial order fulfillment.
  - Cash bids for assets not held.
  - Allows total liquidation of token assets.
  - Minting NFT holder may easily withdraw, cancel, or rebalance orders.
  - Many orders may be written in a single transaction. 
  - All orders are discoverable via electrumX/smallIndex
  - *Transactions must pay standard fees to miners.


Order Commitments:


  Orders are listed on mutable NFT commitments like so
   
     byte16(LE)<quantity>   number of tokens remaining in order
     byte16(LE)<price>      price in token units per coin


  - Buy orders are positive (+)
  - Sell orders are negative (-)
  - Price MUST be expressed in raw token units per coin (100,000,000 sats)
  - CatDex has no concept of display decimal metadata 
 
Transaction Building Modes:


  Administration Mode
  
     Transactions with a minting NFT may withdraw all outputs from the contract.
  
     Auth Baton    input[0] -> output[0]     - Authenticating NFT (minting)
                   input[i] -> output[*]     - Unrestricted spending


  Order Mode
  
    In "Order mode" outputs are submitted in pairs, with both the record for the order
    and the cash value moving on the even "foot" and the tokens trading on the odd "foot".
    
    orderThread    input[even] -> output[even]  - Order NFT of category (mutable)
    assetThread    input[odd]  -> output[odd]   - Tread for asset traded.


Note: 


  The exchange owner(s) holds the minting NFT baton(s), which authorizes spending funds from the exchange.
`,name:"CatDex Blackboard",scripts:["unlock","lock"],variables:{auth_category:{description:"The CashToken Category for orders and authentication.",name:"Authentication Token Category",type:"WalletData"},asset_category:{description:"The CashToken Category Token ID of the asset being traded",name:"Asset Token Category",type:"WalletData"}}},wallet:{description:"Standard p2pkh wallet controlling the exchange minting NFT baton",name:"Exchange Owner",scripts:["wallet_unlock","wallet_lock"],variables:{key:{description:"The private key that controls this wallet.",name:"Key",type:"HdKey"}}}},Na=JSON.parse('{"base":{"data":{"bytecode":{"auth_category":"0xefbe00000000000000000000000000000000000000000000000000000000adde","asset_category":"0x2c06f3b2565d0818a8e41f58beff5918d5dbdc64b11ee8ad474e499751cde07f"}},"description":"","name":"Base Scenario"},"excise_sell_order_baton":{"description":"Buy using a sell order.","extends":"base","name":"Use sell order (baton tread)","transaction":{"inputs":[{"unlockingBytecode":["slot"]},{},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10400,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"0000000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":0,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":9600,"token":{"amount":20,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}}],"version":2},"sourceOutputs":[{"lockingBytecode":["slot"],"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":20}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000}]},"excise_sell_order_asset":{"description":"Test buying an asset using a sell order.","extends":"base","name":"Use sell order to buy (asset tread)","transaction":{"inputs":[{},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10400,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"0000000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":0,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":9600,"token":{"amount":20,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}}],"version":2},"sourceOutputs":[{"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":20}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000}]},"excise_sell_order_asset_two":{"description":"Test buying an asset using a sell order.","extends":"base","name":"Use sell order to buy (asset tread)","transaction":{"inputs":[{},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":200800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"0000000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":800,"token":{"amount":500,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":293779}],"version":2},"sourceOutputs":[{"valueSatoshis":800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1027000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":10000}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":494799}]},"overbuy_order_baton":{"description":"Test that overbuying a sell order should fail.","extends":"base","name":"FAIL: overbuy sell order (baton tread)","transaction":{"inputs":[{"unlockingBytecode":["slot"]},{},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"1400000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":0,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":9200,"token":{"amount":40,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}}],"version":2},"sourceOutputs":[{"lockingBytecode":["slot"],"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":40}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000}]},"overbuy_order_asset":{"description":"Test that overbuying a sell order should fail.","extends":"base","name":"FAIL: overbuy sell order (asset tread)","transaction":{"inputs":[{},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"1400000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":0,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":9200,"token":{"amount":40,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}}],"version":2},"sourceOutputs":[{"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":40}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000}]},"misexcise_sell_order_asset":{"description":"Test that selling to a sell order should fail.","extends":"base","name":"FAIL: selling into sell order (asset tread)","transaction":{"inputs":[{},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"3c00000000000000000000000000008000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":60,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10800}],"version":2},"sourceOutputs":[{"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":20}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":40}}]},"excise_buy_order_baton":{"description":"Test selling an asset using a buy order.","extends":"base","name":"Use buy order to sell tokens","transaction":{"inputs":[{"unlockingBytecode":["slot"]},{},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"0000000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":20,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10400}],"version":2},"sourceOutputs":[{"lockingBytecode":["slot"],"valueSatoshis":10400,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000000000943577000000000000000000000000","capability":"mutable"}}},{"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":0}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":20}}]},"excise_buy_order_asset":{"description":"Test selling an asset to a buy order.","extends":"base","name":"Use buy order to sell tokens","transaction":{"inputs":[{},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"0000000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":20,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10400}],"version":2},"sourceOutputs":[{"valueSatoshis":10400,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000000000943577000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":0}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":20}}]},"create":{"description":"Create an order book","name":"Create Orderbook","transaction":{"inputs":[{"unlockingBytecode":["slot"]},{},{}],"outputs":[{"lockingBytecode":"76a9141cb0e414e168062d46cc0e5799c71e3e4b3028cf88ac","token":{"category":"4ebdbcc129f3cd5759a5d3b76b908bf91f86666cd19793b1a48807fc7f11016c","amount":0,"nft":{"commitment":"0adf","capability":"minting"}},"valueSatoshis":1000},{"lockingBytecode":"aa202e84afbcdb5951e8d159969a2325f72abe0d62f686793e8283118d6e1fdd96e987","token":{"category":"4ebdbcc129f3cd5759a5d3b76b908bf91f86666cd19793b1a48807fc7f11016c","amount":0,"nft":{"commitment":"20a1070000000000000000000000008014000000000000000000000000000000","capability":"mutable"}},"valueSatoshis":800},{"lockingBytecode":"aa202e84afbcdb5951e8d159969a2325f72abe0d62f686793e8283118d6e1fdd96e987","token":{"category":"35c5f1fe73b627b70e11f8297eea49a0f074f33b201c37e7c21ff6027a84a795","amount":0},"valueSatoshis":800},{"lockingBytecode":"aa202e84afbcdb5951e8d159969a2325f72abe0d62f686793e8283118d6e1fdd96e987","token":{"category":"4ebdbcc129f3cd5759a5d3b76b908bf91f86666cd19793b1a48807fc7f11016c","amount":0,"nft":{"commitment":"a086010000000000000000000000000014000000000000000000000000000000","capability":"mutable"}},"valueSatoshis":800},{"lockingBytecode":"aa202e84afbcdb5951e8d159969a2325f72abe0d62f686793e8283118d6e1fdd96e987","token":{"category":"35c5f1fe73b627b70e11f8297eea49a0f074f33b201c37e7c21ff6027a84a795","amount":100000},"valueSatoshis":800},{"lockingBytecode":"76a9141cb0e414e168062d46cc0e5799c71e3e4b3028cf88ac","token":{"category":"35c5f1fe73b627b70e11f8297eea49a0f074f33b201c37e7c21ff6027a84a795","amount":2099999999900000},"valueSatoshis":800},{"lockingBytecode":"76a9141cb0e414e168062d46cc0e5799c71e3e4b3028cf88ac","valueSatoshis":100093052}],"version":2},"sourceOutputs":[{"lockingBytecode":["slot"],"valueSatoshis":1000,"token":{"category":"4ebdbcc129f3cd5759a5d3b76b908bf91f86666cd19793b1a48807fc7f11016c","nft":{"commitment":"0x0adf","capability":"minting"}}},{"lockingBytecode":"76a9141cb0e414e168062d46cc0e5799c71e3e4b3028cf88ac","valueSatoshis":100097016},{"lockingBytecode":"76a9141cb0e414e168062d46cc0e5799c71e3e4b3028cf88ac","valueSatoshis":1000,"token":{"category":"35c5f1fe73b627b70e11f8297eea49a0f074f33b201c37e7c21ff6027a84a795","amount":2100000000000000}}]},"withdraw":{"description":"Withdraw accumulated principal and tokens","extends":"base","name":"Withdraw","transaction":{"inputs":[{"unlockingBytecode":{"script":"wallet_unlock"}},{"unlockingBytecode":["slot"]}],"outputs":[{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"minting"}}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":100000000,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":100000000}}],"version":2},"sourceOutputs":[{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"minting"}}},{"lockingBytecode":["slot"],"valueSatoshis":100000000,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":100000000}}]},"clear":{"data":{"bytecode":{"auth_category":"0x5263006eccd92d7dadbdced311b08e08f940c9c09fe09445d5789d8bd3d6c9aa","asset_category":"0xe9556bdf407a8bb7122ea1a04c8acfeb9ab9c2cb3682288114263ad2237851c6"}},"description":"Clear an order book","name":"Clear Orderbook","transaction":{"inputs":[{"unlockingBytecode":{"script":"wallet_unlock"}},{"unlockingBytecode":{"script":"unlock"}},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"unlock"}},{"unlockingBytecode":{"script":"unlock"}},{"unlockingBytecode":{"script":"wallet_unlock"}},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"wallet_lock"},"token":{"category":"aac9d6d38b9d78d54594e09fc0c940f9088eb011d3cebdad7d2dd9cc6e006352","amount":0,"nft":{"commitment":"0x1234","capability":"minting"}},"valueSatoshis":1000},{"lockingBytecode":{"script":["copy"]},"token":{"category":"c6517823d23a261481288236cbc2b99aebcf8a4ca0a12e12b78b7a40df6b55e9","amount":2100000000000000},"valueSatoshis":800},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":100094709}]},"sourceOutputs":[{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":1000,"token":{"category":"aac9d6d38b9d78d54594e09fc0c940f9088eb011d3cebdad7d2dd9cc6e006352","amount":0,"nft":{"commitment":"1234","capability":"minting"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":10000800,"token":{"category":"aac9d6d38b9d78d54594e09fc0c940f9088eb011d3cebdad7d2dd9cc6e006352","amount":0,"nft":{"commitment":"20a1070000000000000000000000008014000000000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800},{"valueSatoshis":800,"token":{"category":"aac9d6d38b9d78d54594e09fc0c940f9088eb011d3cebdad7d2dd9cc6e006352","amount":0,"nft":{"commitment":"a086010000000000000000000000000014000000000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"category":"c6517823d23a261481288236cbc2b99aebcf8a4ca0a12e12b78b7a40df6b55e9","amount":100000}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":90093052},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":800,"token":{"category":"c6517823d23a261481288236cbc2b99aebcf8a4ca0a12e12b78b7a40df6b55e9","amount":2099999999900000}}]}}'),Ra={unlock:{fails:["overbuy_order_asset","overbuy_order_baton","misexcise_sell_order_asset"],passes:["clear","excise_buy_order_baton","excise_buy_order_asset","excise_sell_order_baton","excise_sell_order_asset","excise_sell_order_asset_two","withdraw"],name:"Swap or Administer",script:"",unlocks:"lock"},wallet_unlock:{passes:["create"],name:"Wallet Unlock",script:"<key.schnorr_signature.all_outputs> <key.public_key>",unlocks:"wallet_lock"},wallet_lock:{lockingType:"standard",name:"Wallet Lock",script:"OP_DUP OP_HASH160 <$(<key.public_key> OP_HASH160)> OP_EQUALVERIFY OP_CHECKSIG"},lock:{lockingType:"p2sh32",name:"CatDex Blackboard",script:`// CatDex - A token category authorized decentralized exchange
//
// 2025-11-22 Pre-alpha, pre-audit
//
// Trade fungible tokens at fixed prices based on orders expressed in NFT commitments

<asset_category> <auth_category>

// pragma cashscript ^0.10.0;
// contract CatDex(bytes32 authCat, bytes32 assetCat){

    // function swap(){
        // If the first input has a minting baton (owner),
        //   the spending of outputs is unrestricted. 
        OP_0 OP_UTXOTOKENCATEGORY OP_OVER OP_2 OP_CAT OP_EQUAL OP_IF
        // if(tx.inputs[0].tokenCategory == authCat + 0x02){
            // pass 
        // }

        // If the order input (even input) is a mutable auth Baton ... 
        OP_ELSE    
        // else{
            // Push the index of this order baton to the stack
            OP_INPUTINDEX OP_INPUTINDEX OP_2 OP_MOD OP_SUB 
            // int orderIndex = this.activeInputIndex - (this.activeInputIndex % 2);  

            // require the order is authenticated by  a mutable baton 
            OP_DUP OP_OUTPUTTOKENCATEGORY OP_2 OP_PICK OP_1 OP_CAT OP_EQUALVERIFY
            // require(tx.outputs[orderIndex].tokenCategory ==  authCat + 0x01);

            // Require the order is auth lives on
            OP_DUP OP_UTXOTOKENCATEGORY OP_OVER OP_OUTPUTTOKENCATEGORY OP_EQUALVERIFY 
            // require(tx.inputs[orderIndex].tokenCategory == tx.outputs[orderIndex].tokenCategory);

            // Require the order baton be passed back to the contract
            OP_DUP OP_OUTPUTBYTECODE OP_OVER OP_UTXOBYTECODE OP_EQUALVERIFY 
            // require(tx.outputs[orderIndex].lockingBytecode == 
            //          tx.inputs[orderIndex].lockingBytecode);

            // Get the next index of the asset thread
            OP_DUP OP_1ADD 
            // int assetIndex = orderIndex + 1; 

            // Require the asset thread be sent at the current contract
            OP_DUP OP_OUTPUTBYTECODE OP_OVER OP_OUTPUTBYTECODE OP_EQUALVERIFY 
            // require(tx.outputs[assetIndex].lockingBytecode == 
            //         tx.outputs[assetIndex].lockingBytecode);                 
                        
            
            // if the amount of tokens is greater than zero,
            OP_DUP OP_OUTPUTTOKENAMOUNT OP_0 OP_GREATERTHAN OP_IF 
            // if(tx.outputs[assetIndex].tokenAmount > 0){
              // require the asset output contain token category specified by the order
              OP_DUP OP_OUTPUTTOKENCATEGORY OP_4 OP_PICK OP_EQUALVERIFY
            //   require(tx.outputs[assetIndex].tokenCategory == assetCat);
            // } 
            OP_ENDIF 

            // Parse the order data from the NFT commitment
            OP_OVER OP_UTXOTOKENCOMMITMENT OP_16 OP_SPLIT 
            // bytes quantityBin, bytes priceBin = 
            //               tx.inputs[orderIndex].nftCommitment.split(16);

            OP_OVER OP_BIN2NUM 
            // int orderQuantity = int(quantityBin);  

            OP_OVER OP_BIN2NUM 
            // int price = int(priceBin);

            // Get the amount of the token traded
 
            OP_4 OP_PICK OP_OUTPUTTOKENAMOUNT OP_5 OP_PICK OP_UTXOTOKENAMOUNT OP_SUB 
            // int tradeQuantity = tx.outputs[assetIndex].tokenAmount - 
            //                      tx.inputs[assetIndex].tokenAmount;

            // Verify new authCat order baton NFT commitment
            OP_2 OP_PICK OP_OVER OP_SUB OP_16 OP_NUM2BIN OP_2 OP_PICK OP_16 OP_NUM2BIN OP_CAT 
            // bytes32 nextCommitment = bytes16(orderQuantity-tradeQuantity) + bytes16(price);

            // Require updating order baton
            OP_7 OP_PICK OP_OUTPUTTOKENCOMMITMENT OP_OVER OP_EQUALVERIFY 
            // require(tx.outputs[orderIndex].nftCommitment == nextCommitment);

            // require the sign of the quantity traded matches the order sign  
            OP_OVER OP_0 OP_GREATERTHAN OP_4 OP_PICK OP_0 OP_GREATERTHAN OP_EQUALVERIFY
            // require((tradeQuantity > 0 == orderQuantity > 0)); 

            // require the amount traded be less than (or equal to) the quantity available
            OP_OVER OP_ABS OP_4 OP_PICK OP_ABS OP_LESSTHANOREQUAL OP_VERIFY 
            // require(abs(tradeQuantity) <= abs(orderQuantity));

            // Verify the value returned with the order exceeds the quantity traded times the price.
            OP_7 OP_PICK OP_OUTPUTVALUE OP_8 OP_PICK OP_UTXOVALUE OP_SUB
            OP_2OVER OP_SWAP OP_MUL <100_000_000> OP_DIV OP_NEGATE OP_GREATERTHANOREQUAL OP_VERIFY 
            // require((tx.outputs[orderIndex].value - tx.inputs[orderIndex].value) >= -(tradeQuantity*price/100_000_000));

        // } 
       OP_2DROP OP_2DROP OP_2DROP OP_2DROP
    // } 
    OP_ENDIF 
// } 
OP_2DROP OP_1`}},qa=["BCH_2024_05","BCH_2025_05"],Da={$schema:Ea,description:Aa,name:Ua,entities:Ca,scenarios:Na,scripts:Ra,supported:qa},La="@unspent/catdex",za={name:La},o0=1e8;class F{static USER_AGENT=za.name;static PROTOCOL_IDENTIFIER="U3X";static tokenAware=!0;static template=Da;static compiler=K0(this.template);static vm=la();static getLockingBytecode(e,a){typeof e=="string"&&(e=U(e)),typeof a=="string"&&(a=U(a));const n=this.compiler.generateBytecode({data:{bytecode:{auth_category:new Uint8Array(e).reverse(),asset_category:new Uint8Array(a).reverse()}},scriptId:"lock"});if(!n.success)throw new Error("Failed to generate bytecode, script: , "+JSON.stringify(n,null,"  "));return n.bytecode}static getScriptHash(e,a,n=!0){return i0(this.getLockingBytecode(e,a),n)}static getAddress(e,a,n="bitcoincash"){return Y0(this.getLockingBytecode(e,a),n,this.tokenAware)}static getCatDexOrdersFromUtxos(e,a,n=!0){typeof e!="string"&&(e=Ae(e));let r=a.filter(l=>l.token_data&&l.token_data?.category!=e).map(l=>{let u=this.parseNFT(l.token_data?.nft?.commitment);return{authCategory:U(l.token_data?.category),assetCategory:U(e),orderUtxo:l,assetUtxo:void 0,price:u.price,quantity:u.quantity,value:l.value,amount:void 0}});r.sort((l,u)=>Number(u.price)-Number(l.price)),n&&(r=r.filter(l=>l.quantity!=0n));let p=[];for(let l of r){let u=a.findIndex(B=>B.tx_hash==l.orderUtxo.tx_hash&&B.tx_pos==l.orderUtxo.tx_pos+1);if(u==-1)throw"Couldn't find matching asset thread";let x={};x={assetUtxo:a[u],amount:a[u]?.token_data?a[u].token_data.amount:0n},p.push({...l,...x})}return p}static getSourceOutput(e,a,n){return{lockingBytecode:this.getLockingBytecode(e,a),valueSatoshis:BigInt(n.value),token:n.token_data?{category:U(n.token_data.category),amount:BigInt(n.token_data.amount),nft:n.token_data.nft?{commitment:U(n.token_data.nft.commitment),capability:n.token_data.nft.capability}:void 0}:void 0}}static parseNFT(e){typeof e=="string"&&(e=U(e));let a=Kt(e.slice(0,16),{requireMinimalEncoding:!1}),n=Kt(e.slice(-16),{requireMinimalEncoding:!1});return{quantity:BigInt(a),price:Number(n)/o0}}static encodeNFT(e){return new Uint8Array([...Yt(Qt(BigInt(e.quantity)),16),...Yt(Qt(BigInt(Math.trunc(e.price*o0))),16)])}static getInput(e,a,n){return typeof e=="string"&&(e=U(e)),typeof a=="string"&&(a=U(a)),{outpointIndex:n.tx_pos,outpointTransactionHash:U(n.tx_hash),sequenceNumber:0,unlockingBytecode:{data:{bytecode:{auth_category:new Uint8Array(e).reverse(),asset_category:new Uint8Array(a).reverse()}},compiler:this.compiler,script:"unlock",valueSatoshis:BigInt(n.value),token:n.token_data?{category:U(n.token_data.category),amount:BigInt(n.token_data.amount),nft:n.token_data.nft?{commitment:U(n.token_data.nft.commitment),capability:n.token_data.nft.capability}:void 0}:void 0}}}static getOrderOutput(e,a){let n=this.getLockingBytecode(e.authCategory,e.assetCategory),s=0n;return e.amount>0?s=BigInt(e.assetUtxo.token_data.amount)-a:s=-a,[{lockingBytecode:n,valueSatoshis:BigInt(e.orderUtxo.value)+BigInt(Math.trunc(Number(a)*e.price)),token:{amount:0n,category:U(e.orderUtxo.token_data.category),nft:{commitment:F.encodeNFT({quantity:e.quantity+a,price:e.price}),capability:"mutable"}}},{lockingBytecode:n,valueSatoshis:800n,token:s!=0n?{category:e.assetCategory,amount:BigInt(s)}:void 0}]}static orderRequestToOutputs(e,a,n){let s=this.getLockingBytecode(e,a);typeof e=="string"&&(e=U(e)),typeof a=="string"&&(a=U(a));let r=800n,p=0n;n.quantity>0n&&(r+=BigInt(Math.trunc(n.price*Number(n.quantity)))),n.quantity<0n&&(p=-BigInt(n.quantity));const l=this.encodeNFT(n);let u=[{lockingBytecode:s,valueSatoshis:r,token:{category:e,amount:0n,nft:{commitment:l,capability:"mutable"}}}];return u.push({lockingBytecode:s,valueSatoshis:800n,token:p>0n?{category:a,amount:p}:void 0}),u}static getWalletSourceOutput(e,a,n=0){return{lockingBytecode:a?ea({addressIndex:n,hdPrivateKey:a,throwErrors:!0}):Uint8Array.from(Array(33)),valueSatoshis:BigInt(e.value),token:e.token_data?{category:U(e.token_data.category),amount:BigInt(e.token_data.amount),nft:e.token_data.nft?{commitment:U(e.token_data.nft.commitment),capability:e.token_data.nft.capability}:void 0}:void 0}}static getWalletInput(e,a,n=0){let s=a?{compiler:this.compiler,data:{hdKeys:{addressIndex:n,hdPrivateKeys:{wallet:a}}},script:"wallet_unlock",valueSatoshis:BigInt(e.value),token:e.token_data?{category:U(e.token_data.category),amount:BigInt(e.token_data.amount),nft:e.token_data.nft?{commitment:U(e.token_data.nft.commitment),capability:e.token_data.nft.capability}:void 0}:void 0}:Uint8Array.from(Array());return{outpointIndex:e.tx_pos,outpointTransactionHash:U(e.tx_hash),sequenceNumber:0,unlockingBytecode:s}}static getAuthWalletOutput(e,a,n=0){return{lockingBytecode:a?{compiler:this.compiler,data:{hdKeys:{addressIndex:n,hdPublicKeys:{wallet:Gt(a).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:BigInt(e.value),token:e.token_data?{category:U(e.token_data.category),amount:BigInt(e.token_data.amount),nft:e.token_data.nft?{commitment:U(e.token_data.nft.commitment),capability:e.token_data.nft.capability}:void 0}:void 0}}static getChangeOutput(e,a,n,s,r=0){return n&&typeof n!="string"&&(n=Ae(n)),{lockingBytecode:s?{compiler:this.compiler,data:{hdKeys:{addressIndex:r,hdPublicKeys:{wallet:Gt(s).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:e,token:a>0&&n?{category:U(n),amount:a}:void 0}}static getAuthLayers(e,a,n=0){let s=[],r=[],p=[];return p.push(this.getWalletSourceOutput(e,a,n)),s.push(this.getWalletInput(e,a,n)),r.push(this.getAuthWalletOutput(e,a,n)),{inputs:s,outputs:r,sourceOutputs:p}}static setBlackBoardLayers(e,a,n,s,r=[]){let p=[],l=[];return p.push(...n.map(u=>this.getInput(e,a,u))),r.push(...n.map(u=>this.getSourceOutput(e,a,u))),l.push(...s.map(u=>this.orderRequestToOutputs(e,a,u)).flat()),{inputs:p,outputs:l,sourceOutputs:r}}static getBlackBoardLayers(e,a,n=[]){let s=[],r=[];if(e=e.filter(u=>Math.sign(Number(u.quantity))!=Math.sign(Number(a))),e.length==0)throw Error("no orders left, maximum recursion depth reached.");const p=a>0?(u,x)=>Number(u.price-x.price):(u,x)=>Number(u.price+x.price);e.sort(p);const l=e.shift();if(!l)throw Error("No matching best order found.");if(!l.assetUtxo)throw Error("Order missing asset utxo");if(s.push(this.getInput(l.authCategory,l.assetCategory,l.orderUtxo)),s.push(this.getInput(l.authCategory,l.assetCategory,l.assetUtxo)),n.push(this.getSourceOutput(l.authCategory,l.assetCategory,l.orderUtxo)),n.push(this.getSourceOutput(l.authCategory,l.assetCategory,l.assetUtxo)),Math.abs(Number(a))<=Math.abs(Number(l.quantity)))r.push(...this.getOrderOutput(l,a));else{r.push(...this.getOrderOutput(l,-l.quantity)),a+=l.quantity;let u=this.getBlackBoardLayers([...e],a,[...n]);s.push(...u.inputs),r.push(...u.outputs),n=u.sourceOutputs}return{inputs:s,outputs:r,sourceOutputs:n}}static getWalletInputs(e,a,n,s,r=[]){let p=[],l=[];if(s&&typeof s!="string"&&(s=Ae(s)),s?(console.log(e),e=e.filter(w=>w.token_data&&w.token_data?.category==s).filter(w=>w.token_data&&!w.token_data.nft),console.log(e)):e=e.filter(w=>!w.token_data),e.length==0)throw Error("no wallet utxos left, maximum recursion depth reached.");const u=Math.floor(Math.random()*e.length),x=e[u];e.splice(u,1),p.push(this.getWalletInput(x,n)),r.push(this.getWalletSourceOutput(x,n));let B=ie(r),y=Z(r,s);if(s&&y<a||!s&&B<a){let w=this.getWalletInputs([...e],a,n,s,[...r]);p.push(...w.inputs),l.push(...w.outputs),r=w.sourceOutputs}return{inputs:p,outputs:l,sourceOutputs:r}}static getWalletLayers(e,a,n,s,r){let p=Xt(a.outputs),l=ie(n),u=p-l;const x=this.getWalletInputs(s,u,r);a.inputs.push(...x.inputs),n.push(...x.sourceOutputs);let B=Jt(a.outputs,e),y=Z(n,e),w=B-y;if(w>0n){const j=this.getWalletInputs(s,w,r,e);a.inputs.push(...j.inputs),n.push(...j.sourceOutputs)}p=Xt(a.outputs),l=ie(n);let g=l-p;B=Jt(a.outputs,e),y=Z(n,e);let P=y-B;return P>0&&(a.outputs.push(this.getChangeOutput(800n,P,e,r)),g-=800n),a.outputs.push(this.getChangeOutput(g,0n,void 0,r)),a}static administer(e,a,n,s,r,p,l=0,u=1){let y={locktime:0,version:2,inputs:[],outputs:[]},w=e.token_data.category;const g=this.getAuthLayers(e,p,l);y.inputs.push(...g.inputs),y.outputs.push(...g.outputs);let P=g.sourceOutputs;const j=this.setBlackBoardLayers(w,a,n,s);y.inputs.push(...j.inputs),y.outputs.push(...j.outputs),P.push(...j.sourceOutputs),y=this.getWalletLayers(a,y,P,r,p);let A=et(y);if(!A.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(A.errors,null,"  "));const D=Zt(A.transaction,u),I=y.outputs.length-1;if(y.outputs[I].valueSatoshis=y.outputs[I].valueSatoshis-D,A=et(y),!A.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(A.errors,null,"  "));const L=A.transaction,Y=$t(L,P,{maximumTokenCommitmentLength:40});if(Y!==!0&&u>0)throw Y;let z=this.vm.verify({sourceOutputs:P,transaction:L});if(typeof z=="string")throw Error(z);let ce=ie(P)-ie(L.outputs);ce>5e3&&(z=`Excessive fees ${ce}`),Z(P,a)==0n&&(z="Error checking token input");let le=Z(P,a)-Z(L.outputs,a);return le!==0n&&(z=`Swapping should not create destroy tokens, token difference: ${le}`),{sourceOutputs:P,transaction:L,verify:z}}static swap(e,a,n,s,r=1){const p=[],l=[];let u=[],x=Ae(a[0]?.assetCategory);if(new Set(a.map(z=>Ae(z.assetCategory))).size>1)throw"A catdex swap may only trade one asset at a time, mixed assets found.";let y={locktime:0,version:2,inputs:p,outputs:l};n=n.filter(z=>z.token_data?.category==x||!z.token_data);let w=this.getBlackBoardLayers(a,e,u);y.inputs.push(...w.inputs),y.outputs.push(...w.outputs),u=w.sourceOutputs,y=this.getWalletLayers(x,y,u,n,s);let g=et(y);if(!g.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(g.errors,null,"  "));const P=Zt(g.transaction,r),j=y.outputs.length-1;if(y.outputs[j].valueSatoshis=y.outputs[j].valueSatoshis-P,g=et(y),!g.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(g.errors,null,"  "));const A=g.transaction,D=$t(A,u,{maximumTokenCommitmentLength:40});if(D!==!0&&r>0)throw D;let I=this.vm.verify({sourceOutputs:u,transaction:A}),L=ie(u)-ie(A.outputs);L>5e3&&(I=`Excessive fees ${L}`),Z(u,x)==0n&&(I="Error checking token input");let Y=Z(u,x)-Z(A.outputs,x);return Y!==0n&&(I=`Swapping should not create destroy tokens, token difference: ${Y}`),{sourceOutputs:u,transaction:A,verify:I}}}async function s0(b,e){let a=(await Z0($0,e.map(s=>[b,s]))).flat();var n=new Map;return a.map(s=>n.set(s.tx_hash+":"+s.tx_pos,s)),n}var Ma=m('<meta name="description" content="CatDex - a decentralized limit order exchange and dex aggregator on Bitcoin Cash."/>'),ja=m('<div class="trollbox svelte-1jynxwz"><!> <label class="switch svelte-1jynxwz">Hide <input type="checkbox" class="svelte-1jynxwz"/> <span class="slider round svelte-1jynxwz"></span></label></div>'),Fa=m("<img/>"),Ha=m('<img alt="Disconnected"/>'),Va=(b,e)=>e(),Wa=m("<option> </option>"),Ka=m('<div class="swap svelte-1jynxwz"><div class="svelte-1jynxwz"><img width="50"/> <br/> </div> <div class="svelte-1jynxwz"><img width="50"/> <br/> </div></div>'),Ya=(b,e)=>e(),Qa=m('<div class="swap svelte-1jynxwz"><label>Swap amount:</label> <input type="number" min="0" max="10"/></div>'),Ga=m('<div class="swap svelte-1jynxwz"><p><a href="/wallet">Deposit funds</a> to trade assets.</p></div>'),Xa=m('<div class="swap svelte-1jynxwz"><button class="svelte-1jynxwz">Broadcast</button></div> <!>',1),Ja=(b,e)=>e(4364),Za=(b,e)=>e(52596),$a=m("<b> </b>"),en=m("<b> </b>"),tn=m('<div><p>You have a CatDex baton. <br/> For others to can find your orders, announce your membership in the CatDex.</p> <button class="svelte-1jynxwz">Month (4364 sats)</button> <button class="svelte-1jynxwz">Year (52596 sats)</button> <p>Membership fees are non-refundable and are claimed by miners.</p> <!></div> <br/>',1),an=m('<a href="/wallet">Deposit funds</a> to create a CatDex authentication baton.',1),nn=(b,e)=>e(),on=m('<p>To write orders, you need to create a CatDex Authentication Baton (1000 sats).</p> <button class="svelte-1jynxwz">Create a new Baton</button>',1),sn=m('<div class="svelte-1jynxwz"><img width="24"/> <br/> </div>'),rn=m('<div class="svelte-1jynxwz"><img width="24"/> <br/> </div>'),cn=(b,e)=>e(!0),ln=(b,e)=>e(),dn=m('<button class="svelte-1jynxwz">Replace Orders</button> <button class="svelte-1jynxwz">Append Orders</button>',1),un=(b,e)=>e(!0),vn=(b,e)=>e(0),fn=m('<button class="svelte-1jynxwz">Clear Orders</button> <button class="svelte-1jynxwz">New Orders</button><br/>',1),pn=m('<div class="orders svelte-1jynxwz"><div class="in svelte-1jynxwz"><b>type</b></div> <div class="in svelte-1jynxwz"><b>price</b></div> <div class="in svelte-1jynxwz"><b>quantity</b></div> <div class="in svelte-1jynxwz"></div> <div class="listButtons svelte-1jynxwz"></div></div>'),bn=m('<div class="orders svelte-1jynxwz"><div class="in svelte-1jynxwz"><!></div> <div class="in svelte-1jynxwz"><input type="number" placeholder="sats per" min="1" max="100000" class="svelte-1jynxwz"/></div> <div class="in svelte-1jynxwz"><input name="quantity" placeholder="qty" type="number" class="svelte-1jynxwz"/> <!></div> <div class="in svelte-1jynxwz"><!></div> <div class="listButtons svelte-1jynxwz"><button class="svelte-1jynxwz">+</button> <button class="svelte-1jynxwz">-</button></div></div>'),_n=m("<p>Sell is negative quantity.<br/> All prices in satoshis</p>"),yn=m('<h3>Your Decentralized Listing</h3> <!> <div class="swap svelte-1jynxwz"><!> <!></div> <div class="orderBooks svelte-1jynxwz"><div class="svelte-1jynxwz"></div> <div class="askBook svelte-1jynxwz"></div></div> <br/> <!> <!> <!> <!> <br/>',1),mn=m("<br/> <div><!> <!></div>",1),gn=m("<div><!></div>"),hn=m('<b>Asset:</b> <select></select> <br/> <!> <br/> <!> <br/> <!> <div class="orderBooks svelte-1jynxwz"><div class="svelte-1jynxwz"></div> <div class="askBook svelte-1jynxwz"></div></div> <h3>Advanced</h3> <label class="switch svelte-1jynxwz"><input type="checkbox" class="svelte-1jynxwz"/> <span class="slider round svelte-1jynxwz"></span></label> <br/> <!> <br/> <br/> <h3>Makers</h3> <div class="grid svelte-1jynxwz"></div>',1),kn=m('<div class="swap svelte-1jynxwz"><p>Not connected.</p></div>'),On=m('<!> <section><div class="status svelte-1jynxwz"><!> <!></div> <h1>Trade CashTokens</h1> <!> <h3>Chat</h3> <label class="switch svelte-1jynxwz"><input type="checkbox" class="svelte-1jynxwz"/> <span class="slider round svelte-1jynxwz"></span></label> <!></section>',1);function $n(b,e){wt(e,!0);let a=S(be(e.data.asset)),n=S(0),s=S(""),r,p=S(""),l=S(0n),u=S(""),x;be([]);let B=S(be([])),y=S(be([])),w=S(be([])),g=S(be([])),P=S(void 0),j=S(void 0),A=S(void 0),D=S(0),I=S(be([])),L=S(be([])),Y=S(be([])),z=S(!1),ce=S(!1),le="",ve=S(void 0),Ue=S(!1),ge=S(void 0),he=S(""),ke=S(0),fe=S(0n);const $=V0.url.hostname=="vox.cash",Oe=$?"BCH":"tBCH",Je=$?"bch.imaginary.cash":"chipnet.bch.ninja",nt=$?ia:ca,ye=$?c0:l0;typeof t(a)!="string"&&f(a,$?"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c":"ffc9d3b3488e890ef113b1c74f40e1f5eb1147a7d4191cecac89fd515721a271",!0);const ae=Ot(`OP_RETURN <"${F.PROTOCOL_IDENTIFIER}">`);let R;const q=Object.entries(nt.identities).map(i=>Object.values(Object.values(i[1]))).flat().filter(i=>i.extensions&&i.extensions.exchanges=="catdex").reduce((i,v)=>(i.set(v.token.category,v),i),new Map),xe=()=>{clearTimeout(x),x=setTimeout(()=>{we(),ee()},1500)};async function ee(){if(r&&t(n)>1e3){let i=await r.request("blockchain.scripthash.listunspent",tt.getScriptHash(F.PROTOCOL_IDENTIFIER),"include_tokens");f(Y,i.map(J=>J.token_data?.category).filter((J,Ne,rt)=>rt.indexOf(J)===Ne),!0);let v=t(Y).map(J=>F.getScriptHash(J,t(a))),X=await s0(r,v),H=Array.from(X.values());if(f(y,F.getCatDexOrdersFromUtxos(t(a),H),!0),t(I).length>0){let J=await s0(r,[F.getScriptHash(t(I)[0].token_data.category,t(a))]);f(L,Array.from(J.values()),!0),f(j,xt(t(L),t(a)),!0),f(A,e0(t(L)),!0),f(w,F.getCatDexOrdersFromUtxos(t(a),t(L)),!0)}}}const we=async function(){let i=await r.request("blockchain.scripthash.listunspent",t(p),"include_tokens");if(i instanceof Error)throw i;f(I,i.filter(v=>v.token_data&&v.token_data.nft&&v.token_data.nft.commitment.startsWith(ae)),!0),typeof t(a)=="string"?(f(B,i.filter(v=>!v.token_data||v.token_data.category==t(a)),!0),f(fe,xt(t(B),t(a)),!0)):(f(B,i.filter(v=>!v.token_data),!0),f(fe,0n)),f(ke,e0(t(B),!0),!0)},Fe=async function(){await R.sendMax(R.getDepositAddress());let i=Ot(`OP_RETURN <"${F.PROTOCOL_IDENTIFIER}"> <"markets are made">`);await R.tokenGenesis({cashaddr:R.getTokenDepositAddress(),commitment:i,capability:a0.minting,value:800})},Ce=async function(i){let v=Ot('OP_RETURN <"markets are made">');await R.tokenMint(t(I)[0].token_data.category,[new ra({cashaddr:tt.getAddress(F.PROTOCOL_IDENTIFIER),commitment:v,capability:a0.none,value:i})]),G0(500),await ee()},M=async function(){await we(),await ee(),typeof t(a)=="string"?(H0(`?asset=${t(a)}`,{keepFocus:!0}),f(fe,xt(t(B),t(a)),!0)):f(fe,0n)},Q=function(i){if(t(g).length+1==i)t(g).splice(i,0,{quantity:void 0,price:void 0});else if(t(g).length>=2){let v=t(g).slice(-2);t(g).push({quantity:v[1].quantity-(v[0].quantity-v[1].quantity),price:v[1].price-(v[0].price-v[1].price)})}else t(g).push({quantity:void 0,price:void 0})},He=function(i){t(g).splice(i,1)},Be=async function(i=!1){let v=i?t(L):[],X=F.administer(t(I)[0],t(a),v,t(g),t(B),t(s)),H=Ae(t0(X.transaction));(await Pt(H)).length==64&&f(g,[],!0)},u0=function(){if(t(l))try{let i=F.swap(BigInt(t(l)),t(y),t(B),t(s));f(ve,i.transaction,!0),f(ge,i.sourceOutputs,!0),le=Ae(t0(t(ve))),f(Ue,i.verify===!0,!0),i.verify===!0&&f(he,"")}catch(i){f(ve,void 0),f(ge,void 0),le="",f(Ue,!1),f(he,i,!0)}},Pt=async function(i){let v=await r.request("blockchain.transaction.broadcast",i);if(v instanceof Error)throw f(u,n0[r.status],!0),f(he,v.message,!0),v;return f(ve,void 0),f(ge,void 0),le="",f(Ue,!1),v},v0=function(i){if(f(u,n0[r.status],!0),i.method==="blockchain.headers.subscribe"){let v=i.params[0];f(n,v.height,!0),ee(),we()}else i.method==="blockchain.scripthash.subscribe"?xe():console.log(i)};C0(async()=>{aa.StorageProvider=ta,R=$?await na.named("vox"):await oa.named("vox"),f(s,sa(R.mnemonic,R.derivationPath.slice(0,-2),R.isTestnet),!0);let i=Q0(R.getDepositAddress());if(typeof i=="string")throw i;f(p,i0(i.bytecode),!0),r=new fa(F.USER_AGENT,"1.4.1",Je),await r.connect(),r.on("notification",v0),await r.subscribe("blockchain.headers.subscribe"),await r.subscribe("blockchain.scripthash.subscribe",t(p));let v=await r.request("blockchain.scripthash.listunspent",tt.getScriptHash(F.PROTOCOL_IDENTIFIER),"include_tokens");f(Y,v.map(H=>H.token_data?.category),!0),t(I).length>0&&f(P,v.filter(H=>H.token_data?.category==t(I)[0].token_data.category).pop(),!0),t(P)?t(P).height<=0?f(D,1e3):t(P).height>0?f(D,t(P).height+t(P).value-t(n)):f(D,0):f(D,0),t(Y).map(H=>F.getScriptHash(H,t(a))).map(async H=>{await r.subscribe("blockchain.scripthash.subscribe",H)}),await r.subscribe("blockchain.scripthash.subscribe",tt.getScriptHash(F.PROTOCOL_IDENTIFIER))}),N0(async()=>{await R.provider.disconnect(),await r.disconnect()});var Tt=On();F0(i=>{var v=Ma();z0.title=" CatDex",_(i,v)});var St=re(Tt);{var f0=i=>{var v=ja(),X=d(v);W0(X,{get topic(){return F.PROTOCOL_IDENTIFIER}});var H=c(X,2),J=c(d(H));je(J),_e(2),o(H),o(v),ht(J,()=>t(ce),Ne=>f(ce,Ne)),_(i,v)};C(St,i=>{t(ce)&&i(f0)})}var It=c(St,2),ot=d(It),Et=d(ot);da(Et,{get template(){return F.template}});var p0=c(Et,2);{var b0=i=>{var v=Fa();V(()=>{se(v,"src",ua),se(v,"alt",t(u))}),_(i,v)},_0=i=>{var v=Ha();V(()=>se(v,"src",va)),_(i,v)};C(p0,i=>{t(u)=="CONNECTED"?i(b0):i(_0,!1)})}o(ot);var At=c(ot,4);{var y0=i=>{var v=hn(),X=c(re(v),2);X.__change=[Va,M],de(X,21,()=>q.keys(),ue,(h,T)=>{var E=Wa(),K={},Pe=d(E,!0);o(E),V(Re=>{K!==(K=t(T))&&(E.value=(E.__value=t(T))??""),N(Pe,Re)},[()=>q.get(t(T)).name]),_(h,E)}),o(X);var H=c(X,4);{var J=h=>{var T=Ka(),E=d(T),K=d(E),Pe=c(K,3);o(E);var Re=c(E,2),Ve=d(Re),dt=c(Ve,3);o(Re),o(T),V((te,me,qe,De,ne)=>{se(K,"src",ye),se(K,"alt",Oe),N(Pe,` ${te??""} sats ${Oe}`),se(Ve,"src",me),se(Ve,"alt",qe),N(dt,` ${De??""}
					${ne??""}`)},[()=>t(ke).toLocaleString(),()=>q.get(t(a)).uris.icon,()=>q.get(t(a)).token.symbol,()=>(t(fe)/BigInt(Math.pow(10,q.get(t(a)).token.decimals))).toLocaleString(),()=>q.get(t(a)).token.symbol]),_(h,T)};C(H,h=>{t(a)&&h(J)})}var Ne=c(H,4);{var rt=h=>{var T=Qa(),E=c(d(T),2);je(E),E.__change=[Ya,u0],o(T),kt(E,()=>t(l),K=>f(l,K)),_(h,T)},h0=h=>{var T=Ga();_(h,T)};C(Ne,h=>{t(ke)>0?h(rt):h(h0,!1)})}var Ct=c(Ne,4);{var k0=h=>{var T=Xa(),E=re(T),K=d(E);K.__click=()=>Pt(le),o(E);var Pe=c(E,2);xa(Pe,{get transaction(){return t(ve)},get sourceOutputs(){return t(ge)},get category(){return t(a)}}),_(h,T)};C(Ct,h=>{t(ve)&&t(Ue)&&h(k0)})}var Nt=c(Ct),it=c(Nt),ct=d(it);de(ct,21,()=>t(y).filter(h=>h.quantity>0),ue,(h,T)=>{at(h,$e(()=>t(T),{get assetCategory(){return t(a)}},()=>({isMainnet:$})))}),o(ct);var Rt=c(ct,2);de(Rt,21,()=>t(y).filter(h=>h.quantity<0).toReversed(),ue,(h,T)=>{at(h,$e(()=>t(T),{get assetCategory(){return t(a)}},()=>({isMainnet:$})))}),o(Rt),o(it);var lt=c(it,4),qt=d(lt);je(qt),_e(2),o(lt);var Dt=c(lt,4);{var O0=h=>{var T=mn(),E=c(re(T),2),K=d(E);{var Pe=te=>{var me=tn(),qe=re(me),De=c(d(qe),2);De.__click=[Ja,Ce];var ne=c(De,2);ne.__click=[Za,Ce];var Te=c(ne,4);{var Le=pe=>{var Se=$a(),Ke=d(Se);o(Se),V(()=>N(Ke,`Membership expires in ${t(D)??""} blocks. Renew now to have your orders discoverable.`)),_(pe,Se)},We=(pe,Se)=>{{var Ke=Ye=>{var Ie=en(),Qe=d(Ie);o(Ie),V(()=>N(Qe,`Membership expired ${t(D)??""} blocks ago. Renew now to keep your orders discoverable.`)),_(Ye,Ie)};C(pe,Ye=>{t(D)<-20&&Ye(Ke)},Se)}};C(Te,pe=>{t(D)>0?pe(Le):pe(We,!1)})}o(qe),_e(2),_(te,me)};C(K,te=>{t(I).length>0&&t(D)<1e3&&te(Pe)})}var Re=c(K,2);{var Ve=te=>{var me=an();_e(),_(te,me)},dt=(te,me)=>{{var qe=ne=>{var Te=on(),Le=c(re(Te),2);Le.__click=[nn,Fe],_(ne,Te)},De=ne=>{var Te=yn(),Le=c(re(Te),2);de(Le,17,()=>t(I),ue,(k,O)=>{Ge(k,{size:24,get category(){return t(O).token_data.category}})});var We=c(Le,2),pe=d(We);{var Se=k=>{var O=sn(),W=d(O),oe=c(W,3);o(O),V(Ee=>{se(W,"src",ye),se(W,"alt",Oe),N(oe,` ${Ee??""} sats ${Oe}`)},[()=>t(A).toLocaleString()]),_(k,O)};C(pe,k=>{t(A)&&k(Se)})}var Ke=c(pe,2);{var Ye=k=>{var O=rn(),W=d(O),oe=c(W,3);o(O),V((Ee,ut,vt,ft)=>{se(W,"src",Ee),se(W,"alt",ut),N(oe,` ${vt??""}
								${ft??""}`)},[()=>q.get(t(a)).uris.icon,()=>q.get(t(a)).token.symbol,()=>(t(j)/BigInt(Math.pow(10,q.get(t(a)).token.decimals))).toLocaleString(),()=>q.get(t(a)).token.symbol]),_(k,O)};C(Ke,k=>{t(j)&&k(Ye)})}o(We);var Ie=c(We,2),Qe=d(Ie);de(Qe,21,()=>t(w).filter(k=>k.quantity>0),ue,(k,O)=>{at(k,$e(()=>t(O),{get assetCategory(){return t(a)}},()=>({isMainnet:$})))}),o(Qe);var zt=c(Qe,2);de(zt,21,()=>t(w).filter(k=>k.quantity<0).toReversed(),ue,(k,O)=>{at(k,$e(()=>t(O),{get assetCategory(){return t(a)}},()=>({isMainnet:$})))}),o(zt),o(Ie);var Mt=c(Ie,4);{var x0=k=>{var O=dn(),W=re(O);W.__click=[cn,Be];var oe=c(W,2);oe.__click=[ln,Be],_(k,O)},w0=k=>{var O=fn(),W=re(O);W.__click=[un,Be];var oe=c(W,2);oe.__click=[vn,Q],_e(),_(k,O)};C(Mt,k=>{t(g).length>0?k(x0):k(w0,!1)})}var jt=c(Mt,2);{var B0=k=>{var O=pn();_(k,O)};C(jt,k=>{t(g).length>0&&k(B0)})}var Ft=c(jt,2);de(Ft,17,()=>t(g),ue,(k,O,W)=>{var oe=bn(),Ee=d(oe),ut=d(Ee);{var vt=G=>{var ze=Ze("BID");_(G,ze)},ft=(G,ze)=>{{var mt=Me=>{var gt=Ze("ASK");_(Me,gt)},U0=Me=>{var gt=Ze("-");_(Me,gt)};C(G,Me=>{t(O).quantity<0?Me(mt):Me(U0,!1)},ze)}};C(ut,G=>{t(O).quantity>0?G(vt):G(ft,!1)})}o(Ee);var pt=c(Ee,2),Ht=d(pt);je(Ht),o(pt);var bt=c(pt,2),_t=d(bt);je(_t);var S0=c(_t,2);Ge(S0,{size:24,get category(){return t(a)}}),o(bt);var yt=c(bt,2),I0=d(yt);{var E0=G=>{var ze=Ze();V(mt=>N(ze,`${mt??""} sats`),[()=>Number(t(O).quantity*t(O).price).toLocaleString()]),_(G,ze)};C(I0,G=>{t(O).quantity*t(O).price>0&&G(E0)})}o(yt);var Vt=c(yt,2),Wt=d(Vt);Wt.__click=()=>Q(W+1);var A0=c(Wt,2);A0.__click=()=>{He(W)},o(Vt),o(oe),kt(Ht,()=>t(O).price,G=>t(O).price=G),kt(_t,()=>t(O).quantity,G=>t(O).quantity=G),_(k,oe)});var P0=c(Ft,2);{var T0=k=>{var O=_n();_(k,O)};C(P0,k=>{t(g).length>0&&k(T0)})}_e(2),_(ne,Te)};C(te,ne=>{t(I).length==0?ne(qe):ne(De,!1)},me)}};C(Re,te=>{t(ke)<1e3&&t(B).length==0?te(Ve):te(dt,!1)})}o(E),_(h,T)};C(Dt,h=>{t(z)&&h(O0)})}var Lt=c(Dt,8);de(Lt,21,()=>t(Y),ue,(h,T)=>{var E=gn(),K=d(E);Ge(K,{get category(){return t(T)},size:24}),o(E),_(h,E)}),o(Lt),V(()=>N(Nt,` ${t(he)??""} `)),ba(X,()=>t(a),h=>f(a,h)),ht(qt,()=>t(z),h=>f(z,h)),_(i,v)},m0=i=>{var v=kn();_(i,v)};C(At,i=>{t(u)=="CONNECTED"?i(y0):i(m0,!1)})}var st=c(At,4),Ut=d(st);je(Ut),_e(2),o(st);var g0=c(st,2);Ia(g0),o(It),ht(Ut,()=>t(ce),i=>f(ce,i)),_(b,Tt),Bt()}j0(["change","click"]);export{$n as component,Zn as universal};
//# sourceMappingURL=6.BOIB8BPt.js.map
