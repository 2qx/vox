{"version":3,"file":"10.DZ-JvC0j.js","sources":["../../../../../../../future/out/index.js","../../../../../../src/lib/Loading.svelte","../../../../../../src/routes/future/+page.svelte"],"sourcesContent":["import packageInfo from '../package.json' with { type: \"json\" };\nexport * from './channel.js';\nexport * from './constant.js';\nexport * from './coupon.js';\nexport * from './vault.js';\nexport const USER_AGENT = packageInfo.name;\n//# sourceMappingURL=index.js.map","<script>\n\tlet count = 3;\n\tlet time = 1.5;\n\tlet delay = 0.2;\n</script>\n\n<span>\n\t{#each Array(count) as _, i}\n\t  <span style:--i={i} style:--time=\"{time}s\" style:--delay=\"{delay}s\">.</span>\n\t{/each}\n</span>\n\n<style>\n  span {\n    display: inline-block;\n    font-size: large;\n  }\n\t\n  span > :where(span) {\n    animation: bounce var(--time) infinite;\n    animation-delay: calc(var(--i) * var(--delay));\n  }\n\t\n  @keyframes bounce {\n    0%,\n    25%,\n    75%,\n    100% {\n      opacity: 1;\n      transform: translateY(0);\n      animation-timing-function: cubic-bezier(0.8, 0, 1, 1);\n    }\n    50% {\n      opacity: 0.5;\n      transform: translateY(-25%);\n      animation-timing-function: cubic-bezier(0, 0, 0.2, 1);\n    }\n  }\n</style>\n","<script lang=\"ts\">\n\timport { onMount, onDestroy } from 'svelte';\n\timport { page } from '$app/state';\n\n\timport SeriesIcon from '$lib/FbchIcon.svelte';\n\timport Loading from '$lib/Loading.svelte';\n\timport Readme from './README.md';\n\n\timport BitauthLink from '$lib/BitauthLink.svelte';\n\timport CONNECTED from '$lib/images/connected.svg';\n\timport DISCONNECTED from '$lib/images/disconnected.svg';\n\n\timport { binToHex, cashAddressToLockingBytecode, encodeTransactionBCH } from '@bitauth/libauth';\n\n\timport { ElectrumClient, ConnectionStatus } from '@electrum-cash/network';\n\timport { BaseWallet, Wallet, TestNetWallet } from 'mainnet-js';\n\n\timport { IndexedDBProvider } from '@mainnet-cash/indexeddb-storage';\n\n\timport bch from '$lib/images/BCH.svg';\n\timport { getScriptHash, getHdPrivateKey, sumUtxoValue, sumTokenAmounts } from '@unspent/tau';\n\timport { Vault, USER_AGENT } from '@fbch/lib';\n\n\tlet now: number = $state(0);\n\n\tlet key = $state('');\n\tlet coupons: any[] = $state();\n\tlet electrumClient: any;\n\tlet walletScriptHash = $state('');\n\tlet amount = $state(0);\n\tlet connectionStatus = $state('');\n\tlet contractState = $state('');\n\n\n\tlet unspent: any[] = $state([]);\n\tlet walletUnspent: any[] = $state([]);\n\n\tlet walletBalance = $state(0);\n\n\tconst isMainnet = page.url.hostname == 'vox.cash';\n\tconst baseTicker = isMainnet ? 'FBCH' : 'tFBCH';\n\tconst prefix = isMainnet ? 'bitcoincash' : 'bchtest';\n\tconst server = isMainnet ? 'bch.imaginary.cash' : 'chipnet.bch.ninja';\n\n\tlet wallet: any;\n\n\tasync function updateCoupons() {\n\t\tif (electrumClient && now > 1000) {\n\t\t\tcoupons = await Vault.getAllCouponUtxos(electrumClient, now);\n\t\t}\n\t}\n\n    const updateWallet = async function () {\n\t\tlet response = await electrumClient.request(\n\t\t\t'blockchain.scripthash.listunspent',\n\t\t\twalletScriptHash,\n\t\t\t'include_tokens'\n\t\t);\n\t\tif (response instanceof Error) throw response;\n\t\tlet walletUnspentIds = new Set(response.map((utxo: any) => `${utxo.tx_hash}\":\"${utxo.tx_pos}`));\n\t\tif (walletUnspent.length == 0 ) {\n\t\t\twalletUnspent = response;\n\t\t}\n\t\twalletBalance = sumUtxoValue(walletUnspent, true);\n\t};\n\n\tconst handleNotifications = function (data: any) {\n\t\tif (data.method === 'blockchain.headers.subscribe') {\n\t\t\tlet d = data.params[0];\n\t\t\tnow = d.height;\n\t\t\tupdateCoupons();\n            updateWallet();\n\t\t} else if (data.method === 'blockchain.scripthash.subscribe') {\n\t\t\tif (data.params[1] !== contractState) {\n\t\t\t\tcontractState = data.params[1];\n\t\t\t\tconnectionStatus = ConnectionStatus[electrumClient.status];\n\t\t\t\tamount = 0;\n\t\t\t\t// debounceUpdateWallet();\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.log(data);\n\t\t}\n\t};\n\n\tonMount(async () => {\n\t\tBaseWallet.StorageProvider = IndexedDBProvider;\n\t\twallet = isMainnet ? await Wallet.named(`vox`) : await TestNetWallet.named(`vox`);\n\n\t\tkey = getHdPrivateKey(wallet.mnemonic!, wallet.derivationPath.slice(0, -2), wallet.isTestnet);\n\t\tlet lockcodeResult = cashAddressToLockingBytecode(wallet.getDepositAddress());\n\t\tif (typeof lockcodeResult == 'string') throw lockcodeResult;\n\t\twalletScriptHash = getScriptHash(lockcodeResult.bytecode);\n\n\t\t// Initialize an electrum client.\n\t\telectrumClient = new ElectrumClient(USER_AGENT, '1.4.1', server);\n\n\t\t// Wait for the client to connect.\n\t\tawait electrumClient.connect();\n\t\t// Set up a callback function to handle new blocks.\n\n\t\t// Listen for notifications.\n\t\telectrumClient.on('notification', handleNotifications);\n\n\t\t// Set up a subscription for new block headers.\n\t\tawait electrumClient.subscribe('blockchain.headers.subscribe');\n\t});\n</script>\n\n<section>\n\n\t<div class=\"status\">\n\t\t<BitauthLink template={Vault.template} />\n\t\t{#if connectionStatus == 'CONNECTED'}\n\t\t\t<img src={CONNECTED} alt={connectionStatus} />\n\t\t{:else}\n\t\t\t<img src={DISCONNECTED} alt=\"Disconnected\" />\n\t\t{/if}\n\t</div>\n\n\t{#if coupons}\n\t\t{#if coupons.length > 0}\n\t\t\t<table class=\"couponTable\">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr class=\"header\">\n\t\t\t\t\t\t<td>BCH</td>\n\t\t\t\t\t\t<td colspan=\"2\">FBCH</td>\n\t\t\t\t\t\t<td colspan=\"2\">Coupon </td>\n\t\t\t\t\t\t<td>Matures</td>\n\t\t\t\t\t\t<td>Action</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr class=\"units\">\n\t\t\t\t\t\t<td><img width=\"15\" src={bch} alt=\"bchLogo\" /></td>\n\t\t\t\t\t\t<td></td>\n\t\t\t\t\t\t<td>series</td>\n\t\t\t\t\t\t<td class=\"r\">sats</td>\n\t\t\t\t\t\t<td>apy</td>\n\t\t\t\t\t\t<td> </td>\n\t\t\t\t\t\t<td> </td>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\n\t\t\t\t<tbody>\n\t\t\t\t\t{#each coupons as c }\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td class=\"r\">{Number(c.placement / 1e8)}</td>\n\t\t\t\t\t\t\t<td class=\"r\"><SeriesIcon time={c.locktime} size=\"15\" /></td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<a style=\"color:#75006b; font-weight:600;\" href=\"/v?block={c.locktime}\"\n\t\t\t\t\t\t\t\t\t>{String(c.locktime).padStart(7, '0')}</a\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</td>\n\n\t\t\t\t\t\t\t<td class=\"sats\">{Number(c.value / 1000).toLocaleString()}k </td>\n\t\t\t\t\t\t\t<td class=\"r\">\n\t\t\t\t\t\t\t\t<i>{c.locale.ypa}%</i>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class=\"tiny\">{c.dateLocale}</td>\n\t\t\t\t\t\t\t<!-- {#if walletBalance + Number(c.value) > c.placement}\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\"\n\t\t\t\t\t\t\t\t\t><button class=\"action\" on:click={() => handlePlacement(c, c.id)}>claim</button\n\t\t\t\t\t\t\t\t\t></td\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\"\n\t\t\t\t\t\t\t\t\t><button class=\"action\" disabled style=\"font-size:xx-small;\">lo bal</button></td\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{/if} -->\n                            <td></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t{/each}\n\t\t\t\t\t<!-- <tr style=\"border-top: solid thin;\">\n\t\t\t\t\t\t\t<td>∑</td>\n\t\t\t\t\t\t\t<td class=\"r\"><b>{openCouponInterest.toFixed(0)} </b></td>\n\t\t\t\t\t\t\t<td class=\"r\">\n\t\t\t\t\t\t\t\t<b>{couponTotal.toLocaleString()} </b>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td></td>\n\t\t\t\t\t\t\t<td></td>\n\t\t\t\t\t\t\t<td></td>\n\t\t\t\t\t\t</tr> -->\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t\t<hr />\n\t\t\t<p style=\"font-size:small\">\n\t\t\t\t<i>sats (satoshis)</i>: one 100,000,000<sup>th</sup> of a whole coin.<br />\n\t\t\t\t<i>spb</i>: rate in sats per coin per block of time remaining to maturation.<br />\n\t\t\t\t<i>apy, coupon rate per annum</i>: effective non-compounding rate of annual return. Note:\n\t\t\t\tapproximate rates assume 870 sats network transaction fees (550 swap, 320 redeem)―paid to\n\t\t\t\tminers.\n\t\t\t</p>\n\t\t{:else}\n\t\t\t<p>no coupons available</p>\n\t\t{/if}\n\t{:else}\n\t\t<div style=\"text-align:center\">\n\t\t\t<h2>loading coupons</h2>\n\t\t\t<Loading />\n\t\t</div>\n\t{/if}\n\t<Readme />\n</section>\n\n<style>\n\t.status {\n\t\ttext-align: end;\n\t}\n\n    .couponTable {\n\t\twidth: 100%;\n\t\tborder-collapse: collapse;\n\t}\n\tthead tr td {\n\t\tborder: 2px ridge rgba(247, 202, 248, 0.6);\n\t\tbackground-color: #ffffff5b;\n\t}\n\n\tthead tr:nth-child(odd) {\n\t\ttext-align: center;\n\t\tfont-weight: 900;\n\t\tfont-size: small;\n\t}\n\n\t.action {\n\t\tdisplay: inline-block;\n\t\tborder-radius: 10px;\n\t\tbackground-color: #fa1ad5;\n\t\tcolor: #fff;\n\t\tmargin: 1px;\n\t\tpadding: 0 5px 0 5px;\n\t\tfont-weight: 900;\n\t\tfont-size: small;\n\t}\n\n\t.action:disabled {\n\t\tdisplay: inline-block;\n\t\tborder-radius: 10px;\n\t\tbackground-color: #80748069;\n\t\tcolor: #ffffff;\n\t\tmargin: 1px;\n\t\tpadding: 0 5px 0 5px;\n\t\tfont-weight: 900;\n\t\tfont-size: small;\n\t}\n\n\t.units {\n\t\ttext-align: center;\n\t\tfont-style: italic;\n\t\tfont-weight: 200;\n\t}\n\ttbody tr:nth-child(odd) {\n\t\tbackground-color: #ff33cc1f;\n\t}\n\ttbody tr:nth-child(even) {\n\t\tbackground-color: #e495e41a;\n\t}\n\t.r {\n\t\ttext-align: right;\n\t}\n\t.tiny {\n\t\tfont-weight: 100;\n\t\tfont-size: small;\n\t\ttext-align: right;\n\t}\n\t.sats {\n\t\ttext-align: right;\n\t\tfont-weight: 300;\n\t\tfont-style: italic;\n\t}\n\n\ttbody tr td {\n\t\tborder: 2px ridge rgba(247, 202, 248, 0.6);\n\t}\n</style>"],"names":["USER_AGENT","packageInfo","count","$.index","$$anchor","_","now","key","coupons","$.state","electrumClient","walletScriptHash","amount","connectionStatus","contractState","$.proxy","walletUnspent","walletBalance","isMainnet","page","server","wallet","updateCoupons","$.get","$.set","Vault","updateWallet","response","utxo","sumUtxoValue","handleNotifications","data","d","ConnectionStatus","onMount","BaseWallet","IndexedDBProvider","Wallet","TestNetWallet","getHdPrivateKey","lockcodeResult","cashAddressToLockingBytecode","getScriptHash","ElectrumClient","CONNECTED","DISCONNECTED","$$render","consequent","alternate","$.each","tbody","c","$.set_attribute","a","$.set_text","text_4","bch","consequent_1","alternate_1","consequent_2","alternate_2"],"mappings":"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"}