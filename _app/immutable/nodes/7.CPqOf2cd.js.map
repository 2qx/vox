{"version":3,"file":"7.CPqOf2cd.js","sources":["../../../../../../src/routes/db/+page.ts","../../../../../../../small/out/index.js","../../../../../../src/routes/db/+page.svelte"],"sourcesContent":["export const prerender = true;","import template from './template.v3.json' with { type: \"json\" };\nimport packageInfo from '../package.json' with { type: \"json\" };\nimport { binToHex, createVirtualMachineBch, encodeTransactionBch, generateTransaction, hexToBin, verifyTransactionTokens } from '@bitauth/libauth';\nimport { getAddress, getLibauthCompiler, getScriptHash, } from '@unspent/tau';\nexport default class SmallIndex {\n    static USER_AGENT = packageInfo.name;\n    static PROTOCOL_IDENTIFIER = \"U3R\";\n    static VERSION = \"1.0.0\";\n    static tokenAware = true;\n    static template = template;\n    static compiler = getLibauthCompiler(this.template);\n    static vm = createVirtualMachineBch();\n    static getLockingBytecode(indexKey) {\n        const lockingBytecodeResult = this.compiler.generateBytecode({\n            data: {\n                \"bytecode\": {\n                    \"key\": hexToBin(indexKey)\n                }\n            },\n            scriptId: 'lock'\n        });\n        if (!lockingBytecodeResult.success)\n            throw new Error('Failed to generate bytecode, script: , ' + JSON.stringify(lockingBytecodeResult, null, '  '));\n        return lockingBytecodeResult.bytecode;\n    }\n    /**\n     * Get cashaddress\n     *\n     * @param indexKey - the key for the record.\n     * @param reversed - whether to reverse the hash.\n     * @throws {Error} if transaction generation fails.\n     * @returns a cashaddress.\n     */\n    static getScriptHash(indexKey, reversed = true) {\n        return getScriptHash(this.getLockingBytecode(indexKey), reversed);\n    }\n    /**\n     * Get cashaddress\n     *\n     * @param indexKey - the key for the record.\n     * @param prefix - cashaddress prefix.\n     * @throws {Error} if transaction generation fails.\n     * @returns a cashaddress.\n     */\n    static getAddress(indexKey, prefix = \"bitcoincash\") {\n        return getAddress(this.getLockingBytecode(indexKey), prefix, this.tokenAware);\n    }\n    static getSourceOutput(indexKey, utxo) {\n        return {\n            lockingBytecode: this.getLockingBytecode(indexKey),\n            valueSatoshis: BigInt(utxo.value)\n        };\n    }\n    static getInput(indexKey, utxo) {\n        return {\n            outpointIndex: utxo.tx_pos,\n            outpointTransactionHash: hexToBin(utxo.tx_hash),\n            sequenceNumber: utxo.value,\n            unlockingBytecode: {\n                data: {\n                    \"bytecode\": {\n                        \"key\": hexToBin(indexKey)\n                    }\n                },\n                compiler: this.compiler,\n                script: 'unlock',\n                valueSatoshis: BigInt(utxo.value),\n            },\n        };\n    }\n    static getOutput() {\n        return {\n            lockingBytecode: {\n                data: {\n                // \"bytecode\": {\n                //     \"key\": hexToBin(indexKey)\n                // }\n                },\n                compiler: this.compiler,\n                script: 'op_return'\n            },\n            valueSatoshis: BigInt(0)\n        };\n    }\n    /**\n     * Drop an expired record.\n     *\n     * @param indexKey - The index key for the record being dropped\n     * @param utxo - contract record to drop.\n     *\n     * @throws {Error} if transaction generation fails.\n     * @returns a transaction template.\n     */\n    static drop(indexKey, utxo) {\n        const inputs = [];\n        const outputs = [];\n        let config = {\n            locktime: 0,\n            version: 2,\n            inputs,\n            outputs\n        };\n        config.inputs.push(this.getInput(indexKey, utxo));\n        config.outputs.push(this.getOutput());\n        let result = generateTransaction(config);\n        if (!result.success)\n            throw new Error('generate transaction failed!, errors: ' + JSON.stringify(result.errors, null, '  '));\n        const sourceOutputs = [this.getSourceOutput(indexKey, utxo)];\n        const transaction = result.transaction;\n        const tokenValidationResult = verifyTransactionTokens(transaction, sourceOutputs, { maximumTokenCommitmentLength: 40 });\n        if (tokenValidationResult !== true)\n            throw tokenValidationResult;\n        let verify = this.vm.verify({\n            sourceOutputs: sourceOutputs,\n            transaction: transaction,\n        });\n        if (typeof verify == \"string\")\n            throw verify;\n        return binToHex(encodeTransactionBch(transaction));\n    }\n}\n//# sourceMappingURL=index.js.map","<script lang=\"ts\">\n\timport Readme from './README.md';\n\n\timport BitauthLink from '$lib/BitauthLink.svelte';\n\timport CONNECTED from '$lib/images/connected.svg';\n\timport DISCONNECTED from '$lib/images/disconnected.svg';\n\n\timport SmallIndex from '@unspent/small';\n\n\tlet connectionStatus = $state('');\n</script>\n\n<section>\n\t<div class=\"status\">\n\t\t<BitauthLink template={SmallIndex.template} />\n\t\t{#if connectionStatus == 'CONNECTED'}\n\t\t\t<img src={CONNECTED} alt={connectionStatus} />\n\t\t{:else}\n\t\t\t<img src={DISCONNECTED} alt=\"Disconnected\" />\n\t\t{/if}\n\t</div>\n\n\t<Readme />\n</section>\n\n<style>\n\t.status {\n\t\ttext-align: end;\n\t}\n</style>\n"],"names":["prerender","SmallIndex","packageInfo","template","getLibauthCompiler","createVirtualMachineBch","indexKey","lockingBytecodeResult","hexToBin","reversed","getScriptHash","prefix","getAddress","utxo","config","result","generateTransaction","sourceOutputs","transaction","tokenValidationResult","verifyTransactionTokens","verify","binToHex","encodeTransactionBch","DISCONNECTED","$$render","alternate"],"mappings":"4cAAO,MAAMA,EAAY;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;iKCIV,MAAMC,CAAW,CAC5B,OAAO,WAAaC,EAAY,KAChC,OAAO,oBAAsB,MAC7B,OAAO,QAAU,QACjB,OAAO,WAAa,GACpB,OAAO,SAAWC,EAClB,OAAO,SAAWC,EAAmB,KAAK,QAAQ,EAClD,OAAO,GAAKC,EAAyB,EACrC,OAAO,mBAAmBC,EAAU,CAChC,MAAMC,EAAwB,KAAK,SAAS,iBAAiB,CACzD,KAAM,CACF,SAAY,CACR,IAAOC,EAASF,CAAQ,CAC5C,CACa,EACD,SAAU,MACtB,CAAS,EACD,GAAI,CAACC,EAAsB,QACvB,MAAM,IAAI,MAAM,0CAA4C,KAAK,UAAUA,EAAuB,KAAM,IAAI,CAAC,EACjH,OAAOA,EAAsB,QACrC,CASI,OAAO,cAAcD,EAAUG,EAAW,GAAM,CAC5C,OAAOC,EAAc,KAAK,mBAAmBJ,CAAQ,EAAGG,CAAQ,CACxE,CASI,OAAO,WAAWH,EAAUK,EAAS,cAAe,CAChD,OAAOC,EAAW,KAAK,mBAAmBN,CAAQ,EAAGK,EAAQ,KAAK,UAAU,CACpF,CACI,OAAO,gBAAgBL,EAAUO,EAAM,CACnC,MAAO,CACH,gBAAiB,KAAK,mBAAmBP,CAAQ,EACjD,cAAe,OAAOO,EAAK,KAAK,CACnC,CACT,CACI,OAAO,SAASP,EAAUO,EAAM,CAC5B,MAAO,CACH,cAAeA,EAAK,OACpB,wBAAyBL,EAASK,EAAK,OAAO,EAC9C,eAAgBA,EAAK,MACrB,kBAAmB,CACf,KAAM,CACF,SAAY,CACR,IAAOL,EAASF,CAAQ,CAChD,CACiB,EACD,SAAU,KAAK,SACf,OAAQ,SACR,cAAe,OAAOO,EAAK,KAAK,CACnC,CACJ,CACT,CACI,OAAO,WAAY,CACf,MAAO,CACH,gBAAiB,CACb,KAAM,CAIL,EACD,SAAU,KAAK,SACf,OAAQ,WACX,EACD,cAAe,OAAO,CAAC,CAC1B,CACT,CAUI,OAAO,KAAKP,EAAUO,EAAM,CAGxB,IAAIC,EAAS,CACT,SAAU,EACV,QAAS,EACT,OALW,CAAE,EAMb,QALY,CAAE,CAMjB,EACDA,EAAO,OAAO,KAAK,KAAK,SAASR,EAAUO,CAAI,CAAC,EAChDC,EAAO,QAAQ,KAAK,KAAK,UAAS,CAAE,EACpC,IAAIC,EAASC,EAAoBF,CAAM,EACvC,GAAI,CAACC,EAAO,QACR,MAAM,IAAI,MAAM,yCAA2C,KAAK,UAAUA,EAAO,OAAQ,KAAM,IAAI,CAAC,EACxG,MAAME,EAAgB,CAAC,KAAK,gBAAgBX,EAAUO,CAAI,CAAC,EACrDK,EAAcH,EAAO,YACrBI,EAAwBC,EAAwBF,EAAaD,EAAe,CAAE,6BAA8B,GAAI,EACtH,GAAIE,IAA0B,GAC1B,MAAMA,EACV,IAAIE,EAAS,KAAK,GAAG,OAAO,CACxB,cAAeJ,EACf,YAAaC,CACzB,CAAS,EACD,GAAI,OAAOG,GAAU,SACjB,MAAMA,EACV,OAAOC,EAASC,EAAqBL,CAAW,CAAC,CACzD,CACA,0LC1GyB,OAAAjB,EAAW,8DAIvBuB,CAAY,CAAA,kBAHaC,EAAAC,EAAA,EAAA"}