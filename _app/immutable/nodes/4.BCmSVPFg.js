import{f as B,a as y,c as Jt}from"../chunks/yGPdYsEk.js";import{o as Zt,a as te}from"../chunks/BL1kRCRP.js";import{p as It,s as v,f as lt,t as R,a as At,k as ee,c as b,r as f,as as ae,aF as d,a9 as bt,aa as i,j as t}from"../chunks/4Ej_4qXs.js";import{s as H,d as se}from"../chunks/BNpjwQLA.js";import{i as j}from"../chunks/CyUl1IAL.js";import{e as oe,i as ne}from"../chunks/PZPIYvej.js";import{s as P}from"../chunks/CnJGQRAh.js";import{p as _t}from"../chunks/CMYq0Xsf.js";import{b as ie}from"../chunks/C4jED5RM.js";import{j as A,g as re,k as ce,m as xt,o as le,i as yt,r as wt,v as Pt,w as ue,x as de,s as Bt,E as ct,p as Q,F as he,$ as Ot,G as Tt,H as Et,I as St,J as pe}from"../chunks/zIYK9qkZ.js";import{h as me,T as ge,W as ve,I as fe,B as ke}from"../chunks/DeOyqwJy.js";import{g as be}from"../chunks/gC8E2xLB.js";import"../chunks/Bq1uU4Db.js";import{i as _e}from"../chunks/CbXjFJPj.js";import{B as ye,C as we,D as Pe}from"../chunks/BbIwgq-g.js";import"../chunks/l0sNRNKZ.js";const Be=!0,ha=Object.freeze(Object.defineProperty({__proto__:null,prerender:Be},Symbol.toStringTag,{value:"Module"})),Oe="data:image/svg+xml,%3csvg%20style='height:400px;width:400px'%20version='1.1'%20viewBox='0%200%2016%2016'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='a'%20gradientTransform='rotate(75)'%3e%3cstop%20stop-color='%23f00'%20offset='.05'/%3e%3cstop%20stop-color='%2300808099'%20offset='.95'/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='m6%201c-2.77%200-5%202.23-5%205v4c0%202.77%202.23%205%205%205h4c2.77%200%205-2.23%205-5v-4c0-2.77-2.23-5-5-5h-4zm2%206a1%201%200%200%201%201%201%201%201%200%200%201-1%201%201%201%200%200%201-1-1%201%201%200%200%201%201-1z'%20fill='url(%23a)'/%3e%3c/svg%3e",Te="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20style='width:400px;%20height:400px;'%3e%3cdefs%3e%3clinearGradient%20id='grad'%20gradientTransform='rotate(75)'%3e%3cstop%20offset='5%25'%20stop-color='aqua'%20/%3e%3cstop%20offset='95%25'%20stop-color='%2300808099'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20style='fill:url(%23grad)'%20d='M%206%201%20C%203.23%201%201%203.23%201%206%20L%201%2010%20C%201%2012.77%203.23%2015%206%2015%20L%2010%2015%20C%2012.77%2015%2015%2012.77%2015%2010%20L%2015%206%20C%2015%203.23%2012.77%201%2010%201%20L%206%201%20z%20M%208%207%20A%201%201%200%200%201%209%208%20A%201%201%200%200%201%208%209%20A%201%201%200%200%201%207%208%20A%201%201%200%200%201%208%207%20z%20'%20/%3e%3c/svg%3e",Ee="https://libauth.org/schemas/wallet-template-v0.schema.json",Se="BlockPoints: A coin age reward token",Ie="BlockPoints",Ae={covenant:{description:"Emit tokens as reward to holders.",name:"BlockPoint Vault",scripts:["lock","unlock"],variables:{age:{description:"The input age (as a number of blocks) claimed to withdraw tokens. The maximum age that can be used to claim tokens is the lessor of covenant thread age or user coins age being used to release tokens.",name:"Age",type:"WalletData"}}},wallet:{scripts:["wallet_unlock","wallet_lock"],variables:{key:{description:"The private key that controls this wallet.",name:"Key",type:"HdKey"}}}},xe={base:{data:{bytecode:{age:"10"}},description:"",name:"Base Scenario",transaction:{inputs:[{outpointTransactionHash:"0e09765ada34fa0bd94ef9df8497173e8aefc560f3eb7c9e0e88b345c4cccb36",outpointIndex:0,unlockingBytecode:["slot"],sequenceNumber:1}]}},release:{name:"Release Tokens",description:"",extends:"base",data:{bytecode:{age:"10"}},transaction:{inputs:[{unlockingBytecode:["slot"],sequenceNumber:10}],outputs:[{lockingBytecode:{script:"lock"},valueSatoshis:800}],locktime:11,version:2},sourceOutputs:[{lockingBytecode:["slot"],valueSatoshis:800}]}},Ne={unlock:{passes:["release"],name:"Unlock Tokens",script:"<age> // ",unlocks:"lock"},lock:{lockingType:"p2sh32",name:"BlockPoint Covenant",script:`// Force a block based relative timelock
   <500000000> OP_OVER OP_GREATERTHANOREQUAL OP_VERIFY
// require(500000000 >= age);
        
// Ensure the first input exceeds the age claimed
   OP_0 OP_INPUTSEQUENCENUMBER OP_OVER OP_GREATERTHANOREQUAL OP_VERIFY
// require(tx.inputs[0].sequenceNumber >= age);
        
// Require the token vault thread to exceed the age claimed
   OP_DUP OP_CHECKSEQUENCEVERIFY OP_DROP
// require(this.age >= age);

// Allow anyone to withdraw a token amount proportional to the value of their aged utxo.
// Note: to convert block satoshis to coindays: 144 * 100_000_000 
// 
   OP_INPUTINDEX OP_OUTPUTTOKENAMOUNT 
   OP_INPUTINDEX OP_UTXOTOKENAMOUNT 
   OP_ROT OP_0 OP_UTXOVALUE OP_MUL <100000000> OP_DIV OP_SUB OP_GREATERTHANOREQUAL OP_VERIFY
//  require(
//      tx.outputs[this.activeInputIndex].tokenAmount >= 
//      tx.inputs[this.activeInputIndex].tokenAmount - 
//      (age * tx.inputs[0].value/100000000)
//  );

// This thread must be in the last input position
// to prevent users building transactions with multiple airdrop threads. 
//
   OP_INPUTINDEX OP_1ADD OP_TXINPUTCOUNT OP_NUMEQUAL
// require(this.activeInputIndex+1 == tx.inputs.length);
`},wallet_unlock:{name:"Wallet Unlock",script:"<key.schnorr_signature.all_outputs> <key.public_key>",unlocks:"wallet_lock"},wallet_lock:{lockingType:"standard",name:"Wallet Lock",script:"OP_DUP OP_HASH160 <$(<key.public_key> OP_HASH160)> OP_EQUALVERIFY OP_CHECKSIG"}},Ce=["BCH_2023_05","BCH_SPEC"],Ue=0,Re={$schema:Ee,description:Se,name:Ie,entities:Ae,scenarios:xe,scripts:Ne,supported:Ce,version:Ue},He="@unspent/blockpoint",Le={name:He},X=A("7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"),$e=A("ffc9d3b3488e890ef113b1c74f40e1f5eb1147a7d4191cecac89fd515721a271");class q{static USER_AGENT=Le.name;static tokenAware=!0;static template=Re;static compiler=re(this.template);static vm=ce();static getLockingBytecode(e={}){const s=this.compiler.generateBytecode({data:e,scriptId:"lock"});if(!s.success)throw new Error("Failed to generate bytecode, script: , "+JSON.stringify(s,null,"  "));return s.bytecode}static getScriptHash(e=!0){return xt(this.getLockingBytecode(),e)}static getAddress(e="bitcoincash"){return le(this.getLockingBytecode(),e,this.tokenAware)}static getSourceOutput(e){return{lockingBytecode:this.getLockingBytecode(),valueSatoshis:BigInt(e.value),token:{category:A(e.token_data.category),amount:BigInt(e.token_data?.amount)}}}static getInput(e,s){return{outpointIndex:e.tx_pos,outpointTransactionHash:A(e.tx_hash),sequenceNumber:s,unlockingBytecode:{data:{bytecode:{age:yt(BigInt(s))}},compiler:this.compiler,script:"unlock",valueSatoshis:BigInt(e.value)}}}static getOutput(e,s,n){return{lockingBytecode:{data:{bytecode:{age:yt(BigInt(n))}},compiler:this.compiler,script:"lock"},valueSatoshis:BigInt(e.value),token:{category:A(e.token_data.category),amount:BigInt(e.token_data?.amount)-BigInt(s)}}}static getWalletSourceOutput(e,s){return{lockingBytecode:s?me({addressIndex:0,hdPrivateKey:s}):Uint8Array.from(Array(33)),valueSatoshis:BigInt(e.value),token:e.token_data?{category:A(e.token_data.category),amount:BigInt(e.token_data?.amount)}:void 0}}static getWalletInput(e,s,n,r=0){const h=n?{compiler:this.compiler,data:{hdKeys:{addressIndex:r,hdPrivateKeys:{wallet:n}}},script:"wallet_unlock",valueSatoshis:BigInt(e.value)}:Uint8Array.from(Array());return{outpointIndex:e.tx_pos,outpointTransactionHash:A(e.tx_hash),sequenceNumber:s,unlockingBytecode:h}}static getTokenOutput(e,s,n=0,r=X){return{lockingBytecode:s?{compiler:this.compiler,data:{hdKeys:{addressIndex:n,hdPublicKeys:{wallet:wt(s).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:800n,token:{category:r,amount:BigInt(e)}}}static getChangeOutput(e,s,n=0){return{lockingBytecode:s?{compiler:this.compiler,data:{hdKeys:{addressIndex:n,hdPublicKeys:{wallet:wt(s).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:BigInt(e.value)-800n}}static getSourceOutputs(e,s,n){const r=[];return r.push(this.getWalletSourceOutput(s,n)),r.push(this.getSourceOutput(e)),r}static claim(e,s,n,r,h,O=1){const M=[],W=[];let c=h?A(h):X;const g=n.height>s.height?n.height:s.height,T=e-g,p=Math.floor(T*n.value/1e8);let m={locktime:0,version:2,inputs:M,outputs:W};m.inputs.push(this.getWalletInput(n,T,r)),m.outputs.push(this.getTokenOutput(p,r,0,c)),m.inputs.push(this.getInput(s,T)),m.outputs.push(this.getOutput(s,p,T)),m.outputs.push(this.getChangeOutput(n,r,0));let k=Pt(m);if(!k.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(k.errors,null,"  "));const K=ue(k.transaction,O);if(m.outputs[2].valueSatoshis=m.outputs[2].valueSatoshis-K,k=Pt(m),!k.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(k.errors,null,"  "));const w=this.getSourceOutputs(s,n,r),x=k.transaction,F=de(x,w);if(F!==!0&&O>0)throw F;let _=this.vm.verify({sourceOutputs:w,transaction:x}),N=Bt(w)-Bt(x.outputs);N>5e3&&(_=`Excessive fees ${N}`),ct(w,h)==0n&&(_="Error checking token input");let E=ct(w,h)-ct(x.outputs,h);return E!==0n&&(_=`Swapping should not create destroy tokens, token difference: ${E}`),{sourceOutputs:w,transaction:x,verify:_}}}var De=B('<h3>About Block Points</h3> <p>Block Points (BPTS) are a reward token distributed based on the value and age of coins users have already hold.</p> <p>The CashToken category id for Block Points is:</p> <p><a href="https://explorer.salemkode.com/token/7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c" rel="nofollow"> </a></p> <p>All 9.2 quintillion Block Points were <a href="https://explorer.salemkode.com/tx/2420c5803f7318160bd4ed6729eecb8385688b79fa5653b8c64a1a8167b5e79f" rel="nofollow">minted in this transaction</a>. The entire circulating supply was then sent to the Block Point vault contract in <a href="https://explorer.salemkode.com/address/bitcoincash:r0ak899wsk9mr9wz78tw2pnppumzry6ypejfvsad6u4vrj4kdewpwsmza35av" rel="nofollow">this transaction</a>.</p> <p>The Block Point vault can only release tokens based on the age of the vault thread or coin being used (whichever utxo is younger). The vault can release tokens at a rate of one Block Point (1 BPTS) per coin per block. Users with that don’t have a whole coin can claim rewards at the same rate as user with many blocks.</p> <p>Anytime coins are moved, the age of the coin resets. So don’t move coins to claim Block Points, wait until you can sign with the wallet you have.</p>',1);function Ve(L,e){It(e,!1),_e();var s=De(),n=v(lt(s),6),r=b(n),h=b(r,!0);f(r),f(n),ae(6),R(O=>H(h,O),[()=>Q(X)],ee),y(L,s),At()}var qe=B("<img/>"),Me=B('<img alt="Disconnected"/>'),We=(L,e)=>e(),Ke=B('<button class="action svelte-68h058"><img width="100" alt="bptLogo"/><br/> </button>'),Fe=B('<button class="action svelte-68h058" disabled><img width="100" alt="bptLogo"/><br/> </button>'),Ge=B('<div class="row svelte-68h058"><!></div>'),ze=B('<div class="swap svelte-68h058"><button class="svelte-68h058">Claim All Rewards</button></div> <h4>Wallet Unspent Transaction Outputs (coins)</h4> <div class="grid svelte-68h058"></div>',1),je=B('<div class="swap svelte-68h058"><p>No confirmed coins to claim Block Points, check back in a few minutes.</p></div>'),Qe=B('<section><div class="status svelte-68h058"><!> <!></div> <h1>Claim Block Point Rewards</h1> <div class="swap svelte-68h058"><div class="svelte-68h058"><img width="50"/> <br/> </div> <div class="svelte-68h058"><img width="50"/> <br/> </div></div> <!> <!></section>');function pa(L,e){It(e,!0);let s=d(0),n=d(""),r=d(""),h=d(""),O,M=d(!1),W,c=d(bt([])),g=d(bt([])),T=d(""),p=d(void 0),m=d(""),k=d(""),K=d(0n),w=d(0),x=d(0n),F=d(0);i(m,q.getScriptHash(),!0);const _=_t.url.hostname=="vox.cash",N=_?Te:Oe,E=_?Q(X):Q($e),ut=_?"BCH":"tBCH",G=_?"BPTS":"tBPTS",dt=_?"bch.imaginary.cash":"chipnet.bch.ninja";let Nt=new Set,ht=0,$,Y="";const Ct=async function(a){if(a.method==="blockchain.headers.subscribe"){let o=a.params[0];i(s,o.height,!0)}else a.method==="blockchain.scripthash.subscribe"?a.params[1]!==t(r)&&(i(r,a.params[1],!0),i(n,Tt[t(p).status],!0),Ut()):console.log(a)},Ut=()=>{clearTimeout(ht),ht=setTimeout(()=>{Rt(),Ht()},1500)},Rt=async function(){let a=await t(p).request("blockchain.scripthash.listunspent",t(k),"include_tokens");if(a instanceof Error)throw a;i(g,a,!0),i(w,Et(t(g),!0),!0),i(K,St(t(g),E),!0),i(g,t(g).filter(o=>!o.token_data).filter(o=>o.height>0),!0)},Ht=async function(){let a=await t(p).request("blockchain.scripthash.listunspent",t(m),"include_tokens");if(a instanceof Error)throw a;let o=new Set(a.map(l=>`${l.tx_hash}":"${l.tx_pos}`));(t(c).length==0||Nt.intersection(o).size==0)&&i(c,a,!0),i(c,t(c).filter(l=>l.height>0),!0),i(c,t(c).filter(l=>l.token_data&&l.token_data.category==E),!0),t(c).sort((l,D)=>l.height-D.height),i(F,Et(t(c),!0),!0),i(x,St(t(c),E),!0)},Lt=async function(a){let o=await t(p).request("blockchain.transaction.broadcast",a);if(o instanceof Error)throw i(n,Tt[t(p).status],!0),o},$t=function(){t(g).map((a,o)=>{pt(t(s),t(c)[o],a,t(T),E)})},pt=function(a,o,l,D,z){try{i(g,t(g).filter(u=>`${u.tx_hash}:${u.tx_pos}`!=`${l.tx_hash}:${l.tx_pos}`),!0);let S=q.claim(a,o,l,D,z);O=S.transaction,W=S.sourceOutputs,i(h,Q(pe(O)),!0),Lt(t(h)),i(M,S.verify===!0,!0),S.verify===!0&&(Y="")}catch(S){O=void 0,W=void 0,i(h,""),i(M,!1),Y=S}};Zt(async()=>{const a=_t.url.hostname!=="vox.cash";ke.StorageProvider=fe,$=a?await ge.named("vox"):await ve.named("vox"),i(T,be($.mnemonic,$.derivationPath.slice(0,-2),$.isTestnet),!0);let o=he($.getDepositAddress());if(typeof o=="string")throw o;i(k,xt(o.bytecode),!0),i(p,new Ot(q.USER_AGENT,"1.4.1",dt),!0),await t(p).connect(),t(p).on("notification",Ct),await t(p).subscribe("blockchain.scripthash.subscribe",t(m)),await t(p).subscribe("blockchain.scripthash.subscribe",t(k)),await t(p).subscribe("blockchain.headers.subscribe")}),te(async()=>{await new Ot(q.USER_AGENT,"1.4.1",dt).disconnect()});var J=Qe(),Z=b(J),mt=b(Z);ye(mt,{get template(){return q.template}});var Dt=v(mt,2);{var Vt=a=>{var o=qe();R(()=>{P(o,"src",we),P(o,"alt",t(n))}),y(a,o)},qt=a=>{var o=Me();R(()=>P(o,"src",Pe)),y(a,o)};j(Dt,a=>{t(n)=="CONNECTED"?a(Vt):a(qt,!1)})}f(Z);var tt=v(Z,4),et=b(tt),at=b(et),Mt=v(at,3);f(et);var gt=v(et,2),st=b(gt),Wt=v(st,3);f(gt),f(tt);var vt=v(tt),ft=v(vt);{var Kt=a=>{var o=ze(),l=lt(o),D=b(l);D.__click=[We,$t],f(l);var z=v(l,4);oe(z,21,()=>t(g),ne,(S,u,C)=>{var kt=Jt(),zt=lt(kt);{var jt=ot=>{var nt=Ge(),Qt=b(nt);{var Xt=U=>{var I=Ke();I.__click=()=>pt(t(s),t(c)[C],t(u),t(T),E);var V=b(I),it=v(V,2);f(I),R(rt=>{P(V,"src",N),H(it,` Claim ${rt??""}
								${G}`)},[()=>t(u).height>t(c)[C].height?Math.floor((t(s)-t(u).height)*t(u).value/1e8):Math.floor((t(s)-t(c)[C].height)*t(u).value/1e8)]),y(U,I)},Yt=U=>{var I=Fe(),V=b(I),it=v(V,2);f(I),R(rt=>{P(V,"src",N),H(it,` ${rt??""}
								${G}`)},[()=>t(u).height>t(c)[C].height?((t(s)-t(u).height)*t(u).value/1e8).toLocaleString(void 0,{minimumFractionDigits:4}):((t(s)-t(c)[C].height)*t(u).value/1e8).toLocaleString(void 0,{minimumFractionDigits:4})]),y(U,I)};j(Qt,U=>{Math.floor((t(s)-t(u).height)*t(u).value/1e8)>=1?U(Xt):U(Yt,!1)})}f(nt),y(ot,nt)};j(zt,ot=>{!t(u).token_data&&t(c)[C]&&ot(jt)})}y(S,kt)}),f(z),y(a,o)},Ft=a=>{var o=je();y(a,o)};j(ft,a=>{t(g).length>0?a(Kt):a(Ft,!1)})}var Gt=v(ft,2);Ve(Gt,{}),f(J),R((a,o)=>{P(at,"src",ie),P(at,"alt",ut),H(Mt,` ${a??""} sats ${ut}`),P(st,"src",N),P(st,"alt",G),H(Wt,` ${o??""}
			${G}`),H(vt,` ${Y??""} `)},[()=>t(w).toLocaleString(),()=>t(K).toLocaleString()]),y(L,J),At()}se(["click"]);export{pa as component,ha as universal};
//# sourceMappingURL=4.BCmSVPFg.js.map
