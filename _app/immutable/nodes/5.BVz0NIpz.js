import{f as _,a as g,c as ot}from"../chunks/DTc5U4eY.js";import{o as st,a as nt}from"../chunks/_R59KZhj.js";import{p as Ie,s as k,f as J,t as L,a as Ae,J as it,c as w,r as b,aA as rt,aB as u,ao as _e,ak as i,ay as ct,I as e}from"../chunks/CQU5mOuk.js";import{s as $,d as lt,h as ut}from"../chunks/CF3aPdyL.js";import{i as K}from"../chunks/CZ0rTjPC.js";import{e as dt,i as ht}from"../chunks/CbL2L94E.js";import{s as P}from"../chunks/-rOGAMhN.js";import{p as pt}from"../chunks/B0rm-kda.js";import{B as mt,t as gt}from"../chunks/B2Xzehbr.js";import{$ as ye,a as we}from"../chunks/BDt1pbpk.js";import{h as vt,I as ft,B as kt,W as bt,T as _t,g as yt}from"../chunks/BTBIn4-B.js";import{h as x,g as wt,d as xe,e as Bt,t as Be,B as Pe,f as Te,C as Pt,v as Tt,q as Oe,D as ue,b as Z,j as Ot,s as Ee,n as Se,E as Et}from"../chunks/BQUio51k.js";import{c as St}from"../chunks/DGwzT_kg.js";import"../chunks/CuzQ0eOn.js";import{i as It}from"../chunks/DiAzQF1U.js";import{B as At}from"../chunks/BzLj6JBc.js";/* empty css                */import{C as xt}from"../chunks/B7hCbxZp.js";import{D as Ct}from"../chunks/DMvn4Q5j.js";const Nt=!0,Ea=Object.freeze(Object.defineProperty({__proto__:null,prerender:Nt},Symbol.toStringTag,{value:"Module"})),Ut="data:image/svg+xml,%3csvg%20style='height:400px;width:400px'%20version='1.1'%20viewBox='0%200%2016%2016'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='a'%20gradientTransform='rotate(75)'%3e%3cstop%20stop-color='%23f00'%20offset='.05'/%3e%3cstop%20stop-color='%2300808099'%20offset='.95'/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='m6%201c-2.77%200-5%202.23-5%205v4c0%202.77%202.23%205%205%205h4c2.77%200%205-2.23%205-5v-4c0-2.77-2.23-5-5-5h-4zm2%206a1%201%200%200%201%201%201%201%201%200%200%201-1%201%201%201%200%200%201-1-1%201%201%200%200%201%201-1z'%20fill='url(%23a)'/%3e%3c/svg%3e",Rt="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20style='width:400px;%20height:400px;'%3e%3cdefs%3e%3clinearGradient%20id='grad'%20gradientTransform='rotate(75)'%3e%3cstop%20offset='5%25'%20stop-color='aqua'%20/%3e%3cstop%20offset='95%25'%20stop-color='%2300808099'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20style='fill:url(%23grad)'%20d='M%206%201%20C%203.23%201%201%203.23%201%206%20L%201%2010%20C%201%2012.77%203.23%2015%206%2015%20L%2010%2015%20C%2012.77%2015%2015%2012.77%2015%2010%20L%2015%206%20C%2015%203.23%2012.77%201%2010%201%20L%206%201%20z%20M%208%207%20A%201%201%200%200%201%209%208%20A%201%201%200%200%201%208%209%20A%201%201%200%200%201%207%208%20A%201%201%200%200%201%208%207%20z%20'%20/%3e%3c/svg%3e",Dt="https://libauth.org/schemas/wallet-template-v0.schema.json",Ht="BlockPoints: A coin age reward token",Lt="BlockPoints",$t={covenant:{description:"Emit tokens as reward to holders.",name:"BlockPoint Vault",scripts:["lock","unlock"],variables:{age:{description:"The input age (as a number of blocks) claimed to withdraw tokens. The maximum age that can be used to claim tokens is the lessor of covenant thread age or user coins age being used to release tokens.",name:"Age",type:"WalletData"}}},wallet:{scripts:["wallet_unlock","wallet_lock"],variables:{key:{description:"The private key that controls this wallet.",name:"Key",type:"HdKey"}}}},qt={base:{data:{bytecode:{age:"10"}},description:"",name:"Base Scenario",transaction:{inputs:[{outpointTransactionHash:"0e09765ada34fa0bd94ef9df8497173e8aefc560f3eb7c9e0e88b345c4cccb36",outpointIndex:0,unlockingBytecode:["slot"],sequenceNumber:1}]}},release:{name:"Release Tokens",description:"",extends:"base",data:{bytecode:{age:"10"}},transaction:{inputs:[{unlockingBytecode:["slot"],sequenceNumber:10}],outputs:[{lockingBytecode:{script:"lock"},valueSatoshis:800}],locktime:11,version:2},sourceOutputs:[{lockingBytecode:["slot"],valueSatoshis:800}]}},zt={unlock:{passes:["release"],name:"Unlock Tokens",script:"<age> // ",unlocks:"lock"},lock:{lockingType:"p2sh32",name:"BlockPoint Covenant",script:`// Force a block based relative timelock
   <500000000> OP_OVER OP_GREATERTHANOREQUAL OP_VERIFY
// require(500000000 >= age);
        
// Ensure the first input exceeds the age claimed
   OP_0 OP_INPUTSEQUENCENUMBER OP_OVER OP_GREATERTHANOREQUAL OP_VERIFY
// require(tx.inputs[0].sequenceNumber >= age);
        
// Require the token vault thread to exceed the age claimed
   OP_DUP OP_CHECKSEQUENCEVERIFY OP_DROP
// require(this.age >= age);

// Allow anyone to withdraw a token amount proportional to the value of their aged utxo.
// Note: to convert block satoshis to coindays: 144 * 100_000_000 
// 
   OP_INPUTINDEX OP_OUTPUTTOKENAMOUNT 
   OP_INPUTINDEX OP_UTXOTOKENAMOUNT 
   OP_ROT OP_0 OP_UTXOVALUE OP_MUL <100000000> OP_DIV OP_SUB OP_GREATERTHANOREQUAL OP_VERIFY
//  require(
//      tx.outputs[this.activeInputIndex].tokenAmount >= 
//      tx.inputs[this.activeInputIndex].tokenAmount - 
//      (age * tx.inputs[0].value/100000000)
//  );

// This thread must be in the last input position
// to prevent users building transactions with multiple airdrop threads. 
//
   OP_INPUTINDEX OP_1ADD OP_TXINPUTCOUNT OP_NUMEQUAL
// require(this.activeInputIndex+1 == tx.inputs.length);
`},wallet_unlock:{name:"Wallet Unlock",script:"<key.schnorr_signature.all_outputs> <key.public_key>",unlocks:"wallet_lock"},wallet_lock:{lockingType:"standard",name:"Wallet Lock",script:"OP_DUP OP_HASH160 <$(<key.public_key> OP_HASH160)> OP_EQUALVERIFY OP_CHECKSIG"}},Vt=["BCH_2023_05","BCH_SPEC"],Mt=0,Wt={$schema:Dt,description:Ht,name:Lt,entities:$t,scenarios:qt,scripts:zt,supported:Vt,version:Mt},Kt="@unspent/blockpoint",Ft={name:Kt},ee=x("7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"),Gt=x("ffc9d3b3488e890ef113b1c74f40e1f5eb1147a7d4191cecac89fd515721a271");class F{static USER_AGENT=Ft.name;static tokenAware=!0;static template=Wt;static compiler=wt(this.template);static vm=St();static getLockingBytecode(a={}){const o=this.compiler.generateBytecode({data:a,scriptId:"lock"});if(!o.success)throw new Error("Failed to generate bytecode, script: , "+JSON.stringify(o,null,"  "));return o.bytecode}static getScriptHash(a=!0){return xe(this.getLockingBytecode(),a)}static getAddress(a="bitcoincash"){return Bt(this.getLockingBytecode(),a,this.tokenAware)}static getSourceOutput(a){return{lockingBytecode:this.getLockingBytecode(),valueSatoshis:BigInt(a.value),token:{category:x(a.token_data.category),amount:BigInt(a.token_data?.amount)}}}static getInput(a,o){return{outpointIndex:a.tx_pos,outpointTransactionHash:x(a.tx_hash),sequenceNumber:o,unlockingBytecode:{data:{bytecode:{age:Be(BigInt(o))}},compiler:this.compiler,script:"unlock",valueSatoshis:BigInt(a.value)}}}static getOutput(a,o,n){return{lockingBytecode:{data:{bytecode:{age:Be(BigInt(n))}},compiler:this.compiler,script:"lock"},valueSatoshis:BigInt(a.value),token:{category:x(a.token_data.category),amount:BigInt(a.token_data?.amount)-BigInt(o)}}}static getWalletSourceOutput(a,o){return{lockingBytecode:o?vt({addressIndex:0,hdPrivateKey:o}):Uint8Array.from(Array(33)),valueSatoshis:BigInt(a.value),token:a.token_data?{category:x(a.token_data.category),amount:BigInt(a.token_data?.amount)}:void 0}}static getWalletInput(a,o,n,r=0){const d=n?{compiler:this.compiler,data:{hdKeys:{addressIndex:r,hdPrivateKeys:{wallet:n}}},script:"wallet_unlock",valueSatoshis:BigInt(a.value)}:Uint8Array.from(Array());return{outpointIndex:a.tx_pos,outpointTransactionHash:x(a.tx_hash),sequenceNumber:o,unlockingBytecode:d}}static getTokenOutput(a,o,n=0,r=ee){return{lockingBytecode:o?{compiler:this.compiler,data:{hdKeys:{addressIndex:n,hdPublicKeys:{wallet:Pe(o).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:800n,token:{category:r,amount:BigInt(a)}}}static getChangeOutput(a,o,n=0){return{lockingBytecode:o?{compiler:this.compiler,data:{hdKeys:{addressIndex:n,hdPublicKeys:{wallet:Pe(o).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:BigInt(a.value)-800n}}static getSourceOutputs(a,o,n){const r=[];return r.push(this.getWalletSourceOutput(o,n)),r.push(this.getSourceOutput(a)),r}static claim(a,o,n,r,d,T=1){const G=[],Q=[];let c=d?x(d):ee;const v=n.height>o.height?n.height:o.height,O=a-v,h=Math.floor(O*n.value/1e8);let p={locktime:0,version:2,inputs:G,outputs:Q};p.inputs.push(this.getWalletInput(n,O,r)),p.outputs.push(this.getTokenOutput(h,r,0,c)),p.inputs.push(this.getInput(o,O)),p.outputs.push(this.getOutput(o,h,O)),p.outputs.push(this.getChangeOutput(n,r,0));let y=Te(p);if(!y.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(y.errors,null,"  "));const X=Pt(y.transaction,T);if(p.outputs[2].valueSatoshis=p.outputs[2].valueSatoshis-X,y=Te(p),!y.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(y.errors,null,"  "));const B=this.getSourceOutputs(o,n,r),C=y.transaction,j=Tt(C,B,{maximumTokenCommitmentLength:40});if(j!==!0&&T>0)throw j;let m=this.vm.verify({sourceOutputs:B,transaction:C});if(typeof m=="string")throw Error(m);let U=Oe(B)-Oe(C.outputs);U>5e3&&(m=`Excessive fees ${U}`),ue(B,d)==0n&&(m="Error checking token input");let E=ue(B,d)-ue(C.outputs,d);if(E!==0n)throw Error(`Claiming should not create destroy tokens, token difference: ${E}`);return{sourceOutputs:B,transaction:C,verify:m}}}var Qt=_('<h3>About Block Points</h3> <p>Block Points (BPTS) are a reward token distributed based on the value and age of coins users have already hold.</p> <p>The CashToken category id for Block Points is:</p> <p><a href="https://explorer.salemkode.com/token/7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c" rel="nofollow"> </a></p> <p>All 9.2 quintillion Block Points were <a href="https://explorer.salemkode.com/tx/2420c5803f7318160bd4ed6729eecb8385688b79fa5653b8c64a1a8167b5e79f" rel="nofollow">minted in this transaction</a>. The entire circulating supply was then sent to the Block Point vault contract in <a href="https://explorer.salemkode.com/tx/f283a9e7c297b8f2688073d055822da74deadac9050dc0785326ee264ff51b53" rel="nofollow">this transaction</a>.</p> <p>The Block Point vault can only release tokens based on the age of the vault thread or coin being used (whichever utxo is younger). The vault can release tokens at a rate of one Block Point (1 BPTS) per coin per block. Users with that donâ€™t have a whole coin can claim rewards at the same rate as user with many blocks.</p> <p>Anytime coins are moved, the age of the coin resets. So donâ€™t move coins to claim Block Points, wait until you can sign with the wallet you have.</p>',1);function Xt(q,a){Ie(a,!1),It();var o=Qt(),n=k(J(o),6),r=w(n),d=w(r,!0);b(r),b(n),rt(6),L(T=>$(d,T),[()=>Z(ee)],it),g(q,o),Ae()}var jt=_('<meta name="description" content="Claim rewards for coins held."/>'),Yt=_("<img/>"),Jt=_('<img alt="Disconnected"/>'),Zt=(q,a)=>a(),ea=_('<button class="action svelte-ob4ehz"><img width="100" alt="bptLogo"/><br/> </button>'),ta=_('<button class="action svelte-ob4ehz" disabled><img width="100" alt="bptLogo"/><br/> </button>'),aa=_('<div class="row svelte-ob4ehz"><!></div>'),oa=_('<div class="swap svelte-ob4ehz"><button class="svelte-ob4ehz">Claim All Rewards</button></div> <h4>Wallet Unspent Transaction Outputs (coins)</h4> <div class="grid svelte-ob4ehz"></div>',1),sa=_('<div class="swap svelte-ob4ehz"><p><a href="/wallet">Deposit funds</a> to claim block points.</p></div>'),na=_('<div class="swap svelte-ob4ehz"><div class="svelte-ob4ehz"><img width="50"/> <br/> </div> <div class="svelte-ob4ehz"><img width="50"/> <br/> </div></div> <!>',1),ia=_('<div class="swap svelte-ob4ehz"><p>Not connected.</p></div>'),ra=_('<section><div class="status svelte-ob4ehz"><!> <!></div> <h1>Claim Block Point Rewards</h1> <!> <!></section>');function Sa(q,a){Ie(a,!0);let o=u(0),n=u(""),r=u(""),d=u(""),T,G=u(!1),Q,c=u(_e([])),v=u(_e([])),O=u(""),h=u(void 0),p=u(""),y=u(""),X=u(0n),B=u(0),C=u(0n),j=u(0);i(p,F.getScriptHash(),!0);const m=pt.url.hostname=="vox.cash",U=m?Rt:Ut,E=m?Z(ee):Z(Gt),de=m?"BCH":"tBCH",Y=m?"BPTS":"tBPTS",he=m?"bch.imaginary.cash":"chipnet.bch.ninja",Ce=m?mt:gt;let Ne=new Set,pe=0,z,te=u("");const Ue=async function(t){if(t.method==="blockchain.headers.subscribe"){let s=t.params[0];i(o,s.height,!0)}else t.method==="blockchain.scripthash.subscribe"?t.params[1]!==e(r)&&(i(r,t.params[1],!0),i(n,we[e(h).status],!0),Re()):console.log(t)},Re=()=>{clearTimeout(pe),pe=setTimeout(()=>{De(),He()},1500)},De=async function(){let t=await e(h).request("blockchain.scripthash.listunspent",e(y),"include_tokens");if(t instanceof Error)throw t;i(v,t,!0),i(B,Ee(e(v),!0),!0),i(X,Se(e(v),E),!0),i(v,e(v).filter(s=>!s.token_data).filter(s=>s.height>0),!0)},He=async function(){let t=await e(h).request("blockchain.scripthash.listunspent",e(p),"include_tokens");if(t instanceof Error)throw t;let s=new Set(t.map(l=>`${l.tx_hash}":"${l.tx_pos}`));(e(c).length==0||Ne.intersection(s).size==0)&&i(c,t,!0),i(c,e(c).filter(l=>l.height>0),!0),i(c,e(c).filter(l=>l.token_data&&l.token_data.category==E),!0),e(c).sort((l,N)=>l.height-N.height),i(j,Ee(e(c),!0),!0),i(C,Se(e(c),E),!0)},Le=async function(t){let s=await e(h).request("blockchain.transaction.broadcast",t);if(s instanceof Error)throw i(n,we[e(h).status],!0),s},$e=function(){e(v).map((t,s)=>{me(e(o),e(c)[s],t,e(O),E)})},me=function(t,s,l,N,V){try{i(v,e(v).filter(M=>`${M.tx_hash}:${M.tx_pos}`!=`${l.tx_hash}:${l.tx_pos}`),!0);let S=F.claim(t,s,l,N,V);T=S.transaction,Q=S.sourceOutputs,i(d,Z(Et(T)),!0),Le(e(d)),i(G,S.verify===!0,!0),S.verify===!0&&i(te,"")}catch(S){T=void 0,Q=void 0,i(d,""),i(G,!1),i(te,S,!0)}};st(async()=>{kt.StorageProvider=ft,z=m?await bt.named("vox"):await _t.named("vox"),i(O,yt(z.mnemonic,z.derivationPath.slice(0,-2),z.isTestnet),!0);let t=Ot(z.getDepositAddress());if(typeof t=="string")throw t;i(y,xe(t.bytecode),!0),i(h,new ye(F.USER_AGENT,"1.4.1",he),!0),await e(h).connect(),e(h).on("notification",Ue),await e(h).subscribe("blockchain.scripthash.subscribe",e(p)),await e(h).subscribe("blockchain.scripthash.subscribe",e(y)),await e(h).subscribe("blockchain.headers.subscribe")}),nt(async()=>{await new ye(F.USER_AGENT,"1.4.1",he).disconnect()});var ae=ra();ut(t=>{var s=jt();ct.title="ðŸŸ¦ Block Points",g(t,s)});var oe=w(ae),ge=w(oe);At(ge,{get template(){return F.template}});var qe=k(ge,2);{var ze=t=>{var s=Yt();L(()=>{P(s,"src",xt),P(s,"alt",e(n))}),g(t,s)},Ve=t=>{var s=Jt();L(()=>P(s,"src",Ct)),g(t,s)};K(qe,t=>{e(n)=="CONNECTED"?t(ze):t(Ve,!1)})}b(oe);var ve=k(oe,4);{var Me=t=>{var s=na(),l=J(s),N=w(l),V=w(N),S=k(V,3);b(N);var M=k(N,2),se=w(M),Fe=k(se,3);b(M),b(l);var fe=k(l),Ge=k(fe);{var Qe=I=>{var R=oa(),ne=J(R),je=w(ne);je.__click=[Zt,$e],b(ne);var ke=k(ne,4);dt(ke,21,()=>e(v),ht,(Ye,f,D)=>{var be=ot(),Je=J(be);{var Ze=ie=>{var re=aa(),et=w(re);{var tt=H=>{var A=ea();A.__click=()=>me(e(o),e(c)[D],e(f),e(O),E);var W=w(A),ce=k(W,2);b(A),L(le=>{P(W,"src",U),$(ce,` Claim ${le??""}
									${Y}`)},[()=>e(f).height>e(c)[D].height?Math.floor((e(o)-e(f).height)*e(f).value/1e8):Math.floor((e(o)-e(c)[D].height)*e(f).value/1e8)]),g(H,A)},at=H=>{var A=ta(),W=w(A),ce=k(W,2);b(A),L(le=>{P(W,"src",U),$(ce,` ${le??""}
									${Y}`)},[()=>e(f).height>e(c)[D].height?((e(o)-e(f).height)*e(f).value/1e8).toLocaleString(void 0,{minimumFractionDigits:4}):((e(o)-e(c)[D].height)*e(f).value/1e8).toLocaleString(void 0,{minimumFractionDigits:4})]),g(H,A)};K(et,H=>{Math.floor((e(o)-e(f).height)*e(f).value/1e8)>=1?H(tt):H(at,!1)})}b(re),g(ie,re)};K(Je,ie=>{!e(f).token_data&&e(c)[D]&&ie(Ze)})}g(Ye,be)}),b(ke),g(I,R)},Xe=I=>{var R=sa();g(I,R)};K(Ge,I=>{e(v).length>0?I(Qe):I(Xe,!1)})}L((I,R)=>{P(V,"src",Ce),P(V,"alt",de),$(S,` ${I??""} sats ${de}`),P(se,"src",U),P(se,"alt",Y),$(Fe,` ${R??""}
				${Y}`),$(fe,` ${e(te)??""} `)},[()=>e(B).toLocaleString(),()=>e(X).toLocaleString()]),g(t,s)},We=t=>{var s=ia();g(t,s)};K(ve,t=>{e(n)=="CONNECTED"?t(Me):t(We,!1)})}var Ke=k(ve,2);Xt(Ke,{}),b(ae),g(q,ae),Ae()}lt(["click"]);export{Sa as component,Ea as universal};
//# sourceMappingURL=5.BVz0NIpz.js.map
