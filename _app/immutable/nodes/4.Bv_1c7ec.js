import{f as I,a as _,c as nt,t as Ee}from"../chunks/DIGK3fbx.js";import"../chunks/D2hU0Bvh.js";import{o as it,a as rt}from"../chunks/gevkG0Tn.js";import{p as De,s as u,f as ue,t as R,a as $e,K as j,c as h,r as d,a0 as ct,D as t,C as r,n as k}from"../chunks/D9HGzNEp.js";import{s as E,d as lt}from"../chunks/DLwNFu-O.js";import{i as S}from"../chunks/CKOgfgCC.js";import{e as ut,i as dt}from"../chunks/Clu73D2-.js";import{s as x}from"../chunks/8RjDFi4k.js";import{i as qe,p as Ie}from"../chunks/C7cq5RI_.js";import{r as pt}from"../chunks/B3x9nJtb.js";import{b as ht}from"../chunks/C4jED5RM.js";import{$ as Ae,a as Se}from"../chunks/CQVT_UhJ.js";import{I as mt,T as gt,W as vt,B as ft}from"../chunks/BgdkrN9n.js";import{i as N,j as kt,k as _t,l as Me,m as bt,o as xe,p as Ne,q as Ce,r as yt,v as wt,s as Ue,a as le,t as Y,B as Bt,x as Pt,y as Ot,z as Re,A as He,C as Tt,D as Et}from"../chunks/DRpJvx58.js";import{h as It,g as At}from"../chunks/DTryOclj.js";import{T as St}from"../chunks/Dym7hIGf.js";const xt=!0,_a=Object.freeze(Object.defineProperty({__proto__:null,prerender:xt},Symbol.toStringTag,{value:"Module"})),Nt="data:image/svg+xml,%3csvg%20style='height:400px;width:400px'%20version='1.1'%20viewBox='0%200%2016%2016'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='a'%20gradientTransform='rotate(75)'%3e%3cstop%20stop-color='%23f00'%20offset='.05'/%3e%3cstop%20stop-color='%2300808099'%20offset='.95'/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='m6%201c-2.77%200-5%202.23-5%205v4c0%202.77%202.23%205%205%205h4c2.77%200%205-2.23%205-5v-4c0-2.77-2.23-5-5-5h-4zm2%206a1%201%200%200%201%201%201%201%201%200%200%201-1%201%201%201%200%200%201-1-1%201%201%200%200%201%201-1z'%20fill='url(%23a)'/%3e%3c/svg%3e",Ct="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20style='width:400px;%20height:400px;'%3e%3cdefs%3e%3clinearGradient%20id='grad'%20gradientTransform='rotate(75)'%3e%3cstop%20offset='5%25'%20stop-color='aqua'%20/%3e%3cstop%20offset='95%25'%20stop-color='%2300808099'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20style='fill:url(%23grad)'%20d='M%206%201%20C%203.23%201%201%203.23%201%206%20L%201%2010%20C%201%2012.77%203.23%2015%206%2015%20L%2010%2015%20C%2012.77%2015%2015%2012.77%2015%2010%20L%2015%206%20C%2015%203.23%2012.77%201%2010%201%20L%206%201%20z%20M%208%207%20A%201%201%200%200%201%209%208%20A%201%201%200%200%201%208%209%20A%201%201%200%200%201%207%208%20A%201%201%200%200%201%208%207%20z%20'%20/%3e%3c/svg%3e",Ut="https://libauth.org/schemas/wallet-template-v0.schema.json",Rt="BlockPoints: A coin age reward token",Ht="BlockPoints",Lt={covenant:{description:"Emit tokens as reward to holders.",name:"BlockPoint Vault",scripts:["lock","unlock"],variables:{age:{description:"The input age (as a number of blocks) claimed to withdraw tokens. The maximum age that can be used to claim tokens is the lessor of covenant thread age or user coins age being used to release tokens.",name:"Age",type:"WalletData"}}},wallet:{scripts:["wallet_unlock","wallet_lock"],variables:{key:{description:"The private key that controls this wallet.",name:"Key",type:"HdKey"}}}},Dt={base:{data:{bytecode:{age:"10"}},description:"",name:"Base Scenario",transaction:{inputs:[{outpointTransactionHash:"0e09765ada34fa0bd94ef9df8497173e8aefc560f3eb7c9e0e88b345c4cccb36",outpointIndex:0,unlockingBytecode:["slot"],sequenceNumber:1}]}},release:{name:"Release Tokens",description:"",extends:"base",data:{bytecode:{age:"10"}},transaction:{inputs:[{unlockingBytecode:["slot"],sequenceNumber:10}],outputs:[{lockingBytecode:{script:"lock"},valueSatoshis:800}],locktime:11,version:2},sourceOutputs:[{lockingBytecode:["slot"],valueSatoshis:800}]}},$t={unlock:{passes:["release"],name:"Unlock Tokens",script:"<age> // ",unlocks:"lock"},lock:{lockingType:"p2sh32",name:"BlockPoint Covenant",script:`// Force a block based relative timelock
   <500000000> OP_OVER OP_GREATERTHANOREQUAL OP_VERIFY
// require(500000000 >= age);
        
// Ensure the first input exceeds the age claimed
   OP_0 OP_INPUTSEQUENCENUMBER OP_OVER OP_GREATERTHANOREQUAL OP_VERIFY
// require(tx.inputs[0].sequenceNumber >= age);
        
// Require the token vault thread to exceed the age claimed
   OP_DUP OP_CHECKSEQUENCEVERIFY OP_DROP
// require(this.age >= age);

// Allow anyone to withdraw a token amount proportional to the value of their aged utxo.
// Note: to convert block satoshis to coindays: 144 * 100_000_000 
// 
   OP_INPUTINDEX OP_OUTPUTTOKENAMOUNT 
   OP_INPUTINDEX OP_UTXOTOKENAMOUNT 
   OP_ROT OP_0 OP_UTXOVALUE OP_MUL <100000000> OP_DIV OP_SUB OP_GREATERTHANOREQUAL OP_VERIFY
//  require(
//      tx.outputs[this.activeInputIndex].tokenAmount >= 
//      tx.inputs[this.activeInputIndex].tokenAmount - 
//      (age * tx.inputs[0].value/100000000)
//  );

// This thread must be in the last input position
// to prevent users building transactions with multiple airdrop threads. 
//
   OP_INPUTINDEX OP_1ADD OP_TXINPUTCOUNT OP_NUMEQUAL
// require(this.activeInputIndex+1 == tx.inputs.length);
`},wallet_unlock:{name:"Wallet Unlock",script:"<key.schnorr_signature.all_outputs> <key.public_key>",unlocks:"wallet_lock"},wallet_lock:{lockingType:"standard",name:"Wallet Lock",script:"OP_DUP OP_HASH160 <$(<key.public_key> OP_HASH160)> OP_EQUALVERIFY OP_CHECKSIG"}},qt=["BCH_2023_05","BCH_SPEC"],Mt=0,Kt={$schema:Ut,description:Rt,name:Ht,entities:Lt,scenarios:Dt,scripts:$t,supported:qt,version:Mt},Vt="@unspent/blockpoint",Wt={name:Vt},J=N("7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"),zt=N("ffc9d3b3488e890ef113b1c74f40e1f5eb1147a7d4191cecac89fd515721a271");class F{static USER_AGENT=Wt.name;static tokenAware=!0;static template=Kt;static compiler=kt(this.template);static vm=_t();static getLockingBytecode(a={}){const o=this.compiler.generateBytecode({data:a,scriptId:"lock"});if(!o.success)throw new Error("Failed to generate bytecode, script: , "+JSON.stringify(o,null,"  "));return o.bytecode}static getScriptHash(a=!0){return Me(this.getLockingBytecode(),a)}static getAddress(a="bitcoincash"){return bt(this.getLockingBytecode(),a,this.tokenAware)}static getSourceOutput(a){return{lockingBytecode:this.getLockingBytecode(),valueSatoshis:BigInt(a.value),token:{category:N(a.token_data.category),amount:BigInt(a.token_data?.amount)}}}static getInput(a,o){return{outpointIndex:a.tx_pos,outpointTransactionHash:N(a.tx_hash),sequenceNumber:o,unlockingBytecode:{data:{bytecode:{age:xe(BigInt(o))}},compiler:this.compiler,script:"unlock",valueSatoshis:BigInt(a.value)}}}static getOutput(a,o,n){return{lockingBytecode:{data:{bytecode:{age:xe(BigInt(n))}},compiler:this.compiler,script:"lock"},valueSatoshis:BigInt(a.value),token:{category:N(a.token_data.category),amount:BigInt(a.token_data?.amount)-BigInt(o)}}}static getWalletSourceOutput(a,o){return{lockingBytecode:o?It({addressIndex:0,hdPrivateKey:o}):Uint8Array.from(Array(33)),valueSatoshis:BigInt(a.value),token:a.token_data?{category:N(a.token_data.category),amount:BigInt(a.token_data?.amount)}:void 0}}static getWalletInput(a,o,n,c=0){const p=n?{compiler:this.compiler,data:{hdKeys:{addressIndex:c,hdPrivateKeys:{wallet:n}}},script:"wallet_unlock",valueSatoshis:BigInt(a.value)}:Uint8Array.from(Array());return{outpointIndex:a.tx_pos,outpointTransactionHash:N(a.tx_hash),sequenceNumber:o,unlockingBytecode:p}}static getTokenOutput(a,o,n=0,c=J){return{lockingBytecode:o?{compiler:this.compiler,data:{hdKeys:{addressIndex:n,hdPublicKeys:{wallet:Ne(o).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:800n,token:{category:c,amount:BigInt(a)}}}static getChangeOutput(a,o,n=0){return{lockingBytecode:o?{compiler:this.compiler,data:{hdKeys:{addressIndex:n,hdPublicKeys:{wallet:Ne(o).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:BigInt(a.value)-800n}}static getSourceOutputs(a,o,n){const c=[];return c.push(this.getWalletSourceOutput(o,n)),c.push(this.getSourceOutput(a)),c}static claim(a,o,n,c,p,b=1){const $=[],q=[];let l=p?N(p):J;const y=n.height>o.height?n.height:o.height,A=a-y,m=Math.floor(A*n.value/1e8);let g={locktime:0,version:2,inputs:$,outputs:q};g.inputs.push(this.getWalletInput(n,A,c)),g.outputs.push(this.getTokenOutput(m,c,0,l)),g.inputs.push(this.getInput(o,A)),g.outputs.push(this.getOutput(o,m,A)),g.outputs.push(this.getChangeOutput(n,c,0));let P=Ce(g);if(!P.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(P.errors,null,"  "));const Q=yt(P.transaction,b);if(g.outputs[2].valueSatoshis=g.outputs[2].valueSatoshis-Q,P=Ce(g),!P.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(P.errors,null,"  "));const O=this.getSourceOutputs(o,n,c),w=P.transaction,M=wt(w,O);if(M!==!0&&b>0)throw M;let B=this.vm.verify({sourceOutputs:O,transaction:w}),K=Ue(O)-Ue(w.outputs);K>5e3&&(B=`Excessive fees ${K}`),le(O,p)==0n&&(B="Error checking token input");let V=le(O,p)-le(w.outputs,p);return V!==0n&&(B=`Swapping should not create destroy tokens, token difference: ${V}`),{sourceOutputs:O,transaction:w,verify:B}}}var Gt=I('<h3>About Block Points</h3> <p>Block Points (BPT) are a reward token distributed based on the value and age of coins users have already hold.</p> <p>The CashToken category id for Block Points is:</p> <p><a href="https://explorer.salemkode.com/token/7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c" rel="nofollow"> </a></p> <p>All 9.2 quintillion Block Points were <a href="https://explorer.salemkode.com/tx/2420c5803f7318160bd4ed6729eecb8385688b79fa5653b8c64a1a8167b5e79f" rel="nofollow">minted in this transaction</a>. The entire circulating supply was then sent to the Block Point vault contract in <a href="https://explorer.salemkode.com/address/bitcoincash:r0ak899wsk9mr9wz78tw2pnppumzry6ypejfvsad6u4vrj4kdewpwsmza35av" rel="nofollow">this transaction</a>.</p> <p>The Block Point vault can only release tokens based on the age of the vault thread or coin being used (whichever utxo is younger). The vault can release tokens at a rate of one Block Point (1 BPT) per coin per block. Users with that don’t have a whole coin can claim rewards at the same rate as user with many blocks.</p> <p>Anytime coins are moved, the age of the coin resets. So don’t move coins to claim Block Points, wait until you can sign with the wallet you have.</p>',1);function Ft(D,a){De(a,!1),qe();var o=Gt(),n=u(ue(o),6),c=h(n),p=h(c,!0);d(c),d(n),ct(6),R(b=>E(p,b),[()=>Y(J)],j),_(D,o),$e()}var Le=pt(()=>ft),jt=I("<img/>"),Qt=I('<img alt="Disconnected"/>'),Xt=(D,a)=>a(),Yt=I('<div class="swap svelte-1lmmn8s"><div class="svelte-1lmmn8s"><!></div></div>'),Jt=I('<button class="action svelte-1lmmn8s"><img width="100" alt="bptLogo"/><br/> </button>'),Zt=I('<div class="row svelte-1lmmn8s"><!></div>'),ea=I('<h4>Wallet Unspent Transaction Outputs (coins)</h4> <div class="grid svelte-1lmmn8s"></div>',1),ta=I("<p>No confirmed coins to claim Block Points</p>"),aa=I('<section><div class="status svelte-1lmmn8s"><!> <!></div> <h1>Claim Block Point Rewards</h1> <div class="swap svelte-1lmmn8s"><div class="svelte-1lmmn8s"><img width="50"/> <br/> <b> </b></div> <div class="svelte-1lmmn8s"><img width="50"/> <br/> <b> </b></div></div> <div class="swap svelte-1lmmn8s"><button class="svelte-1lmmn8s">Claim All Rewards</button></div> <!> <!> <!> <!></section>');function ba(D,a){De(a,!1);let o=k(0),n=k(""),c="",p="",b=k(void 0),$=k(!1),q=k(void 0),l=k([]),y=k([]),A=k(""),m,g="",P="",Q=k(0n),O=k(0);g=F.getScriptHash();const w=Ie.url.hostname=="vox.cash";let M=w?Ct:Nt,B=w?Y(J):Y(zt),K=w?"BCH":"tBCH",V=w?"BPT":"tBPT",de=w?"bch.imaginary.cash":"chipnet.bch.ninja",pe=new Set,W=k(0),z,Z=k("");const Ke=function(e){if(e.method==="blockchain.headers.subscribe"){let s=e.params[0];r(o,s.height)}else e.method==="blockchain.scripthash.subscribe"?e.params[1]!==c&&(c=e.params[1],r(n,Ae[m.status]),r(W,0),me(),he()):console.log(e)},he=async function(){let e=await m.request("blockchain.scripthash.listunspent",P,"include_tokens");if(e instanceof Error)throw e;let s=new Set(e.map(i=>`${i.tx_hash}":"${i.tx_pos}`));(t(y).length==0||pe.intersection(s).size==0)&&r(y,e),r(O,Re(t(y),!0)),r(Q,He(t(y),B)),r(y,t(y).filter(i=>i.height>0))},me=async function(){let e=await m.request("blockchain.scripthash.listunspent",g,"include_tokens");if(e instanceof Error)throw e;let s=new Set(e.map(i=>`${i.tx_hash}":"${i.tx_pos}`));(t(l).length==0||pe.intersection(s).size==0)&&r(l,e),r(l,t(l).filter(i=>i.height>0)),r(l,t(l).filter(i=>i.token_data&&i.token_data.category==B)),t(l).sort((i,C)=>i.height-C.height),Re(t(l),!0),He(t(l),B)},Ve=async function(e){let s=await m.request("blockchain.transaction.broadcast",e);if(s instanceof Error)throw r(n,Ae[m.status]),s},We=function(){t(y).map((e,s)=>{ge(t(o),t(l)[s],e,t(A),B)})},ge=function(e,s,i,C,f){try{let v=F.claim(e,s,i,C,f);r(b,v.transaction),r(q,v.sourceOutputs),p=Y(Pt(t(b))),Ve(p),r($,v.verify===!0),v.verify===!0&&r(Z,"")}catch(v){r(b,void 0),r(q,void 0),p="",r($,!1),r(Z,v)}};it(async()=>{const e=Ie.url.hostname!=="vox.cash";Le(Le().StorageProvider=mt),z=e?await gt.named("vox"):await vt.named("vox"),r(A,At(z.mnemonic,z.derivationPath.slice(0,-2),z.isTestnet));let s=Ot(z.getDepositAddress());if(typeof s=="string")throw s;P=Me(s.bytecode),m=new Se(F.USER_AGENT,"1.4.1",de),await m.connect(),m.on("notification",Ke),await m.subscribe("blockchain.scripthash.subscribe",g),await m.subscribe("blockchain.headers.subscribe"),me(),he()}),rt(async()=>{await new Se(F.USER_AGENT,"1.4.1",de).disconnect()}),qe();var ee=aa(),te=h(ee),ve=h(te);{var ze=e=>{var s=jt();R(()=>{x(s,"src",Tt),x(s,"alt",t(n))}),_(e,s)},Ge=e=>{var s=Qt();R(()=>x(s,"src",Et)),_(e,s)};S(ve,e=>{t(n)=="CONNECTED"?e(ze):e(Ge,!1)})}var Fe=u(ve,2);Bt(Fe,{get template(){return F.template}}),d(te);var ae=u(te,4),se=h(ae),oe=h(se),fe=u(oe,3),ke=u(fe),je=h(ke,!0);d(ke),d(se);var _e=u(se,2),ne=h(_e),be=u(ne,3),ye=u(be),Qe=h(ye,!0);d(ye),d(_e),d(ae);var ie=u(ae,2),Xe=h(ie);Xe.__click=[Xt,We],d(ie);var we=u(ie,2);{var Ye=e=>{var s=Yt(),i=h(s),C=h(i);{var f=T=>{var H=Ee();R(G=>E(H,`place: ${G??""} sats`),[()=>t(W).toLocaleString()],j),_(T,H)},v=(T,H)=>{{var G=U=>{var L=Ee();R(re=>E(L,`redeem: ${re??""} wrapped sats`),[()=>(-t(W)).toLocaleString()],j),_(U,L)};S(T,U=>{t(W)<0&&U(G)},H)}};S(C,T=>{t(W)>0?T(f):T(v,!1)})}d(i),d(s),_(e,s)};S(we,e=>{t(b)&&t($)&&e(Ye)})}var Be=u(we,2);{var Je=e=>{St(e,{get transaction(){return t(b)},get sourceOutputs(){return t(q)},get category(){return B}})};S(Be,e=>{t(b)&&e(Je)})}var Pe=u(Be),Oe=u(Pe);{var Ze=e=>{var s=ea(),i=u(ue(s),2);ut(i,5,()=>t(y),dt,(C,f,v)=>{var T=nt(),H=ue(T);{var G=U=>{var L=Zt(),re=h(L);{var at=ce=>{var X=Jt();X.__click=()=>ge(t(o),t(l)[v],t(f),t(A),B);var Te=h(X),st=u(Te,2);d(X),R(ot=>{x(Te,"src",M),E(st,` Claim ${ot??""} BPT`)},[()=>t(f).height>t(l)[v].height?Math.floor((t(o)-t(f).height)*t(f).value/1e8):Math.floor((t(o)-t(l)[v].height)*t(f).value/1e8)],j),_(ce,X)};S(re,ce=>{Math.floor((t(o)-t(f).height)*t(f).value/1e8)>1&&ce(at)})}d(L),_(U,L)};S(H,U=>{!t(f).token_data&&t(l)[v]&&U(G)})}_(C,T)}),d(i),_(e,s)},et=e=>{var s=ta();_(e,s)};S(Oe,e=>{t(y).filter(s=>!s.token_data).filter(s=>s.height>0).length>0?e(Ze):e(et,!1)})}var tt=u(Oe,2);Ft(tt,{}),d(ee),R((e,s)=>{x(oe,"src",ht),x(oe,"alt",K),E(fe,` ${e??""} `),E(je,K),x(ne,"src",M),x(ne,"alt",V),E(be,` ${s??""} `),E(Qe,V),E(Pe,` ${t(Z)??""} `)},[()=>t(O).toLocaleString(),()=>t(Q).toLocaleString()],j),_(D,ee),$e()}lt(["click"]);export{ba as component,_a as universal};
//# sourceMappingURL=4.Bv_1c7ec.js.map
