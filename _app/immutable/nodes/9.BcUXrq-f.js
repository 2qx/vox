import{f as z,a as W,t as m0}from"../chunks/yGPdYsEk.js";import{o as M0,a as V0}from"../chunks/BL1kRCRP.js";import{as as q0,p as X0,aF as m,a9 as k0,aa as u,c as b,t as L,j as s,a as K0,s as v,r as B,f as G0}from"../chunks/4Ej_4qXs.js";import{d as R0,s as $}from"../chunks/BNpjwQLA.js";import{i as q}from"../chunks/CyUl1IAL.js";import{s as T,r as j0}from"../chunks/CnJGQRAh.js";import{a as F0}from"../chunks/R_USggII.js";import{p as Y0}from"../chunks/BhiH1qEm.js";import{b as J0}from"../chunks/C4jED5RM.js";import{j as O,g as Q0,k as Z0,m as B0,o as tt,r as v0,p as E,s as a0,E as X,v as y0,w as et,x as at,J as st,F as nt,$ as ot,G as _0,H as w0,I as b0}from"../chunks/zIYK9qkZ.js";import{h as it,I as rt,B as ct,W as lt,T as ut}from"../chunks/DeOyqwJy.js";import{g as pt}from"../chunks/gC8E2xLB.js";import"../chunks/Bq1uU4Db.js";import{B as dt,C as ht,D as ft}from"../chunks/BbIwgq-g.js";import"../chunks/l0sNRNKZ.js";const Yt=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),gt="data:image/svg+xml,%3csvg%20version='1.1'%20viewBox='0%200%2016%2016'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='a'%20x1='4.54e-7'%20x2='16'%20y1='8'%20y2='8'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23feccf2'%20offset='0'/%3e%3cstop%20stop-color='%23ffda95'%20offset='1'/%3e%3c/linearGradient%3e%3c/defs%3e%3ccircle%20cx='8'%20cy='8'%20r='8'%20fill='url(%23a)'%20stroke-width='0'/%3e%3ccircle%20cx='8'%20cy='8'%20r='6'%20fill='%2394ff94'%20stroke-width='0'/%3e%3cpath%20d='m7.96%201.07a6.93%206.93%200%200%200-6.89%206.93%206.93%206.93%200%200%200%206.93%206.93%206.93%206.93%200%200%200%206.93-6.93%206.93%206.93%200%200%200-6.93-6.93%206.93%206.93%200%200%200-0.0371%200zm-0.244%201.94%200.00391%200.00586c0.00188%200.00188%200.0847%200.303%200.186%200.67%200.101%200.366%200.186%200.668%200.189%200.67%200.00188%200.00284%200.0377-2.72e-4%200.082-0.00781%200.392-0.0697%200.847-0.0893%201.11-0.0488%200.633%200.0979%201.02%200.413%201.21%200.998%200.185%200.557%200.0921%201.02-0.283%201.41l-0.0684%200.0723h0.111c0.78%200%201.27%200.37%201.47%201.12%200.122%200.443%200.127%200.856%200.0137%201.2-0.0386%200.119-0.129%200.295-0.205%200.402-0.137%200.193-0.392%200.418-0.656%200.576-0.261%200.156-0.711%200.356-1.02%200.455-0.0282%200.0094-0.0548%200.0196-0.0586%200.0234-0.00376%200.0028%200.067%200.272%200.156%200.598%200.0904%200.327%200.174%200.633%200.187%200.68l0.0234%200.0859-0.402%200.109c-0.22%200.0603-0.405%200.109-0.41%200.109-0.00565%200-0.0918-0.299-0.191-0.666-0.101-0.367-0.183-0.669-0.184-0.67-9.58e-4%20-0.0019-0.136%200.0328-0.299%200.0762-0.163%200.0433-0.31%200.0822-0.326%200.0859-0.0169%200.0028-0.0312%200.012-0.0312%200.0176%200%200.0104%200.015%200.064%200.244%200.896%200.0669%200.244%200.121%200.443%200.119%200.445-9.58e-4%209.58e-4%20-0.185%200.0522-0.408%200.113l-0.404%200.111-0.00977-0.0293c-0.00565-0.016-0.0594-0.209-0.121-0.43-0.184-0.671-0.246-0.895-0.25-0.9-0.00284-0.0019-0.373%200.0977-0.826%200.221-0.453%200.123-0.824%200.224-0.826%200.223-0.00284-0.0028-0.105-0.98-0.105-1.01%200-0.016%200.00573-0.0226%200.0293-0.0273%200.0706-0.0132%200.527-0.136%200.592-0.16%200.0951-0.0358%200.17-0.109%200.191-0.184%200.0264-0.0894%200.0211-0.146-0.0391-0.367-0.0311-0.112-0.132-0.474-0.223-0.805-0.0913-0.331-0.225-0.816-0.297-1.08-0.0716-0.262-0.182-0.663-0.246-0.891-0.0631-0.228-0.132-0.484-0.154-0.57-0.0235-0.0857-0.0542-0.173-0.0684-0.197-0.0414-0.0725-0.105-0.13-0.18-0.166-0.0631-0.032-0.0782-0.0362-0.16-0.0391-0.126-0.00565-0.22%200.015-0.691%200.152-0.0763%200.0217-0.113%200.029-0.115%200.0215-0.00659-0.0188-0.232-0.849-0.234-0.857%200-0.00376%200.0827-0.0313%200.184-0.0586%200.101-0.0282%200.468-0.13%200.818-0.227%200.349-0.096%200.639-0.178%200.643-0.18%200.00376-0.00284-0.0765-0.304-0.178-0.67-0.101-0.365-0.18-0.67-0.178-0.674%200.00188-0.00565%200.0254-0.0149%200.0527-0.0215%200.0282-0.00753%200.208-0.0587%200.402-0.111%200.194-0.0537%200.355-0.0956%200.355-0.0938%209.58e-4%209.42e-4%200.083%200.295%200.182%200.654%200.0998%200.36%200.182%200.656%200.184%200.658%200.00188%200.00188%200.13-0.0329%200.285-0.0781%200.154-0.0452%200.298-0.0862%200.322-0.0938%200.033-0.00942%200.041-0.0161%200.0391-0.0293-0.00188-0.0104-0.081-0.301-0.176-0.648-0.0951-0.346-0.174-0.635-0.174-0.641%200-0.00847%200.809-0.235%200.816-0.229zm0.404%202.43c-0.214%200.00565-0.377%200.0308-0.641%200.0977-0.161%200.0395-0.572%200.159-0.58%200.168-0.00376%200.00376%200.117%200.456%200.404%201.5%200.0226%200.0819%200.0442%200.139%200.0508%200.139%200.00565%200%200.0846-0.0194%200.174-0.043%200.619-0.162%200.957-0.303%201.22-0.51%200.0913-0.0716%200.15-0.135%200.211-0.227%200.0565-0.0857%200.0826-0.153%200.102-0.262%200.0179-0.106%200.00619-0.221-0.0371-0.348-0.096-0.287-0.291-0.446-0.621-0.502-0.0772-0.0122-0.133-0.0145-0.281-0.00977l-0.00195-0.00391zm0.963%202.4c-0.239%200.00911-0.522%200.0561-0.854%200.141-0.213%200.0546-0.654%200.185-0.654%200.195%200%200.00376%200.109%200.408%200.244%200.898s0.246%200.892%200.246%200.895c0%200.00942%200.0198%200.0059%200.219-0.0469%200.874-0.229%201.35-0.443%201.63-0.74%200.0876-0.0923%200.123-0.142%200.168-0.238%200.0508-0.106%200.0655-0.174%200.0645-0.297%200-0.199-0.0736-0.394-0.201-0.529-0.187-0.199-0.465-0.292-0.861-0.277h-0.00195z'%20fill='%23800000'/%3e%3c/svg%3e",mt="data:image/svg+xml,%3csvg%20version='1.1'%20viewBox='0%200%2016%2016'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3clinearGradient%20id='a'%20x1='4.54e-7'%20x2='16'%20y1='8'%20y2='8'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23ccfed8'%20offset='0'/%3e%3cstop%20stop-color='%2395baff'%20offset='1'/%3e%3c/linearGradient%3e%3c/defs%3e%3cg%3e%3ccircle%20cx='8'%20cy='8'%20r='8'%20fill='url(%23a)'%20stroke-width='0'/%3e%3ccircle%20cx='8'%20cy='8'%20r='6'%20fill='%23ffa5bf'%20stroke-width='0'/%3e%3cpath%20d='m7.96%201.07a6.93%206.93%200%200%200-6.89%206.93%206.93%206.93%200%200%200%206.93%206.93%206.93%206.93%200%200%200%206.93-6.93%206.93%206.93%200%200%200-6.93-6.93%206.93%206.93%200%200%200-0.0371%200zm-0.244%201.94%200.00391%200.00586c0.00188%200.00188%200.0847%200.303%200.186%200.67%200.101%200.366%200.186%200.668%200.189%200.67%200.00188%200.00284%200.0377-2.72e-4%200.082-0.00781%200.392-0.0697%200.847-0.0893%201.11-0.0488%200.633%200.0979%201.02%200.413%201.21%200.998%200.185%200.557%200.0921%201.02-0.283%201.41l-0.0684%200.0723h0.111c0.78%200%201.27%200.37%201.47%201.12%200.122%200.443%200.127%200.856%200.0137%201.2-0.0386%200.119-0.129%200.295-0.205%200.402-0.137%200.193-0.392%200.418-0.656%200.576-0.261%200.156-0.711%200.356-1.02%200.455-0.0282%200.0094-0.0548%200.0196-0.0586%200.0234-0.00376%200.0028%200.067%200.272%200.156%200.598%200.0904%200.327%200.174%200.633%200.187%200.68l0.0234%200.0859-0.402%200.109c-0.22%200.0603-0.405%200.109-0.41%200.109-0.00565%200-0.0918-0.299-0.191-0.666-0.101-0.367-0.183-0.669-0.184-0.67-9.58e-4%20-0.0019-0.136%200.0328-0.299%200.0762-0.163%200.0433-0.31%200.0822-0.326%200.0859-0.0169%200.0028-0.0312%200.012-0.0312%200.0176%200%200.0104%200.015%200.064%200.244%200.896%200.0669%200.244%200.121%200.443%200.119%200.445-9.58e-4%209.58e-4%20-0.185%200.0522-0.408%200.113l-0.404%200.111-0.00977-0.0293c-0.00565-0.016-0.0594-0.209-0.121-0.43-0.184-0.671-0.246-0.895-0.25-0.9-0.00284-0.0019-0.373%200.0977-0.826%200.221-0.453%200.123-0.824%200.224-0.826%200.223-0.00284-0.0028-0.105-0.98-0.105-1.01%200-0.016%200.00573-0.0226%200.0293-0.0273%200.0706-0.0132%200.527-0.136%200.592-0.16%200.0951-0.0358%200.17-0.109%200.191-0.184%200.0264-0.0894%200.0211-0.146-0.0391-0.367-0.0311-0.112-0.132-0.474-0.223-0.805-0.0913-0.331-0.225-0.816-0.297-1.08-0.0716-0.262-0.182-0.663-0.246-0.891-0.0631-0.228-0.132-0.484-0.154-0.57-0.0235-0.0857-0.0542-0.173-0.0684-0.197-0.0414-0.0725-0.105-0.13-0.18-0.166-0.0631-0.032-0.0782-0.0362-0.16-0.0391-0.126-0.00565-0.22%200.015-0.691%200.152-0.0763%200.0217-0.113%200.029-0.115%200.0215-0.00659-0.0188-0.232-0.849-0.234-0.857%200-0.00376%200.0827-0.0313%200.184-0.0586%200.101-0.0282%200.468-0.13%200.818-0.227%200.349-0.096%200.639-0.178%200.643-0.18%200.00376-0.00284-0.0765-0.304-0.178-0.67-0.101-0.365-0.18-0.67-0.178-0.674%200.00188-0.00565%200.0254-0.0149%200.0527-0.0215%200.0282-0.00753%200.208-0.0587%200.402-0.111%200.194-0.0537%200.355-0.0956%200.355-0.0938%209.58e-4%209.42e-4%200.083%200.295%200.182%200.654%200.0998%200.36%200.182%200.656%200.184%200.658%200.00188%200.00188%200.13-0.0329%200.285-0.0781%200.154-0.0452%200.298-0.0862%200.322-0.0938%200.033-0.00942%200.041-0.0161%200.0391-0.0293-0.00188-0.0104-0.081-0.301-0.176-0.648-0.0951-0.346-0.174-0.635-0.174-0.641%200-0.00847%200.809-0.235%200.816-0.229zm0.404%202.43c-0.214%200.00565-0.377%200.0308-0.641%200.0977-0.161%200.0395-0.572%200.159-0.58%200.168-0.00376%200.00376%200.117%200.456%200.404%201.5%200.0226%200.0819%200.0442%200.139%200.0508%200.139%200.00565%200%200.0846-0.0194%200.174-0.043%200.619-0.162%200.957-0.303%201.22-0.51%200.0913-0.0716%200.15-0.135%200.211-0.227%200.0565-0.0857%200.0826-0.153%200.102-0.262%200.0179-0.106%200.00619-0.221-0.0371-0.348-0.096-0.287-0.291-0.446-0.621-0.502-0.0772-0.0122-0.133-0.0145-0.281-0.00977l-0.00195-0.00391zm0.963%202.4c-0.239%200.00911-0.522%200.0561-0.854%200.141-0.213%200.0546-0.654%200.185-0.654%200.195%200%200.00376%200.109%200.408%200.244%200.898%200.135%200.49%200.246%200.892%200.246%200.895%200%200.00942%200.0198%200.0059%200.219-0.0469%200.874-0.229%201.35-0.443%201.63-0.74%200.0876-0.0923%200.123-0.142%200.168-0.238%200.0508-0.106%200.0655-0.174%200.0645-0.297%200-0.199-0.0736-0.394-0.201-0.529-0.187-0.199-0.465-0.292-0.861-0.277h-0.00195z'%20fill='%234c7e7c'/%3e%3c/g%3e%3c/svg%3e",kt="https://libauth.org/schemas/wallet-template-v0.schema.json",vt=`Wrapped BCH 
 https://gitlab.com/dagurval/wrapped-cash`,yt="Wrapped",_t={covenant:{description:"Wrapped BCH (WBCH) represents an equal amount of Bitcoin Cash (BCH), transforming it into a CashToken format on the Bitcoin Cash blockchain. This enables BCH to be used as a CashToken in smart contracts and decentralized applications on the Bitcoin Cash blockchain.",name:"Wrapped BCH Vault",scripts:["unlock"]},wallet:{description:"",name:"Unnamed Entity",scripts:["wallet_unlock","wallet_lock"],variables:{key:{description:"The private key that controls this wallet.",name:"Key",type:"HdKey"}}}},wt={inline:{description:"",name:"Swap thread",transaction:{inputs:[{unlockingBytecode:["slot"]}],outputs:[{lockingBytecode:{script:"lock"}}],version:2},sourceOutputs:[{lockingBytecode:["slot"]}]},swap:{description:"",name:"Swap WBCH for BCH",transaction:{inputs:[{unlockingBytecode:["slot"]},{unlockingBytecode:{script:"wallet_unlock"}}],outputs:[{lockingBytecode:{script:"lock"},valueSatoshis:2e3,token:{category:"ff4d6e4b90aa8158d39c5dc874fd9411af1ac3b5ed6f354755e8362a0d02c6b3",amount:98e3}},{lockingBytecode:{script:"wallet_lock"},valueSatoshis:1e3,token:{category:"ff4d6e4b90aa8158d39c5dc874fd9411af1ac3b5ed6f354755e8362a0d02c6b3",amount:1e3}}],locktime:0,version:2},sourceOutputs:[{lockingBytecode:["slot"],valueSatoshis:1e3,token:{category:"ff4d6e4b90aa8158d39c5dc874fd9411af1ac3b5ed6f354755e8362a0d02c6b3",amount:99e3}},{lockingBytecode:{script:"wallet_lock"},valueSatoshis:2e3}]}},bt={unlock:{passes:["swap"],name:"Swap Wrapped BCH",script:"// empty",unlocks:"lock"},wallet_unlock:{name:"Wallet Unlock",script:"<key.schnorr_signature.all_outputs> <key.public_key>",unlocks:"wallet_lock"},lock:{lockingType:"p2sh32",name:"Wrapped BCH Covenant",script:`// pragma cashscript ^0.9.0;

// Wrap BCH as tokens
//
// Transaction form:
//      Inputs: 00-covenant
//      Outputs: 00-covenant
//
// Author: Dagur Valberg Johannsson <dagurval@pvv.ntnu.no>
// License: MIT

// contract WrapBCH() {

//     function wrapOrUnwrap() {
//         // Enforce that this contract lives on
           OP_INPUTINDEX OP_OUTPUTBYTECODE OP_INPUTINDEX OP_UTXOBYTECODE OP_EQUALVERIFY 
//         require(tx.outputs[this.activeInputIndex].lockingBytecode
//              == tx.inputs[this.activeInputIndex].lockingBytecode);

           // The token category must not change.
           OP_INPUTINDEX OP_OUTPUTTOKENCATEGORY OP_INPUTINDEX OP_UTXOTOKENCATEGORY OP_EQUALVERIFY 
//         require(tx.outputs[this.activeInputIndex].tokenCategory
//              == tx.inputs[this.activeInputIndex].tokenCategory);

           // The sum of tokens and sats in must equal the sum of tokena and sats out.
           OP_INPUTINDEX OP_UTXOTOKENAMOUNT OP_INPUTINDEX OP_UTXOVALUE OP_ADD 
           OP_INPUTINDEX OP_OUTPUTTOKENAMOUNT OP_INPUTINDEX OP_OUTPUTVALUE OP_ADD OP_NUMEQUAL
//         require(tx.inputs[this.activeInputIndex].tokenAmount + tx.inputs[this.activeInputIndex].value
//             == tx.outputs[this.activeInputIndex].tokenAmount + tx.outputs[this.activeInputIndex].value);
//     }
// }
`},wallet_lock:{lockingType:"standard",name:"Wallet Lock",script:"OP_DUP OP_HASH160 <$(<key.public_key> OP_HASH160)> OP_EQUALVERIFY OP_CHECKSIG"}},Bt=["BCH_2023_05"],Tt={$schema:kt,description:vt,name:yt,entities:_t,scenarios:wt,scripts:bt,supported:Bt},Ot="@unspent/wrap",Ct={name:Ot},n0=O("ff4d6e4b90aa8158d39c5dc874fd9411af1ac3b5ed6f354755e8362a0d02c6b3"),It=O("bb61cd7a6c8a3a3742d965dc7ac73c1117382a5c8930b68338deb881f75c0214");class s0{static USER_AGENT=Ct.name;static tokenAware=!0;static template=Tt;static compiler=Q0(this.template);static vm=Z0();static getLockingBytecode(t={}){const e=this.compiler.generateBytecode({data:t,scriptId:"lock"});if(!e.success)throw new Error("Failed to generate bytecode, script: , "+JSON.stringify(e,null,"  "));return e.bytecode}static getScriptHash(t=!0){return B0(this.getLockingBytecode(),t)}static getAddress(t="bitcoincash"){return tt(this.getLockingBytecode(),t,this.tokenAware)}static getSourceOutput(t){return{lockingBytecode:this.getLockingBytecode(),valueSatoshis:BigInt(t.value),token:{category:O(t.token_data.category),amount:BigInt(t.token_data?.amount)}}}static getInput(t){return{outpointIndex:t.tx_pos,outpointTransactionHash:O(t.tx_hash),sequenceNumber:0,unlockingBytecode:{compiler:this.compiler,script:"unlock"}}}static getOutput(t,e){return{lockingBytecode:{compiler:this.compiler,script:"lock"},valueSatoshis:BigInt(t.value)+e,token:{category:O(t.token_data.category),amount:BigInt(t.token_data?.amount)-BigInt(e)}}}static getWalletSourceOutput(t,e){return{lockingBytecode:e?it({addressIndex:0,hdPrivateKey:e}):Uint8Array.from(Array(33)),valueSatoshis:BigInt(t.value),token:t.token_data?{category:O(t.token_data.category),amount:BigInt(t.token_data?.amount)}:void 0}}static getWalletInput(t,e,o=0){let n=e?{compiler:this.compiler,data:{hdKeys:{addressIndex:o,hdPrivateKeys:{wallet:e}}},script:"wallet_unlock",valueSatoshis:BigInt(t.value)}:Uint8Array.from(Array());return t.token_data&&(n.token={amount:BigInt(t.token_data.amount),category:O(t.token_data.category)}),{outpointIndex:t.tx_pos,outpointTransactionHash:O(t.tx_hash),sequenceNumber:0,unlockingBytecode:n}}static getWrappedOutput(t,e,o=0,n=n0){return{lockingBytecode:e?{compiler:this.compiler,data:{hdKeys:{addressIndex:o,hdPublicKeys:{wallet:v0(e).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:800n,token:{category:n,amount:t}}}static getChangeOutput(t,e,o=0){return{lockingBytecode:e?{compiler:this.compiler,data:{hdKeys:{addressIndex:o,hdPublicKeys:{wallet:v0(e).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:t}}static getSourceOutputs(t,e,o){const n=[];return n.push(this.getSourceOutput(t)),n.push(...e.map(i=>this.getWalletSourceOutput(i,o))),n}static getVaultLayers(t,e,o,n=[]){let i=[],f=[];if(t=t.filter(h=>h.token_data?.category==E(o)),e<0&&(t=t.filter(h=>h.value>800)),t.length==0)throw Error("no vault utxos left, maximum recursion depth reached.");const p=Math.floor(Math.random()*t.length),l=t[p];if(t.splice(p,1),i.push(this.getInput(l)),n.push(this.getSourceOutput(l)),e<0&&-l?.value<e||e>0&&BigInt(l?.token_data?.amount)>e)f.push(this.getOutput(l,BigInt(e)));else{e<0&&e<-(l?.value-800)&&(f.push(this.getOutput(l,-BigInt(l?.value-800))),e+=l?.value-800);let h=this.getVaultLayers([...t],e,o,[...n]);i.push(...h.inputs),f.push(...h.outputs),n=h.sourceOutputs}return{inputs:i,outputs:f,sourceOutputs:n}}static getWalletLayers(t,e,o,n,i=[]){let f=[],p=[];if(e>0&&(t=t.filter(c=>!c.token_data)),e<0&&(t=t.filter(c=>c.token_data?.category==E(n))),t.length==0)throw Error("no wallet utxos left, maximum recursion depth reached.");const l=Math.floor(Math.random()*t.length),h=t[l];t.splice(l,1),f.push(this.getWalletInput(h,o)),i.push(this.getWalletSourceOutput(h,o));let r=a0(i),y=X(i,E(n));if(e<0&&y>=-e||e>0&&r>e){e>0&&p.push(this.getWrappedOutput(e,o,0,n)),e<0&&p.push(this.getWrappedOutput(y+e,o,0,n));let c=r-(e+800n);p.push(this.getChangeOutput(c,o))}else{let c=this.getWalletLayers([...t],e,o,n,[...i]);f.push(...c.inputs),p.push(...c.outputs),i=c.sourceOutputs}return{inputs:f,outputs:p,sourceOutputs:i}}static swap(t,e,o,n,i,f=1){const p=[],l=[];let h=i?O(i):n0,r={locktime:0,version:2,inputs:p,outputs:l};o=o.filter(N=>N.token_data?.category==i||!N.token_data);let y=this.getVaultLayers([...e],t,h);r.inputs.push(...y.inputs),r.outputs.push(...y.outputs);let c=y.sourceOutputs,I=this.getWalletLayers([...o],BigInt(t),n,h);r.inputs.push(...I.inputs),r.outputs.push(...I.outputs),c.push(...I.sourceOutputs);let _=y0(r);if(!_.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(_.errors,null,"  "));const K=et(_.transaction,f),H=r.outputs.length-1;if(r.outputs[H].valueSatoshis=r.outputs[H].valueSatoshis-K,_=y0(r),!_.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(_.errors,null,"  "));const w=_.transaction,U=at(w,c);if(U!==!0&&f>0)throw U;let k=this.vm.verify({sourceOutputs:c,transaction:w}),M=a0(c)-a0(w.outputs);M>5e3&&(k=`Excessive fees ${M}`),X(c,i)==0n&&(k="Error checking token input");let x=X(c,i)-X(w.outputs,i);return x!==0n&&(k=`Swapping should not create destroy tokens, token difference: ${x}`),{sourceOutputs:c,transaction:w,verify:k}}}var xt=z('<h1>About Wrapped BCH</h1> <p>Wrapped Bitcoin Cash (WBCH) are fungible CashTokens redeemable 1:1 for Bitcoin Cash.</p> <p><a href="https://wrapped.cash" rel="nofollow">Wrapped BCH (WBCH)</a> was created by Dagur Valberg Johannsson in <a href="https://bitcoincashresearch.org/t/wbch-bch-wrapped-as-cash-token/1196" rel="nofollow">November 2023</a>.</p> <p>All 21M WBCH minted were sent to an immutable vault contract as 21 outputs, each with 1M WBCH.</p> <p>The Wrapped BCH contract enforces three conditions:</p> <ol><li>The token id MUST not change.</li> <li>An output being spent from the contract MUST return to the contract.</li> <li>The sum of tokens and sats <em>in</em> MUST equal the sum of tokens and satoshis <em>out</em>.</li></ol> <p>These three rules ensure that when tokens are spent from the contract, each must swap an equal amount of Bitcoin Cash in a corresponding output.</p> <p>Notice how WBCH token category (id) isn’t in the contract rules? That’s right. The contract will enforce a 1:1 peg with any token, not just “official” WBCH tokens.</p> <p>Anyone may send any fungible token to the contract, but that doesn’t make it WBCH. So there is one more <strong>important</strong> condition needed to make the Wrapped BCH fair.  Dagur minted a fungible token with 21M tokens (8 decimals) and sent the entire supply to the vault contract.</p> <p>To <strong>verify</strong> that WBCH is fair, we can lookup the pre-genesis transaction:</p> <p><a href="https://explorer.salemkode.com/tx/ff4d6e4b90aa8158d39c5dc874fd9411af1ac3b5ed6f354755e8362a0d02c6b3" rel="nofollow">WBCH pre-genesis transactoin</a></p> <p>… the first output was the coin used to mint all WBCH tokens.</p> <p>The minting transaction was in the next transaction:</p> <p><a href="https://explorer.salemkode.com/tx/110dc94c0aa1a4c60ff4738eeee7f931d8f11086190281f43cf3330419d918c8" rel="nofollow">WBCH minting transaction</a></p> <p>The minting transaction created one wrapped satoshi for every bitcoin (cash) satoshi.</p> <p>Given the total minted supply of 21 WBCH sats, we do NOT need to do forensic blockchain analysis or prove a chain of custody of each token from genesis to the WBCH vault, we can just check that the total balance of WBCH on the vault is equal to the total supply of the fungible token, minus BCH locked on WBCH outputs.</p>',1);function Wt(P){var t=xt();q0(30),W(P,t)}var Ht=z("<img/>"),St=z('<img alt="Disconnected"/>'),Et=(P,t)=>t(),Pt=z('<div class="swap svelte-1x2o9hz"><div class="svelte-1x2o9hz"><!></div></div> <div class="swap svelte-1x2o9hz"><button class="svelte-1x2o9hz">Broadcast</button></div>',1),Ut=z('<section><div class="status svelte-1x2o9hz"><!> <!></div> <h1>Wrap Bitcoin Cash as a CashToken</h1> <div class="swap svelte-1x2o9hz"><div class="svelte-1x2o9hz"><img width="50"/> <br/> </div> <div class="svelte-1x2o9hz"><img width="50"/> <br/> </div></div> <div class="swap svelte-1x2o9hz"><input type="range" step="1000" class="svelte-1x2o9hz"/></div> <!> <!></section>');function Jt(P,t){X0(t,!0);let e=m(""),o="",n=m(void 0),i=m(!1),f,p=m(k0([])),l=m(k0([])),h="",r,y,c=m(""),I=m(""),_=m(0n),K=m(0),H=m(0n),w=m(0);u(c,s0.getScriptHash(),!0);let U="";const k=Y0.url.hostname=="vox.cash",M=k?mt:gt,x=k?E(n0):E(It),N=k?"BCH":"tBCH",o0=k?"WBCH":"tWBCH",T0=k?"bch.imaginary.cash":"chipnet.bch.ninja";let i0=new Set,C=m(0),A,G=m("");const O0=()=>{clearTimeout(y),y=setTimeout(()=>{r0(),c0()},1500)},C0=function(a){a.method==="blockchain.scripthash.subscribe"?a.params[1]!==U&&(U=a.params[1],u(e,_0[r.status],!0),u(C,0),O0()):console.log(a)},r0=async function(){let a=await r.request("blockchain.scripthash.listunspent",s(I),"include_tokens");if(a instanceof Error)throw a;let d=new Set(a.map(g=>`${g.tx_hash}":"${g.tx_pos}`));(s(l).length==0||i0.intersection(d).size==0)&&u(l,a,!0),u(w,w0(s(l),!0),!0),u(H,b0(s(l),x),!0)},c0=async function(){let a=await r.request("blockchain.scripthash.listunspent",s(c),"include_tokens");if(a instanceof Error)throw a;let d=new Set(a.map(g=>`${g.tx_hash}":"${g.tx_pos}`));(s(p).length==0||i0.intersection(d).size==0)&&u(p,a,!0),u(p,s(p).filter(g=>g.token_data&&g.token_data.category==x),!0),u(K,w0(s(p),!0),!0),u(_,b0(s(p),x),!0)},I0=async function(a){let d=await r.request("blockchain.transaction.broadcast",a);if(d instanceof Error)throw u(e,_0[r.status],!0),d},x0=function(){try{let a=s0.swap(s(C),s(p),s(l),h,x);u(n,a.transaction,!0),f=a.sourceOutputs,o=E(st(s(n))),u(i,a.verify===!0,!0),a.verify===!0&&u(G,"")}catch(a){u(n,void 0),f=void 0,o="",u(i,!1),u(G,a,!0)}};M0(async()=>{ct.StorageProvider=rt,A=k?await lt.named("vox"):await ut.named("vox"),h=pt(A.mnemonic,A.derivationPath.slice(0,-2),A.isTestnet);let a=nt(A.getDepositAddress());if(typeof a=="string")throw a;u(I,B0(a.bytecode),!0),r=new ot("unspent/wrap","1.4.1",T0),await r.connect(),r.on("notification",C0),await r.subscribe("blockchain.scripthash.subscribe",s(c)),await r.subscribe("blockchain.scripthash.subscribe",s(I)),c0(),r0()}),V0(async()=>{await r.disconnect()});var R=Ut(),j=b(R),l0=b(j);dt(l0,{get template(){return s0.template}});var W0=v(l0,2);{var H0=a=>{var d=Ht();L(()=>{T(d,"src",ht),T(d,"alt",s(e))}),W(a,d)},S0=a=>{var d=St();L(()=>T(d,"src",ft)),W(a,d)};q(W0,a=>{s(e)=="CONNECTED"?a(H0):a(S0,!1)})}B(j);var F=v(j,4),Y=b(F),J=b(Y),E0=v(J,3);B(Y);var u0=v(Y,2),Q=b(u0),P0=v(Q,3);B(u0),B(F);var Z=v(F,2),D=b(Z);j0(D),D.__change=[Et,x0],B(Z);var p0=v(Z,2);{var U0=a=>{var d=Pt(),g=G0(d),h0=b(g),A0=b(h0);{var D0=S=>{var V=m0();L(t0=>$(V,`place: ${t0??""} sats`),[()=>s(C).toLocaleString()]),W(S,V)},L0=(S,V)=>{{var t0=e0=>{var g0=m0();L(z0=>$(g0,`redeem: ${z0??""} wrapped sats`),[()=>(-s(C)).toLocaleString()]),W(e0,g0)};q(S,e0=>{s(C)<0&&e0(t0)},V)}};q(A0,S=>{s(C)>0?S(D0):S(L0,!1)})}B(h0),B(g);var f0=v(g,2),$0=b(f0);$0.__click=()=>I0(o),B(f0),W(a,d)};q(p0,a=>{s(n)&&s(i)&&a(U0)})}var d0=v(p0),N0=v(d0);Wt(N0),B(R),L((a,d,g)=>{T(J,"src",J0),T(J,"alt",N),$(E0,` ${a??""} sats ${N}`),T(Q,"src",M),T(Q,"alt",o0),$(P0,` ${d??""} sats ${o0}`),T(D,"min",g),T(D,"max",s(w)-2e3),$(d0,` ${s(G)??""}  `)},[()=>s(w).toLocaleString(),()=>s(H).toLocaleString(),()=>Number(-s(H))]),F0(D,()=>s(C),a=>u(C,a)),W(P,R),K0()}R0(["change","click"]);export{Jt as component,Yt as universal};
//# sourceMappingURL=9.BcUXrq-f.js.map
