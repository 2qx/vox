{"version":3,"file":"17.Bg-aMH8f.js","sources":["../../../../../../src/lib/TokenNftData.svelte","../../../../../../src/lib/Utxo.svelte","../../../../../../src/routes/wallet/+page.ts","../../../../../../src/lib/images/cashTokens.svg","../../../../../../src/lib/FutureUtxo.svelte","../../../../../../src/routes/wallet/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { parseUsername } from '@fbch/lib';\n\tlet { commitment, capability } = $props();\n</script>\n\n<div class=\"capability\">\n\t{#if capability}\n\t\t{capability} <img height=16px src={`./${capability}.svg`} /> \n\t{:else}\n\t\timmutable <img  height=16px  src={`./immutable.svg`} /> \n\t{/if}\n</div>\n\n<div class=\"commitment\">\n\t{#if commitment.startsWith('6a03553356')}\n\t\tVox: <i>{parseUsername(commitment)}</i>\n\t{:else if commitment.startsWith('6a03553358')}\n\t\tCatDex: <i>{parseUsername(commitment)}</i>\n\t{:else}\n\t\t{commitment}\n\t{/if}\n</div>\n\n\n\n<style>\n\t.commitment {\n\t\tword-break: break-all;\n\n\t}\n\n\t.capability {\n\t\tdisplay: flex;\n        vertical-align: middle;\n\t}\n</style>\n","<script lang=\"ts\">\n\timport BCH from '$lib/images/BCH.svg';\n\timport tBCH from '$lib/images/tBCH.svg';\n\n\timport TokenNftData from './TokenNftData.svelte';\n\timport TokenAmount from './TokenAmount.svelte';\n\timport TokenIcon from './TokenIcon.svelte';\n\n\tlet { tx_pos, tx_hash, height, value, token_data, isMainnet } = $props();\n\n\tlet bchIcon = isMainnet ? BCH : tBCH;\n</script>\n\n<div class=\"container\">\n\t<div class=\"post\">\n\t\t\n\t\t<div class=\"balance\">\n\t\t\t<div>\n\t\t\t\t{#if token_data}\n\t\t\t\t<TokenIcon category={token_data.category} size={16} {isMainnet}></TokenIcon>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t\t<div class=\"fill\">\n\t\t\t\t{#if token_data}\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<TokenAmount amount={token_data.amount} category={token_data.category} {isMainnet} />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{#if token_data.nft}\n\t\t\t\t\t\t\t<TokenNftData {...token_data.nft} />\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t{#if value > 1000n}\n\t\t\t\t\t<img width=\"16px\" src={bchIcon} /> <b>BCH</b>\n\t\t\t\t\t{Number(value / 100_000_000).toLocaleString(undefined, {})}\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"header\">\n\t\t\t<div class=\"timestamp\">{tx_hash} : {tx_pos}</div>\n\t\t\t<div class=\"fill\"></div>\n\t\t\t<div class=\"timestamp\">{height}</div>\n\t\t</div>\n\t</div>\n</div>\n\n<style>\n\t.container {\n\t\tdisplay: flex;\n\t\tpadding: 2px;\n\t}\n\t.post {\n\t\tborder-radius: 10px;\n\t\tpadding: 5px 5px 5px 15px;\n\t\tbackground-color: #eeeeee;\n\t\tmargin: auto;\n\t\twidth: 100%;\n\t\tborder: #bbb solid;\n\t\tborder-width: 1px;\n\t}\n\n\t.header {\n\t\tdisplay: flex;\n\t}\n\t.balance {\n\t\tdisplay: flex;\n\t}\n\t.fill {\n\t\tflex: 1;\n\t\tword-break: break-all;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\n\t.timestamp {\n\t\tfont-size: xx-small;\n\t\tfont-weight: 200;\n\t\tcolor: #777;\n\t\tword-break: break-all;\n\t}\n\n\t.post :global {\n\t\tp {\n\t\t\tfont-weight: 400;\n\t\t\tline-height: 1;\n\t\t}\n\t}\n\n</style>\n","// since there's no dynamic data here, we can prerender\n// it so that it gets served as a static asset in production\nexport const prerender = true;\n","export default \"__VITE_ASSET__Czgkdlz6__\"","<script lang=\"ts\">\n\timport BCH from '$lib/images/BCH.svg';\n\timport tBCH from '$lib/images/tBCH.svg';\n\n\timport TokenNftData from './TokenNftData.svelte';\n\timport TokenAmount from './TokenAmount.svelte';\n\timport TokenIcon from './TokenIcon.svelte';\n\n\tlet { tx_pos, tx_hash, height, value, token_data, isMainnet, redeemFutures, locktime, now } =\n\t\t$props();\n\n\tlet bchIcon = isMainnet ? BCH : tBCH;\n</script>\n\n<div class=\"container\">\n\t<div class=\"post\">\n\t\t<div class=\"balance\">\n\t\t\t<div>\n\t\t\t\t{#if token_data}\n\t\t\t\t\t<TokenIcon category={token_data.category} size={16} {isMainnet}></TokenIcon>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t\t<div class=\"fill\">\n\t\t\t\t{#if token_data}\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<TokenAmount amount={token_data.amount} category={token_data.category} {isMainnet} />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{#if token_data.nft}\n\t\t\t\t\t\t\t<TokenNftData {...token_data.nft} />\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t{#if value > 1000n}\n\t\t\t\t\t<img width=\"16px\" src={bchIcon} /> <b>BCH</b>\n\t\t\t\t\t{Number(value / 100_000_000).toLocaleString(undefined, {})}\n\t\t\t\t{/if}\n\t\t\t\t{#if now >= locktime}\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"action\"\n\t\t\t\t\t\tonclick={() => {\n\t\t\t\t\t\t\tredeemFutures(tx_hash, tx_pos, locktime, token_data.amount);\n\t\t\t\t\t\t}}>redeem</button\n\t\t\t\t\t>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"header\">\n\t\t\t<div class=\"timestamp\">{tx_hash} : {tx_pos}</div>\n\t\t\t<div class=\"fill\"></div>\n\t\t\t<div class=\"timestamp\">{height}</div>\n\t\t</div>\n\t</div>\n</div>\n\n<style>\n\t.container {\n\t\tdisplay: flex;\n\t\tpadding: 2px;\n\t}\n\t.post {\n\t\tborder-radius: 10px;\n\t\tpadding: 5px 5px 5px 15px;\n\t\tbackground-color: #eeeeee;\n\t\tmargin: auto;\n\t\twidth: 100%;\n\t\tborder: #bbb solid;\n\t\tborder-width: 1px;\n\t}\n\n\t.header {\n\t\tdisplay: flex;\n\t}\n\t.balance {\n\t\tdisplay: flex;\n\t}\n\t\n\t.fill {\n\t\tflex: 1;\n\t\tword-break: break-all;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\t\n\t.timestamp {\n\t\tfont-size: xx-small;\n\t\tfont-weight: 200;\n\t\tcolor: #777;\n\t\tword-break: break-all;\n\t}\n\t\n\n\t.post :global {\n\t\tp {\n\t\t\tfont-weight: 400;\n\t\t\tline-height: 1;\n\t\t}\n\t}\n\n\tbutton {\n\t\tbackground-color: #a45eb6; /* Green */\n\t\tborder: none;\n\t\tcolor: white;\n\t\tpadding: 10px;\n\t\tborder-radius: 20px;\n\t\ttext-align: center;\n\t\ttext-decoration: none;\n\t\tdisplay: inline-block;\n\t\tfont-size: 16px;\n\t}\n\n\tbutton:disabled {\n\t\tbackground-color: #777;\n\t}\n\t\n</style>\n","<script lang=\"ts\">\n\timport { onMount, onDestroy } from 'svelte';\n\timport { page } from '$app/state';\n\timport hot from '$lib/images/hot.svg';\n\timport hotCT from '$lib/images/cashTokens.svg';\n\n\timport BCMR from '$lib/bitcoin-cash-metadata-registry.json' with { type: 'json' };\n\timport tBCMR from '$lib/chipnet-metadata-registry.json' with { type: 'json' };\n\timport { Vault, CATEGORY_MAP, CATEGORY_MAP_CHIPNET } from '@fbch/lib';\n\n\timport {\n\t\tbinToHex,\n\t\tcashAddressToLockingBytecode,\n\t\tencodeTransactionBch,\n\t\tstringify,\n\t\tswapEndianness\n\t} from '@bitauth/libauth';\n\n\timport { getScriptHash, sumUtxoValue, type UtxoI, getHdPrivateKey } from '@unspent/tau';\n\n\timport { ElectrumClient, ConnectionStatus } from '@electrum-cash/network';\n\n\timport { IndexedDBProvider } from '@mainnet-cash/indexeddb-storage';\n\timport { BaseWallet, Wallet, TestNetWallet, TokenSendRequest, WalletTypeEnum } from 'mainnet-js';\n\n\timport CONNECTED from '$lib/images/connected.svg';\n\timport DISCONNECTED from '$lib/images/disconnected.svg';\n\timport Utxo from '$lib/Utxo.svelte';\n\timport FutureUtxo from '$lib/FutureUtxo.svelte';\n\n\tconst isMainnet = page.url.hostname == 'vox.cash';\n\tlet server = isMainnet ? 'bch.imaginary.cash' : 'chipnet.bch.ninja';\n\tconst metadata = isMainnet ? BCMR : tBCMR;\n\tconst SERIES_MAP = isMainnet ? CATEGORY_MAP : CATEGORY_MAP_CHIPNET;\n\n\tlet now = $state(0);\n\tlet wallet: Wallet | TestNetWallet | undefined = $state();\n\tlet key = $state('');\n\tlet walletError = false;\n\tlet balance = $state(0);\n\tlet electrumClient: any;\n\tlet connectionStatus = $state('');\n\tlet connectionError = $state('');\n\tlet showTokenAddress = $state(true);\n\tlet unspent: UtxoI[] | undefined = $state([]);\n\tlet assetsCash: UtxoI[] | undefined = $state([]);\n\tlet assetsCommodity: UtxoI[] | undefined = $state([]);\n\tlet assetsFuture: UtxoI[] | undefined = $state([]);\n\tlet assetsAuth: UtxoI[] | undefined = $state([]);\n\tlet assetsOther: UtxoI[] | undefined = $state([]);\n\tlet showInfo = $state(false);\n\tlet scripthash = $state('');\n\n\tlet showHistory = $state(false);\n\n\tconst bcmr = Object.entries(metadata.identities)\n\t\t.map((o) => {\n\t\t\treturn Object.values(Object.values(o[1]));\n\t\t})\n\t\t.flat()\n\t\t.reduce((acc, o) => {\n\t\t\tacc.set(o.token.category, o);\n\t\t\treturn acc;\n\t\t}, new Map());\n\n\tconst handleNotifications = function (data: any) {\n\t\tif (data.method === 'blockchain.headers.subscribe') {\n\t\t\tconnectionStatus = ConnectionStatus[electrumClient.status];\n\t\t\tlet d = data.params[0];\n\t\t\tnow = d.height;\n\t\t} else if (data.method === 'blockchain.scripthash.subscribe') {\n\t\t\tupdateWallet();\n\t\t} else {\n\t\t\tconsole.log(data);\n\t\t}\n\t};\n\n\tasync function redeemFutures(tx_hash: string, tx_pos: number, locktime: number, amount: number) {\n\t\tlet utxoToRedeem = unspent?.filter((u) => (u.tx_hash == tx_hash && u.tx_pos == tx_pos)).pop();\n\t\tlet vaultUtxos = await electrumClient.request(\n\t\t\t'blockchain.scripthash.listunspent',\n\t\t\tVault.getScriptHash(locktime),\n\t\t\t'include_tokens'\n\t\t);\n\n\t\tvaultUtxos = vaultUtxos.filter(\n\t\t\t(u: UtxoI) => u.token_data?.category == utxoToRedeem?.token_data?.category\n\t\t);\n\n\n\t\tconsole.log(vaultUtxos)\n\t\tif (utxoToRedeem) {\n\t\t\tlet walletUnspent = [...assetsCash!, utxoToRedeem];\n\t\t\tlet swapTx = Vault.swap(-amount, vaultUtxos, walletUnspent, locktime, key);\n\t\t\tlet transactionHex = binToHex(encodeTransactionBch(swapTx.transaction));\n\t\t\tconsole.log(transactionHex);\n\t\t\tbroadcast(transactionHex);\n\t\t}\n\t}\n\tasync function consolidateFungibleTokens() {\n\t\tconst cashaddr = wallet!.getTokenDepositAddress();\n\t\tlet utxos = (await wallet!.getUtxos())\n\t\t\t.filter((u: any) => u.token)\n\t\t\t.filter((u: any) => u.token.amount > 0)\n\t\t\t.filter((u: any) => !u.token.capability);\n\n\t\tlet categoryIds = utxos.map((u) => u.token!.tokenId);\n\t\t// Get a list of\n\t\tlet duplicateCategories = categoryIds.filter(\n\t\t\t(item, index) => categoryIds.indexOf(item) !== index\n\t\t);\n\n\t\tconst categories = [\n\t\t\t...new Set(\n\t\t\t\tduplicateCategories.map((cat: any) => {\n\t\t\t\t\treturn cat;\n\t\t\t\t})\n\t\t\t)\n\t\t];\n\n\t\tlet sendRequests = categories.map((tokenId: any) => {\n\t\t\tconst sumTokens = utxos\n\t\t\t\t.filter((u: any) => u.token.tokenId == tokenId && u.token.amount > 0n)\n\t\t\t\t.map((u: any) => u.token.amount || 0n)\n\t\t\t\t.reduce((a: any, b: any) => a + b, 0n);\n\t\t\treturn new TokenSendRequest({\n\t\t\t\tcashaddr: cashaddr,\n\t\t\t\tvalue: 800,\n\t\t\t\tamount: sumTokens,\n\t\t\t\ttokenId: tokenId\n\t\t\t});\n\t\t});\n\t\treturn await wallet!.send(sendRequests);\n\t}\n\n\tasync function consolidateSats() {\n\t\treturn await wallet!.sendMax(wallet!.getDepositAddress());\n\t}\n\n\tconst toggleSeed = () => {\n\t\tshowInfo = !showInfo;\n\t};\n\n\tconst broadcast = async function (raw_tx: string) {\n\t\tlet response = await electrumClient.request('blockchain.transaction.broadcast', raw_tx);\n\t\tif (response instanceof Error) {\n\t\t\tconnectionStatus = ConnectionStatus[electrumClient.status];\n\t\t\tthrow response;\n\t\t}\n\t\tresponse as any[];\n\t};\n\n\tconst classifyUtxos = function (unspent: UtxoI[] | undefined) {\n\t\tlet classifiedUtxos = Object.groupBy(unspent!, ({ token_data }) => {\n\t\t\tif (!token_data) {\n\t\t\t\treturn 'cash';\n\t\t\t} else if (bcmr.has(token_data!.category) && Number(token_data?.amount) > 0) {\n\t\t\t\treturn 'commodity';\n\t\t\t} else if (SERIES_MAP.has(token_data!.category)) {\n\t\t\t\treturn 'future';\n\t\t\t} else if (token_data!.nft?.commitment.startsWith('6a035533')) {\n\t\t\t\treturn 'auth';\n\t\t\t} else {\n\t\t\t\treturn 'other';\n\t\t\t}\n\t\t});\n\n\t\tassetsCash = classifiedUtxos.cash;\n\t\tassetsCommodity = classifiedUtxos.commodity;\n\t\tassetsFuture = classifiedUtxos.future;\n\t\tassetsAuth = classifiedUtxos.auth;\n\t\tassetsOther = classifiedUtxos.other;\n\t\treturn unspent;\n\t};\n\n\tconst updateWallet = async function () {\n\t\tconsole.log('updating wallet...');\n\t\tlet response = await electrumClient.request(\n\t\t\t'blockchain.scripthash.listunspent',\n\t\t\tscripthash,\n\t\t\t'include_tokens'\n\t\t);\n\t\tif (response instanceof Error) throw response;\n\t\tunspent = classifyUtxos(response);\n\n\t\tbalance = sumUtxoValue(unspent as UtxoI[], true);\n\t};\n\n\tonMount(async () => {\n\t\ttry {\n\t\t\tBaseWallet.StorageProvider = IndexedDBProvider;\n\t\t\twallet = isMainnet ? await Wallet.named(`vox`) : await TestNetWallet.named(`vox`);\n\n\t\t\tkey = getHdPrivateKey(wallet.mnemonic!, wallet.derivationPath.slice(0, -2), wallet.isTestnet);\n\t\t\tlet lockingBytecode = cashAddressToLockingBytecode(wallet.getDepositAddress());\n\t\t\tif (typeof lockingBytecode == 'string') throw lockingBytecode;\n\t\t\tscripthash = getScriptHash(lockingBytecode.bytecode, true);\n\t\t\t// Initialize an electrum client.\n\t\t\telectrumClient = new ElectrumClient('vox/wallet', '1.4.1', server);\n\n\t\t\ttry {\n\t\t\t\t// Wait for the client to connect.\n\t\t\t\tawait electrumClient.connect();\n\t\t\t\t// Set up a callback function to handle new blocks.\n\t\t\t} catch (e) {\n\t\t\t\tconnectionError = e;\n\t\t\t}\n\n\t\t\t// Listen for notifications.\n\t\t\telectrumClient.on('notification', handleNotifications);\n\n\t\t\t// Set up a subscription for new block headers.\n\t\t\tawait electrumClient.subscribe('blockchain.scripthash.subscribe', scripthash);\n\t\t\tawait electrumClient.subscribe('blockchain.headers.subscribe');\n\n\t\t\tawait updateWallet();\n\t\t} catch (e) {\n\t\t\twalletError = true;\n\t\t\tthrow e;\n\t\t}\n\t});\n\n\tonDestroy(async () => {\n\t\tawait wallet!.provider.disconnect();\n\t\tawait electrumClient.disconnect();\n\t});\n</script>\n\n<svelte:head>\n\t<title>ðŸ‘› Wallet</title>\n\t<meta name=\"description\" content=\"Vox Wallet.\" />\n</svelte:head>\n\n<section>\n\t<div class=\"status\">\n\t\t{#if connectionStatus == 'CONNECTED'}\n\t\t\t<img src={CONNECTED} alt={connectionStatus} />\n\t\t{:else}\n\t\t\t<img src={DISCONNECTED} alt=\"Disconnected\" />\n\t\t{/if}\n\t\t<div class=\"scanable\">\n\t\t\t{#if wallet}\n\t\t\t\t{#if !showTokenAddress}\n\t\t\t\t\t<button\n\t\t\t\t\t\tonclick={() => {\n\t\t\t\t\t\t\tshowTokenAddress = !showTokenAddress;\n\t\t\t\t\t\t}}\n\t\t\t\t\t\taria-label=\"toggle address\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<qr-code\n\t\t\t\t\t\t\tid=\"qr1\"\n\t\t\t\t\t\t\tcontents={wallet.getDepositAddress()}\n\t\t\t\t\t\t\tmodule-color=\"#000\"\n\t\t\t\t\t\t\tposition-ring-color=\"#8dc351\"\n\t\t\t\t\t\t\tposition-center-color=\"#ff00ec\"\n\t\t\t\t\t\t\tmask-x-to-y-ratio=\"1.2\"\n\t\t\t\t\t\t\tstyle=\"width: 150px;\n                height: 150px;\n                margin: 0.5em auto;\n                background-color: #fff;\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<img src={hot} width=\"30px\" slot=\"icon\" />\n\t\t\t\t\t\t</qr-code>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<p id=\"deposit\" style=\"text-align: center;\">{wallet.getDepositAddress()}</p>\n\t\t\t\t{:else}\n\t\t\t\t\t<button\n\t\t\t\t\t\tonclick={() => {\n\t\t\t\t\t\t\tshowTokenAddress = !showTokenAddress;\n\t\t\t\t\t\t}}\n\t\t\t\t\t\taria-label=\"toggle address\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<qr-code\n\t\t\t\t\t\t\tid=\"qr1\"\n\t\t\t\t\t\t\tcontents={wallet.getTokenDepositAddress()}\n\t\t\t\t\t\t\tmodule-color=\"#000\"\n\t\t\t\t\t\t\tposition-ring-color=\"#8dc351\"\n\t\t\t\t\t\t\tposition-center-color=\"#ff00ec\"\n\t\t\t\t\t\t\tmask-x-to-y-ratio=\"1.2\"\n\t\t\t\t\t\t\tstyle=\"width: 150px;\n                height: 150px;\n                margin: 0.5em auto;\n                background-color: #fff;\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<img src={hotCT} width=\"30px\" slot=\"icon\" />\n\t\t\t\t\t\t</qr-code>\n\t\t\t\t\t</button>\n\t\t\t\t\t<p id=\"deposit\" style=\"text-align: center;\">{wallet.getTokenDepositAddress()}</p>\n\t\t\t\t{/if}\n\t\t\t{/if}\n\t\t\t{#if connectionError}\n\t\t\t\t<b>{connectionError}</b>\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n\t<div>\n\t\t{#if unspent}\n\t\t\t{#if assetsCash!.length > 0}\n\t\t\t\t<h3>assets : cash</h3>\n\t\t\t\t{#each assetsCash! as u, i (u.tx_hash + ':' + u.tx_pos)}\n\t\t\t\t\t<Utxo {...u} {...{ isMainnet: isMainnet }} />\n\t\t\t\t{/each}\n\t\t\t{/if}\n\t\t\t{#if assetsCommodity!.length > 0}\n\t\t\t\t<h3>assets : commodities</h3>\n\t\t\t\t{#each assetsCommodity! as u, i (u.tx_hash + ':' + u.tx_pos)}\n\t\t\t\t\t<Utxo {...u} {...{ isMainnet: isMainnet }} />\n\t\t\t\t{/each}\n\t\t\t{/if}\n\t\t\t{#if assetsFuture.length > 0}\n\t\t\t\t<h3>assets : commodities : futures</h3>\n\t\t\t\t{#each assetsFuture as u, i (u.tx_hash + ':' + u.tx_pos)}\n\t\t\t\t\t<FutureUtxo\n\t\t\t\t\t\t{...u}\n\t\t\t\t\t\t{...{ isMainnet: isMainnet }}\n\t\t\t\t\t\tlocktime={SERIES_MAP.get(u.token_data?.category)}\n\t\t\t\t\t\t{now}\n\t\t\t\t\t\t{redeemFutures}\n\t\t\t\t\t/>\n\t\t\t\t{/each}\n\t\t\t{/if}\n\n\t\t\t{#if assetsAuth.length > 0}\n\t\t\t\t<h3>assets : authentication</h3>\n\t\t\t\t{#each assetsAuth as u, i (u.tx_hash + ':' + u.tx_pos)}\n\t\t\t\t\t<Utxo {...u} {...{ isMainnet: isMainnet }} />\n\t\t\t\t{/each}\n\t\t\t{/if}\n\n\t\t\t{#if assetsOther!.length > 0}\n\t\t\t\t<h3>assets : other</h3>\n\t\t\t\t{#each assetsOther! as u, i (u.tx_hash + ':' + u.tx_pos)}\n\t\t\t\t\t<Utxo {...u} {isMainnet} />\n\t\t\t\t{/each}\n\t\t\t{/if}\n\t\t\t<div class=\"walletHead\">\n\t\t\t\t<button onclick={() => consolidateFungibleTokens()}> Consolidate Tokens</button>\n\t\t\t\t<button onclick={() => consolidateSats()}> Consolidate Sats</button>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<p>loading wallet...</p>\n\t\t{/if}\n\n\t\t{#if wallet}\n\t\t\t<div class=\"showSeed\">\n\t\t\t\t<button onclick={toggleSeed}>Show/hide backup</button>\n\t\t\t\t{#if showInfo}\n\t\t\t\t\t<h3>DO NOT SHARE WITH ANYONE!</h3>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t{wallet!.toDbString()}\n\t\t\t\t\t</p>\n\t\t\t\t\tNote: vox.cash {new Date().toLocaleDateString()}\n\t\t\t\t{/if}\n\t\t\t</div>\n\n\t\t\t<div class=\"history\">\n\t\t\t\t<button\n\t\t\t\t\tonclick={() => {\n\t\t\t\t\t\tshowHistory = !showHistory;\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\tShow/hide History\n\t\t\t\t</button>\n\t\t\t\t{#if showHistory}\n\t\t\t\t\t<h3>History</h3>\n\t\t\t\t\t{#await wallet!.getHistory({ unit: 'sat', fromHeight: now - 10 })}\n\t\t\t\t\t\t<p>...getting history</p>\n\t\t\t\t\t{:then history}\n\t\t\t\t\t\t{#if history.length > 0}\n\t\t\t\t\t\t\t{#each history as c, i (c.hash)}\n\t\t\t\t\t\t\t\t{#if c!.timestamp > 0}\n\t\t\t\t\t\t\t\t\t<pre>{new Date(c!.timestamp * 1000).toISOString()}</pre>\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t<pre>{new Date().toISOString()}</pre>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t<pre># {c.blockHeight}â–  {c.hash} </pre>\n\t\t\t\t\t\t\t\t<pre>  assets:cash    {c.valueChange.toLocaleString().padStart(14)} sat</pre>\n\t\t\t\t\t\t\t\t<pre>  expenses:fees  {c.fee\n\t\t\t\t\t\t\t\t\t\t.toLocaleString()\n\t\t\t\t\t\t\t\t\t\t.padStart(14)} sat # {c.size} bytes</pre>\n\t\t\t\t\t\t\t\t{#each c.tokenAmountChanges as tokenChange}\n\t\t\t\t\t\t\t\t\t{#if tokenChange.amount != 0n}\n\t\t\t\t\t\t\t\t\t\t<pre>  assets:cash:tokens  {tokenChange.amount.toLocaleString()} {tokenChange.tokenId} </pre>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t<pre>   &nbsp;</pre>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<p>no history</p>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{:catch error}\n\t\t\t\t\t\t<p style=\"color: red\">{error.message}</p>\n\t\t\t\t\t{/await}\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n</section>\n\n<style>\n\t.status {\n\t\ttext-align: end;\n\t}\n\n\th3 {\n\t\tmargin-block-end: 0px;\n\t}\n\n\tpre {\n\t\tmargin-block: 0px;\n\t\tpadding: 0px;\n\t\toverflow: hidden;\n\t\twhite-space: nowrap;\n\t}\n\n\t.scanable {\n\t\tpadding: 60px;\n\t\tbackground-color: white;\n\t\tborder-radius: 30px;\n\t\tdisplay: grid;\n\t}\n\n\t.scanable button {\n\t\ttext-align: center;\n\t\tbackground-color: #fff;\n\t}\n\n\tbutton {\n\t\tbackground-color: #a45eb6; /* Green */\n\t\tborder: none;\n\t\tcolor: white;\n\t\tpadding: 15px 15px;\n\t\tborder-radius: 20px;\n\t\ttext-align: center;\n\t\ttext-decoration: none;\n\t\tdisplay: inline-block;\n\t\tfont-size: 16px;\n\t\tmargin: auto;\n\t}\n\n\t.walletHead {\n\t\tpadding: 15px 15px;\n\t\tdisplay: flex;\n\t}\n\n\t.showSeed {\n\t\tpadding: 25px;\n\t}\n</style>\n"],"names":["parseUsername","$$props","$$render","consequent_2","alternate_2","consequent_1","alternate_1","bchIcon","BCH","tBCH","consequent_3","prerender","hotCT","on_click","_","toggleSeed","showInfo","$.set","__1","showTokenAddress","on_click_1","__2","consolidateFungibleTokens","consolidateSats","on_click_4","__5","showHistory","isMainnet","page","server","metadata","BCMR","tBCMR","SERIES_MAP","CATEGORY_MAP","CATEGORY_MAP_CHIPNET","now","wallet","$.state","key","balance","electrumClient","connectionStatus","connectionError","unspent","$.proxy","assetsCash","assetsCommodity","assetsFuture","assetsAuth","assetsOther","scripthash","bcmr","o","acc","handleNotifications","data","ConnectionStatus","d","updateWallet","redeemFutures","tx_hash","tx_pos","locktime","amount","utxoToRedeem","u","vaultUtxos","Vault","walletUnspent","$.get","swapTx","transactionHex","binToHex","encodeTransactionBch","broadcast","cashaddr","utxos","categoryIds","duplicateCategories","item","index","sendRequests","cat","tokenId","sumTokens","a","b","TokenSendRequest","raw_tx","response","classifyUtxos","classifiedUtxos","token_data","sumUtxoValue","onMount","BaseWallet","IndexedDBProvider","Wallet","TestNetWallet","getHdPrivateKey","lockingBytecode","cashAddressToLockingBytecode","getScriptHash","ElectrumClient","e","onDestroy","CONNECTED","DISCONNECTED","consequent","alternate","$.template_effect","$.set_custom_element_data","qr_code","hot","qr_code_1","$.each","node_6","Utxo","$$anchor","$.spread_props","consequent_4","node_8","consequent_5","node_10","expression","$.derived","FutureUtxo","consequent_6","node_12","consequent_7","node_14","consequent_8","consequent_9","consequent_10","history","node_20","c","$0","$.set_text","text_6","consequent_11","alternate_3","$.index","tokenChange","text_10","consequent_12","text_7","text_9","$1","consequent_13","alternate_4","error","text_11","consequent_14","consequent_15"],"mappings":"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"}