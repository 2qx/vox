import{f as b,a as _,t as v0}from"../chunks/DTc5U4eY.js";import{o as F0,a as J0}from"../chunks/_R59KZhj.js";import{aA as Q0,p as Z0,aB as f,ao as k0,ak as c,a as tt,ay as et,c as O,s as B,I as s,r as I,t as L,f as y0}from"../chunks/CQU5mOuk.js";import{d as at,h as st,s as V}from"../chunks/CF3aPdyL.js";import{i as $}from"../chunks/CZ0rTjPC.js";import{s as W,r as nt}from"../chunks/-rOGAMhN.js";import{b as ot}from"../chunks/Oj09dCTU.js";import{p as it}from"../chunks/DKGt_eH1.js";import{B as rt,t as ct}from"../chunks/B2Xzehbr.js";import{$ as lt,a as _0}from"../chunks/BDt1pbpk.js";import{h as pt,I as ut,B as dt,W as ht,T as ft,g as mt}from"../chunks/BTBIn4-B.js";import{h as S,g as gt,d as C0,e as vt,B as w0,b as z,q as n0,D as R,f as B0,C as kt,v as yt,j as _t,s as b0,n as T0,k as wt}from"../chunks/BQUio51k.js";import{c as Bt}from"../chunks/DGwzT_kg.js";import"../chunks/CuzQ0eOn.js";import{B as bt}from"../chunks/BzLj6JBc.js";import{C as Tt}from"../chunks/B7hCbxZp.js";import{D as Ct}from"../chunks/DMvn4Q5j.js";const me=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),Ot="data:image/svg+xml,%3csvg%20version='1.1'%20viewBox='0%200%2016%2016'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='a'%20x1='4.54e-7'%20x2='16'%20y1='8'%20y2='8'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23feccf2'%20offset='0'/%3e%3cstop%20stop-color='%23ffda95'%20offset='1'/%3e%3c/linearGradient%3e%3c/defs%3e%3ccircle%20cx='8'%20cy='8'%20r='8'%20fill='url(%23a)'%20stroke-width='0'/%3e%3ccircle%20cx='8'%20cy='8'%20r='6'%20fill='%2394ff94'%20stroke-width='0'/%3e%3cpath%20d='m7.96%201.07a6.93%206.93%200%200%200-6.89%206.93%206.93%206.93%200%200%200%206.93%206.93%206.93%206.93%200%200%200%206.93-6.93%206.93%206.93%200%200%200-6.93-6.93%206.93%206.93%200%200%200-0.0371%200zm-0.244%201.94%200.00391%200.00586c0.00188%200.00188%200.0847%200.303%200.186%200.67%200.101%200.366%200.186%200.668%200.189%200.67%200.00188%200.00284%200.0377-2.72e-4%200.082-0.00781%200.392-0.0697%200.847-0.0893%201.11-0.0488%200.633%200.0979%201.02%200.413%201.21%200.998%200.185%200.557%200.0921%201.02-0.283%201.41l-0.0684%200.0723h0.111c0.78%200%201.27%200.37%201.47%201.12%200.122%200.443%200.127%200.856%200.0137%201.2-0.0386%200.119-0.129%200.295-0.205%200.402-0.137%200.193-0.392%200.418-0.656%200.576-0.261%200.156-0.711%200.356-1.02%200.455-0.0282%200.0094-0.0548%200.0196-0.0586%200.0234-0.00376%200.0028%200.067%200.272%200.156%200.598%200.0904%200.327%200.174%200.633%200.187%200.68l0.0234%200.0859-0.402%200.109c-0.22%200.0603-0.405%200.109-0.41%200.109-0.00565%200-0.0918-0.299-0.191-0.666-0.101-0.367-0.183-0.669-0.184-0.67-9.58e-4%20-0.0019-0.136%200.0328-0.299%200.0762-0.163%200.0433-0.31%200.0822-0.326%200.0859-0.0169%200.0028-0.0312%200.012-0.0312%200.0176%200%200.0104%200.015%200.064%200.244%200.896%200.0669%200.244%200.121%200.443%200.119%200.445-9.58e-4%209.58e-4%20-0.185%200.0522-0.408%200.113l-0.404%200.111-0.00977-0.0293c-0.00565-0.016-0.0594-0.209-0.121-0.43-0.184-0.671-0.246-0.895-0.25-0.9-0.00284-0.0019-0.373%200.0977-0.826%200.221-0.453%200.123-0.824%200.224-0.826%200.223-0.00284-0.0028-0.105-0.98-0.105-1.01%200-0.016%200.00573-0.0226%200.0293-0.0273%200.0706-0.0132%200.527-0.136%200.592-0.16%200.0951-0.0358%200.17-0.109%200.191-0.184%200.0264-0.0894%200.0211-0.146-0.0391-0.367-0.0311-0.112-0.132-0.474-0.223-0.805-0.0913-0.331-0.225-0.816-0.297-1.08-0.0716-0.262-0.182-0.663-0.246-0.891-0.0631-0.228-0.132-0.484-0.154-0.57-0.0235-0.0857-0.0542-0.173-0.0684-0.197-0.0414-0.0725-0.105-0.13-0.18-0.166-0.0631-0.032-0.0782-0.0362-0.16-0.0391-0.126-0.00565-0.22%200.015-0.691%200.152-0.0763%200.0217-0.113%200.029-0.115%200.0215-0.00659-0.0188-0.232-0.849-0.234-0.857%200-0.00376%200.0827-0.0313%200.184-0.0586%200.101-0.0282%200.468-0.13%200.818-0.227%200.349-0.096%200.639-0.178%200.643-0.18%200.00376-0.00284-0.0765-0.304-0.178-0.67-0.101-0.365-0.18-0.67-0.178-0.674%200.00188-0.00565%200.0254-0.0149%200.0527-0.0215%200.0282-0.00753%200.208-0.0587%200.402-0.111%200.194-0.0537%200.355-0.0956%200.355-0.0938%209.58e-4%209.42e-4%200.083%200.295%200.182%200.654%200.0998%200.36%200.182%200.656%200.184%200.658%200.00188%200.00188%200.13-0.0329%200.285-0.0781%200.154-0.0452%200.298-0.0862%200.322-0.0938%200.033-0.00942%200.041-0.0161%200.0391-0.0293-0.00188-0.0104-0.081-0.301-0.176-0.648-0.0951-0.346-0.174-0.635-0.174-0.641%200-0.00847%200.809-0.235%200.816-0.229zm0.404%202.43c-0.214%200.00565-0.377%200.0308-0.641%200.0977-0.161%200.0395-0.572%200.159-0.58%200.168-0.00376%200.00376%200.117%200.456%200.404%201.5%200.0226%200.0819%200.0442%200.139%200.0508%200.139%200.00565%200%200.0846-0.0194%200.174-0.043%200.619-0.162%200.957-0.303%201.22-0.51%200.0913-0.0716%200.15-0.135%200.211-0.227%200.0565-0.0857%200.0826-0.153%200.102-0.262%200.0179-0.106%200.00619-0.221-0.0371-0.348-0.096-0.287-0.291-0.446-0.621-0.502-0.0772-0.0122-0.133-0.0145-0.281-0.00977l-0.00195-0.00391zm0.963%202.4c-0.239%200.00911-0.522%200.0561-0.854%200.141-0.213%200.0546-0.654%200.185-0.654%200.195%200%200.00376%200.109%200.408%200.244%200.898s0.246%200.892%200.246%200.895c0%200.00942%200.0198%200.0059%200.219-0.0469%200.874-0.229%201.35-0.443%201.63-0.74%200.0876-0.0923%200.123-0.142%200.168-0.238%200.0508-0.106%200.0655-0.174%200.0645-0.297%200-0.199-0.0736-0.394-0.201-0.529-0.187-0.199-0.465-0.292-0.861-0.277h-0.00195z'%20fill='%23800000'/%3e%3c/svg%3e",It="data:image/svg+xml,%3csvg%20version='1.1'%20viewBox='0%200%2016%2016'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3clinearGradient%20id='a'%20x1='4.54e-7'%20x2='16'%20y1='8'%20y2='8'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23ccfed8'%20offset='0'/%3e%3cstop%20stop-color='%2395baff'%20offset='1'/%3e%3c/linearGradient%3e%3c/defs%3e%3cg%3e%3ccircle%20cx='8'%20cy='8'%20r='8'%20fill='url(%23a)'%20stroke-width='0'/%3e%3ccircle%20cx='8'%20cy='8'%20r='6'%20fill='%23ffa5bf'%20stroke-width='0'/%3e%3cpath%20d='m7.96%201.07a6.93%206.93%200%200%200-6.89%206.93%206.93%206.93%200%200%200%206.93%206.93%206.93%206.93%200%200%200%206.93-6.93%206.93%206.93%200%200%200-6.93-6.93%206.93%206.93%200%200%200-0.0371%200zm-0.244%201.94%200.00391%200.00586c0.00188%200.00188%200.0847%200.303%200.186%200.67%200.101%200.366%200.186%200.668%200.189%200.67%200.00188%200.00284%200.0377-2.72e-4%200.082-0.00781%200.392-0.0697%200.847-0.0893%201.11-0.0488%200.633%200.0979%201.02%200.413%201.21%200.998%200.185%200.557%200.0921%201.02-0.283%201.41l-0.0684%200.0723h0.111c0.78%200%201.27%200.37%201.47%201.12%200.122%200.443%200.127%200.856%200.0137%201.2-0.0386%200.119-0.129%200.295-0.205%200.402-0.137%200.193-0.392%200.418-0.656%200.576-0.261%200.156-0.711%200.356-1.02%200.455-0.0282%200.0094-0.0548%200.0196-0.0586%200.0234-0.00376%200.0028%200.067%200.272%200.156%200.598%200.0904%200.327%200.174%200.633%200.187%200.68l0.0234%200.0859-0.402%200.109c-0.22%200.0603-0.405%200.109-0.41%200.109-0.00565%200-0.0918-0.299-0.191-0.666-0.101-0.367-0.183-0.669-0.184-0.67-9.58e-4%20-0.0019-0.136%200.0328-0.299%200.0762-0.163%200.0433-0.31%200.0822-0.326%200.0859-0.0169%200.0028-0.0312%200.012-0.0312%200.0176%200%200.0104%200.015%200.064%200.244%200.896%200.0669%200.244%200.121%200.443%200.119%200.445-9.58e-4%209.58e-4%20-0.185%200.0522-0.408%200.113l-0.404%200.111-0.00977-0.0293c-0.00565-0.016-0.0594-0.209-0.121-0.43-0.184-0.671-0.246-0.895-0.25-0.9-0.00284-0.0019-0.373%200.0977-0.826%200.221-0.453%200.123-0.824%200.224-0.826%200.223-0.00284-0.0028-0.105-0.98-0.105-1.01%200-0.016%200.00573-0.0226%200.0293-0.0273%200.0706-0.0132%200.527-0.136%200.592-0.16%200.0951-0.0358%200.17-0.109%200.191-0.184%200.0264-0.0894%200.0211-0.146-0.0391-0.367-0.0311-0.112-0.132-0.474-0.223-0.805-0.0913-0.331-0.225-0.816-0.297-1.08-0.0716-0.262-0.182-0.663-0.246-0.891-0.0631-0.228-0.132-0.484-0.154-0.57-0.0235-0.0857-0.0542-0.173-0.0684-0.197-0.0414-0.0725-0.105-0.13-0.18-0.166-0.0631-0.032-0.0782-0.0362-0.16-0.0391-0.126-0.00565-0.22%200.015-0.691%200.152-0.0763%200.0217-0.113%200.029-0.115%200.0215-0.00659-0.0188-0.232-0.849-0.234-0.857%200-0.00376%200.0827-0.0313%200.184-0.0586%200.101-0.0282%200.468-0.13%200.818-0.227%200.349-0.096%200.639-0.178%200.643-0.18%200.00376-0.00284-0.0765-0.304-0.178-0.67-0.101-0.365-0.18-0.67-0.178-0.674%200.00188-0.00565%200.0254-0.0149%200.0527-0.0215%200.0282-0.00753%200.208-0.0587%200.402-0.111%200.194-0.0537%200.355-0.0956%200.355-0.0938%209.58e-4%209.42e-4%200.083%200.295%200.182%200.654%200.0998%200.36%200.182%200.656%200.184%200.658%200.00188%200.00188%200.13-0.0329%200.285-0.0781%200.154-0.0452%200.298-0.0862%200.322-0.0938%200.033-0.00942%200.041-0.0161%200.0391-0.0293-0.00188-0.0104-0.081-0.301-0.176-0.648-0.0951-0.346-0.174-0.635-0.174-0.641%200-0.00847%200.809-0.235%200.816-0.229zm0.404%202.43c-0.214%200.00565-0.377%200.0308-0.641%200.0977-0.161%200.0395-0.572%200.159-0.58%200.168-0.00376%200.00376%200.117%200.456%200.404%201.5%200.0226%200.0819%200.0442%200.139%200.0508%200.139%200.00565%200%200.0846-0.0194%200.174-0.043%200.619-0.162%200.957-0.303%201.22-0.51%200.0913-0.0716%200.15-0.135%200.211-0.227%200.0565-0.0857%200.0826-0.153%200.102-0.262%200.0179-0.106%200.00619-0.221-0.0371-0.348-0.096-0.287-0.291-0.446-0.621-0.502-0.0772-0.0122-0.133-0.0145-0.281-0.00977l-0.00195-0.00391zm0.963%202.4c-0.239%200.00911-0.522%200.0561-0.854%200.141-0.213%200.0546-0.654%200.185-0.654%200.195%200%200.00376%200.109%200.408%200.244%200.898%200.135%200.49%200.246%200.892%200.246%200.895%200%200.00942%200.0198%200.0059%200.219-0.0469%200.874-0.229%201.35-0.443%201.63-0.74%200.0876-0.0923%200.123-0.142%200.168-0.238%200.0508-0.106%200.0655-0.174%200.0645-0.297%200-0.199-0.0736-0.394-0.201-0.529-0.187-0.199-0.465-0.292-0.861-0.277h-0.00195z'%20fill='%234c7e7c'/%3e%3c/g%3e%3c/svg%3e",Wt="https://libauth.org/schemas/wallet-template-v0.schema.json",St=`Wrapped BCH 
 https://gitlab.com/dagurval/wrapped-cash`,Ht="Wrapped",Et={covenant:{description:"Wrapped BCH (WBCH) represents an equal amount of Bitcoin Cash (BCH), transforming it into a CashToken format on the Bitcoin Cash blockchain. This enables BCH to be used as a CashToken in smart contracts and decentralized applications on the Bitcoin Cash blockchain.",name:"Wrapped BCH Vault",scripts:["unlock"]},wallet:{description:"",name:"Unnamed Entity",scripts:["wallet_unlock","wallet_lock"],variables:{key:{description:"The private key that controls this wallet.",name:"Key",type:"HdKey"}}}},xt={inline:{description:"",name:"Swap thread",transaction:{inputs:[{unlockingBytecode:["slot"]}],outputs:[{lockingBytecode:{script:"lock"}}],version:2},sourceOutputs:[{lockingBytecode:["slot"]}]},swap:{description:"",name:"Swap WBCH for BCH",transaction:{inputs:[{unlockingBytecode:["slot"]},{unlockingBytecode:{script:"wallet_unlock"}}],outputs:[{lockingBytecode:{script:"lock"},valueSatoshis:2e3,token:{category:"ff4d6e4b90aa8158d39c5dc874fd9411af1ac3b5ed6f354755e8362a0d02c6b3",amount:98e3}},{lockingBytecode:{script:"wallet_lock"},valueSatoshis:1e3,token:{category:"ff4d6e4b90aa8158d39c5dc874fd9411af1ac3b5ed6f354755e8362a0d02c6b3",amount:1e3}}],locktime:0,version:2},sourceOutputs:[{lockingBytecode:["slot"],valueSatoshis:1e3,token:{category:"ff4d6e4b90aa8158d39c5dc874fd9411af1ac3b5ed6f354755e8362a0d02c6b3",amount:99e3}},{lockingBytecode:{script:"wallet_lock"},valueSatoshis:2e3}]}},Pt={unlock:{passes:["swap"],name:"Swap Wrapped BCH",script:"// empty",unlocks:"lock"},wallet_unlock:{name:"Wallet Unlock",script:"<key.schnorr_signature.all_outputs> <key.public_key>",unlocks:"wallet_lock"},lock:{lockingType:"p2sh32",name:"Wrapped BCH Covenant",script:`// pragma cashscript ^0.9.0;

// Wrap BCH as tokens
//
// Transaction form:
//      Inputs: 00-covenant
//      Outputs: 00-covenant
//
// Author: Dagur Valberg Johannsson <dagurval@pvv.ntnu.no>
// License: MIT

// contract WrapBCH() {

//     function wrapOrUnwrap() {
//         // Enforce that this contract lives on
           OP_INPUTINDEX OP_OUTPUTBYTECODE OP_INPUTINDEX OP_UTXOBYTECODE OP_EQUALVERIFY 
//         require(tx.outputs[this.activeInputIndex].lockingBytecode
//              == tx.inputs[this.activeInputIndex].lockingBytecode);

           // The token category must not change.
           OP_INPUTINDEX OP_OUTPUTTOKENCATEGORY OP_INPUTINDEX OP_UTXOTOKENCATEGORY OP_EQUALVERIFY 
//         require(tx.outputs[this.activeInputIndex].tokenCategory
//              == tx.inputs[this.activeInputIndex].tokenCategory);

           // The sum of tokens and sats in must equal the sum of tokens and sats out.
           OP_INPUTINDEX OP_UTXOTOKENAMOUNT OP_INPUTINDEX OP_UTXOVALUE OP_ADD 
           OP_INPUTINDEX OP_OUTPUTTOKENAMOUNT OP_INPUTINDEX OP_OUTPUTVALUE OP_ADD OP_NUMEQUAL
//         require(tx.inputs[this.activeInputIndex].tokenAmount + tx.inputs[this.activeInputIndex].value
//             == tx.outputs[this.activeInputIndex].tokenAmount + tx.outputs[this.activeInputIndex].value);
//     }
// }
`},wallet_lock:{lockingType:"standard",name:"Wallet Lock",script:"OP_DUP OP_HASH160 <$(<key.public_key> OP_HASH160)> OP_EQUALVERIFY OP_CHECKSIG"}},Ut=["BCH_2023_05"],Nt={$schema:Wt,description:St,name:Ht,entities:Et,scenarios:xt,scripts:Pt,supported:Ut},At="@unspent/wrap",Dt={name:At},i0=S("ff4d6e4b90aa8158d39c5dc874fd9411af1ac3b5ed6f354755e8362a0d02c6b3"),Lt=S("bb61cd7a6c8a3a3742d965dc7ac73c1117382a5c8930b68338deb881f75c0214");class o0{static USER_AGENT=Dt.name;static tokenAware=!0;static template=Nt;static compiler=gt(this.template);static vm=Bt();static getLockingBytecode(t={}){const e=this.compiler.generateBytecode({data:t,scriptId:"lock"});if(!e.success)throw new Error("Failed to generate bytecode, script: , "+JSON.stringify(e,null,"  "));return e.bytecode}static getScriptHash(t=!0){return C0(this.getLockingBytecode(),t)}static getAddress(t="bitcoincash"){return vt(this.getLockingBytecode(),t,this.tokenAware)}static getSourceOutput(t){return{lockingBytecode:this.getLockingBytecode(),valueSatoshis:BigInt(t.value),token:{category:S(t.token_data.category),amount:BigInt(t.token_data?.amount)}}}static getInput(t){return{outpointIndex:t.tx_pos,outpointTransactionHash:S(t.tx_hash),sequenceNumber:0,unlockingBytecode:{compiler:this.compiler,script:"unlock"}}}static getOutput(t,e){return{lockingBytecode:{compiler:this.compiler,script:"lock"},valueSatoshis:BigInt(t.value)+e,token:{category:S(t.token_data.category),amount:BigInt(t.token_data?.amount)-BigInt(e)}}}static getWalletSourceOutput(t,e){return{lockingBytecode:e?pt({addressIndex:0,hdPrivateKey:e}):Uint8Array.from(Array(33)),valueSatoshis:BigInt(t.value),token:t.token_data?{category:S(t.token_data.category),amount:BigInt(t.token_data?.amount)}:void 0}}static getWalletInput(t,e,o=0){let n=e?{compiler:this.compiler,data:{hdKeys:{addressIndex:o,hdPrivateKeys:{wallet:e}}},script:"wallet_unlock",valueSatoshis:BigInt(t.value)}:Uint8Array.from(Array());return t.token_data&&(n.token={amount:BigInt(t.token_data.amount),category:S(t.token_data.category)}),{outpointIndex:t.tx_pos,outpointTransactionHash:S(t.tx_hash),sequenceNumber:0,unlockingBytecode:n}}static getWrappedOutput(t,e,o=0,n=i0){return{lockingBytecode:e?{compiler:this.compiler,data:{hdKeys:{addressIndex:o,hdPublicKeys:{wallet:w0(e).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:800n,token:{category:n,amount:t}}}static getChangeOutput(t,e,o=0){return{lockingBytecode:e?{compiler:this.compiler,data:{hdKeys:{addressIndex:o,hdPublicKeys:{wallet:w0(e).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:t}}static getSourceOutputs(t,e,o){const n=[];return n.push(this.getSourceOutput(t)),n.push(...e.map(i=>this.getWalletSourceOutput(i,o))),n}static getVaultLayers(t,e,o,n=[]){let i=[],m=[];if(t=t.filter(h=>h.token_data?.category==z(o)),e<0&&(t=t.filter(h=>h.value>800)),t.length==0)throw Error("no vault utxos left, maximum recursion depth reached.");const d=Math.floor(Math.random()*t.length),p=t[d];if(t.splice(d,1),i.push(this.getInput(p)),n.push(this.getSourceOutput(p)),e<0&&-p?.value<e||e>0&&BigInt(p?.token_data?.amount)>e)m.push(this.getOutput(p,BigInt(e)));else{e<0&&e<-(p?.value-800)&&(m.push(this.getOutput(p,-BigInt(p?.value-800))),e+=p?.value-800);let h=this.getVaultLayers([...t],e,o,[...n]);i.push(...h.inputs),m.push(...h.outputs),n=h.sourceOutputs}return{inputs:i,outputs:m,sourceOutputs:n}}static getWalletLayers(t,e,o,n,i=[]){let m=[],d=[];if(e>0&&(t=t.filter(l=>!l.token_data)),e<0&&(t=t.filter(l=>l.token_data?.category==z(n))),t.length==0)throw Error("no wallet utxos left, maximum recursion depth reached.");const p=Math.floor(Math.random()*t.length),h=t[p];t.splice(p,1),m.push(this.getWalletInput(h,o)),i.push(this.getWalletSourceOutput(h,o));let r=n0(i),T=R(i,z(n));if(e<0&&T>=-e||e>0&&r>e){e>0&&d.push(this.getWrappedOutput(e,o,0,n)),e<0&&d.push(this.getWrappedOutput(T+e,o,0,n));let l=r-(e+800n);d.push(this.getChangeOutput(l,o))}else{let l=this.getWalletLayers([...t],e,o,n,[...i]);m.push(...l.inputs),d.push(...l.outputs),i=l.sourceOutputs}return{inputs:m,outputs:d,sourceOutputs:i}}static swap(t,e,o,n,i,m=1){const d=[],p=[];let h=i?S(i):i0,r={locktime:0,version:2,inputs:d,outputs:p};o=o.filter(P=>P.token_data?.category==i||!P.token_data);let T=this.getVaultLayers([...e],t,h);r.inputs.push(...T.inputs),r.outputs.push(...T.outputs);let l=T.sourceOutputs,E=this.getWalletLayers([...o],BigInt(t),n,h);r.inputs.push(...E.inputs),r.outputs.push(...E.outputs),l.push(...E.sourceOutputs);let C=B0(r);if(!C.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(C.errors,null,"  "));const G=kt(C.transaction,m),A=r.outputs.length-1;if(r.outputs[A].valueSatoshis=r.outputs[A].valueSatoshis-G,C=B0(r),!C.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(C.errors,null,"  "));const w=C.transaction,M=yt(w,l,{maximumTokenCommitmentLength:40});if(M!==!0&&m>0)throw M;let g=this.vm.verify({sourceOutputs:l,transaction:w});if(typeof g=="string")throw Error(g);let q=n0(l)-n0(w.outputs);q>5e3&&(g=`Excessive fees ${q}`),R(l,i)==0n&&(g="Error checking token input");let x=R(l,i)-R(w.outputs,i);if(x!==0n)throw Error(`Swapping should not create destroy tokens, token difference: ${x}`);return{sourceOutputs:l,transaction:w,verify:g}}}var $t=b('<h1>About Wrapped BCH</h1> <p>Wrapped Bitcoin Cash (WBCH) are fungible CashTokens redeemable 1:1 for Bitcoin Cash.</p> <p><a href="https://wrapped.cash" rel="nofollow">Wrapped BCH (WBCH)</a> was created by Dagur Valberg Johannsson in <a href="https://bitcoincashresearch.org/t/wbch-bch-wrapped-as-cash-token/1196" rel="nofollow">November 2023</a>.</p> <p>All 21M WBCH minted were sent to an immutable vault contract as 21 outputs, each with 1M WBCH.</p> <p>The Wrapped BCH contract enforces three conditions:</p> <ol><li>The token id MUST not change.</li> <li>An output being spent from the contract MUST return to the contract.</li> <li>The sum of tokens and sats <em>in</em> MUST equal the sum of tokens and satoshis <em>out</em>.</li></ol> <p>These three rules ensure that when tokens are spent from the contract, each must swap an equal amount of Bitcoin Cash in a corresponding output.</p> <p>Notice how WBCH token category (id) isn‚Äôt in the contract rules? That‚Äôs right. The contract will enforce a 1:1 peg with any token, not just ‚Äúofficial‚Äù WBCH tokens.</p> <p>Anyone may send any fungible token to the contract, but that doesn‚Äôt make it WBCH. So there is one more <strong>important</strong> condition needed to make the Wrapped BCH fair.  Dagur minted a fungible token with 21M tokens (8 decimals) and sent the entire supply to the vault contract.</p> <p>To <strong>verify</strong> that WBCH is fair, we can lookup the pre-genesis transaction:</p> <p><a href="https://explorer.salemkode.com/tx/ff4d6e4b90aa8158d39c5dc874fd9411af1ac3b5ed6f354755e8362a0d02c6b3" rel="nofollow">WBCH pre-genesis transactoin</a></p> <p>‚Ä¶ the first output was the coin used to mint all WBCH tokens.</p> <p>The minting transaction was in the next transaction:</p> <p><a href="https://explorer.salemkode.com/tx/110dc94c0aa1a4c60ff4738eeee7f931d8f11086190281f43cf3330419d918c8" rel="nofollow">WBCH minting transaction</a></p> <p>The minting transaction created one wrapped satoshi for every bitcoin (cash) satoshi.</p> <p>Given the total minted supply of 21 WBCH sats, we do NOT need to do forensic blockchain analysis or prove a chain of custody of each token from genesis to the WBCH vault, we can just check that the total balance of WBCH on the vault is equal to the total supply of the fungible token, minus BCH locked on WBCH outputs.</p>',1);function zt(N){var t=$t();Q0(30),_(N,t)}var Mt=b('<meta name="description" content="Wrap (or unwrap) Bitcoin Cash as a CashToken."/>'),jt=b("<img/>"),Vt=b('<img alt="Disconnected"/>'),qt=(N,t)=>t(),Xt=b('<input class="slider svelte-1jzmt15" type="range" step="1000"/>'),Kt=b('<p><a href="/wallet">Deposit funds</a> to wrap coins.</p>'),Rt=(N,t,e)=>t(s(e)),Gt=b('<div class="swap svelte-1jzmt15"><div class="svelte-1jzmt15"><!></div></div> <div class="swap svelte-1jzmt15"><button class="svelte-1jzmt15">Broadcast Transaction</button></div>',1),Yt=b('<div class="swap svelte-1jzmt15"><div class="svelte-1jzmt15"><img width="50"/> <br/> </div> <div class="svelte-1jzmt15"><img width="50"/> <br/> </div></div> <div class="swap svelte-1jzmt15"><!></div> <!> ',1),Ft=b('<div class="swap svelte-1jzmt15"><p>Not connected?</p></div>'),Jt=b('<section><div class="status svelte-1jzmt15"><!> <!></div> <h1>Wrap Bitcoin Cash as a CashToken</h1> <!> <!></section>');function ge(N,t){Z0(t,!0);let e=f(""),o=f(""),n=f(void 0),i=f(!1),m=f(void 0),d=f(k0([])),p=f(k0([])),h="",r=f(void 0),T,l=f(""),E=f(""),C=f(0n),G=f(0),A=f(0n),w=f(0);c(l,o0.getScriptHash(),!0);let M="";const g=it.url.hostname=="vox.cash",q=g?It:Ot,x=g?z(i0):z(Lt),P=g?"BCH":"tBCH",X=g?"WBCH":"tWBCH",O0=g?"bch.imaginary.cash":"chipnet.bch.ninja",I0=g?rt:ct;let r0=new Set,H=f(0),j,Y=f("");const W0=()=>{clearTimeout(T),T=setTimeout(()=>{c0(),l0()},1500)},S0=function(a){a.method==="blockchain.scripthash.subscribe"?a.params[1]!==M&&(M=a.params[1],c(e,_0[s(r).status],!0),c(H,0),W0()):console.log(a)},c0=async function(){let a=await s(r).request("blockchain.scripthash.listunspent",s(E),"include_tokens");if(a instanceof Error)throw a;let u=new Set(a.map(k=>`${k.tx_hash}":"${k.tx_pos}`));(s(p).length==0||r0.intersection(u).size==0)&&c(p,a,!0),c(w,b0(s(p),!0),!0),c(A,T0(s(p),x),!0)},l0=async function(){let a=await s(r).request("blockchain.scripthash.listunspent",s(l),"include_tokens");if(a instanceof Error)throw a;let u=new Set(a.map(k=>`${k.tx_hash}":"${k.tx_pos}`));(s(d).length==0||r0.intersection(u).size==0)&&c(d,a,!0),c(d,s(d).filter(k=>k.token_data&&k.token_data.category==x),!0),c(G,b0(s(d),!0),!0),c(C,T0(s(d),x),!0)},H0=async function(a){let u=await s(r).request("blockchain.transaction.broadcast",a);if(u instanceof Error)throw c(e,_0[s(r).status],!0),u},E0=function(){try{let a=o0.swap(s(H),s(d),s(p),h,x);c(n,a.transaction,!0),c(m,a.sourceOutputs,!0),c(o,z(wt(s(n))),!0),c(i,a.verify===!0,!0),a.verify===!0&&c(Y,"")}catch(a){c(n,void 0),c(m,void 0),c(o,""),c(i,!1),c(Y,a,!0)}};F0(async()=>{dt.StorageProvider=ut,j=g?await ht.named("vox"):await ft.named("vox"),h=mt(j.mnemonic,j.derivationPath.slice(0,-2),j.isTestnet);let a=_t(j.getDepositAddress());if(typeof a=="string")throw a;c(E,C0(a.bytecode),!0),c(r,new lt("unspent/wrap","1.4.1",O0),!0),await s(r).connect(),s(r).on("notification",S0),await s(r).subscribe("blockchain.scripthash.subscribe",s(l)),await s(r).subscribe("blockchain.scripthash.subscribe",s(E)),l0(),c0()}),J0(async()=>{await s(r).disconnect()});var F=Jt();st(a=>{var u=Mt();et.title="üéÅ Wrapped BCH",_(a,u)});var J=O(F),p0=O(J);bt(p0,{get template(){return o0.template}});var x0=B(p0,2);{var P0=a=>{var u=jt();L(()=>{W(u,"src",Tt),W(u,"alt",s(e))}),_(a,u)},U0=a=>{var u=Vt();L(()=>W(u,"src",Ct)),_(a,u)};$(x0,a=>{s(e)=="CONNECTED"?a(P0):a(U0,!1)})}I(J);var u0=B(J,4);{var N0=a=>{var u=Yt(),k=y0(u),Q=O(k),Z=O(Q),L0=B(Z,3);I(Q);var d0=B(Q,2),t0=O(d0),$0=B(t0,3);I(d0),I(k);var e0=B(k,2),z0=O(e0);{var M0=y=>{var v=Xt();nt(v),v.__change=[qt,E0],L(U=>{W(v,"min",U),W(v,"max",s(w)-2e3)},[()=>Number(-s(A))]),ot(v,()=>s(H),U=>c(H,U)),_(y,v)},j0=y=>{var v=Kt();_(y,v)};$(z0,y=>{s(w)>0?y(M0):y(j0,!1)})}I(e0);var h0=B(e0,2);{var V0=y=>{var v=Gt(),U=y0(v),f0=O(U),X0=O(f0);{var K0=D=>{var K=v0();L(a0=>V(K,`place ${a0??""} ${P} for ${X}`),[()=>(s(H)/1e8).toLocaleString()]),_(D,K)},R0=(D,K)=>{{var a0=s0=>{var g0=v0();L(Y0=>V(g0,`redeem ${Y0??""} ${X} for ${P}`),[()=>(-s(H)/1e8).toLocaleString()]),_(s0,g0)};$(D,s0=>{s(H)<0&&s0(a0)},K)}};$(X0,D=>{s(H)>0?D(K0):D(R0,!1)})}I(f0),I(U);var m0=B(U,2),G0=O(m0);G0.__click=[Rt,H0,o],I(m0),_(y,v)};$(h0,y=>{s(n)&&s(i)&&y(V0)})}var q0=B(h0);L((y,v)=>{W(Z,"src",I0),W(Z,"alt",P),V(L0,` ${y??""}
				${P}`),W(t0,"src",q),W(t0,"alt",X),V($0,` ${v??""}
				${X}`),V(q0,` ${s(Y)??""}`)},[()=>(s(w)/1e8).toLocaleString(void 0,{maximumSignificantDigits:5}),()=>(Number(s(A))/1e8).toLocaleString(void 0,{maximumSignificantDigits:5})]),_(a,u)},A0=a=>{var u=Ft();_(a,u)};$(u0,a=>{s(e)=="CONNECTED"?a(N0):a(A0,!1)})}var D0=B(u0,2);zt(D0),I(F),_(N,F),tt()}at(["change","click"]);export{ge as component,me as universal};
//# sourceMappingURL=18.CIWhkNcz.js.map
