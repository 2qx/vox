import{f as O,a as k,c as it,t as Se}from"../chunks/DIGK3fbx.js";import"../chunks/D2hU0Bvh.js";import{o as rt,a as ct}from"../chunks/gevkG0Tn.js";import{p as $e,s as u,f as pe,t as C,a as qe,K as q,c as g,r as h,a0 as lt,D as e,C as r,n as _}from"../chunks/D9HGzNEp.js";import{s as T,d as ut}from"../chunks/DLwNFu-O.js";import{i as N}from"../chunks/CKOgfgCC.js";import{e as dt,i as ht}from"../chunks/Clu73D2-.js";import{s as S}from"../chunks/8RjDFi4k.js";import{i as Me,p as Ie}from"../chunks/BWlPubY6.js";import{r as pt}from"../chunks/B3x9nJtb.js";import{b as gt}from"../chunks/C4jED5RM.js";import{$ as Ae,a as Ne}from"../chunks/CQVT_UhJ.js";import{I as mt,T as vt,W as ft,B as kt}from"../chunks/BgdkrN9n.js";import{i as U,j as _t,k as bt,l as Ke,m as yt,o as Ce,p as Ue,q as Re,r as wt,v as Bt,s as Le,a as he,t as Z,B as Pt,x as Tt,y as Ot,z as He,A as De,C as xt,D as Et}from"../chunks/RtVsbt6w.js";import{h as St,g as It}from"../chunks/xicP5GGN.js";import{T as At}from"../chunks/BCRPpk-w.js";const Nt=!0,ya=Object.freeze(Object.defineProperty({__proto__:null,prerender:Nt},Symbol.toStringTag,{value:"Module"})),Ct="data:image/svg+xml,%3csvg%20style='height:400px;width:400px'%20version='1.1'%20viewBox='0%200%2016%2016'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='a'%20gradientTransform='rotate(75)'%3e%3cstop%20stop-color='%23f00'%20offset='.05'/%3e%3cstop%20stop-color='%2300808099'%20offset='.95'/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20d='m6%201c-2.77%200-5%202.23-5%205v4c0%202.77%202.23%205%205%205h4c2.77%200%205-2.23%205-5v-4c0-2.77-2.23-5-5-5h-4zm2%206a1%201%200%200%201%201%201%201%201%200%200%201-1%201%201%201%200%200%201-1-1%201%201%200%200%201%201-1z'%20fill='url(%23a)'/%3e%3c/svg%3e",Ut="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%20style='width:400px;%20height:400px;'%3e%3cdefs%3e%3clinearGradient%20id='grad'%20gradientTransform='rotate(75)'%3e%3cstop%20offset='5%25'%20stop-color='aqua'%20/%3e%3cstop%20offset='95%25'%20stop-color='%2300808099'%20/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20style='fill:url(%23grad)'%20d='M%206%201%20C%203.23%201%201%203.23%201%206%20L%201%2010%20C%201%2012.77%203.23%2015%206%2015%20L%2010%2015%20C%2012.77%2015%2015%2012.77%2015%2010%20L%2015%206%20C%2015%203.23%2012.77%201%2010%201%20L%206%201%20z%20M%208%207%20A%201%201%200%200%201%209%208%20A%201%201%200%200%201%208%209%20A%201%201%200%200%201%207%208%20A%201%201%200%200%201%208%207%20z%20'%20/%3e%3c/svg%3e",Rt="https://libauth.org/schemas/wallet-template-v0.schema.json",Lt="BlockPoints: A coin age reward token",Ht="BlockPoints",Dt={covenant:{description:"Emit tokens as reward to holders.",name:"BlockPoint Vault",scripts:["lock","unlock"],variables:{age:{description:"The input age (as a number of blocks) claimed to withdraw tokens. The maximum age that can be used to claim tokens is the lessor of covenant thread age or user coins age being used to release tokens.",name:"Age",type:"WalletData"}}},wallet:{scripts:["wallet_unlock","wallet_lock"],variables:{key:{description:"The private key that controls this wallet.",name:"Key",type:"HdKey"}}}},zt={base:{data:{bytecode:{age:"10"}},description:"",name:"Base Scenario",transaction:{inputs:[{outpointTransactionHash:"0e09765ada34fa0bd94ef9df8497173e8aefc560f3eb7c9e0e88b345c4cccb36",outpointIndex:0,unlockingBytecode:["slot"],sequenceNumber:1}]}},release:{name:"Release Tokens",description:"",extends:"base",data:{bytecode:{age:"10"}},transaction:{inputs:[{unlockingBytecode:["slot"],sequenceNumber:10}],outputs:[{lockingBytecode:{script:"lock"},valueSatoshis:800}],locktime:11,version:2},sourceOutputs:[{lockingBytecode:["slot"],valueSatoshis:800}]}},$t={unlock:{passes:["release"],name:"Unlock Tokens",script:"<age> // ",unlocks:"lock"},lock:{lockingType:"p2sh32",name:"BlockPoint Covenant",script:`// Force a block based relative timelock
   <500000000> OP_OVER OP_GREATERTHANOREQUAL OP_VERIFY
// require(500000000 >= age);
        
// Ensure the first input exceeds the age claimed
   OP_0 OP_INPUTSEQUENCENUMBER OP_OVER OP_GREATERTHANOREQUAL OP_VERIFY
// require(tx.inputs[0].sequenceNumber >= age);
        
// Require the token vault thread to exceed the age claimed
   OP_DUP OP_CHECKSEQUENCEVERIFY OP_DROP
// require(this.age >= age);

// Allow anyone to withdraw a token amount proportional to the value of their aged utxo.
// Note: to convert block satoshis to coindays: 144 * 100_000_000 
// 
   OP_INPUTINDEX OP_OUTPUTTOKENAMOUNT 
   OP_INPUTINDEX OP_UTXOTOKENAMOUNT 
   OP_ROT OP_0 OP_UTXOVALUE OP_MUL <100000000> OP_DIV OP_SUB OP_GREATERTHANOREQUAL OP_VERIFY
//  require(
//      tx.outputs[this.activeInputIndex].tokenAmount >= 
//      tx.inputs[this.activeInputIndex].tokenAmount - 
//      (age * tx.inputs[0].value/100000000)
//  );

// This thread must be in the last input position
// to prevent users building transactions with multiple airdrop threads. 
//
   OP_INPUTINDEX OP_1ADD OP_TXINPUTCOUNT OP_NUMEQUAL
// require(this.activeInputIndex+1 == tx.inputs.length);
`},wallet_unlock:{name:"Wallet Unlock",script:"<key.schnorr_signature.all_outputs> <key.public_key>",unlocks:"wallet_lock"},wallet_lock:{lockingType:"standard",name:"Wallet Lock",script:"OP_DUP OP_HASH160 <$(<key.public_key> OP_HASH160)> OP_EQUALVERIFY OP_CHECKSIG"}},qt=["BCH_2023_05","BCH_SPEC"],Mt=0,Kt={$schema:Rt,description:Lt,name:Ht,entities:Dt,scenarios:zt,scripts:$t,supported:qt,version:Mt},Vt="@unspent/blockpoint",Wt={name:Vt},ee=U("7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"),Ft=U("ffc9d3b3488e890ef113b1c74f40e1f5eb1147a7d4191cecac89fd515721a271");class Y{static USER_AGENT=Wt.name;static tokenAware=!0;static template=Kt;static compiler=_t(this.template);static vm=bt();static getLockingBytecode(a={}){const s=this.compiler.generateBytecode({data:a,scriptId:"lock"});if(!s.success)throw new Error("Failed to generate bytecode, script: , "+JSON.stringify(s,null,"  "));return s.bytecode}static getScriptHash(a=!0){return Ke(this.getLockingBytecode(),a)}static getAddress(a="bitcoincash"){return yt(this.getLockingBytecode(),a,this.tokenAware)}static getSourceOutput(a){return{lockingBytecode:this.getLockingBytecode(),valueSatoshis:BigInt(a.value),token:{category:U(a.token_data.category),amount:BigInt(a.token_data?.amount)}}}static getInput(a,s){return{outpointIndex:a.tx_pos,outpointTransactionHash:U(a.tx_hash),sequenceNumber:s,unlockingBytecode:{data:{bytecode:{age:Ce(BigInt(s))}},compiler:this.compiler,script:"unlock",valueSatoshis:BigInt(a.value)}}}static getOutput(a,s,n){return{lockingBytecode:{data:{bytecode:{age:Ce(BigInt(n))}},compiler:this.compiler,script:"lock"},valueSatoshis:BigInt(a.value),token:{category:U(a.token_data.category),amount:BigInt(a.token_data?.amount)-BigInt(s)}}}static getWalletSourceOutput(a,s){return{lockingBytecode:s?St({addressIndex:0,hdPrivateKey:s}):Uint8Array.from(Array(33)),valueSatoshis:BigInt(a.value),token:a.token_data?{category:U(a.token_data.category),amount:BigInt(a.token_data?.amount)}:void 0}}static getWalletInput(a,s,n,c=0){const m=n?{compiler:this.compiler,data:{hdKeys:{addressIndex:c,hdPrivateKeys:{wallet:n}}},script:"wallet_unlock",valueSatoshis:BigInt(a.value)}:Uint8Array.from(Array());return{outpointIndex:a.tx_pos,outpointTransactionHash:U(a.tx_hash),sequenceNumber:s,unlockingBytecode:m}}static getTokenOutput(a,s,n=0,c=ee){return{lockingBytecode:s?{compiler:this.compiler,data:{hdKeys:{addressIndex:n,hdPublicKeys:{wallet:Ue(s).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:800n,token:{category:c,amount:BigInt(a)}}}static getChangeOutput(a,s,n=0){return{lockingBytecode:s?{compiler:this.compiler,data:{hdKeys:{addressIndex:n,hdPublicKeys:{wallet:Ue(s).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:BigInt(a.value)-800n}}static getSourceOutputs(a,s,n){const c=[];return c.push(this.getWalletSourceOutput(s,n)),c.push(this.getSourceOutput(a)),c}static claim(a,s,n,c,m,b=1){const K=[],V=[];let l=m?U(m):ee;const y=n.height>s.height?n.height:s.height,I=a-y,v=Math.floor(I*n.value/1e8);let f={locktime:0,version:2,inputs:K,outputs:V};f.inputs.push(this.getWalletInput(n,I,c)),f.outputs.push(this.getTokenOutput(v,c,0,l)),f.inputs.push(this.getInput(s,I)),f.outputs.push(this.getOutput(s,v,I)),f.outputs.push(this.getChangeOutput(n,c,0));let P=Re(f);if(!P.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(P.errors,null,"  "));const J=wt(P.transaction,b);if(f.outputs[2].valueSatoshis=f.outputs[2].valueSatoshis-J,P=Re(f),!P.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(P.errors,null,"  "));const x=this.getSourceOutputs(s,n,c),w=P.transaction,H=Bt(w,x);if(H!==!0&&b>0)throw H;let B=this.vm.verify({sourceOutputs:x,transaction:w}),W=Le(x)-Le(w.outputs);W>5e3&&(B=`Excessive fees ${W}`),he(x,m)==0n&&(B="Error checking token input");let F=he(x,m)-he(w.outputs,m);return F!==0n&&(B=`Swapping should not create destroy tokens, token difference: ${F}`),{sourceOutputs:x,transaction:w,verify:B}}}var Gt=O('<h3>About Block Points</h3> <p>Block Points (BPT) are a reward token distributed based on the value and age of coins users have already hold.</p> <p>The CashToken category id for Block Points is:</p> <p><a href="https://explorer.salemkode.com/token/7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c" rel="nofollow"> </a></p> <p>All 9.2 quintillion Block Points were <a href="https://explorer.salemkode.com/tx/2420c5803f7318160bd4ed6729eecb8385688b79fa5653b8c64a1a8167b5e79f" rel="nofollow">minted in this transaction</a>. The entire circulating supply was then sent to the Block Point vault contract in <a href="https://explorer.salemkode.com/address/bitcoincash:r0ak899wsk9mr9wz78tw2pnppumzry6ypejfvsad6u4vrj4kdewpwsmza35av" rel="nofollow">this transaction</a>.</p> <p>The Block Point vault can only release tokens based on the age of the vault thread or coin being used (whichever utxo is younger). The vault can release tokens at a rate of one Block Point (1 BPT) per coin per block. Users with that don’t have a whole coin can claim rewards at the same rate as user with many blocks.</p> <p>Anytime coins are moved, the age of the coin resets. So don’t move coins to claim Block Points, wait until you can sign with the wallet you have.</p>',1);function jt(M,a){$e(a,!1),Me();var s=Gt(),n=u(pe(s),6),c=g(n),m=g(c,!0);h(c),h(n),lt(6),C(b=>T(m,b),[()=>Z(ee)],q),k(M,s),qe()}var ze=pt(()=>kt),Qt=O("<img/>"),Xt=O('<img alt="Disconnected"/>'),Yt=(M,a)=>a(),Jt=O('<div class="swap svelte-bx5kz"><div class="svelte-bx5kz"><!></div></div>'),Zt=O('<button class="action svelte-bx5kz"><img width="100" alt="bptLogo"/><br/> </button>'),ea=O('<button class="action svelte-bx5kz" disabled><img width="100" alt="bptLogo"/><br/> </button>'),ta=O('<div class="row svelte-bx5kz"><!></div>'),aa=O('<h4>Wallet Unspent Transaction Outputs (coins)</h4> <div class="grid svelte-bx5kz"></div>',1),sa=O("<p>No confirmed coins to claim Block Points</p>"),oa=O('<section><div class="status svelte-bx5kz"><!> <!></div> <h1>Claim Block Point Rewards</h1> <div class="swap svelte-bx5kz"><div class="svelte-bx5kz"><img width="50"/> <br/> <b> </b></div> <div class="svelte-bx5kz"><img width="50"/> <br/> <b> </b></div></div> <div class="swap svelte-bx5kz"><button class="svelte-bx5kz">Claim All Rewards</button></div> <!> <!> <!> <!></section>');function wa(M,a){$e(a,!1);let s=_(0),n=_(""),c="",m="",b=_(void 0),K=_(!1),V=_(void 0),l=_([]),y=_([]),I=_(""),v,f="",P="",J=_(0n),x=_(0);f=Y.getScriptHash();const w=Ie.url.hostname=="vox.cash";let H=w?Ut:Ct,B=w?Z(ee):Z(Ft),W=w?"BCH":"tBCH",F=w?"BPT":"tBPT",ge=w?"bch.imaginary.cash":"chipnet.bch.ninja",me=new Set,G=_(0),j,te=_("");const Ve=function(t){if(t.method==="blockchain.headers.subscribe"){let o=t.params[0];r(s,o.height)}else t.method==="blockchain.scripthash.subscribe"?t.params[1]!==c&&(c=t.params[1],r(n,Ae[v.status]),r(G,0),fe(),ve()):console.log(t)},ve=async function(){let t=await v.request("blockchain.scripthash.listunspent",P,"include_tokens");if(t instanceof Error)throw t;let o=new Set(t.map(i=>`${i.tx_hash}":"${i.tx_pos}`));(e(y).length==0||me.intersection(o).size==0)&&r(y,t),r(x,He(e(y),!0)),r(J,De(e(y),B)),r(y,e(y).filter(i=>i.height>0))},fe=async function(){let t=await v.request("blockchain.scripthash.listunspent",f,"include_tokens");if(t instanceof Error)throw t;let o=new Set(t.map(i=>`${i.tx_hash}":"${i.tx_pos}`));(e(l).length==0||me.intersection(o).size==0)&&r(l,t),r(l,e(l).filter(i=>i.height>0)),r(l,e(l).filter(i=>i.token_data&&i.token_data.category==B)),e(l).sort((i,R)=>i.height-R.height),He(e(l),!0),De(e(l),B)},We=async function(t){let o=await v.request("blockchain.transaction.broadcast",t);if(o instanceof Error)throw r(n,Ae[v.status]),o},Fe=function(){e(y).map((t,o)=>{ke(e(s),e(l)[o],t,e(I),B)})},ke=function(t,o,i,R,d){try{let p=Y.claim(t,o,i,R,d);r(b,p.transaction),r(V,p.sourceOutputs),m=Z(Tt(e(b))),We(m),r(K,p.verify===!0),p.verify===!0&&r(te,"")}catch(p){r(b,void 0),r(V,void 0),m="",r(K,!1),r(te,p)}};rt(async()=>{const t=Ie.url.hostname!=="vox.cash";ze(ze().StorageProvider=mt),j=t?await vt.named("vox"):await ft.named("vox"),r(I,It(j.mnemonic,j.derivationPath.slice(0,-2),j.isTestnet));let o=Ot(j.getDepositAddress());if(typeof o=="string")throw o;P=Ke(o.bytecode),v=new Ne(Y.USER_AGENT,"1.4.1",ge),await v.connect(),v.on("notification",Ve),await v.subscribe("blockchain.scripthash.subscribe",f),await v.subscribe("blockchain.headers.subscribe"),fe(),ve()}),ct(async()=>{await new Ne(Y.USER_AGENT,"1.4.1",ge).disconnect()}),Me();var ae=oa(),se=g(ae),_e=g(se);{var Ge=t=>{var o=Qt();C(()=>{S(o,"src",xt),S(o,"alt",e(n))}),k(t,o)},je=t=>{var o=Xt();C(()=>S(o,"src",Et)),k(t,o)};N(_e,t=>{e(n)=="CONNECTED"?t(Ge):t(je,!1)})}var Qe=u(_e,2);Pt(Qe,{get template(){return Y.template}}),h(se);var oe=u(se,4),ne=g(oe),ie=g(ne),be=u(ie,3),ye=u(be),Xe=g(ye,!0);h(ye),h(ne);var we=u(ne,2),re=g(we),Be=u(re,3),Pe=u(Be),Ye=g(Pe,!0);h(Pe),h(we),h(oe);var ce=u(oe,2),Je=g(ce);Je.__click=[Yt,Fe],h(ce);var Te=u(ce,2);{var Ze=t=>{var o=Jt(),i=g(o),R=g(i);{var d=E=>{var D=Se();C(Q=>T(D,`place: ${Q??""} sats`),[()=>e(G).toLocaleString()],q),k(E,D)},p=(E,D)=>{{var Q=L=>{var z=Se();C(le=>T(z,`redeem: ${le??""} wrapped sats`),[()=>(-e(G)).toLocaleString()],q),k(L,z)};N(E,L=>{e(G)<0&&L(Q)},D)}};N(R,E=>{e(G)>0?E(d):E(p,!1)})}h(i),h(o),k(t,o)};N(Te,t=>{e(b)&&e(K)&&t(Ze)})}var Oe=u(Te,2);{var et=t=>{At(t,{get transaction(){return e(b)},get sourceOutputs(){return e(V)},get category(){return B}})};N(Oe,t=>{e(b)&&t(et)})}var xe=u(Oe),Ee=u(xe);{var tt=t=>{var o=aa(),i=u(pe(o),2);dt(i,5,()=>e(y),ht,(R,d,p)=>{var E=it(),D=pe(E);{var Q=L=>{var z=ta(),le=g(z);{var ot=$=>{var A=Zt();A.__click=()=>ke(e(s),e(l)[p],e(d),e(I),B);var X=g(A),ue=u(X,2);h(A),C(de=>{S(X,"src",H),T(ue,` Claim ${de??""} BPT`)},[()=>e(d).height>e(l)[p].height?Math.floor((e(s)-e(d).height)*e(d).value/1e8):Math.floor((e(s)-e(l)[p].height)*e(d).value/1e8)],q),k($,A)},nt=$=>{var A=ea(),X=g(A),ue=u(X,2);h(A),C(de=>{S(X,"src",H),T(ue,` ${de??""} BPT`)},[()=>e(d).height>e(l)[p].height?((e(s)-e(d).height)*e(d).value/1e8).toLocaleString(void 0,{minimumFractionDigits:3}):((e(s)-e(l)[p].height)*e(d).value/1e8).toLocaleString(void 0,{minimumFractionDigits:3})],q),k($,A)};N(le,$=>{Math.floor((e(s)-e(d).height)*e(d).value/1e8)>=1?$(ot):$(nt,!1)})}h(z),k(L,z)};N(D,L=>{!e(d).token_data&&e(l)[p]&&L(Q)})}k(R,E)}),h(i),k(t,o)},at=t=>{var o=sa();k(t,o)};N(Ee,t=>{e(y).filter(o=>!o.token_data).filter(o=>o.height>0).length>0?t(tt):t(at,!1)})}var st=u(Ee,2);jt(st,{}),h(ae),C((t,o)=>{S(ie,"src",gt),S(ie,"alt",W),T(be,` ${t??""} `),T(Xe,W),S(re,"src",H),S(re,"alt",F),T(Be,` ${o??""} `),T(Ye,F),T(xe,` ${e(te)??""} `)},[()=>e(x).toLocaleString(),()=>e(J).toLocaleString()],q),k(M,ae),qe()}ut(["click"]);export{wa as component,ya as universal};
//# sourceMappingURL=4.OJ3RFws_.js.map
