{"version":3,"file":"7.eVz0lVut.js","sources":["../../../../../../src/routes/db/+page.ts","../../../../../../src/lib/SmallRecord.svelte","../../../../../../src/routes/db/+page.svelte"],"sourcesContent":["import type { PageLoad } from './$types';\n\nexport const prerender = true;\n\nexport const load: PageLoad = ({ params,url }) => {\n    return {\n        key: url.searchParams.get('key')\n    };\n};","<script lang=\"ts\">\n\timport TokenIcon from './TokenIcon.svelte';\n\timport { disassembleBytecodeBch, hexToBin } from '@bitauth/libauth';\n\n\tlet { tx_pos, tx_hash, height, value, token_data, now = $bindable() } = $props();\n</script>\n\n<div class=\"container\">\n\t<div class=\"post\">\n\t\t<div class=\"balance\">\n\t\t\t<div>\n\t\t\t\t{#if token_data}\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<TokenIcon size={24} category={token_data.category}></TokenIcon>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t\t<div class=\"fill\">\n\t\t\t\t{#if token_data.nft.commitment}\n\t\t\t\t\t<pre> {disassembleBytecodeBch(hexToBin(token_data.nft.commitment))}</pre>\n\t\t\t\t{:else}\n\t\t\t\t\t<pre> undefined</pre>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t{#if height > 0}\n\t\t\t\t\t{height + value - now}\n\t\t\t\t{:else}\n\t\t\t\t\t{height}\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"header\">\n\t\t\t<div class=\"fill\"></div>\n\t\t\t<div class=\"timestamp\">{Number(value).toLocaleString(undefined, {})}</div>\n\t\t</div>\n\t</div>\n</div>\n\n<style>\n\t.container {\n\t\tdisplay: flex;\n\t\tpadding: 5px;\n\t}\n\t.post {\n\t\tborder-radius: 10px;\n\t\tpadding: 2px;\n\t\tbackground-color: #eeeeee;\n\t\tmargin: auto;\n\t\twidth: 100%;\n\t\tborder: #bbb solid;\n\t\tborder-width: 1px;\n\t}\n\n\t.header {\n\t\tdisplay: flex;\n\t}\n\t.balance {\n\t\tdisplay: flex;\n\t}\n\tpre {\n\t\tmargin: 2px;\n\t}\n\t.hash {\n\t\tfont-size: xx-small;\n\t\tfont-weight: 200;\n\t\talign-content: flex-start;\n\t\tcolor: #857070;\n\t\tmax-width: 70%;\n\t\tword-break: break-all;\n\t}\n\t.fill {\n\t\tflex: 1;\n\t\tword-break: break-all;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\t.fill pre {\n\t\twhite-space: pre-line;\n\t}\n\t.fill div {\n\t\tpadding: 5px;\n\t}\n\t.fill div p {\n\t\ttext-align: right;\n\t}\n\t.timestamp {\n\t\tfont-size: xx-small;\n\t\tfont-weight: 200;\n\t\tcolor: #777;\n\t\tword-break: break-all;\n\t}\n\t.auth {\n\t\talign-content: center;\n\t\tpadding: 5px 5px 5px 5px;\n\t}\n\t.auth img {\n\t\tborder-radius: 50%;\n\t}\n\n\t.post :global {\n\t\tp {\n\t\t\tfont-weight: 400;\n\t\t\tline-height: 1;\n\t\t}\n\t}\n\n\t.post.op {\n\t\tbackground-color: #fff;\n\t}\n\n\t.error {\n\t\tcolor: brown;\n\t}\n</style>\n","<script lang=\"ts\">\n\timport { onMount, onDestroy } from 'svelte';\n\timport { goto } from '$app/navigation';\n\timport { page } from '$app/state';\n\timport type { PageProps } from './$types';\n\n\timport Readme from './README.md';\n\n\timport BitauthLink from '$lib/BitauthLink.svelte';\n\timport CONNECTED from '$lib/images/connected.svg';\n\timport DISCONNECTED from '$lib/images/disconnected.svg';\n\n\timport TokenIcon from '$lib/TokenIcon.svelte';\n\timport TokenNftData from '$lib/TokenNftData.svelte';\n\n\timport SmallIndex from '@unspent/small';\n\n\timport { ElectrumClient, ConnectionStatus } from '@electrum-cash/network';\n\timport { BaseWallet, Wallet, TestNetWallet, NFTCapability, TokenMintRequest } from 'mainnet-js';\n\n\timport { IndexedDBProvider } from '@mainnet-cash/indexeddb-storage';\n\n\timport { binToHex, cashAddressToLockingBytecode, encodeTransactionBch } from '@bitauth/libauth';\n\n\timport { getScriptHash, getHdPrivateKey, type UtxoI } from '@unspent/tau';\n\n\timport SmallRecord from '$lib/SmallRecord.svelte';\n\n\tlet now: number = $state(0);\n\tlet privatekey = $state('');\n\n\tlet { data }: PageProps = $props();\n\tlet key = $state(data.key ? data.key : '');\n\tconsole.log(key)\n\tlet connectionStatus = $state('');\n\tlet electrumClient: any;\n\tlet walletScriptHash = $state('');\n\tlet wallet: any = $state();\n\tlet transactionError = $state('');\n\n\tlet unspent: UtxoI[] = $state([]);\n\tlet batons: any[] = $state([]);\n\tlet selected: UtxoI | undefined = $state();\n\n\tconst isMainnet = page.url.hostname == 'vox.cash';\n\tconst prefix = isMainnet ? 'bitcoincash' : 'bchtest';\n\tconst server = isMainnet ? 'bch.imaginary.cash' : 'chipnet.bch.ninja';\n\n\tasync function updateUnspent() {\n\t\tgoto(`?key=${key}`, { keepFocus: true });\n\t\tif (electrumClient && now > 1000) {\n\t\t\tunspent = await electrumClient.request(\n\t\t\t\t'blockchain.scripthash.listunspent',\n\t\t\t\tSmallIndex.getScriptHash(key),\n\t\t\t\t'include_tokens'\n\t\t\t);\n\t\t}\n\t}\n\n\tconst clear = async function () {\n\t\t// mint 2 NFTs, amount reducing\n\n\t\tunspent = unspent.filter((u: any) => u.height + u.value < now);\n\t\tconsole.log(key);\n\t\tlet tx = SmallIndex.drop(key, unspent);\n\t\tlet transaction_hex = binToHex(encodeTransactionBch(tx.transaction));\n\t\tawait broadcast(transaction_hex);\n\t};\n\n\tconst handleNotifications = function (data: any) {\n\t\tconnectionStatus = ConnectionStatus[electrumClient.status];\n\t\tif (data.method === 'blockchain.headers.subscribe') {\n\t\t\tlet d = data.params[0];\n\t\t\tnow = d.height;\n\t\t\tupdateUnspent();\n\t\t\tupdateWallet();\n\t\t} else if (data.method === 'blockchain.scripthash.subscribe') {\n\t\t\t// if (data.params[1] !== contractState) {\n\t\t\t// \tcontractState = data.params[1];\n\t\t\t// \tamount = 0n;\n\t\t\t// \tdebounceUpdateWallet();\n\t\t\t// }\n\t\t} else {\n\t\t\tconsole.log(data);\n\t\t}\n\t};\n\n\tconst updateWallet = async function () {\n\t\tlet response = await electrumClient.request(\n\t\t\t'blockchain.scripthash.listunspent',\n\t\t\twalletScriptHash,\n\t\t\t'include_tokens'\n\t\t);\n\t\tif (response instanceof Error) throw response;\n\n\t\tbatons = response.filter(\n\t\t\t(u: UtxoI) =>\n\t\t\t\tu.token_data && u.token_data.nft && u.token_data.nft.capability == NFTCapability.minting\n\t\t);\n\t};\n\n\tconst broadcast = async function (raw_tx: string) {\n\t\tlet response = await electrumClient.request('blockchain.transaction.broadcast', raw_tx);\n\t\tif (response instanceof Error) {\n\t\t\tconnectionStatus = ConnectionStatus[electrumClient.status];\n\t\t\ttransactionError = response.message;\n\t\t\tthrow response;\n\t\t}\n\t\ttransactionError = response;\n\t\tresponse as any[];\n\t};\n\n\tonMount(async () => {\n\t\tBaseWallet.StorageProvider = IndexedDBProvider;\n\t\twallet = isMainnet ? await Wallet.named(`vox`) : await TestNetWallet.named(`vox`);\n\n\t\tprivatekey = getHdPrivateKey(\n\t\t\twallet.mnemonic!,\n\t\t\twallet.derivationPath.slice(0, -2),\n\t\t\twallet.isTestnet\n\t\t);\n\t\tlet lockcodeResult = cashAddressToLockingBytecode(wallet.getDepositAddress());\n\t\tif (typeof lockcodeResult == 'string') throw lockcodeResult;\n\t\twalletScriptHash = getScriptHash(lockcodeResult.bytecode);\n\n\t\t// Initialize an electrum client.\n\t\telectrumClient = new ElectrumClient(SmallIndex.USER_AGENT, '1.4.1', server);\n\n\t\t// Wait for the client to connect.\n\t\tawait electrumClient.connect();\n\t\t// Set up a callback function to handle new blocks.\n\n\t\t// Listen for notifications.\n\t\telectrumClient.on('notification', handleNotifications);\n\n\t\t// Set up a subscription for new block headers.\n\t\tawait electrumClient.subscribe('blockchain.headers.subscribe');\n\t});\n</script>\n\n<section>\n\t<div class=\"status\">\n\t\t<BitauthLink template={SmallIndex.template} />\n\t\t{#if connectionStatus == 'CONNECTED'}\n\t\t\t<img src={CONNECTED} alt={connectionStatus} />\n\t\t{:else}\n\t\t\t<img src={DISCONNECTED} alt=\"Disconnected\" />\n\t\t{/if}\n\t</div>\n\n\t<label for=\"key\">Key:</label>\n\t<input\n\t\tid=\"key\"\n\t\tbind:value={key}\n\t\tonchange={() => updateUnspent()}\n\t\tplaceholder=\"enter the index key\"\n\t/>\n\n\t<br />\n\t<br />\n\t{#if unspent.length > 0}\n\t\t{#each unspent as record}\n\t\t\t<SmallRecord {...record} {now} />\n\t\t{/each}\n\t{:else}\n\t\tNo Records\n\t{/if}\n\t<br />\n\t<br />\n\t<button onclick={() => clear()}>Clear Expired</button>\n\t{transactionError}\n\t<Readme />\n</section>\n\n<style>\n\t.status {\n\t\ttext-align: end;\n\t}\n\n\tbutton {\n\t\tbackground-color: #a45eb6; /* Green */\n\t\tborder: none;\n\t\tcolor: white;\n\t\tpadding: 10px;\n\t\tborder-radius: 20px;\n\t\ttext-align: center;\n\t\ttext-decoration: none;\n\t\tdisplay: inline-block;\n\t\tfont-size: 16px;\n\t}\n</style>\n"],"names":["prerender","load","params","url","disassembleBytecodeBch","hexToBin","$$props","$$render","consequent_1","alternate","consequent_2","alternate_1","updateUnspent","clear","now","privatekey","key","$.state","$.proxy","$.get","connectionStatus","electrumClient","walletScriptHash","wallet","transactionError","unspent","batons","isMainnet","page","server","goto","$.set","SmallIndex","u","tx","transaction_hex","binToHex","encodeTransactionBch","broadcast","handleNotifications","data","ConnectionStatus","d","updateWallet","response","NFTCapability","raw_tx","onMount","BaseWallet","IndexedDBProvider","Wallet","TestNetWallet","getHdPrivateKey","lockcodeResult","cashAddressToLockingBytecode","getScriptHash","ElectrumClient","CONNECTED","DISCONNECTED","consequent","$.each","node_3","record","$.bind_value","input","$$value"],"mappings":"wlCAEO,MAAMA,GAAY,GAEZC,GAAiB,CAAC,CAAE,OAAAC,EAAO,IAAAC,MAC7B,CACH,IAAKA,EAAI,aAAa,IAAI,KAAK,CACnC,siCCMmB,sCAAyB,wIAMpC,IAAAC,GAAuBC,GAAoBC,EAAA,WAAA,IAAI,UAAU,CAAA,6CADjDA,EAAA,WAAA,IAAI,WAAUC,EAAAC,CAAA,EAAAD,EAAAE,EAAA,EAAA,2JAOhB,EAACF,EAAAG,CAAA,EAAAH,EAAAI,EAAA,EAAA,sFASQ,OAAML,EAAA,KAAA,EAAQ,eAAe,OAAS,CAAA,CAAA,8ECwH/CM,EAAa,YAePC,EAAK,6QA7IxB,IAAAC,IAAqB,CAAC,EACtBC,IAAoB,EAAE,EAGtBC,EAAkBC,EAAAC,EAAAZ,EAAA,KAAA,IAAWA,EAAA,KAAA,IAAM,EAAE,CAAA,EACzC,QAAQ,IAAGa,EAACH,CAAG,CAAA,EACX,IAAAI,IAA0B,EAAE,EAC5BC,EACAC,IAA0B,EAAE,EAC5BC,EAAWN,EAAA,MAAA,EACXO,IAA0B,EAAE,EAE5BC,EAAgBR,EAAAC,EAAA,CAAA,CAAA,CAAA,EAChBQ,EAAaT,EAAAC,EAAA,CAAA,CAAA,CAAA,EAGX,MAAAS,EAAYC,GAAK,IAAI,UAAY,WAEjCC,EAASF,EAAY,qBAAuB,oBAEnC,eAAAf,GAAgB,CAC9BkB,GAAa,QAAAX,EAAAH,CAAG,CAAM,GAAA,CAAA,UAAW,GAAI,EACjCK,GAAkBF,EAAAL,CAAG,EAAG,KAC3BiB,EAAAN,EAAgB,MAAAJ,EAAe,QAC9B,oCACAW,EAAW,cAAcb,EAAAH,CAAG,GAC5B,gBAAe,EAAA,EAAA,CAGlB,CAEM,MAAAH,EAA0B,gBAAA,CAG/BkB,EAAAN,EAAUN,EAAAM,CAAO,EAAC,OAAQQ,GAAWA,EAAE,OAASA,EAAE,QAAQnB,CAAG,CAAA,EAAA,EAAA,EAC7D,QAAQ,IAAGK,EAACH,CAAG,CAAA,EACX,IAAAkB,EAAKF,EAAW,KAAKb,EAAAH,CAAG,IAAES,CAAO,CAAA,EACjCU,EAAkBC,GAASC,GAAqBH,EAAG,WAAW,CAAA,EAC5D,MAAAI,EAAUH,CAAe,CAC/B,EAEKI,EAAmB,SAAaC,EAAW,CAE5C,GADJT,EAAAX,EAAmBqB,EAAiBpB,EAAe,MAAM,EAAA,EAAA,EACrDmB,EAAK,SAAW,+BAAgC,CAC/C,IAAAE,EAAIF,EAAK,OAAO,CAAC,IACrB1B,EAAM4B,EAAE,OAAM,EAAA,EACd9B,EAAa,EACb+B,EAAY,CACZ,MAAUH,EAAK,SAAW,mCAO1B,QAAQ,IAAIA,CAAI,CAEjB,EAEKG,EAAiC,gBAAA,KAClCC,EAAQ,MAASvB,EAAe,QACnC,oCAAmCF,EACnCG,CAAgB,EAChB,gBAAe,KAEZsB,aAAoB,MAAK,MAAQA,IAErClB,EAASkB,EAAS,OAChBX,GACAA,EAAE,YAAcA,EAAE,WAAW,KAAOA,EAAE,WAAW,IAAI,YAAcY,GAAc,OAAA,EAAA,EAAA,CAEnF,EAEKP,EAAS,eAAmBQ,EAAgB,CAC7C,IAAAF,QAAiBvB,EAAe,QAAQ,mCAAoCyB,CAAM,KAClFF,aAAoB,MACvBb,MAAAA,EAAAX,EAAmBqB,EAAiBpB,EAAe,MAAM,EAAA,EAAA,IACzDG,EAAmBoB,EAAS,QAAO,EAAA,EAC7BA,EAEPb,EAAAP,EAAmBoB,EAAQ,EAAA,CAE3B,EAEDG,GAAoB,SAAA,CACnBC,GAAW,gBAAkBC,KAC7B1B,EAASI,EAAkB,MAAAuB,GAAO,MAAK,KAAA,EAAA,MAAgBC,GAAc,MAAK,KAAA,EAAA,EAAA,EAE1EpB,EAAAhB,EAAaqC,GAAejC,EAC3BI,CAAM,EAAC,WACPA,CAAM,EAAC,eAAe,MAAM,IAAK,EAAAJ,EACjCI,CAAM,EAAC,SAAA,EAAA,EAAA,EAEJ,IAAA8B,EAAiBC,GAA6BnC,EAAAI,CAAM,EAAC,kBAAiB,CAAA,YAC/D8B,GAAkB,SAAQ,MAAQA,EAC7CtB,EAAAT,EAAmBiC,GAAcF,EAAe,QAAQ,EAAA,EAAA,EAGxDhC,EAAc,IAAOmC,GAAexB,EAAW,WAAY,QAASH,CAAM,EAGpE,MAAAR,EAAe,QAAO,EAI5BA,EAAe,GAAG,eAAgBkB,CAAmB,QAG/ClB,EAAe,UAAU,8BAA8B,EAC7D,gDAKuB,OAAAW,EAAW,gEAEvByB,EAAS,cAAOrC,CAAgB,CAAA,6CAEhCsC,EAAY,CAAA,kBAHlBvC,EAAAC,CAAgB,GAAI,YAAWb,EAAAoD,CAAA,EAAApD,EAAAE,EAAA,EAAA,yFAkB7BmD,GAAAC,EAAA,GAAA,IAAA1C,EAAAM,CAAO,QAAIqC,KAAM,eACNA,EAAM,EAAA,mFAFpBrC,CAAO,EAAC,OAAS,EAAClB,EAAAC,CAAA,EAAAD,EAAAI,EAAA,EAAA,+EAUtBa,CAAgB,GAAA,EAAA,GAAA,CAAA,EAjBJuC,GAAAC,EAAA,IAAA7C,EAAAH,CAAG,OAAHA,EAAGiD,CAAA,CAAA"}