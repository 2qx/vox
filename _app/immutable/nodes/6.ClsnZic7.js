import{f as h,a as m,t as Xe}from"../chunks/DTc5U4eY.js";import{o as U0,a as N0}from"../chunks/_R59KZhj.js";import{e as a0,P as C0,aM as R0,aN as D0,p as ht,aA as be,f as se,s as c,c as d,r,I as a,t as W,a as yt,af as L0,aB as T,ao as pe,ak as b,ay as M0}from"../chunks/CQU5mOuk.js";import{l as F0,s as E,d as H0,h as V0}from"../chunks/CF3aPdyL.js";import{i as R}from"../chunks/CZ0rTjPC.js";import{e as _e,i as me}from"../chunks/CbL2L94E.js";import{r as Me,s as oe}from"../chunks/-rOGAMhN.js";import{a as ft,b as pt}from"../chunks/Oj09dCTU.js";import{s as bt}from"../chunks/DBDCTY7c.js";import{g as W0}from"../chunks/CrfBm3bt.js";import{p as K0}from"../chunks/B0rm-kda.js";import{a as Y0}from"../chunks/Bp5dD34W.js";import{q as re,D as j,g as Q0,h as I,d as n0,e as z0,b as Ie,J as Vt,K as Wt,t as Kt,B as Yt,H as Qt,L as zt,f as Je,C as Gt,v as Xt,p as _t,j as G0,n as mt,s as Jt,k as jt}from"../chunks/BQUio51k.js";/* empty css                */import{c as X0}from"../chunks/q36Eg1F8.js";import{s as J0}from"../chunks/CXfu__Ha.js";import{B as o0,t as s0}from"../chunks/B2Xzehbr.js";import{i as j0,l as Z0}from"../chunks/Bt3MikUi.js";/* empty css                */import{T as Qe}from"../chunks/otdWaXgM.js";import{h as $0,I as ea,B as ta,W as aa,T as na,g as oa,b as sa,N as Zt}from"../chunks/BTBIn4-B.js";import{B as ra,t as ia}from"../chunks/B-JAlK32.js";import"../chunks/CuzQ0eOn.js";import{c as ca}from"../chunks/DGwzT_kg.js";import{S as je}from"../chunks/zv45hi4S.js";import{B as la}from"../chunks/BzLj6JBc.js";import{C as da}from"../chunks/B7hCbxZp.js";import{D as ua}from"../chunks/DMvn4Q5j.js";import{$ as va,a as $t}from"../chunks/BDt1pbpk.js";function r0(p,e,t){if(p.multiple){if(e==null)return;if(!C0(e))return R0();for(var n of p.options)n.selected=e.includes(ze(n));return}for(n of p.options){var o=ze(n);if(D0(o,e)){n.selected=!0;return}}(!t||e!==void 0)&&(p.selectedIndex=-1)}function fa(p,e){a0(()=>{var t=new MutationObserver(()=>{var n=p.__value;r0(p,n)});return t.observe(p,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function pa(p,e,t=e){var n=!0;F0(p,"change",o=>{var s=o?"[selected]":":checked",f;if(p.multiple)f=[].map.call(p.querySelectorAll(s),ze);else{var l=p.querySelector(s)??p.querySelector("option:not([disabled])");f=l&&ze(l)}t(f)}),a0(()=>{var o=e();if(r0(p,o,n),n&&o===void 0){var s=p.querySelector(":checked");s!==null&&(o=ze(s),t(o))}p.__value=o,n=!1}),fa(p)}function ze(p){return"__value"in p?p.__value:p.value}var ba=h("<i> </i>"),_a=h("<i>0</i>"),ma=h('<tr class="svelte-1oaaxak"><td class="r sats svelte-1oaaxak"> </td><td class="r sats svelte-1oaaxak"><!></td></tr>'),ga=h("<i> </i>"),ha=h("<i>0</i>"),ya=h('<tr class="svelte-1oaaxak"><td class="r sats svelte-1oaaxak"> </td><td class="r sats svelte-1oaaxak"><!></td></tr>'),ka=h(' <br/> <div class="twoUp svelte-1oaaxak"><div class="svelte-1oaaxak"><h4>Inputs</h4> <table class="svelte-1oaaxak"><thead class="r svelte-1oaaxak"><tr class="svelte-1oaaxak"><td class="svelte-1oaaxak">Sats</td><td class="svelte-1oaaxak">Tokens</td></tr></thead><tbody class="svelte-1oaaxak"></tbody><tfoot class="svelte-1oaaxak"><tr><td class="r svelte-1oaaxak"> </td><td class="r svelte-1oaaxak"><i> </i></td></tr></tfoot></table></div> <div class="svelte-1oaaxak"><h4>Outputs</h4> <table class="svelte-1oaaxak"><thead class="r svelte-1oaaxak"><tr class="svelte-1oaaxak"><td class="svelte-1oaaxak">Sats</td><td class="svelte-1oaaxak">Tokens</td></tr></thead><tbody class="svelte-1oaaxak"></tbody><tfoot class="svelte-1oaaxak"><tr><td class="r svelte-1oaaxak"> </td><td class="r svelte-1oaaxak"><i> </i></td></tr></tfoot></table></div></div> <h4>Difference</h4> <table class="svelte-1oaaxak"><thead class="r svelte-1oaaxak"><tr class="svelte-1oaaxak"><td class="svelte-1oaaxak">Sats</td><td class="svelte-1oaaxak">Tokens</td></tr></thead><tfoot class="svelte-1oaaxak"><tr><td class="r svelte-1oaaxak"> </td><td class="r svelte-1oaaxak"><i> </i></td></tr></tfoot></table>',1);function Oa(p,e){ht(e,!0),be();var t=ka(),n=se(t),o=c(n,2),s=c(o),f=d(s),l=c(d(f),2),u=c(d(l));_e(u,21,()=>e.sourceOutputs,me,(ge,ee)=>{var N=ma(),C=d(N),xe=d(C,!0);r(C);var te=c(C),Pe=d(te);{var Fe=M=>{var z=ba(),He=d(z,!0);r(z),W(Te=>E(He,Te),[()=>a(ee).token.amount.toLocaleString()]),m(M,z)},qe=M=>{var z=_a();m(M,z)};R(Pe,M=>{a(ee).token?M(Fe):M(qe,!1)})}r(te),r(N),W(M=>E(xe,M),[()=>a(ee).valueSatoshis.toLocaleString()]),m(ge,N)}),r(u);var k=c(u),x=d(k),_=d(x),O=d(_,!0);r(_);var g=c(_),S=d(g),H=d(S,!0);r(S),r(g),r(x),r(k),r(l),r(f);var q=c(f,2),K=c(d(q),2),A=c(d(K));_e(A,21,()=>e.transaction.outputs,me,(ge,ee)=>{var N=ya(),C=d(N),xe=d(C,!0);r(C);var te=c(C),Pe=d(te);{var Fe=M=>{var z=ga(),He=d(z,!0);r(z),W(Te=>E(He,Te),[()=>a(ee).token.amount.toLocaleString()]),m(M,z)},qe=M=>{var z=ha();m(M,z)};R(Pe,M=>{a(ee).token?M(Fe):M(qe,!1)})}r(te),r(N),W(M=>E(xe,M),[()=>a(ee).valueSatoshis.toLocaleString()]),m(ge,N)}),r(A);var D=c(A),Q=d(D),L=d(Q),ie=d(L,!0);r(L);var ce=c(L),ue=d(ce),Ee=d(ue,!0);r(ue),r(ce),r(Q),r(D),r(K),r(q),r(s);var ye=c(s,4),ke=c(d(ye)),Oe=d(ke),ve=d(Oe),$=d(ve);r(ve);var Be=c(ve),Ge=d(Be),Ze=d(Ge);r(Ge),r(Be),r(Oe),r(ke),r(ye),W((ge,ee,N,C,xe,te)=>{E(n,`Locktime: ${e.transaction.locktime??""}`),E(o,` Version: ${e.transaction.version??""} `),E(O,ge),E(H,ee),E(ie,N),E(Ee,C),E($,`Fee:
				${xe??""}`),E(Ze,`Burned:
					${te??""}`)},[()=>re(e.sourceOutputs).toLocaleString(),()=>j(e.sourceOutputs,e.category).toLocaleString(),()=>re(e.transaction.outputs).toLocaleString(),()=>j(e.transaction.outputs,e.category).toLocaleString(),()=>(re(e.sourceOutputs)-re(e.transaction.outputs)).toLocaleString(),()=>(j(e.sourceOutputs,e.category)-j(e.transaction.outputs,e.category)).toLocaleString()]),m(p,t),yt()}const Ba=!0,xa=({params:p,url:e})=>({asset:e.searchParams.get("asset")}),Xn=Object.freeze(Object.defineProperty({__proto__:null,load:xa,prerender:Ba},Symbol.toStringTag,{value:"Module"}));var Pa=h('<div class="auth svelte-2vt4ng"><!></div> <div class="price svelte-2vt4ng"> </div> <div class="quantity svelte-2vt4ng"> <!></div>',1),Ta=h('<div><div class="post svelte-2vt4ng"><div class="balance svelte-2vt4ng"><div class="order svelte-2vt4ng"><!></div></div></div></div>');function gt(p,e){ht(e,!0);let t=L0(()=>e.quantity>0);e.isMainnet?o0:s0;var n=Ta(),o=d(n),s=d(o),f=d(s),l=d(f);{var u=k=>{var x=Pa(),_=se(x),O=d(_);Qe(O,{size:20,get category(){return e.orderUtxo.token_data.category}}),r(_);var g=c(_,2),S=d(g,!0);r(g);var H=c(g,2),q=d(H),K=c(q);Qe(K,{size:20,get category(){return e.assetCategory},get isMainnet(){return e.isMainnet}}),r(H),W((A,D)=>{E(S,A),E(q,`${D??""} `)},[()=>Number(e.price).toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:6}),()=>Number(e.quantity).toLocaleString(void 0,{}).padStart(12)]),m(k,x)};R(l,k=>{e.orderUtxo&&k(u)})}r(f),r(s),r(o),r(n),W(()=>J0(n,1,X0(["container",{bid:a(t)}]),"svelte-2vt4ng")),m(p,n),yt()}var Sa=h('<h3>About CatDex</h3> <p>Category Decentralized Exchange is a protocol to exchange assets using orders stored on non-fungible token commitments.</p> <p>More information about <a href="https://bitcoincashresearch.org/t/catdex-a-token-category-authorized-decentralized-exchange/1480" rel="nofollow">the contract.</a></p>',1);function wa(p){var e=Sa();be(4),m(p,e)}const Ia="https://libauth.org/schemas/wallet-template-v0.schema.json",Ea="CatDex: a bi-directional limit order CashToken exchange.",qa="CatDex",Aa={covenant:{description:`A CatDex blackboard contract holds limit orders and token treads for trading. 


Anyone may spend a mutable order NFT to trade some or all of the quantity specified from any output held by the exchange.  


Features:


  - Bidirectional limit order exchange.
  - ZERO commission trades*.
  - Partial order fulfillment.
  - Cash bids for assets not held.
  - Allows total liquidation of token assets.
  - Minting NFT holder may easily withdraw, cancel, or rebalance orders.
  - Many orders may be written in a single transaction. 
  - All orders are discoverable via electrumX/smallIndex
  - *Transactions must pay standard fees to miners.


Order Commitments:


  Orders are listed on mutable NFT commitments like so
   
     byte16(LE)<quantity>   number of tokens remaining in order
     byte16(LE)<price>      price in token units per coin


  - Buy orders are positive (+)
  - Sell orders are negative (-)
  - Price MUST be expressed in raw token units per coin (100,000,000 sats)
  - CatDex has no concept of display decimal metadata 
 
Transaction Building Modes:


  Administration Mode
  
     Transactions with a minting NFT may withdraw all outputs from the contract.
  
     Auth Baton    input[0] -> output[0]     - Authenticating NFT (minting)
                   input[i] -> output[*]     - Unrestricted spending


  Order Mode
  
    In "Order mode" outputs are submitted in pairs, with both the record for the order
    and the cash value moving on the even "foot" and the tokens trading on the odd "foot".
    
    orderThread    input[even] -> output[even]  - Order NFT of category (mutable)
    assetThread    input[odd]  -> output[odd]   - Tread for asset traded.


Note: 


  The exchange owner(s) holds the minting NFT baton(s), which authorizes spending funds from the exchange.
`,name:"CatDex Blackboard",scripts:["unlock","lock"],variables:{auth_category:{description:"The CashToken Category for orders and authentication.",name:"Authentication Token Category",type:"WalletData"},asset_category:{description:"The CashToken Category Token ID of the asset being traded",name:"Asset Token Category",type:"WalletData"}}},wallet:{description:"Standard p2pkh wallet controlling the exchange minting NFT baton",name:"Exchange Owner",scripts:["wallet_unlock","wallet_lock"],variables:{key:{description:"The private key that controls this wallet.",name:"Key",type:"HdKey"}}}},Ua=JSON.parse('{"base":{"data":{"bytecode":{"auth_category":"0xefbe00000000000000000000000000000000000000000000000000000000adde","asset_category":"0x2c06f3b2565d0818a8e41f58beff5918d5dbdc64b11ee8ad474e499751cde07f"}},"description":"","name":"Base Scenario"},"excise_sell_order_baton":{"description":"Buy using a sell order.","extends":"base","name":"Use sell order (baton tread)","transaction":{"inputs":[{"unlockingBytecode":["slot"]},{},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10400,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"0000000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":0,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":9600,"token":{"amount":20,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}}],"version":2},"sourceOutputs":[{"lockingBytecode":["slot"],"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":20}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000}]},"excise_sell_order_asset":{"description":"Test buying an asset using a sell order.","extends":"base","name":"Use sell order to buy (asset tread)","transaction":{"inputs":[{},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10400,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"0000000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":0,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":9600,"token":{"amount":20,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}}],"version":2},"sourceOutputs":[{"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":20}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000}]},"excise_sell_order_asset_two":{"description":"Test buying an asset using a sell order.","extends":"base","name":"Use sell order to buy (asset tread)","transaction":{"inputs":[{},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":200800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"0000000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":800,"token":{"amount":500,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":293779}],"version":2},"sourceOutputs":[{"valueSatoshis":800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1027000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":10000}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":494799}]},"overbuy_order_baton":{"description":"Test that overbuying a sell order should fail.","extends":"base","name":"FAIL: overbuy sell order (baton tread)","transaction":{"inputs":[{"unlockingBytecode":["slot"]},{},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"1400000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":0,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":9200,"token":{"amount":40,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}}],"version":2},"sourceOutputs":[{"lockingBytecode":["slot"],"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":40}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000}]},"overbuy_order_asset":{"description":"Test that overbuying a sell order should fail.","extends":"base","name":"FAIL: overbuy sell order (asset tread)","transaction":{"inputs":[{},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"1400000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":0,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":9200,"token":{"amount":40,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}}],"version":2},"sourceOutputs":[{"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":40}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000}]},"misexcise_sell_order_asset":{"description":"Test that selling to a sell order should fail.","extends":"base","name":"FAIL: selling into sell order (asset tread)","transaction":{"inputs":[{},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"3c00000000000000000000000000008000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":60,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10800}],"version":2},"sourceOutputs":[{"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":20}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":40}}]},"excise_buy_order_baton":{"description":"Test selling an asset using a buy order.","extends":"base","name":"Use buy order to sell tokens","transaction":{"inputs":[{"unlockingBytecode":["slot"]},{},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"0000000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":20,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10400}],"version":2},"sourceOutputs":[{"lockingBytecode":["slot"],"valueSatoshis":10400,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000000000943577000000000000000000000000","capability":"mutable"}}},{"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":0}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":20}}]},"excise_buy_order_asset":{"description":"Test selling an asset to a buy order.","extends":"base","name":"Use buy order to sell tokens","transaction":{"inputs":[{},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"0000000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":20,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10400}],"version":2},"sourceOutputs":[{"valueSatoshis":10400,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000000000943577000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":0}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":20}}]},"create":{"description":"Create an order book","name":"Create Orderbook","transaction":{"inputs":[{"unlockingBytecode":["slot"]},{},{}],"outputs":[{"lockingBytecode":"76a9141cb0e414e168062d46cc0e5799c71e3e4b3028cf88ac","token":{"category":"4ebdbcc129f3cd5759a5d3b76b908bf91f86666cd19793b1a48807fc7f11016c","amount":0,"nft":{"commitment":"0adf","capability":"minting"}},"valueSatoshis":1000},{"lockingBytecode":"aa202e84afbcdb5951e8d159969a2325f72abe0d62f686793e8283118d6e1fdd96e987","token":{"category":"4ebdbcc129f3cd5759a5d3b76b908bf91f86666cd19793b1a48807fc7f11016c","amount":0,"nft":{"commitment":"20a1070000000000000000000000008014000000000000000000000000000000","capability":"mutable"}},"valueSatoshis":800},{"lockingBytecode":"aa202e84afbcdb5951e8d159969a2325f72abe0d62f686793e8283118d6e1fdd96e987","token":{"category":"35c5f1fe73b627b70e11f8297eea49a0f074f33b201c37e7c21ff6027a84a795","amount":0},"valueSatoshis":800},{"lockingBytecode":"aa202e84afbcdb5951e8d159969a2325f72abe0d62f686793e8283118d6e1fdd96e987","token":{"category":"4ebdbcc129f3cd5759a5d3b76b908bf91f86666cd19793b1a48807fc7f11016c","amount":0,"nft":{"commitment":"a086010000000000000000000000000014000000000000000000000000000000","capability":"mutable"}},"valueSatoshis":800},{"lockingBytecode":"aa202e84afbcdb5951e8d159969a2325f72abe0d62f686793e8283118d6e1fdd96e987","token":{"category":"35c5f1fe73b627b70e11f8297eea49a0f074f33b201c37e7c21ff6027a84a795","amount":100000},"valueSatoshis":800},{"lockingBytecode":"76a9141cb0e414e168062d46cc0e5799c71e3e4b3028cf88ac","token":{"category":"35c5f1fe73b627b70e11f8297eea49a0f074f33b201c37e7c21ff6027a84a795","amount":2099999999900000},"valueSatoshis":800},{"lockingBytecode":"76a9141cb0e414e168062d46cc0e5799c71e3e4b3028cf88ac","valueSatoshis":100093052}],"version":2},"sourceOutputs":[{"lockingBytecode":["slot"],"valueSatoshis":1000,"token":{"category":"4ebdbcc129f3cd5759a5d3b76b908bf91f86666cd19793b1a48807fc7f11016c","nft":{"commitment":"0x0adf","capability":"minting"}}},{"lockingBytecode":"76a9141cb0e414e168062d46cc0e5799c71e3e4b3028cf88ac","valueSatoshis":100097016},{"lockingBytecode":"76a9141cb0e414e168062d46cc0e5799c71e3e4b3028cf88ac","valueSatoshis":1000,"token":{"category":"35c5f1fe73b627b70e11f8297eea49a0f074f33b201c37e7c21ff6027a84a795","amount":2100000000000000}}]},"withdraw":{"description":"Withdraw accumulated principal and tokens","extends":"base","name":"Withdraw","transaction":{"inputs":[{"unlockingBytecode":{"script":"wallet_unlock"}},{"unlockingBytecode":["slot"]}],"outputs":[{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"minting"}}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":100000000,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":100000000}}],"version":2},"sourceOutputs":[{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"minting"}}},{"lockingBytecode":["slot"],"valueSatoshis":100000000,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":100000000}}]},"clear":{"data":{"bytecode":{"auth_category":"0x5263006eccd92d7dadbdced311b08e08f940c9c09fe09445d5789d8bd3d6c9aa","asset_category":"0xe9556bdf407a8bb7122ea1a04c8acfeb9ab9c2cb3682288114263ad2237851c6"}},"description":"Clear an order book","name":"Clear Orderbook","transaction":{"inputs":[{"unlockingBytecode":{"script":"wallet_unlock"}},{"unlockingBytecode":{"script":"unlock"}},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"unlock"}},{"unlockingBytecode":{"script":"unlock"}},{"unlockingBytecode":{"script":"wallet_unlock"}},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"wallet_lock"},"token":{"category":"aac9d6d38b9d78d54594e09fc0c940f9088eb011d3cebdad7d2dd9cc6e006352","amount":0,"nft":{"commitment":"0x1234","capability":"minting"}},"valueSatoshis":1000},{"lockingBytecode":{"script":["copy"]},"token":{"category":"c6517823d23a261481288236cbc2b99aebcf8a4ca0a12e12b78b7a40df6b55e9","amount":2100000000000000},"valueSatoshis":800},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":100094709}]},"sourceOutputs":[{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":1000,"token":{"category":"aac9d6d38b9d78d54594e09fc0c940f9088eb011d3cebdad7d2dd9cc6e006352","amount":0,"nft":{"commitment":"1234","capability":"minting"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":10000800,"token":{"category":"aac9d6d38b9d78d54594e09fc0c940f9088eb011d3cebdad7d2dd9cc6e006352","amount":0,"nft":{"commitment":"20a1070000000000000000000000008014000000000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800},{"valueSatoshis":800,"token":{"category":"aac9d6d38b9d78d54594e09fc0c940f9088eb011d3cebdad7d2dd9cc6e006352","amount":0,"nft":{"commitment":"a086010000000000000000000000000014000000000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"category":"c6517823d23a261481288236cbc2b99aebcf8a4ca0a12e12b78b7a40df6b55e9","amount":100000}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":90093052},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":800,"token":{"category":"c6517823d23a261481288236cbc2b99aebcf8a4ca0a12e12b78b7a40df6b55e9","amount":2099999999900000}}]}}'),Na={unlock:{fails:["overbuy_order_asset","overbuy_order_baton","misexcise_sell_order_asset"],passes:["clear","excise_buy_order_baton","excise_buy_order_asset","excise_sell_order_baton","excise_sell_order_asset","excise_sell_order_asset_two","withdraw"],name:"Swap or Administer",script:"",unlocks:"lock"},wallet_unlock:{passes:["create"],name:"Wallet Unlock",script:"<key.schnorr_signature.all_outputs> <key.public_key>",unlocks:"wallet_lock"},wallet_lock:{lockingType:"standard",name:"Wallet Lock",script:"OP_DUP OP_HASH160 <$(<key.public_key> OP_HASH160)> OP_EQUALVERIFY OP_CHECKSIG"},lock:{lockingType:"p2sh32",name:"CatDex Blackboard",script:`// CatDex - A token category authorized decentralized exchange
//
// 2025-11-22 Pre-alpha, pre-audit
//
// Trade fungible tokens at fixed prices based on orders expressed in NFT commitments

<asset_category> <auth_category>

// pragma cashscript ^0.10.0;
// contract CatDex(bytes32 authCat, bytes32 assetCat){

    // function swap(){
        // If the first input has a minting baton (owner),
        //   the spending of outputs is unrestricted. 
        OP_0 OP_UTXOTOKENCATEGORY OP_OVER OP_2 OP_CAT OP_EQUAL OP_IF
        // if(tx.inputs[0].tokenCategory == authCat + 0x02){
            // pass 
        // }

        // If the order input (even input) is a mutable auth Baton ... 
        OP_ELSE    
        // else{
            // Push the index of this order baton to the stack
            OP_INPUTINDEX OP_INPUTINDEX OP_2 OP_MOD OP_SUB 
            // int orderIndex = this.activeInputIndex - (this.activeInputIndex % 2);  

            // require the order is authenticated by  a mutable baton 
            OP_DUP OP_OUTPUTTOKENCATEGORY OP_2 OP_PICK OP_1 OP_CAT OP_EQUALVERIFY
            // require(tx.outputs[orderIndex].tokenCategory ==  authCat + 0x01);

            // Require the order is auth lives on
            OP_DUP OP_UTXOTOKENCATEGORY OP_OVER OP_OUTPUTTOKENCATEGORY OP_EQUALVERIFY 
            // require(tx.inputs[orderIndex].tokenCategory == tx.outputs[orderIndex].tokenCategory);

            // Require the order baton be passed back to the contract
            OP_DUP OP_OUTPUTBYTECODE OP_OVER OP_UTXOBYTECODE OP_EQUALVERIFY 
            // require(tx.outputs[orderIndex].lockingBytecode == 
            //          tx.inputs[orderIndex].lockingBytecode);

            // Get the next index of the asset thread
            OP_DUP OP_1ADD 
            // int assetIndex = orderIndex + 1; 

            // Require the asset thread be sent at the current contract
            OP_DUP OP_OUTPUTBYTECODE OP_OVER OP_OUTPUTBYTECODE OP_EQUALVERIFY 
            // require(tx.outputs[assetIndex].lockingBytecode == 
            //         tx.outputs[assetIndex].lockingBytecode);                 
                        
            
            // if the amount of tokens is greater than zero,
            OP_DUP OP_OUTPUTTOKENAMOUNT OP_0 OP_GREATERTHAN OP_IF 
            // if(tx.outputs[assetIndex].tokenAmount > 0){
              // require the asset output contain token category specified by the order
              OP_DUP OP_OUTPUTTOKENCATEGORY OP_4 OP_PICK OP_EQUALVERIFY
            //   require(tx.outputs[assetIndex].tokenCategory == assetCat);
            // } 
            OP_ENDIF 

            // Parse the order data from the NFT commitment
            OP_OVER OP_UTXOTOKENCOMMITMENT OP_16 OP_SPLIT 
            // bytes quantityBin, bytes priceBin = 
            //               tx.inputs[orderIndex].nftCommitment.split(16);

            OP_OVER OP_BIN2NUM 
            // int orderQuantity = int(quantityBin);  

            OP_OVER OP_BIN2NUM 
            // int price = int(priceBin);

            // Get the amount of the token traded
 
            OP_4 OP_PICK OP_OUTPUTTOKENAMOUNT OP_5 OP_PICK OP_UTXOTOKENAMOUNT OP_SUB 
            // int tradeQuantity = tx.outputs[assetIndex].tokenAmount - 
            //                      tx.inputs[assetIndex].tokenAmount;

            // Verify new authCat order baton NFT commitment
            OP_2 OP_PICK OP_OVER OP_SUB OP_16 OP_NUM2BIN OP_2 OP_PICK OP_16 OP_NUM2BIN OP_CAT 
            // bytes32 nextCommitment = bytes16(orderQuantity-tradeQuantity) + bytes16(price);

            // Require updating order baton
            OP_7 OP_PICK OP_OUTPUTTOKENCOMMITMENT OP_OVER OP_EQUALVERIFY 
            // require(tx.outputs[orderIndex].nftCommitment == nextCommitment);

            // require the sign of the quantity traded matches the order sign  
            OP_OVER OP_0 OP_GREATERTHAN OP_4 OP_PICK OP_0 OP_GREATERTHAN OP_EQUALVERIFY
            // require((tradeQuantity > 0 == orderQuantity > 0)); 

            // require the amount traded be less than (or equal to) the quantity available
            OP_OVER OP_ABS OP_4 OP_PICK OP_ABS OP_LESSTHANOREQUAL OP_VERIFY 
            // require(abs(tradeQuantity) <= abs(orderQuantity));

            // Verify the value returned with the order exceeds the quantity traded times the price.
            OP_7 OP_PICK OP_OUTPUTVALUE OP_8 OP_PICK OP_UTXOVALUE OP_SUB
            OP_2OVER OP_SWAP OP_MUL <100_000_000> OP_DIV OP_NEGATE OP_GREATERTHANOREQUAL OP_VERIFY 
            // require((tx.outputs[orderIndex].value - tx.inputs[orderIndex].value) >= -(tradeQuantity*price/100_000_000));

        // } 
       OP_2DROP OP_2DROP OP_2DROP OP_2DROP
    // } 
    OP_ENDIF 
// } 
OP_2DROP OP_1`}},Ca=["BCH_2024_05","BCH_2025_05"],Ra={$schema:Ia,description:Ea,name:qa,entities:Aa,scenarios:Ua,scripts:Na,supported:Ca},Da="@unspent/catdex",La={name:Da},e0=1e8;class F{static USER_AGENT=La.name;static PROTOCOL_IDENTIFIER="U3X";static tokenAware=!0;static template=Ra;static compiler=Q0(this.template);static vm=ca();static getLockingBytecode(e,t){typeof e=="string"&&(e=I(e)),typeof t=="string"&&(t=I(t));const n=this.compiler.generateBytecode({data:{bytecode:{auth_category:new Uint8Array(e).reverse(),asset_category:new Uint8Array(t).reverse()}},scriptId:"lock"});if(!n.success)throw new Error("Failed to generate bytecode, script: , "+JSON.stringify(n,null,"  "));return n.bytecode}static getScriptHash(e,t,n=!0){return n0(this.getLockingBytecode(e,t),n)}static getAddress(e,t,n="bitcoincash"){return z0(this.getLockingBytecode(e,t),n,this.tokenAware)}static getCatDexOrdersFromUtxos(e,t,n=!0){typeof e!="string"&&(e=Ie(e));let s=t.filter(l=>l.token_data&&l.token_data?.category!=e).map(l=>{let u=this.parseNFT(l.token_data?.nft?.commitment);return{authCategory:I(l.token_data?.category),assetCategory:I(e),orderUtxo:l,assetUtxo:void 0,price:u.price,quantity:u.quantity,value:l.value,amount:void 0}});s.sort((l,u)=>Number(u.price)-Number(l.price)),n&&(s=s.filter(l=>l.quantity!=0n));let f=[];for(let l of s){let u=t.findIndex(x=>x.tx_hash==l.orderUtxo.tx_hash&&x.tx_pos==l.orderUtxo.tx_pos+1);if(u==-1)throw"Couldn't find matching asset thread";let k={};k={assetUtxo:t[u],amount:t[u]?.token_data?t[u].token_data.amount:0n},f.push({...l,...k})}return f}static getSourceOutput(e,t,n){return{lockingBytecode:this.getLockingBytecode(e,t),valueSatoshis:BigInt(n.value),token:n.token_data?{category:I(n.token_data.category),amount:BigInt(n.token_data.amount),nft:n.token_data.nft?{commitment:I(n.token_data.nft.commitment),capability:n.token_data.nft.capability}:void 0}:void 0}}static parseNFT(e){typeof e=="string"&&(e=I(e));let t=Vt(e.slice(0,16),{requireMinimalEncoding:!1}),n=Vt(e.slice(-16),{requireMinimalEncoding:!1});return{quantity:BigInt(t),price:Number(n)/e0}}static encodeNFT(e){return new Uint8Array([...Wt(Kt(BigInt(e.quantity)),16),...Wt(Kt(BigInt(Math.trunc(e.price*e0))),16)])}static getInput(e,t,n){return typeof e=="string"&&(e=I(e)),typeof t=="string"&&(t=I(t)),{outpointIndex:n.tx_pos,outpointTransactionHash:I(n.tx_hash),sequenceNumber:0,unlockingBytecode:{data:{bytecode:{auth_category:new Uint8Array(e).reverse(),asset_category:new Uint8Array(t).reverse()}},compiler:this.compiler,script:"unlock",valueSatoshis:BigInt(n.value),token:n.token_data?{category:I(n.token_data.category),amount:BigInt(n.token_data.amount),nft:n.token_data.nft?{commitment:I(n.token_data.nft.commitment),capability:n.token_data.nft.capability}:void 0}:void 0}}}static getOrderOutput(e,t){let n=this.getLockingBytecode(e.authCategory,e.assetCategory),o=0n;return e.amount>0?o=BigInt(e.assetUtxo.token_data.amount)-t:o=-t,[{lockingBytecode:n,valueSatoshis:BigInt(e.orderUtxo.value)+BigInt(Number(t)*e.price),token:{amount:0n,category:I(e.orderUtxo.token_data.category),nft:{commitment:F.encodeNFT({quantity:e.quantity+t,price:e.price}),capability:"mutable"}}},{lockingBytecode:n,valueSatoshis:800n,token:o!=0n?{category:e.assetCategory,amount:BigInt(o)}:void 0}]}static orderRequestToOutputs(e,t,n){let o=this.getLockingBytecode(e,t);typeof e=="string"&&(e=I(e)),typeof t=="string"&&(t=I(t));let s=800n,f=0n;n.quantity>0n&&(s+=BigInt(Math.trunc(n.price*Number(n.quantity)))),n.quantity<0n&&(f=-BigInt(n.quantity));const l=this.encodeNFT(n);let u=[{lockingBytecode:o,valueSatoshis:s,token:{category:e,amount:0n,nft:{commitment:l,capability:"mutable"}}}];return u.push({lockingBytecode:o,valueSatoshis:800n,token:f>0n?{category:t,amount:f}:void 0}),u}static getWalletSourceOutput(e,t,n=0){return{lockingBytecode:t?$0({addressIndex:n,hdPrivateKey:t,throwErrors:!0}):Uint8Array.from(Array(33)),valueSatoshis:BigInt(e.value),token:e.token_data?{category:I(e.token_data.category),amount:BigInt(e.token_data.amount),nft:e.token_data.nft?{commitment:I(e.token_data.nft.commitment),capability:e.token_data.nft.capability}:void 0}:void 0}}static getWalletInput(e,t,n=0){let o=t?{compiler:this.compiler,data:{hdKeys:{addressIndex:n,hdPrivateKeys:{wallet:t}}},script:"wallet_unlock",valueSatoshis:BigInt(e.value),token:e.token_data?{category:I(e.token_data.category),amount:BigInt(e.token_data.amount),nft:e.token_data.nft?{commitment:I(e.token_data.nft.commitment),capability:e.token_data.nft.capability}:void 0}:void 0}:Uint8Array.from(Array());return{outpointIndex:e.tx_pos,outpointTransactionHash:I(e.tx_hash),sequenceNumber:0,unlockingBytecode:o}}static getAuthWalletOutput(e,t,n=0){return{lockingBytecode:t?{compiler:this.compiler,data:{hdKeys:{addressIndex:n,hdPublicKeys:{wallet:Yt(t).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:BigInt(e.value),token:e.token_data?{category:I(e.token_data.category),amount:BigInt(e.token_data.amount),nft:e.token_data.nft?{commitment:I(e.token_data.nft.commitment),capability:e.token_data.nft.capability}:void 0}:void 0}}static getChangeOutput(e,t,n,o,s=0){return n&&typeof n!="string"&&(n=Ie(n)),{lockingBytecode:o?{compiler:this.compiler,data:{hdKeys:{addressIndex:s,hdPublicKeys:{wallet:Yt(o).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:e,token:t>0&&n?{category:I(n),amount:t}:void 0}}static getAuthLayers(e,t,n=0){let o=[],s=[],f=[];return f.push(this.getWalletSourceOutput(e,t,n)),o.push(this.getWalletInput(e,t,n)),s.push(this.getAuthWalletOutput(e,t,n)),{inputs:o,outputs:s,sourceOutputs:f}}static setBlackBoardLayers(e,t,n,o,s=[]){let f=[],l=[];return f.push(...n.map(u=>this.getInput(e,t,u))),s.push(...n.map(u=>this.getSourceOutput(e,t,u))),l.push(...o.map(u=>this.orderRequestToOutputs(e,t,u)).flat()),{inputs:f,outputs:l,sourceOutputs:s}}static getBlackBoardLayers(e,t,n=[]){let o=[],s=[];if(e=e.filter(u=>Math.sign(Number(u.quantity))!=Math.sign(Number(t))),e.length==0)throw Error("no orders left, maximum recursion depth reached.");const f=t>0?(u,k)=>Number(u.price-k.price):(u,k)=>Number(u.price+k.price);e.sort(f);const l=e.shift();if(!l)throw Error("No matching best order found.");if(!l.assetUtxo)throw Error("Order missing asset utxo");if(o.push(this.getInput(l.authCategory,l.assetCategory,l.orderUtxo)),o.push(this.getInput(l.authCategory,l.assetCategory,l.assetUtxo)),n.push(this.getSourceOutput(l.authCategory,l.assetCategory,l.orderUtxo)),n.push(this.getSourceOutput(l.authCategory,l.assetCategory,l.assetUtxo)),Math.abs(Number(t))<=Math.abs(Number(l.quantity)))s.push(...this.getOrderOutput(l,t));else{s.push(...this.getOrderOutput(l,-l.quantity)),t+=l.quantity;let u=this.getBlackBoardLayers([...e],t,[...n]);o.push(...u.inputs),s.push(...u.outputs),n=u.sourceOutputs}return{inputs:o,outputs:s,sourceOutputs:n}}static getWalletInputs(e,t,n,o,s=[]){let f=[],l=[];if(o&&typeof o!="string"&&(o=Ie(o)),o?(console.log(e),e=e.filter(O=>O.token_data&&O.token_data?.category==o).filter(O=>O.token_data&&!O.token_data.nft),console.log(e)):e=e.filter(O=>!O.token_data),e.length==0)throw Error("no wallet utxos left, maximum recursion depth reached.");const u=Math.floor(Math.random()*e.length),k=e[u];e.splice(u,1),f.push(this.getWalletInput(k,n)),s.push(this.getWalletSourceOutput(k,n));let x=re(s),_=j(s,o);if(o&&_<t||!o&&x<t){let O=this.getWalletInputs([...e],t,n,o,[...s]);f.push(...O.inputs),l.push(...O.outputs),s=O.sourceOutputs}return{inputs:f,outputs:l,sourceOutputs:s}}static getWalletLayers(e,t,n,o,s){let f=Qt(t.outputs),l=re(n),u=f-l;const k=this.getWalletInputs(o,u,s);t.inputs.push(...k.inputs),n.push(...k.sourceOutputs);let x=zt(t.outputs,e),_=j(n,e),O=x-_;if(console.log("Tokens required:",O),O>0n){const H=this.getWalletInputs(o,O,s,e);t.inputs.push(...H.inputs),n.push(...H.sourceOutputs)}f=Qt(t.outputs),l=re(n);let g=l-f;x=zt(t.outputs,e),_=j(n,e);let S=_-x;return S>0&&(t.outputs.push(this.getChangeOutput(800n,S,e,s)),g-=800n),t.outputs.push(this.getChangeOutput(g,0n,void 0,s)),t}static administer(e,t,n,o,s,f,l=0,u=1){let _={locktime:0,version:2,inputs:[],outputs:[]},O=e.token_data.category;const g=this.getAuthLayers(e,f,l);_.inputs.push(...g.inputs),_.outputs.push(...g.outputs);let S=g.sourceOutputs;const H=this.setBlackBoardLayers(O,t,n,o);_.inputs.push(...H.inputs),_.outputs.push(...H.outputs),S.push(...H.sourceOutputs),_=this.getWalletLayers(t,_,S,s,f);let q=Je(_);if(!q.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(q.errors,null,"  "));const K=Gt(q.transaction,u),A=_.outputs.length-1;if(_.outputs[A].valueSatoshis=_.outputs[A].valueSatoshis-K,q=Je(_),!q.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(q.errors,null,"  "));const D=q.transaction,Q=Xt(D,S,{maximumTokenCommitmentLength:40});if(Q!==!0&&u>0)throw Q;let L=this.vm.verify({sourceOutputs:S,transaction:D});if(typeof L=="string")throw Error(L);let ie=re(S)-re(D.outputs);ie>5e3&&(L=`Excessive fees ${ie}`),j(S,t)==0n&&(L="Error checking token input");let ce=j(S,t)-j(D.outputs,t);return ce!==0n&&(L=`Swapping should not create destroy tokens, token difference: ${ce}`),{sourceOutputs:S,transaction:D,verify:L}}static swap(e,t,n,o,s=1){const f=[],l=[];let u=[],k=Ie(t[0]?.assetCategory);if(new Set(t.map(L=>Ie(L.assetCategory))).size>1)throw"A catdex swap may only trade one asset at a time, mixed assets found.";let _={locktime:0,version:2,inputs:f,outputs:l};n=n.filter(L=>L.token_data?.category==k||!L.token_data);let O=this.getBlackBoardLayers(t,e,u);_.inputs.push(...O.inputs),_.outputs.push(...O.outputs),u=O.sourceOutputs,_=this.getWalletLayers(k,_,u,n,o);let g=Je(_);if(!g.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(g.errors,null,"  "));const S=Gt(g.transaction,s),H=_.outputs.length-1;if(_.outputs[H].valueSatoshis=_.outputs[H].valueSatoshis-S,g=Je(_),!g.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(g.errors,null,"  "));const q=g.transaction,K=Xt(q,u,{maximumTokenCommitmentLength:40});if(K!==!0&&s>0)throw K;let A=this.vm.verify({sourceOutputs:u,transaction:q}),D=re(u)-re(q.outputs);D>5e3&&(A=`Excessive fees ${D}`),j(u,k)==0n&&(A="Error checking token input");let Q=j(u,k)-j(q.outputs,k);return Q!==0n&&(A=`Swapping should not create destroy tokens, token difference: ${Q}`),{sourceOutputs:u,transaction:q,verify:A}}}async function t0(p,e){let t=(await j0(Z0,e.map(o=>[p,o]))).flat();var n=new Map;return t.map(o=>n.set(o.tx_hash+":"+o.tx_pos,o)),n}var Ma=h('<meta name="description" content="CatDex - a decentralized limit order exchange and dex aggregator on Bitcoin Cash."/>'),Fa=h('<div class="trollbox svelte-28e4qu"><!> <label class="switch svelte-28e4qu">Hide <input type="checkbox" class="svelte-28e4qu"/> <span class="slider round svelte-28e4qu"></span></label></div>'),Ha=h("<img/>"),Va=h('<img alt="Disconnected"/>'),Wa=(p,e)=>e(),Ka=h("<option> </option>"),Ya=h('<div class="swap svelte-28e4qu"><div class="svelte-28e4qu"><img width="50"/> <br/> </div> <div class="svelte-28e4qu"><img width="50"/> <br/> </div></div>'),Qa=(p,e)=>e(),za=h('<div class="swap svelte-28e4qu"><label>Swap amount:</label> <input type="number" min="0" max="10"/></div>'),Ga=h('<div class="swap svelte-28e4qu"><p><a href="/wallet">Deposit funds</a> to trade assets.</p></div>'),Xa=h('<div class="swap svelte-28e4qu"><button class="svelte-28e4qu">Broadcast</button></div> <!>',1),Ja=(p,e)=>e(4364),ja=(p,e)=>e(52596),Za=h("<b> </b>"),$a=h("<b> </b>"),en=h('<div><p>You have a CatDex baton. <br/> For others to can find your orders, announce your membership in the CatDex.</p> <button class="svelte-28e4qu">Month (4364 sats)</button> <button class="svelte-28e4qu">Year (52596 sats)</button> <p>Membership fees are non-refundable and are claimed by miners.</p> <!></div> <br/>',1),tn=h('<a href="/wallet">Deposit funds</a> to create a CatDex authentication baton.',1),an=(p,e)=>e(),nn=h('<p>To write orders, you need to create a CatDex Authentication Baton (1000 sats).</p> <button class="svelte-28e4qu">Create a new Baton</button>',1),on=(p,e)=>e(!0),sn=(p,e)=>e(),rn=h('<button class="svelte-28e4qu">Replace Orders</button> <button class="svelte-28e4qu">Append Orders</button>',1),cn=(p,e)=>e(!0),ln=(p,e)=>e(0),dn=h('<button class="svelte-28e4qu">Clear Orders</button> <button class="svelte-28e4qu">New Orders</button><br/>',1),un=h('<div class="orders svelte-28e4qu"><div class="in svelte-28e4qu"><b>type</b></div> <div class="in svelte-28e4qu"><b>price</b></div> <div class="in svelte-28e4qu"><b>quantity</b></div> <div class="in svelte-28e4qu"></div> <div class="listButtons svelte-28e4qu"></div></div>'),vn=h('<div class="orders svelte-28e4qu"><div class="in svelte-28e4qu"><!></div> <div class="in svelte-28e4qu"><input type="number" placeholder="sats per" min="1" max="100000" class="svelte-28e4qu"/></div> <div class="in svelte-28e4qu"><input name="quantity" placeholder="qty" type="number" class="svelte-28e4qu"/> <!></div> <div class="in svelte-28e4qu"><!></div> <div class="listButtons svelte-28e4qu"><button class="svelte-28e4qu">+</button> <button class="svelte-28e4qu">-</button></div></div>'),fn=h("<p>Sell is negative quantity.<br/> All prices in satoshis</p>"),pn=h('<h3>Your Decentralized Listing</h3> <!> <div class="swap svelte-28e4qu"><div class="svelte-28e4qu"><img width="24"/> <br/> </div> <div class="svelte-28e4qu"><img width="24"/> <br/> </div></div> <!> <br/> <!> <!> <!> <!> <br/>',1),bn=h("<br/> <div><!> <!></div>",1),_n=h("<div><!></div>"),mn=h('<b>Asset:</b> <select></select> <br/> <!> <br/> <!> <br/> <!> <div class="orderBooks svelte-28e4qu"><div class="svelte-28e4qu"></div> <div class="askBook svelte-28e4qu"></div></div> <h3>Advanced</h3> <label class="switch svelte-28e4qu"><input type="checkbox" class="svelte-28e4qu"/> <span class="slider round svelte-28e4qu"></span></label> <br/> <!> <br/> <br/> <h3>Makers</h3> <div class="grid svelte-28e4qu"></div>',1),gn=h('<div class="swap svelte-28e4qu"><p>Not connected.</p></div>'),hn=h('<!> <section><div class="status svelte-28e4qu"><!> <!></div> <h1>Trade CashTokens</h1> <!> <h3>Chat</h3> <label class="switch svelte-28e4qu"><input type="checkbox" class="svelte-28e4qu"/> <span class="slider round svelte-28e4qu"></span></label> <!></section>',1);function Jn(p,e){ht(e,!0);let t=T(pe(e.data.asset)),n=T(0),o=T(""),s,f=T(""),l=T(0n),u=T(""),k;pe([]);let x=T(pe([])),_=T(pe([])),O=T(pe([])),g=T(pe([])),S=T(void 0),H=T(void 0),q=T(void 0),K=T(0),A=T(pe([])),D=T(pe([])),Q=T(pe([])),L=T(!1),ie=T(!1),ce="",ue=T(void 0),Ee=T(!1),ye=T(void 0),ke=T(""),Oe=T(0),ve=T(0n);const $=K0.url.hostname=="vox.cash",Be=$?"BCH":"tBCH",Ge=$?"bch.imaginary.cash":"chipnet.bch.ninja",Ze=$?ra:ia,ge=$?o0:s0;typeof a(t)!="string"&&b(t,$?"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c":"ffc9d3b3488e890ef113b1c74f40e1f5eb1147a7d4191cecac89fd515721a271",!0);const ee=_t(`OP_RETURN <"${F.PROTOCOL_IDENTIFIER}">`);let N;const C=Object.entries(Ze.identities).map(i=>Object.values(Object.values(i[1]))).flat().filter(i=>i.extensions&&i.extensions.exchanges=="catdex").reduce((i,v)=>(i.set(v.token.category,v),i),new Map),xe=()=>{clearTimeout(k),k=setTimeout(()=>{Pe(),te()},1500)};async function te(){if(s&&a(n)>1e3){let i=await s.request("blockchain.scripthash.listunspent",je.getScriptHash(F.PROTOCOL_IDENTIFIER),"include_tokens");b(Q,i.map(J=>J.token_data?.category).filter((J,Ae,tt)=>tt.indexOf(J)===Ae),!0);let v=a(Q).map(J=>F.getScriptHash(J,a(t))),X=await t0(s,v),V=Array.from(X.values());if(b(_,F.getCatDexOrdersFromUtxos(a(t),V),!0),a(A).length>0){let J=await t0(s,[F.getScriptHash(a(A)[0].token_data.category,a(t))]);b(D,Array.from(J.values()),!0),b(H,mt(a(D),a(t)),!0),b(q,Jt(a(D)),!0),b(O,F.getCatDexOrdersFromUtxos(a(t),a(D)),!0)}}}const Pe=async function(){let i=await s.request("blockchain.scripthash.listunspent",a(f),"include_tokens");if(i instanceof Error)throw i;b(A,i.filter(v=>v.token_data&&v.token_data.nft&&v.token_data.nft.commitment.startsWith(ee)),!0),typeof a(t)=="string"?(b(x,i.filter(v=>!v.token_data||v.token_data.category==a(t)),!0),b(ve,mt(a(x),a(t)),!0)):(b(x,i.filter(v=>!v.token_data),!0),b(ve,0n)),b(Oe,Jt(a(x),!0),!0)},Fe=async function(){await N.sendMax(N.getDepositAddress());let i=_t(`OP_RETURN <"${F.PROTOCOL_IDENTIFIER}"> <"markets are made">`);await N.tokenGenesis({cashaddr:N.getTokenDepositAddress(),commitment:i,capability:Zt.minting,value:800})},qe=async function(i){let v=_t('OP_RETURN <"markets are made">');await N.tokenMint(a(A)[0].token_data.category,[new sa({cashaddr:je.getAddress(F.PROTOCOL_IDENTIFIER),commitment:v,capability:Zt.none,value:i})])},M=async function(){await Pe(),await te(),typeof a(t)=="string"?(W0(`?asset=${a(t)}`,{keepFocus:!0}),b(ve,mt(a(x),a(t)),!0)):b(ve,0n)},z=function(i){if(a(g).length+1==i)a(g).splice(i,0,{quantity:void 0,price:void 0});else if(a(g).length>=2){let v=a(g).slice(-2);a(g).push({quantity:v[1].quantity-(v[0].quantity-v[1].quantity),price:v[1].price-(v[0].price-v[1].price)})}else a(g).push({quantity:void 0,price:void 0})},He=function(i){a(g).splice(i,1)},Te=async function(i=!1){let v=i?a(D):[],X=F.administer(a(A)[0],a(t),v,a(g),a(x),a(o)),V=Ie(jt(X.transaction));(await kt(V)).length==64&&b(g,[],!0)},i0=function(){if(a(l))try{let i=F.swap(BigInt(a(l)),a(_),a(x),a(o));b(ue,i.transaction,!0),b(ye,i.sourceOutputs,!0),ce=Ie(jt(a(ue))),b(Ee,i.verify===!0,!0),i.verify===!0&&b(ke,"")}catch(i){b(ue,void 0),b(ye,void 0),ce="",b(Ee,!1),b(ke,i,!0)}},kt=async function(i){let v=await s.request("blockchain.transaction.broadcast",i);if(v instanceof Error)throw b(u,$t[s.status],!0),b(ke,v.message,!0),v;return b(ue,void 0),b(ye,void 0),ce="",b(Ee,!1),v},c0=function(i){if(b(u,$t[s.status],!0),i.method==="blockchain.headers.subscribe"){let v=i.params[0];b(n,v.height,!0),te(),Pe()}else i.method==="blockchain.scripthash.subscribe"?xe():console.log(i)};U0(async()=>{ta.StorageProvider=ea,N=$?await aa.named("vox"):await na.named("vox"),b(o,oa(N.mnemonic,N.derivationPath.slice(0,-2),N.isTestnet),!0);let i=G0(N.getDepositAddress());if(typeof i=="string")throw i;b(f,n0(i.bytecode),!0),s=new va(F.USER_AGENT,"1.4.1",Ge),await s.connect(),s.on("notification",c0),await s.subscribe("blockchain.headers.subscribe"),await s.subscribe("blockchain.scripthash.subscribe",a(f));let v=await s.request("blockchain.scripthash.listunspent",je.getScriptHash(F.PROTOCOL_IDENTIFIER),"include_tokens");b(Q,v.map(V=>V.token_data?.category),!0),b(S,v.filter(V=>V.token_data?.category==a(A)[0].token_data.category).pop(),!0),b(K,a(S)&&a(S).height>0?a(S).height+a(S).value-a(n):0,!0),a(Q).map(V=>F.getScriptHash(V,a(t))).map(async V=>{await s.subscribe("blockchain.scripthash.subscribe",V)}),await s.subscribe("blockchain.scripthash.subscribe",je.getScriptHash(F.PROTOCOL_IDENTIFIER))}),N0(async()=>{await N.provider.disconnect(),await s.disconnect()});var Ot=hn();V0(i=>{var v=Ma();M0.title=" CatDex",m(i,v)});var Bt=se(Ot);{var l0=i=>{var v=Fa(),X=d(v);Y0(X,{get topic(){return F.PROTOCOL_IDENTIFIER}});var V=c(X,2),J=c(d(V));Me(J),be(2),r(V),r(v),ft(J,()=>a(ie),Ae=>b(ie,Ae)),m(i,v)};R(Bt,i=>{a(ie)&&i(l0)})}var xt=c(Bt,2),$e=d(xt),Pt=d($e);la(Pt,{get template(){return F.template}});var d0=c(Pt,2);{var u0=i=>{var v=Ha();W(()=>{oe(v,"src",da),oe(v,"alt",a(u))}),m(i,v)},v0=i=>{var v=Va();W(()=>oe(v,"src",ua)),m(i,v)};R(d0,i=>{a(u)=="CONNECTED"?i(u0):i(v0,!1)})}r($e);var Tt=c($e,4);{var f0=i=>{var v=mn(),X=c(se(v),2);X.__change=[Wa,M],_e(X,21,()=>C.keys(),me,(y,P)=>{var w=Ka(),Y={},Se=d(w,!0);r(w),W(Ue=>{Y!==(Y=a(P))&&(w.value=(w.__value=a(P))??""),E(Se,Ue)},[()=>C.get(a(P)).name]),m(y,w)}),r(X);var V=c(X,4);{var J=y=>{var P=Ya(),w=d(P),Y=d(w),Se=c(Y,3);r(w);var Ue=c(w,2),Ve=d(Ue),st=c(Ve,3);r(Ue),r(P),W((Z,he,Ne,Ce,ae)=>{oe(Y,"src",ge),oe(Y,"alt",Be),E(Se,` ${Z??""} sats ${Be}`),oe(Ve,"src",he),oe(Ve,"alt",Ne),E(st,` ${Ce??""}
					${ae??""}`)},[()=>a(Oe).toLocaleString(),()=>C.get(a(t)).uris.icon,()=>C.get(a(t)).token.symbol,()=>(a(ve)/BigInt(Math.pow(10,C.get(a(t)).token.decimals))).toLocaleString(),()=>C.get(a(t)).token.symbol]),m(y,P)};R(V,y=>{a(t)&&y(J)})}var Ae=c(V,4);{var tt=y=>{var P=za(),w=c(d(P),2);Me(w),w.__change=[Qa,i0],r(P),pt(w,()=>a(l),Y=>b(l,Y)),m(y,P)},_0=y=>{var P=Ga();m(y,P)};R(Ae,y=>{a(Oe)>0?y(tt):y(_0,!1)})}var wt=c(Ae,4);{var m0=y=>{var P=Xa(),w=se(P),Y=d(w);Y.__click=()=>kt(ce),r(w);var Se=c(w,2);Oa(Se,{get transaction(){return a(ue)},get sourceOutputs(){return a(ye)},get category(){return a(t)}}),m(y,P)};R(wt,y=>{a(ue)&&a(Ee)&&y(m0)})}var It=c(wt),at=c(It),nt=d(at);_e(nt,21,()=>a(_).filter(y=>y.quantity>0),me,(y,P)=>{gt(y,bt(()=>a(P),{get assetCategory(){return a(t)}},()=>({isMainnet:$})))}),r(nt);var Et=c(nt,2);_e(Et,21,()=>a(_).filter(y=>y.quantity<0).toReversed(),me,(y,P)=>{gt(y,bt(()=>a(P),{get assetCategory(){return a(t)}},()=>({isMainnet:$})))}),r(Et),r(at);var ot=c(at,4),qt=d(ot);Me(qt),be(2),r(ot);var At=c(ot,4);{var g0=y=>{var P=bn(),w=c(se(P),2),Y=d(w);{var Se=Z=>{var he=en(),Ne=se(he),Ce=c(d(Ne),2);Ce.__click=[Ja,qe];var ae=c(Ce,2);ae.__click=[ja,qe];var we=c(ae,4);{var Re=le=>{var ne=Za(),Ke=d(ne);r(ne),W(()=>E(Ke,`Membership expires in ${a(K)??""} blocks. Renew now to have your orders discoverable.`)),m(le,ne)},We=le=>{var ne=$a(),Ke=d(ne);r(ne),W(()=>E(Ke,`Membership expired ${a(K)??""} blocks ago. Renew now to keep your orders discoverable.`)),m(le,ne)};R(we,le=>{a(K)>0?le(Re):le(We,!1)})}r(Ne),be(2),m(Z,he)};R(Y,Z=>{a(K)<1e3&&Z(Se)})}var Ue=c(Y,2);{var Ve=Z=>{var he=tn();be(),m(Z,he)},st=(Z,he)=>{{var Ne=ae=>{var we=nn(),Re=c(se(we),2);Re.__click=[an,Fe],m(ae,we)},Ce=ae=>{var we=pn(),Re=c(se(we),2);_e(Re,17,()=>a(A),me,(U,B)=>{Qe(U,{size:24,get category(){return a(B).token_data.category}})});var We=c(Re,2),le=d(We),ne=d(le),Ke=c(ne,3);r(le);var Nt=c(le,2),rt=d(Nt),h0=c(rt,3);r(Nt),r(We);var Ct=c(We,2);_e(Ct,17,()=>a(O),me,(U,B)=>{gt(U,bt(()=>a(B),{get assetCategory(){return a(t)}},()=>({isMainnet:$})))});var Rt=c(Ct,4);{var y0=U=>{var B=rn(),de=se(B);de.__click=[on,Te];var fe=c(de,2);fe.__click=[sn,Te],m(U,B)},k0=U=>{var B=dn(),de=se(B);de.__click=[cn,Te];var fe=c(de,2);fe.__click=[ln,z],be(),m(U,B)};R(Rt,U=>{a(g).length>0?U(y0):U(k0,!1)})}var Dt=c(Rt,2);{var O0=U=>{var B=un();m(U,B)};R(Dt,U=>{a(g).length>0&&U(O0)})}var Lt=c(Dt,2);_e(Lt,17,()=>a(g),me,(U,B,de)=>{var fe=vn(),Ye=d(fe),P0=d(Ye);{var T0=G=>{var De=Xe("BID");m(G,De)},S0=(G,De)=>{{var ut=Le=>{var vt=Xe("ASK");m(Le,vt)},A0=Le=>{var vt=Xe("-");m(Le,vt)};R(G,Le=>{a(B).quantity<0?Le(ut):Le(A0,!1)},De)}};R(P0,G=>{a(B).quantity>0?G(T0):G(S0,!1)})}r(Ye);var it=c(Ye,2),Mt=d(it);Me(Mt),r(it);var ct=c(it,2),lt=d(ct);Me(lt);var w0=c(lt,2);Qe(w0,{size:24,get category(){return a(t)}}),r(ct);var dt=c(ct,2),I0=d(dt);{var E0=G=>{var De=Xe();W(ut=>E(De,`${ut??""} sats`),[()=>Number(a(B).quantity*a(B).price).toLocaleString()]),m(G,De)};R(I0,G=>{a(B).quantity*a(B).price>0&&G(E0)})}r(dt);var Ft=c(dt,2),Ht=d(Ft);Ht.__click=()=>z(de+1);var q0=c(Ht,2);q0.__click=()=>{He(de)},r(Ft),r(fe),pt(Mt,()=>a(B).price,G=>a(B).price=G),pt(lt,()=>a(B).quantity,G=>a(B).quantity=G),m(U,fe)});var B0=c(Lt,2);{var x0=U=>{var B=fn();m(U,B)};R(B0,U=>{a(g).length>0&&U(x0)})}be(2),W((U,B,de,fe,Ye)=>{oe(ne,"src",ge),oe(ne,"alt",Be),E(Ke,` ${U??""} sats ${Be}`),oe(rt,"src",B),oe(rt,"alt",de),E(h0,` ${fe??""}
							${Ye??""}`)},[()=>a(q).toLocaleString(),()=>C.get(a(t)).uris.icon,()=>C.get(a(t)).token.symbol,()=>(a(H)/BigInt(Math.pow(10,C.get(a(t)).token.decimals))).toLocaleString(),()=>C.get(a(t)).token.symbol]),m(ae,we)};R(Z,ae=>{a(A).length==0?ae(Ne):ae(Ce,!1)},he)}};R(Ue,Z=>{a(Oe)<1e3&&a(x).length==0?Z(Ve):Z(st,!1)})}r(w),m(y,P)};R(At,y=>{a(L)&&y(g0)})}var Ut=c(At,8);_e(Ut,21,()=>a(Q),me,(y,P)=>{var w=_n(),Y=d(w);Qe(Y,{get category(){return a(P)},size:24}),r(w),m(y,w)}),r(Ut),W(()=>E(It,` ${a(ke)??""} `)),pa(X,()=>a(t),y=>b(t,y)),ft(qt,()=>a(L),y=>b(L,y)),m(i,v)},p0=i=>{var v=gn();m(i,v)};R(Tt,i=>{a(u)=="CONNECTED"?i(f0):i(p0,!1)})}var et=c(Tt,4),St=d(et);Me(St),be(2),r(et);var b0=c(et,2);wa(b0),r(xt),ft(St,()=>a(ie),i=>b(ie,i)),m(p,Ot),yt()}H0(["change","click"]);export{Jn as component,Xn as universal};
//# sourceMappingURL=6.ClsnZic7.js.map
