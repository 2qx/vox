import{f as g,a as b,t as Ze}from"../chunks/DTc5U4eY.js";import{o as A0,a as U0}from"../chunks/_R59KZhj.js";import{e as o0,P as N0,aM as C0,aN as R0,p as xt,aA as me,f as re,s as c,c as d,r,I as a,t as K,a as Pt,af as q0,aB as w,ao as fe,ak as f,ay as D0}from"../chunks/CQU5mOuk.js";import{l as L0,s as C,d as M0,h as F0}from"../chunks/CF3aPdyL.js";import{i as N}from"../chunks/CZ0rTjPC.js";import{e as pe,i as be}from"../chunks/CbL2L94E.js";import{r as He,s as se}from"../chunks/-rOGAMhN.js";import{a as gt,b as ht}from"../chunks/Oj09dCTU.js";import{s as yt}from"../chunks/DBDCTY7c.js";import{g as H0}from"../chunks/DiO3Z1Hh.js";import{p as V0}from"../chunks/DKGt_eH1.js";import{a as W0}from"../chunks/CwtakbR7.js";import{q as ie,D as Z,g as K0,h as U,d as s0,e as Y0,b as Ee,J as Kt,K as Yt,t as Qt,B as zt,H as Gt,L as Xt,f as $e,C as Jt,v as jt,p as kt,j as Q0,n as Ot,s as Zt,k as $t}from"../chunks/BQUio51k.js";/* empty css                */import{c as z0}from"../chunks/q36Eg1F8.js";import{s as G0}from"../chunks/CXfu__Ha.js";import{B as r0,t as i0}from"../chunks/B2Xzehbr.js";import{i as X0,l as J0}from"../chunks/Bt3MikUi.js";/* empty css                */import{T as Ge}from"../chunks/otdWaXgM.js";import{h as j0,I as Z0,B as $0,W as ea,T as ta,g as aa,b as na,N as e0}from"../chunks/BTBIn4-B.js";import{B as oa,t as sa}from"../chunks/B-JAlK32.js";import"../chunks/CuzQ0eOn.js";import{c as ra}from"../chunks/DGwzT_kg.js";import{S as et}from"../chunks/zv45hi4S.js";import{B as ia}from"../chunks/BzLj6JBc.js";import{C as ca}from"../chunks/B7hCbxZp.js";import{D as la}from"../chunks/DMvn4Q5j.js";import{$ as da,a as t0}from"../chunks/BDt1pbpk.js";function c0(p,e,t){if(p.multiple){if(e==null)return;if(!N0(e))return C0();for(var n of p.options)n.selected=e.includes(Xe(n));return}for(n of p.options){var o=Xe(n);if(R0(o,e)){n.selected=!0;return}}(!t||e!==void 0)&&(p.selectedIndex=-1)}function ua(p,e){o0(()=>{var t=new MutationObserver(()=>{var n=p.__value;c0(p,n)});return t.observe(p,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function va(p,e,t=e){var n=!0;L0(p,"change",o=>{var s=o?"[selected]":":checked",m;if(p.multiple)m=[].map.call(p.querySelectorAll(s),Xe);else{var l=p.querySelector(s)??p.querySelector("option:not([disabled])");m=l&&Xe(l)}t(m)}),o0(()=>{var o=e();if(c0(p,o,n),n&&o===void 0){var s=p.querySelector(":checked");s!==null&&(o=Xe(s),t(o))}p.__value=o,n=!1}),ua(p)}function Xe(p){return"__value"in p?p.__value:p.value}var fa=g("<i> </i>"),ma=g("<i>0</i>"),pa=g('<tr class="svelte-1oaaxak"><td class="r sats svelte-1oaaxak"> </td><td class="r sats svelte-1oaaxak"><!></td></tr>'),ba=g("<i> </i>"),_a=g("<i>0</i>"),ga=g('<tr class="svelte-1oaaxak"><td class="r sats svelte-1oaaxak"> </td><td class="r sats svelte-1oaaxak"><!></td></tr>'),ha=g(' <br/> <div class="twoUp svelte-1oaaxak"><div class="svelte-1oaaxak"><h4>Inputs</h4> <table class="svelte-1oaaxak"><thead class="r svelte-1oaaxak"><tr class="svelte-1oaaxak"><td class="svelte-1oaaxak">Sats</td><td class="svelte-1oaaxak">Tokens</td></tr></thead><tbody class="svelte-1oaaxak"></tbody><tfoot class="svelte-1oaaxak"><tr><td class="r svelte-1oaaxak"> </td><td class="r svelte-1oaaxak"><i> </i></td></tr></tfoot></table></div> <div class="svelte-1oaaxak"><h4>Outputs</h4> <table class="svelte-1oaaxak"><thead class="r svelte-1oaaxak"><tr class="svelte-1oaaxak"><td class="svelte-1oaaxak">Sats</td><td class="svelte-1oaaxak">Tokens</td></tr></thead><tbody class="svelte-1oaaxak"></tbody><tfoot class="svelte-1oaaxak"><tr><td class="r svelte-1oaaxak"> </td><td class="r svelte-1oaaxak"><i> </i></td></tr></tfoot></table></div></div> <h4>Difference</h4> <table class="svelte-1oaaxak"><thead class="r svelte-1oaaxak"><tr class="svelte-1oaaxak"><td class="svelte-1oaaxak">Sats</td><td class="svelte-1oaaxak">Tokens</td></tr></thead><tfoot class="svelte-1oaaxak"><tr><td class="r svelte-1oaaxak"> </td><td class="r svelte-1oaaxak"><i> </i></td></tr></tfoot></table>',1);function ya(p,e){xt(e,!0),me();var t=ha(),n=re(t),o=c(n,2),s=c(o),m=d(s),l=c(d(m),2),u=c(d(l));pe(u,21,()=>e.sourceOutputs,be,(_e,te)=>{var R=pa(),q=d(R),Be=d(q,!0);r(q);var ae=c(q),xe=d(ae);{var Ve=F=>{var G=fa(),We=d(G,!0);r(G),K(Pe=>C(We,Pe),[()=>a(te).token.amount.toLocaleString()]),b(F,G)},Ue=F=>{var G=ma();b(F,G)};N(xe,F=>{a(te).token?F(Ve):F(Ue,!1)})}r(ae),r(R),K(F=>C(Be,F),[()=>a(te).valueSatoshis.toLocaleString()]),b(_e,R)}),r(u);var O=c(u),P=d(O),_=d(P),B=d(_,!0);r(_);var h=c(_),T=d(h),H=d(T,!0);r(T),r(h),r(P),r(O),r(l),r(m);var E=c(m,2),D=c(d(E),2),A=c(d(D));pe(A,21,()=>e.transaction.outputs,be,(_e,te)=>{var R=ga(),q=d(R),Be=d(q,!0);r(q);var ae=c(q),xe=d(ae);{var Ve=F=>{var G=ba(),We=d(G,!0);r(G),K(Pe=>C(We,Pe),[()=>a(te).token.amount.toLocaleString()]),b(F,G)},Ue=F=>{var G=_a();b(F,G)};N(xe,F=>{a(te).token?F(Ve):F(Ue,!1)})}r(ae),r(R),K(F=>C(Be,F),[()=>a(te).valueSatoshis.toLocaleString()]),b(_e,R)}),r(A);var L=c(A),z=d(L),M=d(z),ce=d(M,!0);r(M);var le=c(M),de=d(le),Ae=d(de,!0);r(de),r(le),r(z),r(L),r(D),r(E),r(s);var he=c(s,4),ye=c(d(he)),ke=d(ye),ue=d(ke),ee=d(ue);r(ue);var Oe=c(ue),Je=d(Oe),tt=d(Je);r(Je),r(Oe),r(ke),r(ye),r(he),K((_e,te,R,q,Be,ae)=>{C(n,`Locktime: ${e.transaction.locktime??""}`),C(o,` Version: ${e.transaction.version??""} `),C(B,_e),C(H,te),C(ce,R),C(Ae,q),C(ee,`Fee:
				${Be??""}`),C(tt,`Burned:
					${ae??""}`)},[()=>ie(e.sourceOutputs).toLocaleString(),()=>Z(e.sourceOutputs,e.category).toLocaleString(),()=>ie(e.transaction.outputs).toLocaleString(),()=>Z(e.transaction.outputs,e.category).toLocaleString(),()=>(ie(e.sourceOutputs)-ie(e.transaction.outputs)).toLocaleString(),()=>(Z(e.sourceOutputs,e.category)-Z(e.transaction.outputs,e.category)).toLocaleString()]),b(p,t),Pt()}const ka=!0,Oa=({params:p,url:e})=>({asset:e.searchParams.get("asset")}),Xn=Object.freeze(Object.defineProperty({__proto__:null,load:Oa,prerender:ka},Symbol.toStringTag,{value:"Module"}));var Ba=g('<div class="auth svelte-2vt4ng"><!></div> <div class="price svelte-2vt4ng"> </div> <div class="quantity svelte-2vt4ng"> <!></div>',1),xa=g('<div><div class="post svelte-2vt4ng"><div class="balance svelte-2vt4ng"><div class="order svelte-2vt4ng"><!></div></div></div></div>');function Bt(p,e){xt(e,!0);let t=q0(()=>e.quantity>0);e.isMainnet?r0:i0;var n=xa(),o=d(n),s=d(o),m=d(s),l=d(m);{var u=O=>{var P=Ba(),_=re(P),B=d(_);Ge(B,{size:20,get category(){return e.orderUtxo.token_data.category}}),r(_);var h=c(_,2),T=d(h,!0);r(h);var H=c(h,2),E=d(H),D=c(E);Ge(D,{size:20,get category(){return e.assetCategory},get isMainnet(){return e.isMainnet}}),r(H),K((A,L)=>{C(T,A),C(E,`${L??""} `)},[()=>Number(e.price).toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:6}),()=>Number(e.quantity).toLocaleString(void 0,{}).padStart(12)]),b(O,P)};N(l,O=>{e.orderUtxo&&O(u)})}r(m),r(s),r(o),r(n),K(()=>G0(n,1,z0(["container",{bid:a(t)}]),"svelte-2vt4ng")),b(p,n),Pt()}var Pa=g('<h3>About CatDex</h3> <p>Category Decentralized Exchange is a protocol to exchange assets using orders stored on non-fungible token commitments.</p> <p>More information about <a href="https://bitcoincashresearch.org/t/catdex-a-token-category-authorized-decentralized-exchange/1480" rel="nofollow">the contract.</a></p>',1);function Ta(p){var e=Pa();me(4),b(p,e)}const Sa="https://libauth.org/schemas/wallet-template-v0.schema.json",wa="CatDex: a bi-directional limit order CashToken exchange.",Ia="CatDex",Ea={covenant:{description:`A CatDex blackboard contract holds limit orders and token treads for trading. 


Anyone may spend a mutable order NFT to trade some or all of the quantity specified from any output held by the exchange.  


Features:


  - Bidirectional limit order exchange.
  - ZERO commission trades*.
  - Partial order fulfillment.
  - Cash bids for assets not held.
  - Allows total liquidation of token assets.
  - Minting NFT holder may easily withdraw, cancel, or rebalance orders.
  - Many orders may be written in a single transaction. 
  - All orders are discoverable via electrumX/smallIndex
  - *Transactions must pay standard fees to miners.


Order Commitments:


  Orders are listed on mutable NFT commitments like so
   
     byte16(LE)<quantity>   number of tokens remaining in order
     byte16(LE)<price>      price in token units per coin


  - Buy orders are positive (+)
  - Sell orders are negative (-)
  - Price MUST be expressed in raw token units per coin (100,000,000 sats)
  - CatDex has no concept of display decimal metadata 
 
Transaction Building Modes:


  Administration Mode
  
     Transactions with a minting NFT may withdraw all outputs from the contract.
  
     Auth Baton    input[0] -> output[0]     - Authenticating NFT (minting)
                   input[i] -> output[*]     - Unrestricted spending


  Order Mode
  
    In "Order mode" outputs are submitted in pairs, with both the record for the order
    and the cash value moving on the even "foot" and the tokens trading on the odd "foot".
    
    orderThread    input[even] -> output[even]  - Order NFT of category (mutable)
    assetThread    input[odd]  -> output[odd]   - Tread for asset traded.


Note: 


  The exchange owner(s) holds the minting NFT baton(s), which authorizes spending funds from the exchange.
`,name:"CatDex Blackboard",scripts:["unlock","lock"],variables:{auth_category:{description:"The CashToken Category for orders and authentication.",name:"Authentication Token Category",type:"WalletData"},asset_category:{description:"The CashToken Category Token ID of the asset being traded",name:"Asset Token Category",type:"WalletData"}}},wallet:{description:"Standard p2pkh wallet controlling the exchange minting NFT baton",name:"Exchange Owner",scripts:["wallet_unlock","wallet_lock"],variables:{key:{description:"The private key that controls this wallet.",name:"Key",type:"HdKey"}}}},Aa=JSON.parse('{"base":{"data":{"bytecode":{"auth_category":"0xefbe00000000000000000000000000000000000000000000000000000000adde","asset_category":"0x2c06f3b2565d0818a8e41f58beff5918d5dbdc64b11ee8ad474e499751cde07f"}},"description":"","name":"Base Scenario"},"excise_sell_order_baton":{"description":"Buy using a sell order.","extends":"base","name":"Use sell order (baton tread)","transaction":{"inputs":[{"unlockingBytecode":["slot"]},{},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10400,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"0000000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":0,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":9600,"token":{"amount":20,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}}],"version":2},"sourceOutputs":[{"lockingBytecode":["slot"],"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":20}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000}]},"excise_sell_order_asset":{"description":"Test buying an asset using a sell order.","extends":"base","name":"Use sell order to buy (asset tread)","transaction":{"inputs":[{},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10400,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"0000000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":0,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":9600,"token":{"amount":20,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}}],"version":2},"sourceOutputs":[{"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":20}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000}]},"excise_sell_order_asset_two":{"description":"Test buying an asset using a sell order.","extends":"base","name":"Use sell order to buy (asset tread)","transaction":{"inputs":[{},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":200800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"0000000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":800,"token":{"amount":500,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":293779}],"version":2},"sourceOutputs":[{"valueSatoshis":800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1027000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":10000}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":494799}]},"overbuy_order_baton":{"description":"Test that overbuying a sell order should fail.","extends":"base","name":"FAIL: overbuy sell order (baton tread)","transaction":{"inputs":[{"unlockingBytecode":["slot"]},{},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"1400000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":0,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":9200,"token":{"amount":40,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}}],"version":2},"sourceOutputs":[{"lockingBytecode":["slot"],"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":40}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000}]},"overbuy_order_asset":{"description":"Test that overbuying a sell order should fail.","extends":"base","name":"FAIL: overbuy sell order (asset tread)","transaction":{"inputs":[{},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"1400000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":0,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":9200,"token":{"amount":40,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}}],"version":2},"sourceOutputs":[{"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":40}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000}]},"misexcise_sell_order_asset":{"description":"Test that selling to a sell order should fail.","extends":"base","name":"FAIL: selling into sell order (asset tread)","transaction":{"inputs":[{},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"3c00000000000000000000000000008000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":60,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10800}],"version":2},"sourceOutputs":[{"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000008000943577000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":20}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":40}}]},"excise_buy_order_baton":{"description":"Test selling an asset using a buy order.","extends":"base","name":"Use buy order to sell tokens","transaction":{"inputs":[{"unlockingBytecode":["slot"]},{},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"0000000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":20,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10400}],"version":2},"sourceOutputs":[{"lockingBytecode":["slot"],"valueSatoshis":10400,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000000000943577000000000000000000000000","capability":"mutable"}}},{"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":0}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":20}}]},"excise_buy_order_asset":{"description":"Test selling an asset to a buy order.","extends":"base","name":"Use buy order to sell tokens","transaction":{"inputs":[{},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"lock"},"valueSatoshis":10000,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"mutable","commitment":"0000000000000000000000000000000000943577000000000000000000000000"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"amount":20,"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c"}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10400}],"version":2},"sourceOutputs":[{"valueSatoshis":10400,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"commitment":"1400000000000000000000000000000000943577000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":0}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":10000,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":20}}]},"create":{"description":"Create an order book","name":"Create Orderbook","transaction":{"inputs":[{"unlockingBytecode":["slot"]},{},{}],"outputs":[{"lockingBytecode":"76a9141cb0e414e168062d46cc0e5799c71e3e4b3028cf88ac","token":{"category":"4ebdbcc129f3cd5759a5d3b76b908bf91f86666cd19793b1a48807fc7f11016c","amount":0,"nft":{"commitment":"0adf","capability":"minting"}},"valueSatoshis":1000},{"lockingBytecode":"aa202e84afbcdb5951e8d159969a2325f72abe0d62f686793e8283118d6e1fdd96e987","token":{"category":"4ebdbcc129f3cd5759a5d3b76b908bf91f86666cd19793b1a48807fc7f11016c","amount":0,"nft":{"commitment":"20a1070000000000000000000000008014000000000000000000000000000000","capability":"mutable"}},"valueSatoshis":800},{"lockingBytecode":"aa202e84afbcdb5951e8d159969a2325f72abe0d62f686793e8283118d6e1fdd96e987","token":{"category":"35c5f1fe73b627b70e11f8297eea49a0f074f33b201c37e7c21ff6027a84a795","amount":0},"valueSatoshis":800},{"lockingBytecode":"aa202e84afbcdb5951e8d159969a2325f72abe0d62f686793e8283118d6e1fdd96e987","token":{"category":"4ebdbcc129f3cd5759a5d3b76b908bf91f86666cd19793b1a48807fc7f11016c","amount":0,"nft":{"commitment":"a086010000000000000000000000000014000000000000000000000000000000","capability":"mutable"}},"valueSatoshis":800},{"lockingBytecode":"aa202e84afbcdb5951e8d159969a2325f72abe0d62f686793e8283118d6e1fdd96e987","token":{"category":"35c5f1fe73b627b70e11f8297eea49a0f074f33b201c37e7c21ff6027a84a795","amount":100000},"valueSatoshis":800},{"lockingBytecode":"76a9141cb0e414e168062d46cc0e5799c71e3e4b3028cf88ac","token":{"category":"35c5f1fe73b627b70e11f8297eea49a0f074f33b201c37e7c21ff6027a84a795","amount":2099999999900000},"valueSatoshis":800},{"lockingBytecode":"76a9141cb0e414e168062d46cc0e5799c71e3e4b3028cf88ac","valueSatoshis":100093052}],"version":2},"sourceOutputs":[{"lockingBytecode":["slot"],"valueSatoshis":1000,"token":{"category":"4ebdbcc129f3cd5759a5d3b76b908bf91f86666cd19793b1a48807fc7f11016c","nft":{"commitment":"0x0adf","capability":"minting"}}},{"lockingBytecode":"76a9141cb0e414e168062d46cc0e5799c71e3e4b3028cf88ac","valueSatoshis":100097016},{"lockingBytecode":"76a9141cb0e414e168062d46cc0e5799c71e3e4b3028cf88ac","valueSatoshis":1000,"token":{"category":"35c5f1fe73b627b70e11f8297eea49a0f074f33b201c37e7c21ff6027a84a795","amount":2100000000000000}}]},"withdraw":{"description":"Withdraw accumulated principal and tokens","extends":"base","name":"Withdraw","transaction":{"inputs":[{"unlockingBytecode":{"script":"wallet_unlock"}},{"unlockingBytecode":["slot"]}],"outputs":[{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"minting"}}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":100000000,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":100000000}}],"version":2},"sourceOutputs":[{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":800,"token":{"category":"dead00000000000000000000000000000000000000000000000000000000beef","nft":{"capability":"minting"}}},{"lockingBytecode":["slot"],"valueSatoshis":100000000,"token":{"category":"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c","amount":100000000}}]},"clear":{"data":{"bytecode":{"auth_category":"0x5263006eccd92d7dadbdced311b08e08f940c9c09fe09445d5789d8bd3d6c9aa","asset_category":"0xe9556bdf407a8bb7122ea1a04c8acfeb9ab9c2cb3682288114263ad2237851c6"}},"description":"Clear an order book","name":"Clear Orderbook","transaction":{"inputs":[{"unlockingBytecode":{"script":"wallet_unlock"}},{"unlockingBytecode":{"script":"unlock"}},{"unlockingBytecode":["slot"]},{"unlockingBytecode":{"script":"unlock"}},{"unlockingBytecode":{"script":"unlock"}},{"unlockingBytecode":{"script":"wallet_unlock"}},{"unlockingBytecode":{"script":"wallet_unlock"}}],"outputs":[{"lockingBytecode":{"script":"wallet_lock"},"token":{"category":"aac9d6d38b9d78d54594e09fc0c940f9088eb011d3cebdad7d2dd9cc6e006352","amount":0,"nft":{"commitment":"0x1234","capability":"minting"}},"valueSatoshis":1000},{"lockingBytecode":{"script":["copy"]},"token":{"category":"c6517823d23a261481288236cbc2b99aebcf8a4ca0a12e12b78b7a40df6b55e9","amount":2100000000000000},"valueSatoshis":800},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":100094709}]},"sourceOutputs":[{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":1000,"token":{"category":"aac9d6d38b9d78d54594e09fc0c940f9088eb011d3cebdad7d2dd9cc6e006352","amount":0,"nft":{"commitment":"1234","capability":"minting"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":10000800,"token":{"category":"aac9d6d38b9d78d54594e09fc0c940f9088eb011d3cebdad7d2dd9cc6e006352","amount":0,"nft":{"commitment":"20a1070000000000000000000000008014000000000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":["slot"],"valueSatoshis":800},{"valueSatoshis":800,"token":{"category":"aac9d6d38b9d78d54594e09fc0c940f9088eb011d3cebdad7d2dd9cc6e006352","amount":0,"nft":{"commitment":"a086010000000000000000000000000014000000000000000000000000000000","capability":"mutable"}}},{"lockingBytecode":{"script":"lock"},"valueSatoshis":800,"token":{"category":"c6517823d23a261481288236cbc2b99aebcf8a4ca0a12e12b78b7a40df6b55e9","amount":100000}},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":90093052},{"lockingBytecode":{"script":"wallet_lock"},"valueSatoshis":800,"token":{"category":"c6517823d23a261481288236cbc2b99aebcf8a4ca0a12e12b78b7a40df6b55e9","amount":2099999999900000}}]}}'),Ua={unlock:{fails:["overbuy_order_asset","overbuy_order_baton","misexcise_sell_order_asset"],passes:["clear","excise_buy_order_baton","excise_buy_order_asset","excise_sell_order_baton","excise_sell_order_asset","excise_sell_order_asset_two","withdraw"],name:"Swap or Administer",script:"",unlocks:"lock"},wallet_unlock:{passes:["create"],name:"Wallet Unlock",script:"<key.schnorr_signature.all_outputs> <key.public_key>",unlocks:"wallet_lock"},wallet_lock:{lockingType:"standard",name:"Wallet Lock",script:"OP_DUP OP_HASH160 <$(<key.public_key> OP_HASH160)> OP_EQUALVERIFY OP_CHECKSIG"},lock:{lockingType:"p2sh32",name:"CatDex Blackboard",script:`// CatDex - A token category authorized decentralized exchange
//
// 2025-11-22 Pre-alpha, pre-audit
//
// Trade fungible tokens at fixed prices based on orders expressed in NFT commitments

<asset_category> <auth_category>

// pragma cashscript ^0.10.0;
// contract CatDex(bytes32 authCat, bytes32 assetCat){

    // function swap(){
        // If the first input has a minting baton (owner),
        //   the spending of outputs is unrestricted. 
        OP_0 OP_UTXOTOKENCATEGORY OP_OVER OP_2 OP_CAT OP_EQUAL OP_IF
        // if(tx.inputs[0].tokenCategory == authCat + 0x02){
            // pass 
        // }

        // If the order input (even input) is a mutable auth Baton ... 
        OP_ELSE    
        // else{
            // Push the index of this order baton to the stack
            OP_INPUTINDEX OP_INPUTINDEX OP_2 OP_MOD OP_SUB 
            // int orderIndex = this.activeInputIndex - (this.activeInputIndex % 2);  

            // require the order is authenticated by  a mutable baton 
            OP_DUP OP_OUTPUTTOKENCATEGORY OP_2 OP_PICK OP_1 OP_CAT OP_EQUALVERIFY
            // require(tx.outputs[orderIndex].tokenCategory ==  authCat + 0x01);

            // Require the order is auth lives on
            OP_DUP OP_UTXOTOKENCATEGORY OP_OVER OP_OUTPUTTOKENCATEGORY OP_EQUALVERIFY 
            // require(tx.inputs[orderIndex].tokenCategory == tx.outputs[orderIndex].tokenCategory);

            // Require the order baton be passed back to the contract
            OP_DUP OP_OUTPUTBYTECODE OP_OVER OP_UTXOBYTECODE OP_EQUALVERIFY 
            // require(tx.outputs[orderIndex].lockingBytecode == 
            //          tx.inputs[orderIndex].lockingBytecode);

            // Get the next index of the asset thread
            OP_DUP OP_1ADD 
            // int assetIndex = orderIndex + 1; 

            // Require the asset thread be sent at the current contract
            OP_DUP OP_OUTPUTBYTECODE OP_OVER OP_OUTPUTBYTECODE OP_EQUALVERIFY 
            // require(tx.outputs[assetIndex].lockingBytecode == 
            //         tx.outputs[assetIndex].lockingBytecode);                 
                        
            
            // if the amount of tokens is greater than zero,
            OP_DUP OP_OUTPUTTOKENAMOUNT OP_0 OP_GREATERTHAN OP_IF 
            // if(tx.outputs[assetIndex].tokenAmount > 0){
              // require the asset output contain token category specified by the order
              OP_DUP OP_OUTPUTTOKENCATEGORY OP_4 OP_PICK OP_EQUALVERIFY
            //   require(tx.outputs[assetIndex].tokenCategory == assetCat);
            // } 
            OP_ENDIF 

            // Parse the order data from the NFT commitment
            OP_OVER OP_UTXOTOKENCOMMITMENT OP_16 OP_SPLIT 
            // bytes quantityBin, bytes priceBin = 
            //               tx.inputs[orderIndex].nftCommitment.split(16);

            OP_OVER OP_BIN2NUM 
            // int orderQuantity = int(quantityBin);  

            OP_OVER OP_BIN2NUM 
            // int price = int(priceBin);

            // Get the amount of the token traded
 
            OP_4 OP_PICK OP_OUTPUTTOKENAMOUNT OP_5 OP_PICK OP_UTXOTOKENAMOUNT OP_SUB 
            // int tradeQuantity = tx.outputs[assetIndex].tokenAmount - 
            //                      tx.inputs[assetIndex].tokenAmount;

            // Verify new authCat order baton NFT commitment
            OP_2 OP_PICK OP_OVER OP_SUB OP_16 OP_NUM2BIN OP_2 OP_PICK OP_16 OP_NUM2BIN OP_CAT 
            // bytes32 nextCommitment = bytes16(orderQuantity-tradeQuantity) + bytes16(price);

            // Require updating order baton
            OP_7 OP_PICK OP_OUTPUTTOKENCOMMITMENT OP_OVER OP_EQUALVERIFY 
            // require(tx.outputs[orderIndex].nftCommitment == nextCommitment);

            // require the sign of the quantity traded matches the order sign  
            OP_OVER OP_0 OP_GREATERTHAN OP_4 OP_PICK OP_0 OP_GREATERTHAN OP_EQUALVERIFY
            // require((tradeQuantity > 0 == orderQuantity > 0)); 

            // require the amount traded be less than (or equal to) the quantity available
            OP_OVER OP_ABS OP_4 OP_PICK OP_ABS OP_LESSTHANOREQUAL OP_VERIFY 
            // require(abs(tradeQuantity) <= abs(orderQuantity));

            // Verify the value returned with the order exceeds the quantity traded times the price.
            OP_7 OP_PICK OP_OUTPUTVALUE OP_8 OP_PICK OP_UTXOVALUE OP_SUB
            OP_2OVER OP_SWAP OP_MUL <100_000_000> OP_DIV OP_NEGATE OP_GREATERTHANOREQUAL OP_VERIFY 
            // require((tx.outputs[orderIndex].value - tx.inputs[orderIndex].value) >= -(tradeQuantity*price/100_000_000));

        // } 
       OP_2DROP OP_2DROP OP_2DROP OP_2DROP
    // } 
    OP_ENDIF 
// } 
OP_2DROP OP_1`}},Na=["BCH_2024_05","BCH_2025_05"],Ca={$schema:Sa,description:wa,name:Ia,entities:Ea,scenarios:Aa,scripts:Ua,supported:Na},Ra="@unspent/catdex",qa={name:Ra},a0=1e8;class V{static USER_AGENT=qa.name;static PROTOCOL_IDENTIFIER="U3X";static tokenAware=!0;static template=Ca;static compiler=K0(this.template);static vm=ra();static getLockingBytecode(e,t){typeof e=="string"&&(e=U(e)),typeof t=="string"&&(t=U(t));const n=this.compiler.generateBytecode({data:{bytecode:{auth_category:new Uint8Array(e).reverse(),asset_category:new Uint8Array(t).reverse()}},scriptId:"lock"});if(!n.success)throw new Error("Failed to generate bytecode, script: , "+JSON.stringify(n,null,"  "));return n.bytecode}static getScriptHash(e,t,n=!0){return s0(this.getLockingBytecode(e,t),n)}static getAddress(e,t,n="bitcoincash"){return Y0(this.getLockingBytecode(e,t),n,this.tokenAware)}static getCatDexOrdersFromUtxos(e,t,n=!0){typeof e!="string"&&(e=Ee(e));let s=t.filter(l=>l.token_data&&l.token_data?.category!=e).map(l=>{let u=this.parseNFT(l.token_data?.nft?.commitment);return{authCategory:U(l.token_data?.category),assetCategory:U(e),orderUtxo:l,assetUtxo:void 0,price:u.price,quantity:u.quantity,value:l.value,amount:void 0}});s.sort((l,u)=>Number(u.price)-Number(l.price)),n&&(s=s.filter(l=>l.quantity!=0n));let m=[];for(let l of s){let u=t.findIndex(P=>P.tx_hash==l.orderUtxo.tx_hash&&P.tx_pos==l.orderUtxo.tx_pos+1);if(u==-1)throw"Couldn't find matching asset thread";let O={};O={assetUtxo:t[u],amount:t[u]?.token_data?t[u].token_data.amount:0n},m.push({...l,...O})}return m}static getSourceOutput(e,t,n){return{lockingBytecode:this.getLockingBytecode(e,t),valueSatoshis:BigInt(n.value),token:n.token_data?{category:U(n.token_data.category),amount:BigInt(n.token_data.amount),nft:n.token_data.nft?{commitment:U(n.token_data.nft.commitment),capability:n.token_data.nft.capability}:void 0}:void 0}}static parseNFT(e){typeof e=="string"&&(e=U(e));let t=Kt(e.slice(0,16),{requireMinimalEncoding:!1}),n=Kt(e.slice(-16),{requireMinimalEncoding:!1});return{quantity:BigInt(t),price:Number(n)/a0}}static encodeNFT(e){return new Uint8Array([...Yt(Qt(BigInt(e.quantity)),16),...Yt(Qt(BigInt(Math.trunc(e.price*a0))),16)])}static getInput(e,t,n){return typeof e=="string"&&(e=U(e)),typeof t=="string"&&(t=U(t)),{outpointIndex:n.tx_pos,outpointTransactionHash:U(n.tx_hash),sequenceNumber:0,unlockingBytecode:{data:{bytecode:{auth_category:new Uint8Array(e).reverse(),asset_category:new Uint8Array(t).reverse()}},compiler:this.compiler,script:"unlock",valueSatoshis:BigInt(n.value),token:n.token_data?{category:U(n.token_data.category),amount:BigInt(n.token_data.amount),nft:n.token_data.nft?{commitment:U(n.token_data.nft.commitment),capability:n.token_data.nft.capability}:void 0}:void 0}}}static getOrderOutput(e,t){let n=this.getLockingBytecode(e.authCategory,e.assetCategory),o=0n;return e.amount>0?o=BigInt(e.assetUtxo.token_data.amount)-t:o=-t,[{lockingBytecode:n,valueSatoshis:BigInt(e.orderUtxo.value)+BigInt(Number(t)*e.price),token:{amount:0n,category:U(e.orderUtxo.token_data.category),nft:{commitment:V.encodeNFT({quantity:e.quantity+t,price:e.price}),capability:"mutable"}}},{lockingBytecode:n,valueSatoshis:800n,token:o!=0n?{category:e.assetCategory,amount:BigInt(o)}:void 0}]}static orderRequestToOutputs(e,t,n){let o=this.getLockingBytecode(e,t);typeof e=="string"&&(e=U(e)),typeof t=="string"&&(t=U(t));let s=800n,m=0n;n.quantity>0n&&(s+=BigInt(Math.trunc(n.price*Number(n.quantity)))),n.quantity<0n&&(m=-BigInt(n.quantity));const l=this.encodeNFT(n);let u=[{lockingBytecode:o,valueSatoshis:s,token:{category:e,amount:0n,nft:{commitment:l,capability:"mutable"}}}];return u.push({lockingBytecode:o,valueSatoshis:800n,token:m>0n?{category:t,amount:m}:void 0}),u}static getWalletSourceOutput(e,t,n=0){return{lockingBytecode:t?j0({addressIndex:n,hdPrivateKey:t,throwErrors:!0}):Uint8Array.from(Array(33)),valueSatoshis:BigInt(e.value),token:e.token_data?{category:U(e.token_data.category),amount:BigInt(e.token_data.amount),nft:e.token_data.nft?{commitment:U(e.token_data.nft.commitment),capability:e.token_data.nft.capability}:void 0}:void 0}}static getWalletInput(e,t,n=0){let o=t?{compiler:this.compiler,data:{hdKeys:{addressIndex:n,hdPrivateKeys:{wallet:t}}},script:"wallet_unlock",valueSatoshis:BigInt(e.value),token:e.token_data?{category:U(e.token_data.category),amount:BigInt(e.token_data.amount),nft:e.token_data.nft?{commitment:U(e.token_data.nft.commitment),capability:e.token_data.nft.capability}:void 0}:void 0}:Uint8Array.from(Array());return{outpointIndex:e.tx_pos,outpointTransactionHash:U(e.tx_hash),sequenceNumber:0,unlockingBytecode:o}}static getAuthWalletOutput(e,t,n=0){return{lockingBytecode:t?{compiler:this.compiler,data:{hdKeys:{addressIndex:n,hdPublicKeys:{wallet:zt(t).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:BigInt(e.value),token:e.token_data?{category:U(e.token_data.category),amount:BigInt(e.token_data.amount),nft:e.token_data.nft?{commitment:U(e.token_data.nft.commitment),capability:e.token_data.nft.capability}:void 0}:void 0}}static getChangeOutput(e,t,n,o,s=0){return n&&typeof n!="string"&&(n=Ee(n)),{lockingBytecode:o?{compiler:this.compiler,data:{hdKeys:{addressIndex:s,hdPublicKeys:{wallet:zt(o).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:e,token:t>0&&n?{category:U(n),amount:t}:void 0}}static getAuthLayers(e,t,n=0){let o=[],s=[],m=[];return m.push(this.getWalletSourceOutput(e,t,n)),o.push(this.getWalletInput(e,t,n)),s.push(this.getAuthWalletOutput(e,t,n)),{inputs:o,outputs:s,sourceOutputs:m}}static setBlackBoardLayers(e,t,n,o,s=[]){let m=[],l=[];return m.push(...n.map(u=>this.getInput(e,t,u))),s.push(...n.map(u=>this.getSourceOutput(e,t,u))),l.push(...o.map(u=>this.orderRequestToOutputs(e,t,u)).flat()),{inputs:m,outputs:l,sourceOutputs:s}}static getBlackBoardLayers(e,t,n=[]){let o=[],s=[];if(e=e.filter(u=>Math.sign(Number(u.quantity))!=Math.sign(Number(t))),e.length==0)throw Error("no orders left, maximum recursion depth reached.");const m=t>0?(u,O)=>Number(u.price-O.price):(u,O)=>Number(u.price+O.price);e.sort(m);const l=e.shift();if(!l)throw Error("No matching best order found.");if(!l.assetUtxo)throw Error("Order missing asset utxo");if(o.push(this.getInput(l.authCategory,l.assetCategory,l.orderUtxo)),o.push(this.getInput(l.authCategory,l.assetCategory,l.assetUtxo)),n.push(this.getSourceOutput(l.authCategory,l.assetCategory,l.orderUtxo)),n.push(this.getSourceOutput(l.authCategory,l.assetCategory,l.assetUtxo)),Math.abs(Number(t))<=Math.abs(Number(l.quantity)))s.push(...this.getOrderOutput(l,t));else{s.push(...this.getOrderOutput(l,-l.quantity)),t+=l.quantity;let u=this.getBlackBoardLayers([...e],t,[...n]);o.push(...u.inputs),s.push(...u.outputs),n=u.sourceOutputs}return{inputs:o,outputs:s,sourceOutputs:n}}static getWalletInputs(e,t,n,o,s=[]){let m=[],l=[];if(o&&typeof o!="string"&&(o=Ee(o)),o?(console.log(e),e=e.filter(B=>B.token_data&&B.token_data?.category==o).filter(B=>B.token_data&&!B.token_data.nft),console.log(e)):e=e.filter(B=>!B.token_data),e.length==0)throw Error("no wallet utxos left, maximum recursion depth reached.");const u=Math.floor(Math.random()*e.length),O=e[u];e.splice(u,1),m.push(this.getWalletInput(O,n)),s.push(this.getWalletSourceOutput(O,n));let P=ie(s),_=Z(s,o);if(o&&_<t||!o&&P<t){let B=this.getWalletInputs([...e],t,n,o,[...s]);m.push(...B.inputs),l.push(...B.outputs),s=B.sourceOutputs}return{inputs:m,outputs:l,sourceOutputs:s}}static getWalletLayers(e,t,n,o,s){let m=Gt(t.outputs),l=ie(n),u=m-l;const O=this.getWalletInputs(o,u,s);t.inputs.push(...O.inputs),n.push(...O.sourceOutputs);let P=Xt(t.outputs,e),_=Z(n,e),B=P-_;if(console.log("Tokens required:",B),B>0n){const H=this.getWalletInputs(o,B,s,e);t.inputs.push(...H.inputs),n.push(...H.sourceOutputs)}m=Gt(t.outputs),l=ie(n);let h=l-m;P=Xt(t.outputs,e),_=Z(n,e);let T=_-P;return T>0&&(t.outputs.push(this.getChangeOutput(800n,T,e,s)),h-=800n),t.outputs.push(this.getChangeOutput(h,0n,void 0,s)),t}static administer(e,t,n,o,s,m,l=0,u=1){let _={locktime:0,version:2,inputs:[],outputs:[]},B=e.token_data.category;const h=this.getAuthLayers(e,m,l);_.inputs.push(...h.inputs),_.outputs.push(...h.outputs);let T=h.sourceOutputs;const H=this.setBlackBoardLayers(B,t,n,o);_.inputs.push(...H.inputs),_.outputs.push(...H.outputs),T.push(...H.sourceOutputs),_=this.getWalletLayers(t,_,T,s,m);let E=$e(_);if(!E.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(E.errors,null,"  "));const D=Jt(E.transaction,u),A=_.outputs.length-1;if(_.outputs[A].valueSatoshis=_.outputs[A].valueSatoshis-D,E=$e(_),!E.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(E.errors,null,"  "));const L=E.transaction,z=jt(L,T,{maximumTokenCommitmentLength:40});if(z!==!0&&u>0)throw z;let M=this.vm.verify({sourceOutputs:T,transaction:L});if(typeof M=="string")throw Error(M);let ce=ie(T)-ie(L.outputs);ce>5e3&&(M=`Excessive fees ${ce}`),Z(T,t)==0n&&(M="Error checking token input");let le=Z(T,t)-Z(L.outputs,t);return le!==0n&&(M=`Swapping should not create destroy tokens, token difference: ${le}`),{sourceOutputs:T,transaction:L,verify:M}}static swap(e,t,n,o,s=1){const m=[],l=[];let u=[],O=Ee(t[0]?.assetCategory);if(new Set(t.map(M=>Ee(M.assetCategory))).size>1)throw"A catdex swap may only trade one asset at a time, mixed assets found.";let _={locktime:0,version:2,inputs:m,outputs:l};n=n.filter(M=>M.token_data?.category==O||!M.token_data);let B=this.getBlackBoardLayers(t,e,u);_.inputs.push(...B.inputs),_.outputs.push(...B.outputs),u=B.sourceOutputs,_=this.getWalletLayers(O,_,u,n,o);let h=$e(_);if(!h.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(h.errors,null,"  "));const T=Jt(h.transaction,s),H=_.outputs.length-1;if(_.outputs[H].valueSatoshis=_.outputs[H].valueSatoshis-T,h=$e(_),!h.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(h.errors,null,"  "));const E=h.transaction,D=jt(E,u,{maximumTokenCommitmentLength:40});if(D!==!0&&s>0)throw D;let A=this.vm.verify({sourceOutputs:u,transaction:E}),L=ie(u)-ie(E.outputs);L>5e3&&(A=`Excessive fees ${L}`),Z(u,O)==0n&&(A="Error checking token input");let z=Z(u,O)-Z(E.outputs,O);return z!==0n&&(A=`Swapping should not create destroy tokens, token difference: ${z}`),{sourceOutputs:u,transaction:E,verify:A}}}async function n0(p,e){let t=(await X0(J0,e.map(o=>[p,o]))).flat();var n=new Map;return t.map(o=>n.set(o.tx_hash+":"+o.tx_pos,o)),n}var Da=g('<meta name="description" content="CatDex - a decentralized limit order exchange and dex aggregator on Bitcoin Cash."/>'),La=g('<div class="trollbox svelte-umdsn1"><!> <label class="switch svelte-umdsn1">Hide <input type="checkbox" class="svelte-umdsn1"/> <span class="slider round svelte-umdsn1"></span></label></div>'),Ma=g("<img/>"),Fa=g('<img alt="Disconnected"/>'),Ha=(p,e)=>e(),Va=g("<option> </option>"),Wa=g('<div class="swap svelte-umdsn1"><div class="svelte-umdsn1"><img width="50"/> <br/> </div> <div class="svelte-umdsn1"><img width="50"/> <br/> </div></div>'),Ka=(p,e)=>e(),Ya=g('<div class="swap svelte-umdsn1"><label>Swap amount:</label> <input type="number" min="0" max="10"/></div>'),Qa=g('<div class="swap svelte-umdsn1"><p><a href="/wallet">Deposit funds</a> to trade assets.</p></div>'),za=g('<div class="swap svelte-umdsn1"><button class="svelte-umdsn1">Broadcast</button></div> <!>',1),Ga=(p,e)=>e(4364),Xa=(p,e)=>e(52596),Ja=g("<b> </b>"),ja=g("<b> </b>"),Za=g('<div><p>You have a CatDex baton. <br/> For others to can find your orders, announce your membership in the CatDex.</p> <button class="svelte-umdsn1">Month (4364 sats)</button> <button class="svelte-umdsn1">Year (52596 sats)</button> <p>Membership fees are non-refundable and are claimed by miners.</p> <!></div> <br/>',1),$a=g('<a href="/wallet">Deposit funds</a> to create a CatDex authentication baton.',1),en=(p,e)=>e(),tn=g('<p>To write orders, you need to create a CatDex Authentication Baton (1000 sats).</p> <button class="svelte-umdsn1">Create a new Baton</button>',1),an=g('<div class="svelte-umdsn1"><img width="24"/> <br/> </div>'),nn=g('<div class="svelte-umdsn1"><img width="24"/> <br/> </div>'),on=(p,e)=>e(!0),sn=(p,e)=>e(),rn=g('<button class="svelte-umdsn1">Replace Orders</button> <button class="svelte-umdsn1">Append Orders</button>',1),cn=(p,e)=>e(!0),ln=(p,e)=>e(0),dn=g('<button class="svelte-umdsn1">Clear Orders</button> <button class="svelte-umdsn1">New Orders</button><br/>',1),un=g('<div class="orders svelte-umdsn1"><div class="in svelte-umdsn1"><b>type</b></div> <div class="in svelte-umdsn1"><b>price</b></div> <div class="in svelte-umdsn1"><b>quantity</b></div> <div class="in svelte-umdsn1"></div> <div class="listButtons svelte-umdsn1"></div></div>'),vn=g('<div class="orders svelte-umdsn1"><div class="in svelte-umdsn1"><!></div> <div class="in svelte-umdsn1"><input type="number" placeholder="sats per" min="1" max="100000" class="svelte-umdsn1"/></div> <div class="in svelte-umdsn1"><input name="quantity" placeholder="qty" type="number" class="svelte-umdsn1"/> <!></div> <div class="in svelte-umdsn1"><!></div> <div class="listButtons svelte-umdsn1"><button class="svelte-umdsn1">+</button> <button class="svelte-umdsn1">-</button></div></div>'),fn=g("<p>Sell is negative quantity.<br/> All prices in satoshis</p>"),mn=g('<h3>Your Decentralized Listing</h3> <!> <div class="swap svelte-umdsn1"><!> <!></div> <!> <br/> <!> <!> <!> <!> <br/>',1),pn=g("<br/> <div><!> <!></div>",1),bn=g("<div><!></div>"),_n=g('<b>Asset:</b> <select></select> <br/> <!> <br/> <!> <br/> <!> <div class="orderBooks svelte-umdsn1"><div class="svelte-umdsn1"></div> <div class="askBook svelte-umdsn1"></div></div> <h3>Advanced</h3> <label class="switch svelte-umdsn1"><input type="checkbox" class="svelte-umdsn1"/> <span class="slider round svelte-umdsn1"></span></label> <br/> <!> <br/> <br/> <h3>Makers</h3> <div class="grid svelte-umdsn1"></div>',1),gn=g('<div class="swap svelte-umdsn1"><p>Not connected.</p></div>'),hn=g('<!> <section><div class="status svelte-umdsn1"><!> <!></div> <h1>Trade CashTokens</h1> <!> <h3>Chat</h3> <label class="switch svelte-umdsn1"><input type="checkbox" class="svelte-umdsn1"/> <span class="slider round svelte-umdsn1"></span></label> <!></section>',1);function Jn(p,e){xt(e,!0);let t=w(fe(e.data.asset)),n=w(0),o=w(""),s,m=w(""),l=w(0n),u=w(""),O;fe([]);let P=w(fe([])),_=w(fe([])),B=w(fe([])),h=w(fe([])),T=w(void 0),H=w(void 0),E=w(void 0),D=w(0),A=w(fe([])),L=w(fe([])),z=w(fe([])),M=w(!1),ce=w(!1),le="",de=w(void 0),Ae=w(!1),he=w(void 0),ye=w(""),ke=w(0),ue=w(0n);const ee=V0.url.hostname=="vox.cash",Oe=ee?"BCH":"tBCH",Je=ee?"bch.imaginary.cash":"chipnet.bch.ninja",tt=ee?oa:sa,_e=ee?r0:i0;typeof a(t)!="string"&&f(t,ee?"7fe0cd5197494e47ade81eb164dcdbd51859ffbe581fe4a818085d56b2f3062c":"ffc9d3b3488e890ef113b1c74f40e1f5eb1147a7d4191cecac89fd515721a271",!0);const te=kt(`OP_RETURN <"${V.PROTOCOL_IDENTIFIER}">`);let R;const q=Object.entries(tt.identities).map(i=>Object.values(Object.values(i[1]))).flat().filter(i=>i.extensions&&i.extensions.exchanges=="catdex").reduce((i,v)=>(i.set(v.token.category,v),i),new Map),Be=()=>{clearTimeout(O),O=setTimeout(()=>{xe(),ae()},1500)};async function ae(){if(s&&a(n)>1e3){let i=await s.request("blockchain.scripthash.listunspent",et.getScriptHash(V.PROTOCOL_IDENTIFIER),"include_tokens");f(z,i.map(j=>j.token_data?.category).filter((j,Ne,ot)=>ot.indexOf(j)===Ne),!0);let v=a(z).map(j=>V.getScriptHash(j,a(t))),J=await n0(s,v),W=Array.from(J.values());if(f(_,V.getCatDexOrdersFromUtxos(a(t),W),!0),a(A).length>0){let j=await n0(s,[V.getScriptHash(a(A)[0].token_data.category,a(t))]);f(L,Array.from(j.values()),!0),f(H,Ot(a(L),a(t)),!0),f(E,Zt(a(L)),!0),f(B,V.getCatDexOrdersFromUtxos(a(t),a(L)),!0)}}}const xe=async function(){let i=await s.request("blockchain.scripthash.listunspent",a(m),"include_tokens");if(i instanceof Error)throw i;f(A,i.filter(v=>v.token_data&&v.token_data.nft&&v.token_data.nft.commitment.startsWith(te)),!0),typeof a(t)=="string"?(f(P,i.filter(v=>!v.token_data||v.token_data.category==a(t)),!0),f(ue,Ot(a(P),a(t)),!0)):(f(P,i.filter(v=>!v.token_data),!0),f(ue,0n)),f(ke,Zt(a(P),!0),!0)},Ve=async function(){await R.sendMax(R.getDepositAddress());let i=kt(`OP_RETURN <"${V.PROTOCOL_IDENTIFIER}"> <"markets are made">`);await R.tokenGenesis({cashaddr:R.getTokenDepositAddress(),commitment:i,capability:e0.minting,value:800})},Ue=async function(i){let v=kt('OP_RETURN <"markets are made">');await R.tokenMint(a(A)[0].token_data.category,[new na({cashaddr:et.getAddress(V.PROTOCOL_IDENTIFIER),commitment:v,capability:e0.none,value:i})])},F=async function(){await xe(),await ae(),typeof a(t)=="string"?(H0(`?asset=${a(t)}`,{keepFocus:!0}),f(ue,Ot(a(P),a(t)),!0)):f(ue,0n)},G=function(i){if(a(h).length+1==i)a(h).splice(i,0,{quantity:void 0,price:void 0});else if(a(h).length>=2){let v=a(h).slice(-2);a(h).push({quantity:v[1].quantity-(v[0].quantity-v[1].quantity),price:v[1].price-(v[0].price-v[1].price)})}else a(h).push({quantity:void 0,price:void 0})},We=function(i){a(h).splice(i,1)},Pe=async function(i=!1){let v=i?a(L):[],J=V.administer(a(A)[0],a(t),v,a(h),a(P),a(o)),W=Ee($t(J.transaction));(await Tt(W)).length==64&&f(h,[],!0)},l0=function(){if(a(l))try{let i=V.swap(BigInt(a(l)),a(_),a(P),a(o));f(de,i.transaction,!0),f(he,i.sourceOutputs,!0),le=Ee($t(a(de))),f(Ae,i.verify===!0,!0),i.verify===!0&&f(ye,"")}catch(i){f(de,void 0),f(he,void 0),le="",f(Ae,!1),f(ye,i,!0)}},Tt=async function(i){let v=await s.request("blockchain.transaction.broadcast",i);if(v instanceof Error)throw f(u,t0[s.status],!0),f(ye,v.message,!0),v;return f(de,void 0),f(he,void 0),le="",f(Ae,!1),v},d0=function(i){if(f(u,t0[s.status],!0),i.method==="blockchain.headers.subscribe"){let v=i.params[0];f(n,v.height,!0),ae(),xe()}else i.method==="blockchain.scripthash.subscribe"?Be():console.log(i)};A0(async()=>{$0.StorageProvider=Z0,R=ee?await ea.named("vox"):await ta.named("vox"),f(o,aa(R.mnemonic,R.derivationPath.slice(0,-2),R.isTestnet),!0);let i=Q0(R.getDepositAddress());if(typeof i=="string")throw i;f(m,s0(i.bytecode),!0),s=new da(V.USER_AGENT,"1.4.1",Je),await s.connect(),s.on("notification",d0),await s.subscribe("blockchain.headers.subscribe"),await s.subscribe("blockchain.scripthash.subscribe",a(m));let v=await s.request("blockchain.scripthash.listunspent",et.getScriptHash(V.PROTOCOL_IDENTIFIER),"include_tokens");f(z,v.map(W=>W.token_data?.category),!0),f(T,v.filter(W=>W.token_data?.category==a(A)[0].token_data.category).pop(),!0),a(T)?a(T).height<=0?f(D,1e3):a(T).height>0?f(D,a(T).height+a(T).value-a(n)):f(D,0):f(D,0),a(z).map(W=>V.getScriptHash(W,a(t))).map(async W=>{await s.subscribe("blockchain.scripthash.subscribe",W)}),await s.subscribe("blockchain.scripthash.subscribe",et.getScriptHash(V.PROTOCOL_IDENTIFIER))}),U0(async()=>{await R.provider.disconnect(),await s.disconnect()});var St=hn();F0(i=>{var v=Da();D0.title=" CatDex",b(i,v)});var wt=re(St);{var u0=i=>{var v=La(),J=d(v);W0(J,{get topic(){return V.PROTOCOL_IDENTIFIER}});var W=c(J,2),j=c(d(W));He(j),me(2),r(W),r(v),gt(j,()=>a(ce),Ne=>f(ce,Ne)),b(i,v)};N(wt,i=>{a(ce)&&i(u0)})}var It=c(wt,2),at=d(It),Et=d(at);ia(Et,{get template(){return V.template}});var v0=c(Et,2);{var f0=i=>{var v=Ma();K(()=>{se(v,"src",ca),se(v,"alt",a(u))}),b(i,v)},m0=i=>{var v=Fa();K(()=>se(v,"src",la)),b(i,v)};N(v0,i=>{a(u)=="CONNECTED"?i(f0):i(m0,!1)})}r(at);var At=c(at,4);{var p0=i=>{var v=_n(),J=c(re(v),2);J.__change=[Ha,F],pe(J,21,()=>q.keys(),be,(y,S)=>{var I=Va(),Q={},Te=d(I,!0);r(I),K(Ce=>{Q!==(Q=a(S))&&(I.value=(I.__value=a(S))??""),C(Te,Ce)},[()=>q.get(a(S)).name]),b(y,I)}),r(J);var W=c(J,4);{var j=y=>{var S=Wa(),I=d(S),Q=d(I),Te=c(Q,3);r(I);var Ce=c(I,2),Ke=d(Ce),ct=c(Ke,3);r(Ce),r(S),K(($,ge,Re,qe,ne)=>{se(Q,"src",_e),se(Q,"alt",Oe),C(Te,` ${$??""} sats ${Oe}`),se(Ke,"src",ge),se(Ke,"alt",Re),C(ct,` ${qe??""}
					${ne??""}`)},[()=>a(ke).toLocaleString(),()=>q.get(a(t)).uris.icon,()=>q.get(a(t)).token.symbol,()=>(a(ue)/BigInt(Math.pow(10,q.get(a(t)).token.decimals))).toLocaleString(),()=>q.get(a(t)).token.symbol]),b(y,S)};N(W,y=>{a(t)&&y(j)})}var Ne=c(W,4);{var ot=y=>{var S=Ya(),I=c(d(S),2);He(I),I.__change=[Ka,l0],r(S),ht(I,()=>a(l),Q=>f(l,Q)),b(y,S)},g0=y=>{var S=Qa();b(y,S)};N(Ne,y=>{a(ke)>0?y(ot):y(g0,!1)})}var Nt=c(Ne,4);{var h0=y=>{var S=za(),I=re(S),Q=d(I);Q.__click=()=>Tt(le),r(I);var Te=c(I,2);ya(Te,{get transaction(){return a(de)},get sourceOutputs(){return a(he)},get category(){return a(t)}}),b(y,S)};N(Nt,y=>{a(de)&&a(Ae)&&y(h0)})}var Ct=c(Nt),st=c(Ct),rt=d(st);pe(rt,21,()=>a(_).filter(y=>y.quantity>0),be,(y,S)=>{Bt(y,yt(()=>a(S),{get assetCategory(){return a(t)}},()=>({isMainnet:ee})))}),r(rt);var Rt=c(rt,2);pe(Rt,21,()=>a(_).filter(y=>y.quantity<0).toReversed(),be,(y,S)=>{Bt(y,yt(()=>a(S),{get assetCategory(){return a(t)}},()=>({isMainnet:ee})))}),r(Rt),r(st);var it=c(st,4),qt=d(it);He(qt),me(2),r(it);var Dt=c(it,4);{var y0=y=>{var S=pn(),I=c(re(S),2),Q=d(I);{var Te=$=>{var ge=Za(),Re=re(ge),qe=c(d(Re),2);qe.__click=[Ga,Ue];var ne=c(qe,2);ne.__click=[Xa,Ue];var Se=c(ne,4);{var De=ve=>{var we=Ja(),Qe=d(we);r(we),K(()=>C(Qe,`Membership expires in ${a(D)??""} blocks. Renew now to have your orders discoverable.`)),b(ve,we)},Ye=(ve,we)=>{{var Qe=ze=>{var Le=ja(),je=d(Le);r(Le),K(()=>C(je,`Membership expired ${a(D)??""} blocks ago. Renew now to keep your orders discoverable.`)),b(ze,Le)};N(ve,ze=>{a(D)<-2&&ze(Qe)},we)}};N(Se,ve=>{a(D)>0?ve(De):ve(Ye,!1)})}r(Re),me(2),b($,ge)};N(Q,$=>{a(A).length>0&&a(D)<1e3&&$(Te)})}var Ce=c(Q,2);{var Ke=$=>{var ge=$a();me(),b($,ge)},ct=($,ge)=>{{var Re=ne=>{var Se=tn(),De=c(re(Se),2);De.__click=[en,Ve],b(ne,Se)},qe=ne=>{var Se=mn(),De=c(re(Se),2);pe(De,17,()=>a(A),be,(x,k)=>{Ge(x,{size:24,get category(){return a(k).token_data.category}})});var Ye=c(De,2),ve=d(Ye);{var we=x=>{var k=an(),Y=d(k),oe=c(Y,3);r(k),K(Ie=>{se(Y,"src",_e),se(Y,"alt",Oe),C(oe,` ${Ie??""} sats ${Oe}`)},[()=>a(E).toLocaleString()]),b(x,k)};N(ve,x=>{a(E)&&x(we)})}var Qe=c(ve,2);{var ze=x=>{var k=nn(),Y=d(k),oe=c(Y,3);r(k),K((Ie,lt,dt,ut)=>{se(Y,"src",Ie),se(Y,"alt",lt),C(oe,` ${dt??""}
								${ut??""}`)},[()=>q.get(a(t)).uris.icon,()=>q.get(a(t)).token.symbol,()=>(a(H)/BigInt(Math.pow(10,q.get(a(t)).token.decimals))).toLocaleString(),()=>q.get(a(t)).token.symbol]),b(x,k)};N(Qe,x=>{a(H)&&x(ze)})}r(Ye);var Le=c(Ye,2);pe(Le,17,()=>a(B),be,(x,k)=>{Bt(x,yt(()=>a(k),{get assetCategory(){return a(t)}},()=>({isMainnet:ee})))});var je=c(Le,4);{var k0=x=>{var k=rn(),Y=re(k);Y.__click=[on,Pe];var oe=c(Y,2);oe.__click=[sn,Pe],b(x,k)},O0=x=>{var k=dn(),Y=re(k);Y.__click=[cn,Pe];var oe=c(Y,2);oe.__click=[ln,G],me(),b(x,k)};N(je,x=>{a(h).length>0?x(k0):x(O0,!1)})}var Mt=c(je,2);{var B0=x=>{var k=un();b(x,k)};N(Mt,x=>{a(h).length>0&&x(B0)})}var Ft=c(Mt,2);pe(Ft,17,()=>a(h),be,(x,k,Y)=>{var oe=vn(),Ie=d(oe),lt=d(Ie);{var dt=X=>{var Me=Ze("BID");b(X,Me)},ut=(X,Me)=>{{var bt=Fe=>{var _t=Ze("ASK");b(Fe,_t)},E0=Fe=>{var _t=Ze("-");b(Fe,_t)};N(X,Fe=>{a(k).quantity<0?Fe(bt):Fe(E0,!1)},Me)}};N(lt,X=>{a(k).quantity>0?X(dt):X(ut,!1)})}r(Ie);var vt=c(Ie,2),Ht=d(vt);He(Ht),r(vt);var ft=c(vt,2),mt=d(ft);He(mt);var T0=c(mt,2);Ge(T0,{size:24,get category(){return a(t)}}),r(ft);var pt=c(ft,2),S0=d(pt);{var w0=X=>{var Me=Ze();K(bt=>C(Me,`${bt??""} sats`),[()=>Number(a(k).quantity*a(k).price).toLocaleString()]),b(X,Me)};N(S0,X=>{a(k).quantity*a(k).price>0&&X(w0)})}r(pt);var Vt=c(pt,2),Wt=d(Vt);Wt.__click=()=>G(Y+1);var I0=c(Wt,2);I0.__click=()=>{We(Y)},r(Vt),r(oe),ht(Ht,()=>a(k).price,X=>a(k).price=X),ht(mt,()=>a(k).quantity,X=>a(k).quantity=X),b(x,oe)});var x0=c(Ft,2);{var P0=x=>{var k=fn();b(x,k)};N(x0,x=>{a(h).length>0&&x(P0)})}me(2),b(ne,Se)};N($,ne=>{a(A).length==0?ne(Re):ne(qe,!1)},ge)}};N(Ce,$=>{a(ke)<1e3&&a(P).length==0?$(Ke):$(ct,!1)})}r(I),b(y,S)};N(Dt,y=>{a(M)&&y(y0)})}var Lt=c(Dt,8);pe(Lt,21,()=>a(z),be,(y,S)=>{var I=bn(),Q=d(I);Ge(Q,{get category(){return a(S)},size:24}),r(I),b(y,I)}),r(Lt),K(()=>C(Ct,` ${a(ye)??""} `)),va(J,()=>a(t),y=>f(t,y)),gt(qt,()=>a(M),y=>f(M,y)),b(i,v)},b0=i=>{var v=gn();b(i,v)};N(At,i=>{a(u)=="CONNECTED"?i(p0):i(b0,!1)})}var nt=c(At,4),Ut=d(nt);He(Ut),me(2),r(nt);var _0=c(nt,2);Ta(_0),r(It),gt(Ut,()=>a(ce),i=>f(ce,i)),b(p,St),Pt()}M0(["change","click"]);export{Jn as component,Xn as universal};
//# sourceMappingURL=6.CKhWGDyi.js.map
