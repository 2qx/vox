import{f as d,a as v,c as Ct,t as de}from"./yGPdYsEk.js";import{o as ue,a as he}from"./BL1kRCRP.js";import{h as Ot,p as Ft,c as o,r as i,s as r,t as g,a as Vt,f as nt,j as e,aF as T,aa as c,a9 as Lt,a0 as Zt,as as _e}from"./4Ej_4qXs.js";import{d as Gt,s as b}from"./BNpjwQLA.js";import{a as fe,C as J,b as me,p as pe}from"./DxC2wkOi.js";import{i as k}from"./CyUl1IAL.js";import{e as be,i as ge}from"./PZPIYvej.js";import{s as A,r as ke,c as we}from"./CnJGQRAh.js";import{b as xe,a as ye}from"./R_USggII.js";import{s as ze}from"./DlPNFNxT.js";import{p as Wt}from"./7iLcJUjS.js";import{L as yt,F as Te,m as Ne,$ as Ce,G as zt,H as Ee,p as Tt,J as Nt,s as Ae}from"./zIYK9qkZ.js";import{I as Se,B as He,T as Me,W as De,N as It,a as Ue}from"./DeOyqwJy.js";import{a as Be,b as Et}from"./BtgC42a0.js";import{g as Pe}from"./gC8E2xLB.js";import{B as qe,C as Re,D as Oe}from"./BbIwgq-g.js";function Le(n,a,u,N,S,D){var R=n.__className;if(Ot||R!==u||R===void 0){var w=Be(u,N);(!Ot||w!==n.getAttribute("class"))&&(w==null?n.removeAttribute("class"):n.className=w),n.__className=u}return D}const Ze=8;async function We(n,a,u=Ze){let N=0,S=[];for(;N<a.length;){const D=a.slice(N,N+u);S=[...S,...await Promise.all(D.map(R=>n(R)))],N+=u}return S}async function Ie(n){return await n[0].request("blockchain.transaction.get",n[1],!1)}async function Fe(n,a){return We(Ie,a.map(u=>[n,u]))}const Ve="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='15px'%20fill='%23000'%3e%3cpath%20d='M280-120q-33%200-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0%2033-23.5%2056.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160%200h80v-360h-80v360ZM280-720v520-520Z'/%3e%3c/svg%3e",Ge="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48px'%20viewBox='0%20-960%20960%20960'%20width='48px'%20fill='%23888'%3e%3cpath%20d='M272-120v-512l278-288%2058%2046-52%20242h359v171L767-120H272Zm60-60h397l126-299v-93H482l53-249-203%20214v427Zm0-427v427-427ZM79-120v-512h193v60H139v392h133v60H79Z'/%3e%3c/svg%3e";var je=d('<img height="32px" class="svelte-1kup2az"/>'),Je=d('<div style="width:32px"></div>'),Ke=(n,a)=>{c(a,!e(a))},Ye=d('<div> <button class="svelte-1kup2az"> </button></div>'),Qe=(n,a)=>{c(a,!e(a))},Xe=d('<div> <button class="svelte-1kup2az"> </button></div>'),$e=d('<div class="error svelte-1kup2az"> </div>'),ta=(n,a)=>{a.likePost(a.hash)},ea=d('<img height="32px" class="svelte-1kup2az"/>'),aa=d('<div style="width:32px"></div>'),sa=d('<div class="container svelte-1kup2az"><div class="auth svelte-1kup2az"><!></div> <div><div class="footer svelte-1kup2az"><div class="fill svelte-1kup2az"></div> <div class="action"></div></div> <!> <div class="footer svelte-1kup2az"><div class="hash svelte-1kup2az"> </div> <div class="fill svelte-1kup2az"></div> <div class="actions svelte-1kup2az"><button class="svelte-1kup2az"><img height="16px" alt="likes"/> </button></div> <div class="timestamp svelte-1kup2az"> </div></div></div> <div class="auth svelte-1kup2az"><!></div></div>');function oa(n,a){Ft(a,!0);let u=T(!1);const N=400;var S=sa(),D=o(S),R=o(D);{var w=h=>{var _=je();g(q=>{A(_,"src",q),A(_,"alt",a.auth)},[()=>Et(a.auth,16)]),v(h,_)},O=h=>{var _=Je();v(h,_)};k(R,h=>{a.thisAuth?h(O,!1):h(w)})}i(D);var L=r(D,2),U=r(o(L),2);{var lt=h=>{var _=Ct(),q=nt(_);{var ft=H=>{var I=Ye(),et=o(I),X=r(et);X.__click=[Ke,u];var M=o(X,!0);i(X),i(I),g(()=>{b(et,`${a.body??""} `),b(M,e(u)?"show less":"show more")}),v(H,I)},mt=(H,I)=>{{var et=M=>{var F=Xe(),at=o(F),rt=r(at);rt.__click=[Qe,u];var ut=o(rt,!0);i(rt),i(F),g(vt=>{b(at,`${vt??""} `),b(ut,e(u)?"show less":"show more")},[()=>a.body.substring(0,N)+" ..."]),v(M,F)},X=M=>{var F=de();g(()=>b(F,a.body)),v(M,F)};k(H,M=>{a.body.length>N+20?M(et):M(X,!1)},I)}};k(q,H=>{a.body.length>N+20&&e(u)?H(ft):H(mt,!1)})}v(h,_)},K=h=>{var _=$e(),q=o(_,!0);i(_),g(()=>b(q,a.error)),v(h,_)};k(U,h=>{a.error?h(K,!1):h(lt)})}var B=r(U,2),C=o(B),ct=o(C,!0);i(C);var Z=r(C,4),W=o(Z);W.__click=[ta,a];var dt=o(W),P=r(dt);i(W),i(Z);var Y=r(Z,2),Q=o(Y);i(Y),i(B),i(L);var f=r(L,2),it=o(f);{var x=h=>{var _=ea();g(q=>{A(_,"src",q),A(_,"alt",a.auth)},[()=>Et(a.auth,16)]),v(h,_)},p=h=>{var _=aa();v(h,_)};k(it,h=>{a.thisAuth?h(x):h(p,!1)})}i(f),i(S),g(()=>{Le(L,1,`post ${a.thisAuth?"op":""} `,"svelte-1kup2az"),b(ct,a.hash),A(dt,"src",Ge),b(P,` ${a.likes??""}`),b(Q,`${a.height??""} ■ ${a.sequence??""}`)}),v(n,S),Vt()}Gt(["click"]);var ia=d('<a target="_blank"> </a>'),ra=d("<img/>"),va=d('<img alt="Disconnected"/>'),na=(n,a,u)=>a(e(u)),la=d('<div class="deleteMe svelte-1f5vzoo"><button class="svelte-1f5vzoo"><img height="36px"/></button></div>'),ca=d("<!> <!>",1),da=d('<p style="color: red"> </p>'),ua=(n,a)=>a(),ha=d('<div class="row footer svelte-1f5vzoo"><h2>Create new identity</h2> <button class="svelte-1f5vzoo">New identity 1M sats</button></div>'),_a=d('<div class="row footer svelte-1f5vzoo"><p><a href="/wallet">Deposit funds</a> to create identity</p></div>'),fa=(n,a)=>a(),ma=d('<img height="32px" alt="avatar" class="svelte-1f5vzoo"/>'),pa=d('<div style="font-size:x-small;"> <br/> </div>'),ba=(n,a,u)=>a(e(u)),ga=d('<div class="edit svelte-1f5vzoo"><textarea class="svelte-1f5vzoo"> </textarea> <div class="estimate svelte-1f5vzoo"> </div></div> <div class="send svelte-1f5vzoo"><div class="auth svelte-1f5vzoo"><!> <!></div> <button class="svelte-1f5vzoo">Send</button></div>',1),ka=d("<p>Not connected?</p>"),wa=d('<div class="row footer svelte-1f5vzoo"><!></div>'),xa=(n,a)=>a(1e7),ya=(n,a)=>a(1e6),za=d('<div class="row footer svelte-1f5vzoo"><button class="svelte-1f5vzoo">Top up 10M sats</button> <button class="svelte-1f5vzoo">Top up 1M sats</button></div>'),Ta=d('<div class="box svelte-1f5vzoo"><div class="row header svelte-1f5vzoo"> <sub>■</sub> <div style="flex: 2 2 auto;"></div> <b><a href="/pop/">/pop</a> </b> <div style="flex: 2 2 auto;"></div> <!> <!> <!></div> <div id="chat" class="row content svelte-1f5vzoo"><!></div> <!> <div class="row footer svelte-1f5vzoo"><div style="margin: auto;">Advanced</div> <div><label class="switch svelte-1f5vzoo"><input type="checkbox" class="svelte-1f5vzoo"/> <span class="slider round svelte-1f5vzoo"></span></label></div></div> <!></div>');function Wa(n,a){Ft(a,!0);const u=Wt.url.hostname=="vox.cash",N=u?"bitcoincash":"bchtest",S=u?"bch.imaginary.cash":"chipnet.bch.ninja",D=u?"https://explorer.salemkode.com/address/":"https://cbch.loping.net/address/",R=yt('OP_RETURN <"U3V">');let w=T(0),O=T(0),L=T(0n),U=T(""),lt=T(""),K=T(""),B=T(""),C=T(0),ct=T(0),Z=T(!1);const W=Zt(()=>J.getScriptHash(a.topic)),dt=Zt(()=>J.getAddress(a.topic,N));let P=T(Lt([])),Y,Q="",f,it="",x,p=T(Lt([]));const h=()=>{clearTimeout(Y),Y=setTimeout(()=>{H(),I()},1500)},_=async function(t){if(t.method==="blockchain.headers.subscribe"){let s=t.params[0];c(w,s.height,!0)}else t.method==="blockchain.scripthash.subscribe"?t.params[1]!==e(lt)&&(c(lt,t.params[1],!0),c(U,zt[f.status],!0),h()):console.log(t)},q=function(){let t=document.getElementById("chat");var s=t.scrollHeight;t.scrollTo(0,s)},ft=async function(t){let s=J.like(a.topic,t,e(p)[0],(Math.round(e(w)/1e3)+10)*10,Q),l=Tt(Nt(s.transaction));await at(l)},mt=async function(){let t=await f.request("blockchain.headers.get_tip");if(t instanceof Error)throw t;c(w,t.height,!0)},H=async function(){let t=await f.request("blockchain.scripthash.listunspent",it,"include_tokens");if(t instanceof Error)throw t;c(p,t.filter(s=>s.token_data&&s.token_data.nft&&s.token_data.nft.commitment.startsWith(R)),!0),e(p).length>0&&e(p)[0].token_data&&(c(B,e(p)[0].token_data.category,!0),c(O,e(p)[0].value,!0))},I=async function(){let t=await f.request("blockchain.scripthash.listunspent",e(W),"include_tokens");if(t instanceof Error)throw t;c(L,Ee(t),!0);let s=Array.from(new Set(t.map(m=>m.tx_hash))),l=await f.request("blockchain.scripthash.get_history",e(W),e(w)-1500,-1),z=await Fe(f,s);c(P,me(l,z,a.topic),!0),c(P,e(P).map(m=>({thisAuth:e(B)==m.auth,...m})),!0),e(P).slice(-1).length>0?c(C,e(P).slice(-1)[0].height<=0?e(P).slice(-1)[0].sequence+1:0,!0):c(C,0)},et=async function(t){let s=await f.request("blockchain.scripthash.listunspent",e(W),"include_tokens");if(s instanceof Error)throw s;let l=s.filter(y=>y.tx_hash==t.hash),z=J.clear(a.topic,l,e(p)[0],Q,e(w)),m=Tt(Nt(z.transaction));await at(m)},X=()=>{clearTimeout(Y),Y=setTimeout(()=>{c(ct,M(e(K)),!0)},500)},M=function(t){let s=J.post(a.topic,t,e(p)[0],(Math.round(e(w)/1e3)+10)*10,Q,e(C));const l=s.transaction.outputs[s.transaction.outputs.length-1].valueSatoshis;return Number(Ae(s.sourceOutputs)-l)},F=async function(t){let s=J.post(a.topic,t,e(p)[0],(Math.round(e(w)/1e3)+10)*10,Q,e(C)),l=Tt(Nt(s.transaction));await at(l),c(K,"")},at=async function(t){let s=await f.request("blockchain.transaction.broadcast",t);if(c(C,e(C)+1),s instanceof Error)throw c(U,zt[f.status],!0),s},rt=async function(){await x.sendMax(x.getDepositAddress());let t=yt('OP_RETURN <"U3V"> <"pseudonymous">');await x.tokenGenesis({cashaddr:x.getTokenDepositAddress(),commitment:t,capability:It.minting,value:1e6})},ut=async function(t){c(O,e(p)[0].value,!0),c(B,e(p)[0].token_data.category,!0);let s=yt('OP_RETURN <"U3V"> <"pseudonymous">');await x.send(new Ue({cashaddr:x.getTokenDepositAddress(),tokenId:e(B),commitment:s,capability:It.minting,value:e(O)+t})),await H()};ue(async()=>{const t=Wt.url.hostname!=="vox.cash";He.StorageProvider=Se,x=t?await Me.named("vox"):await De.named("vox"),Q=Pe(x.mnemonic,x.derivationPath.slice(0,-2),x.isTestnet);let s=Te(x.getDepositAddress());if(typeof s=="string")throw s;it=Ne(s.bytecode),f=new Ce(J.USER_AGENT,"1.4.1",S),await f.connect(),f.on("notification",_),c(U,zt[f.status],!0),await f.subscribe("blockchain.scripthash.subscribe",e(W)),await f.subscribe("blockchain.scripthash.subscribe",it),await mt(),await H(),await I(),q()}),he(async()=>{await x.provider.disconnect(),await f.disconnect()});var vt=Ta(),pt=o(vt),At=o(pt,!0),St=r(At,2),bt=r(St,3),jt=r(o(bt));i(bt);var Ht=r(bt,4);{var Jt=t=>{var s=ia(),l=o(s);i(s),g(z=>{A(s,"href",`${D}${e(dt)??""}`),b(l,`${z??""}k sats  `)},[()=>Math.floor(Number(e(L))/1e3).toLocaleString()]),v(t,s)};k(Ht,t=>{e(L)&&t(Jt)})}var Mt=r(Ht,2);qe(Mt,{get template(){return J.template}});var Kt=r(Mt,2);{var Yt=t=>{var s=ra();g(()=>{A(s,"src",Re),A(s,"alt",e(U))}),v(t,s)},Qt=t=>{var s=va();g(()=>A(s,"src",Oe)),v(t,s)};k(Kt,t=>{e(U)=="CONNECTED"?t(Yt):t(Qt,!1)})}i(pt);var gt=r(pt,2),Xt=o(gt);fe(Xt,()=>a.transactions,null,(t,s)=>{var l=Ct(),z=nt(l);be(z,17,()=>e(P),ge,(m,y)=>{var $=ca(),st=nt($);oa(st,ze({likePost:ft},()=>e(y)));var wt=r(st,2);{var V=G=>{var tt=la(),j=o(tt);j.__click=[na,et,y];var ht=o(j);i(j),i(tt),g(()=>A(ht,"src",Ve)),v(G,tt)};k(wt,G=>{e(Z)&&G(V)})}v(m,$)}),v(t,l)},(t,s)=>{var l=da(),z=o(l,!0);i(l),g(()=>b(z,e(s).message)),v(t,l)}),i(gt);var Dt=r(gt,2);{var $t=t=>{var s=ha(),l=r(o(s),2);l.__click=[ua,rt],i(s),v(t,s)},te=(t,s)=>{{var l=m=>{var y=_a();v(m,y)},z=m=>{var y=wa(),$=o(y);{var st=V=>{var G=ga(),tt=nt(G),j=o(tt);we(j),j.__keyup=[fa,X];var ht=r(j,2),se=o(ht);i(ht),i(tt);var qt=r(tt,2),xt=o(qt),Rt=o(xt);{var oe=E=>{var ot=ma();g(_t=>A(ot,"src",_t),[()=>Et(e(B),16)]),v(E,ot)};k(Rt,E=>{e(B)&&E(oe)})}var ie=r(Rt,2);{var re=E=>{var ot=pa(),_t=o(ot,!0),ne=r(_t,2);i(ot),g((le,ce)=>{b(_t,le),b(ne,` ${ce??""}sats`)},[()=>pe(e(p)[0].token_data.nft.commitment),()=>e(O).toLocaleString()]),v(E,ot)};k(ie,E=>{e(p).length>0&&E(re)})}i(xt);var ve=r(xt,2);ve.__click=[ba,F,K],i(qt),g(E=>b(se,`${E??""} sats`),[()=>e(ct).toLocaleString()]),ye(j,()=>e(K),E=>c(K,E)),v(V,G)},wt=V=>{var G=ka();v(V,G)};k($,V=>{e(U)=="CONNECTED"?V(st):V(wt,!1)})}i(y),v(m,y)};k(t,m=>{e(O)<11e5&&e(p).length==0?m(l):m(z,!1)},s)}};k(Dt,t=>{e(O)>1e6&&e(p).length==0?t($t):t(te,!1)})}var kt=r(Dt,2),Ut=r(o(kt),2),Bt=o(Ut),Pt=o(Bt);ke(Pt),_e(2),i(Bt),i(Ut),i(kt);var ee=r(kt,2);{var ae=t=>{var s=Ct(),l=nt(s);{var z=m=>{var y=za(),$=o(y);$.__click=[xa,ut];var st=r($,2);st.__click=[ya,ut],i(y),v(m,y)};k(l,m=>{e(p).length>0&&m(z)})}v(t,s)};k(ee,t=>{e(Z)&&t(ae)})}i(vt),g(t=>{b(At,t),b(St,` ${e(C)??""} `),b(jt,`/${a.topic??""}`)},[()=>e(w).toLocaleString()]),xe(Pt,()=>e(Z),t=>c(Z,t)),v(n,vt),Vt()}Gt(["click","keyup"]);export{Wa as C};
//# sourceMappingURL=DcR3kTcm.js.map
