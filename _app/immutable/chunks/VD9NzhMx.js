import{f as _,a as v,c as Ct,t as ue}from"./yGPdYsEk.js";import{o as _e,a as he}from"./BL1kRCRP.js";import{h as Zt,p as Ft,c as o,r as i,s as r,t as w,a as Gt,f as it,j as e,aF as T,aa as u,a9 as Wt,a0 as It,as as fe}from"./4Ej_4qXs.js";import{d as jt,s as k}from"./BNpjwQLA.js";import{a as me,C as D,b as pe,p as be}from"./mdkU_V67.js";import{i as x}from"./CyUl1IAL.js";import{e as ge,i as ke}from"./PZPIYvej.js";import{s as P,r as we,c as xe}from"./CnJGQRAh.js";import{b as ye,a as ze}from"./R_USggII.js";import{s as Te}from"./DlPNFNxT.js";import{p as Ee}from"./BsSZmcee.js";import{L as Et,F as Ne,m as Ce,$ as Ae,G as Nt,H as Se,p as vt,J as ct,s as Pe}from"./zIYK9qkZ.js";import{I as He,B as Me,W as qe,T as Be,N as Vt,a as De}from"./DeOyqwJy.js";import{a as Ue,b as At}from"./BtgC42a0.js";import{g as Re}from"./gC8E2xLB.js";import{B as Oe,C as Le,D as Ze}from"./BbIwgq-g.js";function We(l,a,d,E,H,U){var V=l.__className;if(Zt||V!==d||V===void 0){var g=Ue(d,E);(!Zt||g!==l.getAttribute("class"))&&(g==null?l.removeAttribute("class"):l.className=g),l.__className=d}return U}const Ie=8;async function Ve(l,a,d=Ie){let E=0,H=[];for(;E<a.length;){const U=a.slice(E,E+d);H=[...H,...await Promise.all(U.map(V=>l(V)))],E+=d}return H}async function Fe(l){return await l[0].request("blockchain.transaction.get",l[1],!1)}async function Ge(l,a){return Ve(Fe,a.map(d=>[l,d]))}const je="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='15px'%20fill='%23000'%3e%3cpath%20d='M280-120q-33%200-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0%2033-23.5%2056.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160%200h80v-360h-80v360ZM280-720v520-520Z'/%3e%3c/svg%3e",Je="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48px'%20viewBox='0%20-960%20960%20960'%20width='48px'%20fill='%23888'%3e%3cpath%20d='M272-120v-512l278-288%2058%2046-52%20242h359v171L767-120H272Zm60-60h397l126-299v-93H482l53-249-203%20214v427Zm0-427v427-427ZM79-120v-512h193v60H139v392h133v60H79Z'/%3e%3c/svg%3e";var Ke=_('<img height="32px" class="svelte-1kup2az"/>'),Ye=_('<div style="width:32px"></div>'),Qe=(l,a)=>{u(a,!e(a))},Xe=_('<div> <button class="svelte-1kup2az"> </button></div>'),$e=(l,a)=>{u(a,!e(a))},ta=_('<div> <button class="svelte-1kup2az"> </button></div>'),ea=_('<div class="error svelte-1kup2az"> </div>'),aa=(l,a)=>{a.likePost(a.hash)},sa=_('<img height="32px" class="svelte-1kup2az"/>'),oa=_('<div style="width:32px"></div>'),ia=_('<div class="container svelte-1kup2az"><div class="auth svelte-1kup2az"><!></div> <div><div class="footer svelte-1kup2az"><div class="fill svelte-1kup2az"></div> <div class="action"></div></div> <!> <div class="footer svelte-1kup2az"><div class="hash svelte-1kup2az"> </div> <div class="fill svelte-1kup2az"></div> <div class="actions svelte-1kup2az"><button class="svelte-1kup2az"><img height="16px" alt="likes"/> </button></div> <div class="timestamp svelte-1kup2az"> </div></div></div> <div class="auth svelte-1kup2az"><!></div></div>');function ra(l,a){Ft(a,!0);let d=T(!1);const E=400;var H=ia(),U=o(H),V=o(U);{var g=h=>{var b=Ke();w(W=>{P(b,"src",W),P(b,"alt",a.auth)},[()=>At(a.auth,16)]),v(h,b)},F=h=>{var b=Ye();v(h,b)};x(V,h=>{a.thisAuth?h(F,!1):h(g)})}i(U);var G=r(U,2),R=r(o(G),2);{var dt=h=>{var b=Ct(),W=it(b);{var pt=q=>{var tt=Xe(),st=o(tt),J=r(st);J.__click=[Qe,d];var B=o(J,!0);i(J),i(tt),w(()=>{k(st,`${a.body??""} `),k(B,e(d)?"show less":"show more")}),v(q,tt)},bt=(q,tt)=>{{var st=B=>{var K=ta(),ht=o(K),nt=r(ht);nt.__click=[$e,d];var et=o(nt,!0);i(nt),i(K),w(gt=>{k(ht,`${gt??""} `),k(et,e(d)?"show less":"show more")},[()=>a.body.substring(0,E)+" ..."]),v(B,K)},J=B=>{var K=ue();w(()=>k(K,a.body)),v(B,K)};x(q,B=>{a.body.length>E+20?B(st):B(J,!1)},tt)}};x(W,q=>{a.body.length>E+20&&e(d)?q(pt):q(bt,!1)})}v(h,b)},X=h=>{var b=ea(),W=o(b,!0);i(b),w(()=>k(W,a.error)),v(h,b)};x(R,h=>{a.error?h(X,!1):h(dt)})}var O=r(R,2),N=o(O),ut=o(N,!0);i(N);var j=r(N,4),M=o(j);M.__click=[aa,a];var _t=o(M),L=r(_t);i(M),i(j);var $=r(j,2),Z=o($);i($),i(O),i(G);var f=r(G,2),rt=o(f);{var y=h=>{var b=sa();w(W=>{P(b,"src",W),P(b,"alt",a.auth)},[()=>At(a.auth,16)]),v(h,b)},p=h=>{var b=oa();v(h,b)};x(rt,h=>{a.thisAuth?h(y):h(p,!1)})}i(f),i(H),w(()=>{We(G,1,`post ${a.thisAuth?"op":""} `,"svelte-1kup2az"),k(ut,a.hash),P(_t,"src",Je),k(L,` ${a.likes??""}`),k(Z,`${a.height??""} ■ ${a.sequence??""}`)}),v(l,H),Gt()}jt(["click"]);var na=_('<a target="_blank"> </a>'),la=_("<img/>"),va=_('<img alt="Disconnected"/>'),ca=(l,a,d)=>a(e(d)),da=_('<div class="deleteMe svelte-1f5vzoo"><button class="svelte-1f5vzoo"><img height="36px"/></button></div>'),ua=_("<!> <!>",1),_a=_('<p style="color: red"> </p>'),ha=(l,a)=>a(),fa=_('<div class="row footer svelte-1f5vzoo"><h2>Create new identity</h2> <button class="svelte-1f5vzoo">New identity 1M sats</button></div>'),ma=_('<div class="row footer svelte-1f5vzoo"><p><a href="/wallet">Deposit funds</a> to create identity</p></div>'),pa=(l,a)=>a(),ba=_('<img height="32px" alt="avatar" class="svelte-1f5vzoo"/>'),ga=_('<div style="font-size:x-small;"> <br/> </div>'),ka=(l,a,d)=>a(e(d)),wa=_('<div class="edit svelte-1f5vzoo"><textarea class="svelte-1f5vzoo"> </textarea> <div class="estimate svelte-1f5vzoo"> </div></div> <div class="send svelte-1f5vzoo"><div class="auth svelte-1f5vzoo"><!> <!></div> <button class="svelte-1f5vzoo">Send</button></div>',1),xa=_("<p>Not connected?</p>"),ya=_('<div class="row footer svelte-1f5vzoo"><!></div>'),za=(l,a)=>a(1e7),Ta=(l,a)=>a(1e6),Ea=(l,a)=>a(),Na=(l,a)=>a(),Ca=_('<div class="row footer svelte-1f5vzoo"><button class="svelte-1f5vzoo">Top up 10M sats</button> <button class="svelte-1f5vzoo">Top up 1M sats</button></div> <div class="row footer svelte-1f5vzoo"><button class="svelte-1f5vzoo">Clear Old Posts</button> <button class="svelte-1f5vzoo">Burn Spam</button></div>',1),Aa=_('<div class="box svelte-1f5vzoo"><div class="row header svelte-1f5vzoo"> <sub>■</sub> <div style="flex: 2 2 auto;"></div> <b><a href="/pop/">/pop</a> </b> <div style="flex: 2 2 auto;"></div> <!> <!> <!></div> <div id="chat" class="row content svelte-1f5vzoo"><!></div> <!> <div class="row footer svelte-1f5vzoo"><div style="margin: auto;">Advanced</div> <div><label class="switch svelte-1f5vzoo"><input type="checkbox" class="svelte-1f5vzoo"/> <span class="slider round svelte-1f5vzoo"></span></label></div></div> <!></div>');function Ga(l,a){Ft(a,!0);const d=Ee.url.hostname=="vox.cash",E=d?"bitcoincash":"bchtest",H=d?"bch.imaginary.cash":"chipnet.bch.ninja",U=d?"https://explorer.salemkode.com/address/":"https://cbch.loping.net/address/",V=Et('OP_RETURN <"U3V">');let g=T(0),F=T(0),G=T(0n),R=T(""),dt=T(""),X=T(""),O=T(""),N=T(0),ut=T(0),j=T(!1);const M=It(()=>D.getScriptHash(a.topic)),_t=It(()=>D.getAddress(a.topic,E));let L=T(Wt([])),$,Z="",f,rt="",y,p=T(Wt([]));const h=()=>{clearTimeout($),$=setTimeout(()=>{q(),J()},1500)},b=async function(t){if(t.method==="blockchain.headers.subscribe"){let s=t.params[0];u(g,s.height,!0)}else t.method==="blockchain.scripthash.subscribe"?t.params[1]!==e(dt)&&(u(dt,t.params[1],!0),u(R,Nt[f.status],!0),h()):console.log(t)},W=function(){let t=document.getElementById("chat");var s=t.scrollHeight;t.scrollTo(0,s)},pt=async function(t){let s=D.like(a.topic,t,e(p)[0],(Math.round(e(g)/1e3)+10)*10,Z),n=vt(ct(s.transaction));await et(n)},bt=async function(){let t=await f.request("blockchain.headers.get_tip");if(t instanceof Error)throw t;u(g,t.height,!0)},q=async function(){let t=await f.request("blockchain.scripthash.listunspent",rt,"include_tokens");if(t instanceof Error)throw t;u(p,t.filter(s=>s.token_data&&s.token_data.nft&&s.token_data.nft.commitment.startsWith(V)),!0),e(p).length>0&&e(p)[0].token_data&&(u(O,e(p)[0].token_data.category,!0),u(F,e(p)[0].value,!0))},tt=async function(){let t=await f.request("blockchain.scripthash.listunspent",e(M),"include_tokens");if(t instanceof Error)throw t;let s=t.filter(c=>c.height>0&&e(g)-c.height>1e3),n=D.clear(a.topic,s,e(p)[0],Z,e(g)),m=vt(ct(n.transaction));console.log(m),await et(m)},st=async function(){let t=await f.request("blockchain.scripthash.listunspent",e(M),"include_tokens");if(t instanceof Error)throw t;let s=t.filter(c=>Math.floor(c.value/10)*1e3-c.height<1e3);console.log(s);let n=D.clear(a.topic,s,e(p)[0],Z,e(g)),m=vt(ct(n.transaction));console.log(m),await et(m)},J=async function(){let t=await f.request("blockchain.scripthash.listunspent",e(M),"include_tokens");if(t instanceof Error)throw t;u(G,Se(t),!0);let s=Array.from(new Set(t.map(c=>c.tx_hash))),n=await f.request("blockchain.scripthash.get_history",e(M),e(g)-1500,-1),m=await Ge(f,s);u(L,pe(n,m,a.topic),!0),u(L,e(L).map(c=>({thisAuth:e(O)==c.auth,...c})),!0),e(L).slice(-1).length>0?u(N,e(L).slice(-1)[0].height<=0?e(L).slice(-1)[0].sequence+1:0,!0):u(N,0)},B=async function(t){let s=await f.request("blockchain.scripthash.listunspent",e(M),"include_tokens");if(s instanceof Error)throw s;let n=s.filter(z=>z.tx_hash==t.hash),m=D.clear(a.topic,n,e(p)[0],Z,e(g)),c=vt(ct(m.transaction));await et(c)},K=()=>{clearTimeout($),$=setTimeout(()=>{u(ut,ht(e(X)),!0)},500)},ht=function(t){let s=D.post(a.topic,t,e(p)[0],(Math.round(e(g)/1e3)+10)*10,Z,e(N));const n=s.transaction.outputs[s.transaction.outputs.length-1].valueSatoshis;return Number(Pe(s.sourceOutputs)-n)},nt=async function(t){let s=(Math.round(e(g)/1e3)+10)*10,n=D.post(a.topic,t,e(p)[0],s,Z,e(N)),m=vt(ct(n.transaction));await et(m),u(X,"")},et=async function(t){let s=await f.request("blockchain.transaction.broadcast",t);if(u(N,e(N)+1),s instanceof Error)throw u(R,Nt[f.status],!0),s},gt=async function(){await y.sendMax(y.getDepositAddress());let t=Et('OP_RETURN <"U3V"> <"pseudonymous">');await y.tokenGenesis({cashaddr:y.getTokenDepositAddress(),commitment:t,capability:Vt.minting,value:1e6})},St=async function(t){u(F,e(p)[0].value,!0),u(O,e(p)[0].token_data.category,!0);let s=Et('OP_RETURN <"U3V"> <"pseudonymous">');await y.send(new De({cashaddr:y.getTokenDepositAddress(),tokenId:e(O),commitment:s,capability:Vt.minting,value:e(F)+t})),await q()};_e(async()=>{Me.StorageProvider=He,y=d?await qe.named("vox"):await Be.named("vox"),Z=Re(y.mnemonic,y.derivationPath.slice(0,-2),y.isTestnet);let t=Ne(y.getDepositAddress());if(typeof t=="string")throw t;rt=Ce(t.bytecode),f=new Ae(D.USER_AGENT,"1.4.1",H),await f.connect(),f.on("notification",b),u(R,Nt[f.status],!0),await f.subscribe("blockchain.scripthash.subscribe",e(M)),await f.subscribe("blockchain.scripthash.subscribe",rt),await bt(),await q(),await J(),W()}),he(async()=>{await y.provider.disconnect(),await f.disconnect()});var kt=Aa(),wt=o(kt),Pt=o(wt,!0),Ht=r(Pt,2),xt=r(Ht,3),Jt=r(o(xt));i(xt);var Mt=r(xt,4);{var Kt=t=>{var s=na(),n=o(s);i(s),w(m=>{P(s,"href",`${U}${e(_t)??""}`),k(n,`${m??""}k sats  `)},[()=>Math.floor(Number(e(G))/1e3).toLocaleString()]),v(t,s)};x(Mt,t=>{e(G)&&t(Kt)})}var qt=r(Mt,2);Oe(qt,{get template(){return D.template}});var Yt=r(qt,2);{var Qt=t=>{var s=la();w(()=>{P(s,"src",Le),P(s,"alt",e(R))}),v(t,s)},Xt=t=>{var s=va();w(()=>P(s,"src",Ze)),v(t,s)};x(Yt,t=>{e(R)=="CONNECTED"?t(Qt):t(Xt,!1)})}i(wt);var yt=r(wt,2),$t=o(yt);me($t,()=>a.transactions,null,(t,s)=>{var n=Ct(),m=it(n);ge(m,17,()=>e(L),ke,(c,z)=>{var Y=ua(),at=it(Y);ra(at,Te({likePost:pt},()=>e(z)));var lt=r(at,2);{var C=A=>{var I=da(),Q=o(I);Q.__click=[ca,B,z];var ft=o(Q);i(Q),i(I),w(()=>P(ft,"src",je)),v(A,I)};x(lt,A=>{e(j)&&A(C)})}v(c,Y)}),v(t,n)},(t,s)=>{var n=_a(),m=o(n,!0);i(n),w(()=>k(m,e(s).message)),v(t,n)}),i(yt);var Bt=r(yt,2);{var te=t=>{var s=fa(),n=r(o(s),2);n.__click=[ha,gt],i(s),v(t,s)},ee=(t,s)=>{{var n=c=>{var z=ma();v(c,z)},m=c=>{var z=ya(),Y=o(z);{var at=C=>{var A=wa(),I=it(A),Q=o(I);xe(Q),Q.__keyup=[pa,K];var ft=r(Q,2),oe=o(ft);i(ft),i(I);var Ot=r(I,2),Tt=o(Ot),Lt=o(Tt);{var ie=S=>{var ot=ba();w(mt=>P(ot,"src",mt),[()=>At(e(O),16)]),v(S,ot)};x(Lt,S=>{e(O)&&S(ie)})}var re=r(Lt,2);{var ne=S=>{var ot=ga(),mt=o(ot,!0),ve=r(mt,2);i(ot),w((ce,de)=>{k(mt,ce),k(ve,` ${de??""}sats`)},[()=>be(e(p)[0].token_data.nft.commitment),()=>e(F).toLocaleString()]),v(S,ot)};x(re,S=>{e(p).length>0&&S(ne)})}i(Tt);var le=r(Tt,2);le.__click=[ka,nt,X],i(Ot),w(S=>k(oe,`${S??""} sats`),[()=>e(ut).toLocaleString()]),ze(Q,()=>e(X),S=>u(X,S)),v(C,A)},lt=C=>{var A=xa();v(C,A)};x(Y,C=>{e(R)=="CONNECTED"?C(at):C(lt,!1)})}i(z),v(c,z)};x(t,c=>{e(F)<11e5&&e(p).length==0?c(n):c(m,!1)},s)}};x(Bt,t=>{e(F)>1e6&&e(p).length==0?t(te):t(ee,!1)})}var zt=r(Bt,2),Dt=r(o(zt),2),Ut=o(Dt),Rt=o(Ut);we(Rt),fe(2),i(Ut),i(Dt),i(zt);var ae=r(zt,2);{var se=t=>{var s=Ct(),n=it(s);{var m=c=>{var z=Ca(),Y=it(z),at=o(Y);at.__click=[za,St];var lt=r(at,2);lt.__click=[Ta,St],i(Y);var C=r(Y,2),A=o(C);A.__click=[Ea,tt];var I=r(A,2);I.__click=[Na,st],i(C),v(c,z)};x(n,c=>{e(p).length>0&&c(m)})}v(t,s)};x(ae,t=>{e(j)&&t(se)})}i(kt),w(t=>{k(Pt,t),k(Ht,` ${e(N)??""} `),k(Jt,`/${a.topic??""}`)},[()=>e(g).toLocaleString()]),ye(Rt,()=>e(j),t=>u(j,t)),v(l,kt),Gt()}jt(["click","keyup"]);export{Ga as C};
//# sourceMappingURL=VD9NzhMx.js.map
