const a=({index:o,result:e,type:t})=>({errors:e.errors.map(s=>({...s,error:`Failed compilation of ${t} directive at index "${o}": ${s.error}`})),index:o,...e.errorType==="parse"?{}:{resolved:e.resolve},type:t}),l=({outputTemplate:o,index:e})=>{if("script"in o.lockingBytecode){const t=o.lockingBytecode,s=t.data??{},i=t.compiler.generateBytecode({data:s,debug:!0,scriptId:t.script});return i.success?{lockingBytecode:i.bytecode,...o.token===void 0?{}:{token:o.token},valueSatoshis:o.valueSatoshis}:a({index:e,result:i,type:"locking"})}return{lockingBytecode:o.lockingBytecode.slice(),...o.token===void 0?{}:{token:o.token},valueSatoshis:o.valueSatoshis}},k=({inputTemplate:o,index:e,template:t,outputs:s})=>{if("script"in o.unlockingBytecode){const i=o.unlockingBytecode,r=[];r[e]={lockingBytecode:Uint8Array.of(),...o.unlockingBytecode.token===void 0?{}:{token:o.unlockingBytecode.token},valueSatoshis:o.unlockingBytecode.valueSatoshis};const u=i.compiler.generateBytecode({data:{...i.data,compilationContext:{inputIndex:e,sourceOutputs:r,transaction:{inputs:t.inputs,locktime:t.locktime,outputs:s,version:t.version}}},debug:!0,scriptId:i.script});return u.success?{outpointIndex:o.outpointIndex,outpointTransactionHash:o.outpointTransactionHash.slice(),sequenceNumber:o.sequenceNumber,unlockingBytecode:u.bytecode}:a({index:e,result:u,type:"unlocking"})}return{outpointIndex:o.outpointIndex,outpointTransactionHash:o.outpointTransactionHash.slice(),sequenceNumber:o.sequenceNumber,unlockingBytecode:o.unlockingBytecode.slice()}},g=o=>{const e=o.outputs.map((c,n)=>l({index:n,outputTemplate:c})),t=e.filter(c=>"errors"in c);if(t.length>0)return{completions:e.map((n,d)=>"lockingBytecode"in n?{index:d,output:n,type:"output"}:n).filter(n=>"output"in n),errors:t,stage:"outputs",success:!1};const s=e,i=o.inputs.map((c,n)=>k({index:n,inputTemplate:c,outputs:s,template:o})),r=i.filter(c=>"errors"in c);return r.length>0?{completions:i.map((n,d)=>"unlockingBytecode"in n?{index:d,input:n,type:"input"}:n).filter(n=>"input"in n),errors:r,stage:"inputs",success:!1}:{success:!0,transaction:{inputs:i,locktime:o.locktime,outputs:s,version:o.version}}};export{g};
//# sourceMappingURL=4WAd-rdk.js.map
