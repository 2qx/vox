import{u as Q,l,k as K,m as V,J as L,K as x,w as A,r as g,A as q,b as _,D as S,F as T,G as I,E as W,v as G,o as t0,L as a0,z as c0,M as n0,N as J,O as o0}from"./DLngWCRZ.js";import{a as M}from"./BP7KE8cK.js";import{h as Z}from"./PlXE8sTw.js";import{g as B}from"./4WAd-rdk.js";const s0=8,i0="chipnet.bch.ninja";function L0(d=!0){return d?"bch.imaginary.cash":i0}async function $(d,e,t=s0){let a=0,c=[];for(;a<e.length;){const n=e.slice(a,a+t);c=[...c,...await Promise.all(n.map(s=>d(s)))],a+=t}return c}async function d0(d){return await d[0].request("blockchain.transaction.get",d[1],!1)}async function S0(d,e){return $(d0,e.map(t=>[d,t]))}async function u0(d){let e=await d[0].request("blockchain.scripthash.listunspent",d[1]);if(e instanceof Error)throw e;return e.map(t=>({...t,scripthash:d[1]}))}const r0="@fbch/lib",F={name:r0},l0="https://libauth.org/schemas/wallet-template-v0.schema.json",f0="Templates for Future Bitcoin Cash ecosystem of contracts ",O0="FBCH: Future Bitcoin Cash",b0={coupon_vault:{description:"An entity that holds coupons 'owned' by the covenant.",name:"Coupon Vault",scripts:["coupon_unlock","coupon_lock"],variables:{amount:{description:"Minimum required threshold to claim the coupon",name:"Coupon Amount (Satoshis)",type:"WalletData"},lock:{description:"The locking script the coupon will target",name:"Coupon destination",type:"WalletData"}}},future_vault:{description:"An entity that holds coupons 'owned' by the covenant.",name:"Future Vault",scripts:["vault_lock","vault_unlock"],variables:{locktime:{description:"The timestamp (blocks) when the future vault will become bidirectional",name:"Vault Locktime (blocks)",type:"WalletData"}}},future_channel:{description:"Vault holding messages to be burned into coupons.",name:"Future Chan",scripts:["process_message","edit_message","channel_lock"],variables:{channel:{description:"The subject of the channel",name:"Channel (bytes)",type:"WalletData"},amount:{description:"Minimum required threshold to claim the coupon",name:"Coupon Amount (Satoshis)",type:"WalletData"},vault_script:{description:"Unlocking bytecode for the future vault",name:"Future Vault bytecode",type:"WalletData"},coupon_script:{description:"Unlocking bytecode for the coupon vault",name:"Future coupon bytecode",type:"WalletData"}}},wallet:{description:"The entity paying transaction fees, swapping or editing messages.",name:"Funding Entity",scripts:["wallet_lock","wallet_unlock"],variables:{key:{description:"The private key that controls this wallet.",name:"Key",type:"HdKey"}}}},P0={default_channel:{data:{bytecode:{channel:"",lock:"",amount:"10000000",vault_script:"0xc0d3c0d0a06376b17568c0cec0d188c0cdc0c788c0d0c0c693c0d3c0cc939c77",coupon_script:"0x00cc00c694a16900c788c08bc39c"}},description:"",name:"Unnamed Scenario",transaction:{locktime:99e4}},clear_spam:{data:{currentBlockHeight:99e4},description:"Should clear a message sent with insufficient sats",extends:"default_channel",name:"Clear Spam Message",transaction:{inputs:[{unlockingBytecode:["slot"]},{unlockingBytecode:{script:"wallet_unlock"}}],outputs:[{lockingBytecode:{script:"wallet_lock"},valueSatoshis:999},{lockingBytecode:{script:"wallet_lock"},valueSatoshis:1e6}],locktime:99e4,version:2},sourceOutputs:[{lockingBytecode:["slot"],valueSatoshis:1e3,token:{category:"dead00000000000000000000000000000000000000000000000000000000beef",nft:{commitment:"6a00000000000000000000000000000000000000000000000000000000beef",capability:"none"}}},{lockingBytecode:{script:"wallet_lock"},valueSatoshis:1e6}]},transform_message:{data:{currentBlockHeight:99e4},description:"Should transform a message into a coupon",extends:"default_channel",name:"Transform Message",transaction:{inputs:[{unlockingBytecode:["slot"]},{unlockingBytecode:{script:"wallet_unlock"}}],outputs:[{lockingBytecode:{script:"coupon_lock"},valueSatoshis:10010}],locktime:99e4,version:2},sourceOutputs:[{lockingBytecode:["slot"],valueSatoshis:1e4,token:{category:"dead00000000000000000000000000000000000000000000000000000000beef",nft:{commitment:"6a00000000000000000000000000000000000000000000000000000000beef",capability:"none"}}},{lockingBytecode:{script:"wallet_lock"},valueSatoshis:9999}]},burn_message:{data:{bytecode:{channel:"",lock:"0xaa205b876e30b7a65024200d12cef03622def95a93468f980fb27561e5272ab965ad87",amount:"100000000",vault_script:"0xc0d3c0d0a06376b17568c0cec0d188c0cdc0c788c0d0c0c693c0d3c0cc939c77",coupon_script:"0x00cc00c694a16900c788c08bc39c"}},description:"",extends:"default_channel",name:"Burn (censor) message",transaction:{inputs:[{unlockingBytecode:["slot"]},{unlockingBytecode:{script:"wallet_unlock"}}],outputs:[{lockingBytecode:{script:"coupon_lock"},valueSatoshis:27700}]},sourceOutputs:[{lockingBytecode:["slot"],valueSatoshis:2770},{lockingBytecode:{script:"wallet_lock"},valueSatoshis:99e4}]},edit_message:{description:"Modify message with NFT key",extends:"default_channel",name:"Edit Message",transaction:{inputs:[{outpointTransactionHash:"dead00000000000000000000000000000000000000000000000000000000beef",outpointIndex:1,unlockingBytecode:["slot"],sequenceNumber:1e3},{unlockingBytecode:{script:"wallet_unlock"}}],outputs:[{valueSatoshis:1e4,token:{category:"dead00000000000000000000000000000000000000000000000000000000beef",nft:{commitment:"6a<'hi'>",capability:"mutable"}},lockingBytecode:{script:"channel_lock"}},{lockingBytecode:{script:"wallet_lock"},valueSatoshis:800}]},sourceOutputs:[{lockingBytecode:["slot"],valueSatoshis:1e4,token:{category:"dead00000000000000000000000000000000000000000000000000000000beef",nft:{commitment:"6a<'hello'>",capability:"mutable"}}},{lockingBytecode:{script:"wallet_lock"},valueSatoshis:800,token:{category:"dead00000000000000000000000000000000000000000000000000000000beef",nft:{commitment:"6a<beef>",capability:"minting"}}}]},claim_coupon:{data:{bytecode:{lock:"0xaa2082590fa4fd4f322dea535de4ebcebb6e65526e71432027a8ed6a3a201391d82c87",amount:"10000000",locktime:"1000"}},description:"Claim a coupon",name:"Claim Coupon",transaction:{inputs:[{unlockingBytecode:{script:"vault_unlock"}},{unlockingBytecode:{script:"wallet_unlock"}},{outpointTransactionHash:"dead00000000000000000000000000000000000000000000000000000000beef",outpointIndex:0,unlockingBytecode:["slot"]}],outputs:[{lockingBytecode:{script:"vault_lock"},valueSatoshis:10000001e3,token:{amount:1e3,category:"dead00000000000000000000000000000000000000000000000000000000beef"}}]},sourceOutputs:[{lockingBytecode:{script:"vault_lock"},valueSatoshis:1e3,token:{amount:10000001e3,category:"dead00000000000000000000000000000000000000000000000000000000beef"}},{lockingBytecode:{script:"wallet_lock"},valueSatoshis:1e10},{lockingBytecode:["slot"]}]},place_bch:{data:{bytecode:{locktime:"1000"}},description:"Place BCH into a Future Vault",name:"Place BCH for FBCH",transaction:{inputs:[{outpointTransactionHash:"dead00000000000000000000000000000000000000000000000000000000beef",outpointIndex:0,unlockingBytecode:["slot"]},{unlockingBytecode:{script:"wallet_unlock"}}],outputs:[{valueSatoshis:21e6,token:{amount:1e3,category:"dead00000000000000000000000000000000000000000000000000000000beef"},lockingBytecode:{script:"vault_lock"}},{valueSatoshis:1e3,token:{amount:20999e3,category:"dead00000000000000000000000000000000000000000000000000000000beef"},lockingBytecode:{script:"wallet_lock"}}]},sourceOutputs:[{lockingBytecode:["slot"],valueSatoshis:1e3,token:{amount:21e6,category:"dead00000000000000000000000000000000000000000000000000000000beef"}},{lockingBytecode:{script:"wallet_lock"},valueSatoshis:21e6}]},redeem_fbch:{data:{bytecode:{locktime:"1000"}},description:"",name:"Redeem FBCH for BCH",transaction:{locktime:1e3,inputs:[{outpointTransactionHash:"dead00000000000000000000000000000000000000000000000000000000beef",outpointIndex:0,unlockingBytecode:["slot"]},{unlockingBytecode:{script:"wallet_unlock"}}],outputs:[{valueSatoshis:1e3,lockingBytecode:{script:"vault_lock"},token:{amount:21e6,category:"dead00000000000000000000000000000000000000000000000000000000beef"}},{valueSatoshis:21e6}]},sourceOutputs:[{lockingBytecode:["slot"],valueSatoshis:21e6,token:{amount:1e3,category:"dead00000000000000000000000000000000000000000000000000000000beef"}},{lockingBytecode:{script:"wallet_lock"},valueSatoshis:1e3,token:{amount:20999e3,category:"dead00000000000000000000000000000000000000000000000000000000beef"}}]}},_0=JSON.parse('{"process_message":{"fails":["edit_message"],"passes":["burn_message","clear_spam","transform_message"],"name":"Process Messages","script":"OP_0 // function index\\n","timeLockType":"height","unlocks":"channel_lock"},"edit_message":{"fails":["burn_message","clear_spam","transform_message"],"passes":["edit_message"],"name":"Edit Message","script":"OP_1 // function index\\n","timeLockType":"height","unlocks":"channel_lock"},"coupon_unlock":{"passes":["claim_coupon"],"name":"Unlock Coupon","script":"// \\"claim\\" function parameters\\n// none\\n","unlocks":"coupon_lock"},"vault_unlock":{"passes":["place_bch","redeem_fbch"],"name":"Unlock Future Vault","script":"// \\"swap\\" function parameters\\n// none\\n","timeLockType":"height","unlocks":"vault_lock"},"wallet_unlock":{"name":"Wallet Unlock","script":"<key.schnorr_signature.all_outputs>\\n<key.public_key>","unlocks":"wallet_lock"},"channel_lock":{"lockingType":"p2sh32","name":"Channel Message Lock","script":"<channel>\\n// pragma cashscript ~0.10.0;\\n    \\n// FutureChan - A message board contract.\\n//\\n// Message board for data written in mutable or immutable NFT commitments. \\n//\\n// - Messages can be removed after a week.\\n// - Messages can be censored early by paying a 9 times multiplier penalty.  \\n// - Messages must contain a value greater than 1/100th of a block time 2.5 months.\\n// - Messages with insufficient value may be cleared by anyone at any time.\\n// \\n// - Messages can be edited (or deleted) using an NFT with minting capability.\\n// \\n// - Clearing (or censoring) messages must create 0.1 FBCH (or 1 FBCH) coupons.\\n//\\n// - Many different channels can be used by using a different channel identifier.\\n// - Note: `cashc` compiler must be patched to not error from channel identifier usage. \\n//\\n//\\n\\n// contract FutureChan(bytes channel) {\\n\\n    OP_OVER OP_0 OP_NUMEQUAL OP_IF\\n    // function clearMessage() {\\n        \\n        // Chan messages will create a 0.1 FBCH coupon targeting a FBCH vault \\n        // where vault time is specified using the number of sats on the message.\\n        // Example #1: 9873 sats => ( 9873 % 10 ) * 1000 => FBCH-0987000; 0.1 BCH coupon\\n        //         #2:  543 sats =>  ( 543 % 10 ) * 1000 => MEV BURN\\n        //         #3: 9873 sats =>               98,730 => FBCH-0987000; 1 BCH coupon\\n\\n        OP_INPUTINDEX OP_UTXOVALUE OP_10 OP_DIV <1000> OP_MUL \\n        // int vaultTime = int(tx.inputs[this.activeInputIndex].value / 10)*1000;\\n\\n        // Default to a 0.1 BCH series coupon\\n        <10_000_000>\\n        // int amount = 10000000;\\n\\n        // If the message is being censored, the burner must provide 9 X the initial value to a 1 BCH coupon\\n        OP_INPUTINDEX OP_OUTPUTVALUE OP_INPUTINDEX OP_UTXOVALUE OP_10 OP_MUL OP_NUMEQUAL \\n        // bool isPrematureBurn = tx.outputs[this.activeInputIndex].value == tx.inputs[this.activeInputIndex].value*10;\\n\\n        // If this is an early burn (moderation), create a 1 BCH coupon \\n        OP_DUP OP_IF   \\n        //if(isPrematureBurn){\\n\\n            <100_000_000> OP_ROT OP_DROP OP_SWAP\\n            //amount = 100000000;\\n        // } // \\n        OP_ENDIF\\n\\n        // If the message has matured, the full value is used for a coupon\\n        OP_INPUTINDEX OP_OUTPUTVALUE OP_INPUTINDEX OP_UTXOVALUE OP_NUMEQUAL \\n        // bool hasMatured = tx.outputs[this.activeInputIndex].value == tx.inputs[this.activeInputIndex].value;\\n\\n        // If not early, require the message is a week old\\n        OP_DUP OP_IF \\n        // if(hasMatured){\\n\\n            // Require the message be at least a week old\\n            <1000> OP_CHECKSEQUENCEVERIFY \\n            // require(tx.age >= 1000);\\n\\n        // }  //\\n        OP_DROP OP_ENDIF \\n\\n        // If sats specifed a bad locktime (allow an early burn, no coupon, pure MEV)        \\n        OP_NOT OP_SWAP OP_NOT OP_BOOLAND OP_IF \\n        // if(!hasMatured && !isPrematureBurn){\\n\\n            // If the vault time indicated is less than ~2.5 months into the future.\\n            // Let the message be cleared and the value be taken by anyone.\\n            OP_OVER <10_000> OP_SUB OP_CHECKLOCKTIMEVERIFY OP_DROP \\n            // require(tx.time >= ( vaultTime - 10000 ));\\n\\n        // } \\n\\n        // Otherwise, the sats must pay an FBCH coupon\\n        OP_ELSE \\n        // else {\\n\\n            // Calculate the future vault corresponding to the locktime\\n            OP_OVER OP_SIZE \\n            OP_NIP OP_2 OP_PICK \\n            OP_CAT <0xc0d3c0d0a06376b17568c0cec0d188c0cdc0c788c0d0c0c693c0d3c0cc939c77> OP_CAT \\n            // bytes theVault = bytes(bytes(vaultTime).length) + \\n            //                 bytes(vaultTime) + \\n            //                 0xc0d3c0d0a06376b17568c0cec0d188c0cdc0c788c0d0c0c693c0d3c0cc939c77;\\n\\n            // Construct P2SH32 locking bytecode from redeem bytecode\\n            <0xaa20> OP_OVER OP_HASH256 OP_CAT <0x87> \\n            // bytes vaultLockingBytecode = 0xaa20 + hash256(theVault) + 0x87;\\n\\n            // Calculate the coupon vault corresponding to the locktime\\n            OP_CAT OP_DUP OP_SIZE OP_NIP OP_OVER OP_CAT\\n            OP_3 OP_PICK OP_SIZE OP_NIP OP_CAT \\n            OP_3 OP_PICK OP_CAT <0x00cc00c694a16900c788c08bc39c> OP_CAT\\n            // bytes theCoupon =  bytes(vaultLockingBytecode.length) + vaultLockingBytecode +\\n            //                 bytes(bytes(amount).length) + bytes(amount) + \\n            //                 0x00cc00c694a16900c788c08bc39c;\\n\\n            // Construct P2SH32 locking bytecode from redeem bytecode\\n            <0xaa20> OP_OVER OP_HASH256 OP_CAT <0x87> OP_CAT \\n            // bytes couponLockingBytecode = 0xaa20 + hash256(theCoupon) + 0x87;\\n\\n            // Send the message value to the coupon vault.\\n            OP_INPUTINDEX OP_OUTPUTBYTECODE OP_OVER OP_EQUALVERIFY \\n            // require(tx.outputs[this.activeInputIndex].lockingBytecode == couponLockingBytecode);\\n\\n        // } // \\n        OP_2DROP OP_2DROP OP_ENDIF\\n\\n        // Without CashTokens\\n        OP_INPUTINDEX OP_OUTPUTTOKENCATEGORY OP_0 OP_EQUALVERIFY \\n        // require(tx.outputs[this.activeInputIndex].tokenCategory == 0x);\\n\\n    // } // \\n    OP_2DROP OP_2DROP \\n\\n    // Messages on mutable NFTs may be edited (or deleted) using a minting NFT of the same token category.  \\n    // Messages on immutable NFTs may only be deleted. \\n    //\\n    // oldMessage[0]          -> editedMessage[0]\\n    // oldMessage[1]          -> editedMessage[1]\\n    // oldMessage[n]          -> editedMessage[n]\\n    // mintingBaton[in.len-1] -> extendedMessage[n+1]\\n    //                        -> extendedMessage[n+2]\\n    //                        -> mintingBaton[out.len-1]\\n    //\\n    OP_1 OP_ELSE OP_SWAP OP_1 OP_NUMEQUALVERIFY \\n    // function editMessage(){\\n\\n        // Sats must be carried forward.\\n        OP_INPUTINDEX OP_OUTPUTVALUE OP_INPUTINDEX OP_UTXOVALUE OP_NUMEQUALVERIFY \\n        // require(tx.outputs[this.activeInputIndex].value == tx.inputs[this.activeInputIndex].value);\\n\\n        // ... to an output on this same contract\\n        OP_INPUTINDEX OP_OUTPUTBYTECODE OP_INPUTINDEX OP_UTXOBYTECODE OP_EQUALVERIFY \\n        // require(tx.outputs[this.activeInputIndex].lockingBytecode == tx.inputs[this.activeInputIndex].lockingBytecode);\\n        \\n        // But neither the commitment, NFT nor token data are required as outputs. They may be omitted.\\n\\n        // As long as last input carried a matching minting NFT\\n        // \\n        OP_TXINPUTCOUNT OP_1SUB OP_UTXOTOKENCATEGORY OP_INPUTINDEX OP_UTXOTOKENCATEGORY <32> OP_SPLIT OP_DROP OP_2 OP_CAT OP_EQUAL \\n        // require(tx.inputs[tx.inputs.length - 1].tokenCategory == tx.inputs[this.activeInputIndex].tokenCategory.split(32)[0] + 0x02);\\n\\n    // } //\\n     OP_NIP  \\n\\n// } //\\n OP_ENDIF\\n"},"coupon_lock":{"lockingType":"p2sh32","name":"Coupon Lock","script":"<lock> <amount>\\n// contract Coupon(\\n//   // Minimum spent (sats) to claim each coupon utxo.\\n//   int amount,\\n  \\n//   // Contract holding the logic.\\n//   bytes lock\\n// ){\\n\\n//   function apply() {\\n\\n    // assure at the minium amount is sent to the intended contract\\n    OP_0 OP_OUTPUTVALUE OP_0 OP_UTXOVALUE OP_SUB OP_LESSTHANOREQUAL OP_VERIFY\\n    // require((tx.outputs[0].value - tx.inputs[0].value) >= amount);\\n\\n\\n    // Check that the Coupon is interacting with an existing Vault instance \\n    OP_0 OP_UTXOBYTECODE OP_EQUALVERIFY\\n\\n    // require(tx.inputs[0].lockingBytecode == lock);\\n\\n    // The coupon must be spent as the last input, \\n    //   therefore only coupon may be spent at a time.\\n    OP_INPUTINDEX OP_1ADD OP_TXINPUTCOUNT OP_NUMEQUAL\\n    // require(this.activeInputIndex+1 == tx.inputs.length);\\n // }\\n"},"wallet_lock":{"lockingType":"standard","name":"Wallet Lock","script":"OP_DUP\\nOP_HASH160 <$(<key.public_key> OP_HASH160\\n)> OP_EQUALVERIFY\\nOP_CHECKSIG"},"vault_lock":{"lockingType":"p2sh32","name":"Lock Future Vault","script":"<locktime> \\n// contract Vault(int locktime) {\\n\\n    // function swap() {\\n        \\n        // If tokens are flowing back into this contract\\n        OP_INPUTINDEX OP_OUTPUTTOKENAMOUNT OP_INPUTINDEX OP_UTXOTOKENAMOUNT OP_GREATERTHAN OP_IF \\n        // if(tx.outputs[this.activeInputIndex].tokenAmount > tx.inputs[this.activeInputIndex].tokenAmount){\\n        \\n            // Enforce a BIP65 timelock \\n            // Note, intended for use with block height based locks \\n            // (where:  locktime < 500M).\\n            OP_DUP OP_CHECKLOCKTIMEVERIFY OP_DROP\\n            // require(tx.time >= locktime);\\n\\n        //} \\n        OP_ENDIF \\n        \\n        // Inspired by wrapped.cash c. Nov 2023\\n        // Author: Dagur Valberg Johannsson <dagurval@pvv.ntnu.no> \\n        // License: MIT\\n        //\\n        // ensure the token in and out matches\\n        OP_INPUTINDEX OP_UTXOTOKENCATEGORY OP_INPUTINDEX OP_OUTPUTTOKENCATEGORY OP_EQUALVERIFY \\n        // require(\\n        //   tx.inputs[this.activeInputIndex].tokenCategory \\n        //   == \\n        //   tx.outputs[this.activeInputIndex].tokenCategory\\n        //   );\\n\\n        // Enforce that this contract lives on\\n        OP_INPUTINDEX OP_OUTPUTBYTECODE OP_INPUTINDEX OP_UTXOBYTECODE OP_EQUALVERIFY\\n        // require(\\n        //   tx.outputs[this.activeInputIndex].lockingBytecode \\n        //   == \\n        //   tx.inputs[this.activeInputIndex].lockingBytecode\\n        //   );\\n\\n        // ensure the sum of sats and tokens in \\n        // matches the sum of sats and tokens out.\\n        OP_INPUTINDEX OP_UTXOTOKENAMOUNT OP_INPUTINDEX OP_UTXOVALUE OP_ADD\\n        OP_INPUTINDEX OP_OUTPUTTOKENAMOUNT OP_INPUTINDEX OP_OUTPUTVALUE OP_ADD \\n        OP_NUMEQUAL\\n        OP_NIP        \\n        // require(\\n        //   tx.inputs[this.activeInputIndex].tokenAmount + \\n        //   tx.inputs[this.activeInputIndex].value \\n        //   == \\n        //   tx.outputs[this.activeInputIndex].tokenAmount + \\n        //   tx.outputs[this.activeInputIndex].value\\n        //  );\\n//     }\\n// }"},"gantry_lock":{"lockingType":"p2sh32","name":"Gantry","script":"<vault_script> \\n<step> \\n OP_INPUTINDEX OP_0 OP_NUMEQUALVERIFY\\n OP_INPUTINDEX OP_UTXOBYTECODE OP_INPUTINDEX OP_OUTPUTBYTECODE OP_EQUALVERIFY\\n OP_INPUTINDEX OP_UTXOTOKENCATEGORY OP_INPUTINDEX OP_OUTPUTTOKENCATEGORY OP_EQUALVERIFY\\n OP_INPUTINDEX OP_OUTPUTVALUE OP_INPUTINDEX OP_UTXOVALUE <8500> OP_SUB OP_NUMEQUALVERIFY OP_INPUTINDEX OP_UTXOTOKENCOMMITMENT OP_BIN2NUM OP_INPUTINDEX OP_OUTPUTTOKENCOMMITMENT OP_OVER OP_3 OP_PICK OP_ADD OP_4 OP_NUM2BIN OP_EQUALVERIFY OP_DUP OP_ROT OP_DIV OP_10 OP_MOD OP_0 OP_NUMEQUAL OP_IF OP_TXOUTPUTCOUNT OP_1 OP_NUMEQUALVERIFY OP_ELSE OP_DUP OP_SIZE OP_NIP OP_OVER OP_CAT OP_2 OP_PICK OP_CAT OP_HASH256 OP_PUSHBYTES_32 OP_OVER OP_HASH256 OP_CAT OP_EQUAL OP_CAT OP_1 OP_OUTPUTBYTECODE OP_OVER OP_EQUALVERIFY OP_1 OP_OUTPUTTOKENCATEGORY OP_0 OP_OUTPOINTTXHASH OP_EQUALVERIFY OP_1 OP_OUTPUTTOKENCOMMITMENT OP_0 OP_EQUALVERIFY OP_1 OP_OUTPUTTOKENAMOUNT <2100000000000000> OP_NUMEQUALVERIFY OP_1 OP_OUTPUTVALUE <1000> OP_NUMEQUALVERIFY OP_2 OP_OUTPUTBYTECODE OP_OVER OP_EQUALVERIFY OP_2 OP_OUTPUTTOKENCATEGORY OP_0 OP_OUTPOINTTXHASH OP_EQUALVERIFY OP_2 OP_OUTPUTTOKENCOMMITMENT OP_0 OP_EQUALVERIFY OP_2 OP_OUTPUTTOKENAMOUNT <2100000000000000> OP_NUMEQUALVERIFY OP_2 OP_OUTPUTVALUE <1000> OP_NUMEQUALVERIFY OP_3 OP_OUTPUTBYTECODE OP_OVER OP_EQUALVERIFY OP_3 OP_OUTPUTTOKENCATEGORY OP_0 OP_OUTPOINTTXHASH OP_EQUALVERIFY OP_3 OP_OUTPUTTOKENCOMMITMENT OP_0 OP_EQUALVERIFY OP_3 OP_OUTPUTTOKENAMOUNT <2100000000000000> OP_NUMEQUALVERIFY OP_3 OP_OUTPUTVALUE <1000> OP_NUMEQUALVERIFY OP_4 OP_OUTPUTBYTECODE OP_OVER OP_EQUALVERIFY OP_4 OP_OUTPUTTOKENCATEGORY OP_0 OP_OUTPOINTTXHASH OP_EQUALVERIFY OP_4 OP_OUTPUTTOKENCOMMITMENT OP_0 OP_EQUALVERIFY OP_4 OP_OUTPUTTOKENAMOUNT <2100000000000000> OP_NUMEQUALVERIFY OP_4 OP_OUTPUTVALUE <1000> OP_NUMEQUALVERIFY OP_5 OP_OUTPUTBYTECODE OP_OVER OP_EQUALVERIFY OP_5 OP_OUTPUTTOKENCATEGORY OP_0 OP_OUTPOINTTXHASH OP_EQUALVERIFY OP_5 OP_OUTPUTTOKENCOMMITMENT OP_0 OP_EQUALVERIFY OP_5 OP_OUTPUTTOKENAMOUNT <2100000000000000> OP_NUMEQUALVERIFY OP_5 OP_OUTPUTVALUE <1000> OP_NUMEQUALVERIFY OP_6 OP_OUTPUTBYTECODE OP_OVER OP_EQUALVERIFY OP_6 OP_OUTPUTTOKENCATEGORY OP_0 OP_OUTPOINTTXHASH OP_EQUALVERIFY OP_6 OP_OUTPUTTOKENCOMMITMENT OP_0 OP_EQUALVERIFY OP_6 OP_OUTPUTTOKENAMOUNT <2100000000000000> OP_NUMEQUALVERIFY OP_6 OP_OUTPUTVALUE <1000> OP_NUMEQUALVERIFY OP_7 OP_OUTPUTBYTECODE OP_OVER OP_EQUALVERIFY OP_7 OP_OUTPUTTOKENCATEGORY OP_0 OP_OUTPOINTTXHASH OP_EQUALVERIFY OP_7 OP_OUTPUTTOKENCOMMITMENT OP_0 OP_EQUALVERIFY OP_7 OP_OUTPUTTOKENAMOUNT <2100000000000000> OP_NUMEQUALVERIFY OP_7 OP_OUTPUTVALUE <1000> OP_NUMEQUALVERIFY OP_8 OP_OUTPUTBYTECODE <OP_RETURN <\'FBCH\'>> OP_4 OP_PICK OP_SIZE OP_NIP OP_CAT OP_4 OP_PICK OP_CAT OP_EQUALVERIFY OP_8 OP_OUTPUTTOKENCATEGORY OP_0 OP_EQUALVERIFY OP_8 OP_OUTPUTVALUE OP_0 OP_NUMEQUALVERIFY OP_TXOUTPUTCOUNT OP_9 OP_NUMEQUALVERIFY OP_2DROP OP_ENDIF OP_2DROP OP_1"},"battery_lock":{"lockingType":"p2sh32","name":"Battery","script":"<vault_script> <gantry_script> <857000> <1_000_000> OP_INPUTINDEX OP_UTXOTOKENCOMMITMENT OP_BIN2NUM OP_2 OP_PICK OP_3 OP_ROLL OP_2 OP_PICK OP_MOD OP_SUB OP_OVER OP_ADD OP_4 OP_NUM2BIN OP_0 OP_OUTPUTTOKENCOMMITMENT OP_EQUALVERIFY OP_3 OP_PICK OP_SIZE OP_NIP OP_4 OP_ROLL OP_CAT OP_OVER OP_SIZE OP_NIP OP_CAT OP_OVER OP_CAT OP_3 OP_ROLL OP_CAT OP_HASH256 OP_PUSHBYTES_32 OP_SWAP OP_HASH256 OP_CAT OP_EQUAL OP_CAT OP_0 OP_OUTPUTBYTECODE OP_EQUALVERIFY OP_INPUTINDEX OP_UTXOTOKENCATEGORY <32> OP_SPLIT OP_DROP OP_1 OP_CAT OP_0 OP_OUTPUTTOKENCATEGORY OP_EQUALVERIFY OP_TXOUTPUTCOUNT OP_2 OP_NUMEQUALVERIFY OP_0 OP_OUTPUTVALUE <42500000000> OP_2 OP_PICK OP_DIV OP_GREATERTHAN OP_VERIFY OP_1 OP_OUTPUTVALUE OP_INPUTINDEX OP_UTXOVALUE <42500000000> OP_3 OP_PICK OP_DIV OP_SUB <1800> OP_SUB OP_GREATERTHAN OP_VERIFY OP_DUP OP_ROT OP_GREATERTHAN OP_IF OP_1 OP_OUTPUTTOKENCOMMITMENT OP_OVER OP_10 OP_DIV OP_4 OP_NUM2BIN OP_EQUALVERIFY OP_1 OP_OUTPUTTOKENCATEGORY OP_INPUTINDEX OP_UTXOTOKENCATEGORY OP_EQUALVERIFY OP_1 OP_OUTPUTBYTECODE OP_INPUTINDEX OP_UTXOBYTECODE OP_EQUALVERIFY OP_ELSE OP_1 OP_OUTPUTTOKENCATEGORY OP_0 OP_EQUALVERIFY OP_ENDIF OP_DROP OP_1"}}'),p0=["BCH_2023_05","BCH_SPEC"],C={$schema:l0,description:f0,name:O0,entities:b0,scenarios:P0,scripts:_0,supported:p0},h0=[3,4,5,6],g0=[-1,0,1,2],R0=new Map([["16dac7ae826ad3913db3b1f0c1db567e3086a7591334c0fd3667ab13e51ae831",858e3],["0cc1cb6033617c83ba69e158398f7d3097ee9fc538f52075a3a2df0af206b819",859e3],["ca323c19cf6fc269822c6bfdda13f5c062c67bc3a20dbe73d87c43e1b2baca95",86e4],["a42742e4188780dbdc6017016e2d49803eedfe0881805d2b19bc0e93fcae96ee",861e3],["bdaaf2610c0a4ae34c0d7432f39aaaa4b5467d2f8e5255018ea073e1a558a678",862e3],["89a2430a98bb92b504d6d23182d4b0d3c9455b4d9e9671aeae4b09208f1df584",863e3],["7face04783f30345a6d48cd7747a7cabf92b6c0523f2e021c238573c691f2438",864e3],["09dabc81889bd7d1301f7e0620301460bcc0f754ab9b9838b881b72182b1d502",865e3],["b2a37403c5d97bf6c2e1338c054b6d73eef1543137cea85b6ab9eaeff5a43087",866e3],["30d336f109876e8a66a6da63ac52c807e85e2bba00204f1b010ef9cd42fd98b7",867e3],["28afff19a58a8ad529aa5631bc3576e9ab19675e541b28963b61e53055e77942",868e3],["357ce1027d7f07f6c0c8bb79ccd2e0f2d44e9f2e91a754befc66380cdbaa6449",869e3],["d861cd6420db1e280764b846bac790cc86c1e7ea93adecb2d1c9b4289eeaa1a8",87e4],["08cd919b34a789bc07a37c6c68e9d15f105a36010fcb8a8bd017190fff84a6b8",871e3],["f55d2e61aadc9519d1c0a346cbbc7766a5e871660a3c25b61eb517be200f901c",872e3],["e9c7dca6f33c7c963bbbb7f72e85d5181d76ad9eb26d8ac7e0765921e6bc7248",873e3],["a0055c80f357a2e14b203274cbe0f211bd25ad4032deab59dba1187397a23a0f",874e3],["3c1136e10ba3a3852f1ab3d1bff1727c3b9c7782a8cb84fba5706ffaccfae24c",875e3],["cdbc9154e80320895be94b616624ea967e6121879476dd285470a297e0f94e6c",876e3],["5c88fbc5e0a8e828050bf83b3ebfc9b8d151c77079b4079e4f620588c2989ac1",877e3],["53047c3ecccf16318a8a49376213e7695b81392c18a9a88ade84157ef3c4b793",878e3],["b49acab285c26cfeac6cd8c3deabf8a04ed9eefd522ce5559342e526a3b35cc9",879e3],["812006db91178d966c52207b32b46b337e5a6c1c87196e1af36834606205a2bb",88e4],["31225667a83a30779e44dbb19f4251820ee4e00b13c3b5ae8d00bca2351c3981",881e3],["5891be47b3b87d848678462eb65f82c3bd2e450693d5f5a6ab5b16ac3b6d8bd2",882e3],["dde1e93679e85d7c894285fc4cb95a5e717918f56ff405d9a740f2be82a301cb",883e3],["68931d718e1482c0d1a4ff73daa4cd7e6a1e22ca9e66d552bcb21ae861737115",884e3],["019fbdca8662a1f6b617e3385c1dd903cde128d5d2d0b270015baacff1949ec0",885e3],["a4d1892a9a2319c7e23933f98a926b00877556162ca64a3668182d9a388c8d27",886e3],["e337b4468fd9a737968cd82b09dfd91884220134994949f9e8c1dc70c3471f5b",887e3],["8385c083c569dcceb6dff0d08b950d35822c4ccd5fa40084071346df677550b4",888e3],["55727d2dee32dca41f4d31434c28b2324b8d1e06ff26282ff451ea5329f0e153",889e3],["988fd2522d329f6fc079929e86baadf9e636763b5351296d18aa199b13b4493d",89e4],["5ec2629236f62393d1d3da47c764553aa7057a83ee60383225d1397573bd9f9f",891e3],["336a642ace9290d91a1189b576236d9c8c7fffa01eea388a8b3bb635c94a6cc3",892e3],["edbbb22cda1b04ffa4741c51f35d506002d4dc5b9a36c9cb3aa3fe578303af3f",893e3],["3753b96d4a6d246c72fe5469e4e79361af59186168ffa26b89f29cf037fc0e3f",894e3],["ca95807958352f83fec68c5e0bc7ca30e211a7bdeb1801eac4573e9cbc0730a8",895e3],["30834fbca4bbd8e2bd5c4754395a21b2af24e7759cbc882a9df4dab1e953411a",896e3],["78687328f1f07a5a58d9d1e70b30cbb854205520e9e1787b2460b0222f3623ff",897e3],["8b97fc83485dd45ae2122f163de5897eafcdec81dbf779e4153548e24bd556ed",898e3],["5f1abc1bf36ea45291c0d303f9a63b5c8632687e6b1b224beb3b311fa0685812",899e3],["4575d242087a5e8a574be521ff8eef4ac1a7ee9a012834821a1272503e2e880a",9e5],["9c5f32f489b49f56ebe172d5f1a2f9f0ad467d8f05c3af42d9baa1778c04598c",901e3],["ca17a6b04e5217db5783a96ff8501c37977ef6f54ad67a7496efe9105b34d897",902e3],["9e405b79a5784a1b4179dba017ea01fa77c5d0b050d0852983ec2a00f88c870b",903e3],["645d0dbc137e0cfaacd8412b62884f55a0de158ef0e504b3df4058b29caf8786",904e3],["bae12c5a0b11e9f85e2d1d1d07b0d1a1edf3dba0fa36e48cf73f48a69709240c",905e3],["448c2a2f5f871d654c7263f315a7bfb875e12f2a39b78decd35d03273acb23bf",906e3],["7d28d82f8899bb1739dc2645bebf50b7c5e18c92eb6838b42aea02920d8c4cb8",907e3],["567cca6bfeef85f1958bd11c022c9e41a8fa5a0d2a26e5e1405b1e70805e480d",908e3],["cda41febe6abe5bd56be403792a357d5adfcfe129d960833d157db50175ea493",909e3],["7d83793c073bf83162a1d710fe973bfa040cefedd699dca2a6a96243ecc45ef4",91e4],["46cd3f632d9708bdc95a60eee153be0536fec4d175b4c17702103ac9ba685884",911e3],["7c81b949b796ba3ec164695c6cc4ca3bcff973df3808ae34162777063fd3c885",912e3],["61bcab4ddf4d7b172e06f29ff466ce5e275d4476a5dd7d1f8177c63f3b9ddcbe",913e3],["f7b3c495ff4128b52507c683a04e06955db0356401a16ffe5c88ed3e276fc474",914e3],["e95ae8fe9541fd93daab84e4a2b70e73edf54b570875ff62e8c68602abe6d5f6",915e3],["7adc06cea8abb9ebd52753a604404073c54ba17f187660188952864b6f4c93f0",916e3],["7bb445f53e8b05945e2d64cdb0cf32a633026389813edd978cefd5e278647207",917e3],["717ffab63d7edfcef357eac158ab52590dd3a6588726f855abd0cee0169708f6",918e3],["e602521afca264ba6fec44dd61b4b740aba3965488ee06f91ed452a7256a38b6",919e3],["13117fb7ee0827bbf577772515643dd8052a71981e6f6c4d9001ded23f214fa3",92e4],["402ec1aa54d4aee881a299c172c4e4e7d275dec797ec24a7f7d5197f68d24b15",921e3],["426a8a1772efdaff9f5612d77ea9bdb629a7239283e86d32a2c0a1d3709366a3",922e3],["532dcc825f20b26d5d4bc48338c8605697c60d47f0c325f9bcb3fac4c99a665b",923e3],["d389e0804e502f284051220656e9f799c456fbd1fa3c422dcbe223cd91d9f139",924e3],["e8cc1205260eef7652d8eba8136d95cd04f10e74ab43901cf39b5b936cc7acb8",925e3],["076bec7bd4a15ff4b9bd49d34a2d2096fa158ab97adc697cf6482c0d3c1975c8",926e3],["1563ee90b05893b7e90340732cb2ab5071ce6f8590feda7b1bcf536f59953e36",927e3],["10e42bbc6ebed71bbd021ca238b479e3a15e90b295b63b246974bfb598982c4d",928e3],["79a48064600e68b36ecedcbd5315fff5572576bf038ebbf5d6ddc54b0f411edb",929e3],["bb85461930db00680ad4e93876f87463e351a9686d98448a7cb8e9d9500a2dcb",93e4],["2c8d115341c2f0cce4c21034e11308ea17acf612548c211ef56bbd4e993d8eaf",931e3],["8825efd15c4a3f407c477b52d3e3ccd0d20f79d543dccc178a05a5a6ec4e95e1",932e3],["6dfd3dd2586671fa49ea35e0b411e711c4b0b2d81ba2dfa9069225290449d2c7",933e3],["8c21209f83685bc6cbe8adeb809a6a2e4c743a987608a262680d492e12fa3456",934e3],["8b7f2755c522f06cb3de2a921b236f94e40f40d1e590e2b4a25d709b4a89e9e6",935e3],["e2f7333f3b20243e58d63dd894b89d9eb8d6a88fd17f86676689f4fc0e30e082",936e3],["4304b54c8b217d58a7d2c62d3941811a6a6e86e027ea46fc548fdc74107e5928",937e3],["b675520e9b828c8a16f1acc8f7396c36f67bd616283ffd759e9ad89fc91ab421",938e3],["9bd91f3c1c255f8a3839287160c2718100a8fbd320906bc7e8fae4b80a9491a7",939e3],["f05609733ca9699b72bb17ef4dfb9bcd78603d57a2d8ec2879f2bfae1262709e",94e4],["609c121384f469657fcff4768ea81abc35cbc0664e0c4930a49af34e1b1f117d",941e3],["fc552c7600bddf806cf70a43db497de0444312e972bbe0e5cc91bc0ca5c27f9c",942e3],["56ebf2117caf4a7906f0de14198a40bec3243f4ee3e59e59308c7d4ab064adf6",943e3],["f81ca1e0b315c2ca2f1278ec052bbf2d7cbcbc21dd0146512ef0eca33872c6a3",944e3],["33226b6126b666635a6c40ab104a3b313248f6422d0ed96493c8068af83df2ce",945e3],["e5b30ed135b1a8c4884b72c5bbf58357c3095880d2d82faaf55673f574069977",946e3],["281b06dda54ec91628986ff9881569f9eb66caddb5f2e560dd1fead5fc7af9d5",947e3],["c49130a6b5e71959a7bba89aa1109357c2b31079976a50e348ee800b670fe3a9",948e3],["7f2a81b1c67891e4932dd4491e290a32e95db022590e67d601ccf0fa1b6e009d",949e3],["14a5b06bf5203ce053a7e4101176135d09591956d488c96cf585e813ba9a2026",95e4],["fd4e8d0419f0db4d29ec2f87ea6d4ab2dd53cdfb4161cec85e7a371ca5e15d21",951e3],["81fe6b90f20d432c8a132b94afcd05dacfbeef5f0cd81ab7bdb5161b5a799f2d",952e3],["2473ef8a484a8f9fc301e4564176e18ec763694814191d5a2572aa227d972d9f",953e3],["c52ae4969cb658fa14dad5e740b4bbb0634d78d54f424583901f3111ef1ab0c1",954e3],["a416fd7ab1c2b09f93936b85e4e47fbdc0289e330e21a269ab4f5d8ffea53820",955e3],["4b17351c0b18675a59ab9813486097ee77151df43bd91ec8161dc9fb8f71af42",956e3],["29b6f97ff15d2335c1fb2edb341606a3a6d0a6a0611a027812e9d280e9325244",957e3],["fb73bd73fdb0b81c161e6f3b26213f6a8ef678bdb2ab03261f350038a5f167aa",958e3],["17087e7739a1f2de923939984e489ed96941583655d7599c006fc259a0854208",959e3],["c487cd1882c8b33e3b7fcdb151b8b597971b432f163a86ffbe36c9b4203a0a9c",96e4],["1729bbb68107953a8742137249e89db6bc6658987539d70976059700ec1683f3",961e3],["79e18ce094e4b5c65e7722ffe01cecc1eeab1511af4f50d814f3684e90521dd2",97e4],["05590cd644d3c9e9e4c28ae9bfd7a3a5ab47d3e230544e109502aa0e58ac2770",98e4],["6e117ef48d571fa7bb6f4850bc2d532d8417fa240a365e5188967e1f52e3f05c",99e4],["29db350a88f66124229824e75b753432551f59b972b0175eb7d71e528b9073cb",1e6],["f48d7a05100f416d12c775b6f56d11f3b77a609cae677e328c10775534f5ac34",101e4],["ca0ee31c809597bfec4afef784f7da59374556e80d8407fba1779c89b5be2e41",102e4],["4ba06592954448468547775103229485d001e71d91084375c33b396490cd4b6c",103e4],["9877da4c1bac6178b1fe80c21e6a330ae86b3f783ea1915dfbbd7c06d6825861",104e4],["00f01ec3711703677bc1b96e4d9391568c7158049ebadf0385dd216d37a0e9c3",105e4],["b9024d48f71a3fab09c788563ce0b1bbc113b6b662989283fbd3d541afbf7a1a",106e4],["36593517db2ab8f8d6e2520ccbeaa049262f71db4888de10d087883c3a917f91",107e4],["58b867bc4e0b3ca7cc296303eaade403975b7a6a0d289bc60e9342bbf92e7bf0",108e4],["973cd634204cbac0df4235289d0365a9a375dc5e11a8d2e325e378b264582721",109e4],["889cc584b5eea00c13e48258199f066bbeb0e88b6ce65519fe2312f4cf37b40d",11e5],["d55621c14ed467198a9c58d92f784479a5aef8f0e7f9bc859d83112360e16480",111e4],["39ef8ac95f3ee553f9ee86da8f73d160de9a159eafb5c611de771d2891fcc2e7",112e4],["6aac3c903d5e55821ad4fdbd9f9ee3aceb89f91b66b6467034165ab7fb588e70",113e4],["2da7a5fcd209f68ad1dbf4c68f6ab3c3c0150682ec525de52ab93135d2b26cf3",114e4],["69ff94cc9b14a102f1d6a8df5dc55d86b97907533bac1c2aeab9ec33c045a76a",115e4],["d9d7b5d6d71a5fefaba74a25deffff74454064bbd08ddd24f3619b1d27ceff91",12e5],["fbc3b05d84ae0972ab3a2028d8980f3a597ab89fe075c1bd6129f3c890d67b0f",13e5],["e2170fd75867a4d0b8df24204aea8aebb33a7d699e058a6ab42f0254bca9026b",14e5],["e9057952ded4aad0480169d390906ac619e0d6e31614534f1dcb954e222524f1",15e5],["08a24b2ca498845e4929a017614252ec674f48641b2119b1ae8411deb424bdf6",16e5],["b9fb0b7e67bb69cb4b634ddc0efe4b578eda4fc48c870b2ce398d850bf4a28da",17e5],["3cf5fec8745e0dd77c5b622699d95fe9c9955583e1d97974045958a9406f6256",18e5],["8848979f5e377eb7aa7d9a4c2c67ab20a7de917409a52ce482a8f9987910f502",19e5],["edad1c825338554b83e562aab2c2b220569033a2ccbd970975f3ddda320b70e1",2e6],["1654b42288a501e82ad48195d8a15382ad57d0a684caa8a07767b4552166ef3f",21e5],["d95d8dab23deeea1119e6ea9a7d2efdde31c1f8d9386c42d7962a5ed2b539d32",22e5],["8d672efb35d6e36767cc650ed215955d46fef715421de17d1c15257b9bb89528",23e5],["70c090c733864629e0b1674cb81a943bebb47cbeb6a66134430cb9d39b7157b6",24e5],["3e22adf69fb684e970cb98eefa386fdbf34656d1c907e58308e5e7f27bf9c9f3",25e5],["6df2d7adae18b5270a65d51c2bff426b3c0dae4f23d9efdbdf7dd984e4acc164",26e5],["3d3a57df1e7a91939eca1b7d45fb7289ef3e2b9a765eb3621f1f20275361074a",27e5],["b8f55be2a6e3d5a57536c8cdf235ffe43a240b06868179d0d427ca64f58a87ba",28e5],["03882c71eb1eced84a39fd392df210bb175e6a109bd0c918444b93b67ea8854a",3e6],["5e296fd6ce4c63996094f4ddb22441867411a6bcbb732430ad4f4cc6b4fb3480",4e6]]);function X(d){if(!d)return new Uint8Array(0);const e=d.replace(/^0x/,"");return(e===d?Q:l)(e)}function j(d,e,t,a=1e8){return e<=d?{spb:1/0,ytm:1/0,ypa:1/0}:(t-=870,{spb:Math.round(Number(t/(e-d)/((a-t)/1e8)+Number.EPSILON)*100)/100,ytm:Number(t/(a-t)*100),ypa:Number(t/(a-t)*100*(52596/(e-d)))})}function m0(d,e,t,a=1e8){let c=j(d,e,t,a);return{spb:c.spb.toLocaleString(void 0,{maximumFractionDigits:0,minimumFractionDigits:0}),ytm:c.ytm.toLocaleString(void 0,{maximumFractionDigits:1,minimumFractionDigits:1}),ypa:c.ypa.toLocaleString(void 0,{maximumFractionDigits:1,minimumFractionDigits:1})}}function T0(d,e){const t=e-d;var a=new Date;return a.setTime(a.getTime()+6e5*t),a}function E0(d,e){var t=T0(d,e);let a=e-d,c={};return a<200?c={month:"numeric",day:"numeric",hour:"numeric",hourCycle:"h24"}:a<1e3?c={month:"numeric",day:"numeric"}:a>2e5?c={year:"numeric"}:a>5e4?c={year:"numeric",month:"numeric"}:c={month:"numeric",day:"numeric",year:"numeric"},new Intl.DateTimeFormat(void 0,c).format(t)}async function U0(d,e){let t=(await $(u0,e.map(c=>[d,c]))).flat();var a=new Map;return t.map(c=>a.set(c.tx_hash+":"+c.tx_pos,c)),a}class z{static compiler=K(C)}class U{static USER_AGENT=F.name;static tokenAware=!1;static template=C;static vm=M();static compiler=z.compiler;amount=1e6;lock=new Uint8Array(0);static unlockingScript="00cc00c694a16900c788c08bc39c";static getScriptHash(e,t,a=!0){return V(this.getLockingBytecode(e,t),a)}static getAddress(e,t,a=L.mainnet){let c=this.getLockingBytecode(e,t),n=x({bytecode:c,prefix:a,tokenSupport:!1});if(typeof n=="string")throw n;return n.address}static getUnlockingBytecode(e,t){const a=A(g(BigInt(e))),c=A(t),n=l(this.unlockingScript);return new Uint8Array([...c,...a,...n])}static getLockingBytecode(e,t){return new Uint8Array([...l("aa20"),...q(this.getUnlockingBytecode(e,t)),...l("87")])}}class D{static USER_AGENT=F.name;static tokenAware=!0;static compiler=z.compiler;static template=C;static vm=M();locktime=0;static getScriptHash(e,t=!0){return V(this.getLockingBytecode(e),t)}static getAddress(e,t=L.mainnet,a=this.tokenAware){let c=this.getLockingBytecode(e),n=x({bytecode:c,prefix:t,tokenSupport:a});if(typeof n=="string")throw n;return n.address}static getCouponAddress(e,t,a=L.mainnet){return U.getAddress(e,this.getLockingBytecode(t),a)}static getCouponScriptHash(e,t){return U.getScriptHash(e,this.getLockingBytecode(t))}static getCouponLockingBytecode(e,t){return U.getLockingBytecode(e,this.getLockingBytecode(t))}static getUnlockingBytecode(e){const t=this.compiler.generateBytecode({data:{bytecode:{locktime:g(BigInt(e))}},scriptId:"vault_unlock"});if(!t.success)throw new Error("Failed to generate bytecode, script: FutureChan, "+JSON.stringify(t,null,"  "));return t.bytecode.slice(1)}static getLockingBytecode(e){const t=this.compiler.generateBytecode({data:{bytecode:{locktime:g(BigInt(e))}},scriptId:"vault_lock"});if(!t.success)throw new Error("Failed to generate bytecode, script: , "+JSON.stringify(t,null,"  "));return t.bytecode}static getSeriesTimes(e,t=3,a=10){const c=Math.pow(10,t),n=e-e%c+c;return Array.from({length:a},(s,i)=>n+c*i)}static getAllCouponSeries(e,t){t||(t=h0.map(s=>this.getSeriesTimes(e-1e3,s,s==6?4:void 0)).flat()),t=[...new Set(t)];let c=g0.map(s=>Math.pow(10,s)*1e8).map(s=>t.map(i=>{let o=U.getScriptHash(s,this.getLockingBytecode(i));return{locktime:i,placement:s,order:Math.log10(s/1e8),scripthash:o,lockingBytecode:_(U.getLockingBytecode(s,this.getLockingBytecode(i)))}})).flat();var n=new Map;return c.forEach(s=>n.set(s.scripthash,s)),n}static async getAllCouponUtxos(e,t){let a=D.getAllCouponSeries(t),c=await U0(e,[...a.keys()]);return c.forEach((n,s,i)=>{let o=a.get(n.scripthash);o&&i.set(s,{...n,...j(t,o.locktime,Number(n.value),o.placement),locale:m0(t,o.locktime,Number(n.value),o.placement),...o,dateLocale:E0(t,o.locktime)})}),Array.from(c.values()).sort((n,s)=>s.spb-n.spb)}static getSourceOutput(e,t){return{lockingBytecode:this.getLockingBytecode(t),valueSatoshis:BigInt(e.value),token:{category:l(e.token_data.category),amount:BigInt(e.token_data?.amount)}}}static getCouponSourceOutput(e,t,a){return{lockingBytecode:this.getCouponLockingBytecode(t,a),valueSatoshis:BigInt(e.value)}}static getInput(e,t){return{outpointIndex:e.tx_pos,outpointTransactionHash:l(e.tx_hash),sequenceNumber:0,unlockingBytecode:{compiler:this.compiler,script:"vault_unlock",data:{bytecode:{locktime:g(BigInt(t))}},valueSatoshis:BigInt(e.value),token:e.token_data?{category:l(e.token_data.category),amount:BigInt(e.token_data.amount),nft:e.token_data.nft?{commitment:l(e.token_data.nft.commitment),capability:e.token_data.nft.capability}:void 0}:void 0}}}static getCouponInput(e,t,a){return{outpointIndex:e.tx_pos,outpointTransactionHash:l(e.tx_hash),sequenceNumber:0,unlockingBytecode:{data:{bytecode:{amount:g(BigInt(t)),lock:this.getLockingBytecode(a)}},compiler:this.compiler,script:"coupon_unlock",valueSatoshis:BigInt(e.value)}}}static getOutput(e,t,a){return{lockingBytecode:{compiler:this.compiler,data:{bytecode:{locktime:g(BigInt(a))}},script:"vault_lock"},valueSatoshis:BigInt(e.value)+t,token:{category:l(e.token_data.category),amount:BigInt(e.token_data?.amount)-BigInt(t)}}}static getWalletSourceOutput(e,t){return{lockingBytecode:t?Z({addressIndex:0,hdPrivateKey:t}):Uint8Array.from(Array(33)),valueSatoshis:BigInt(e.value),token:e.token_data?{category:l(e.token_data.category),amount:BigInt(e.token_data?.amount)}:void 0}}static getWalletInput(e,t,a=0){let c=t?{compiler:this.compiler,data:{hdKeys:{addressIndex:a,hdPrivateKeys:{wallet:t}}},script:"wallet_unlock",valueSatoshis:BigInt(e.value)}:Uint8Array.from(Array());return e.token_data&&(c.token={amount:BigInt(e.token_data.amount),category:l(e.token_data.category)}),{outpointIndex:e.tx_pos,outpointTransactionHash:l(e.tx_hash),sequenceNumber:0,unlockingBytecode:c}}static getFutureOutput(e,t,a,c=0){return{lockingBytecode:a?{compiler:this.compiler,data:{hdKeys:{addressIndex:c,hdPublicKeys:{wallet:S(a).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:800n,token:{category:t,amount:e}}}static getChangeOutput(e,t,a=0){return{lockingBytecode:t?{compiler:this.compiler,data:{hdKeys:{addressIndex:a,hdPublicKeys:{wallet:S(t).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:e}}static getVaultLayers(e,t,a,c,n=[]){let s=[],i=[];if(e=e.filter(r=>r.token_data?.category==_(c)),t<0&&(e=e.filter(r=>r.value>800)),e.length==0)throw Error("no vault utxos left, maximum recursion depth reached.");const o=Math.floor(Math.random()*e.length),u=e[o];if(e.splice(o,1),s.push(this.getInput(u,a)),n.push(this.getSourceOutput(u,a)),t<0&&-u?.value<t||t>0&&BigInt(u?.token_data?.amount)>t)i.push(this.getOutput(u,BigInt(t),a));else{t<0&&t<-(u?.value-800)&&(i.push(this.getOutput(u,-BigInt(u?.value-800),a)),t+=u?.value-800);let r=this.getVaultLayers([...e],t,c,[...n]);s.push(...r.inputs),i.push(...r.outputs),n=r.sourceOutputs}return{inputs:s,outputs:i,sourceOutputs:n}}static getCouponLayer(e,t,a,c=[]){let n=[],s=[];return n.push(this.getCouponInput(e,t,a)),c.push(this.getCouponSourceOutput(e,t,a)),{inputs:n,outputs:s,sourceOutputs:c}}static getWalletLayers(e,t,a,c,n=[]){let s=[],i=[];if(t>0&&(e=e.filter(f=>!f.token_data)),t<0&&(e=e.filter(f=>f.token_data?.category==_(c))),e.length==0)throw Error("no wallet utxos left, maximum recursion depth reached.");const o=Math.floor(Math.random()*e.length),u=e[o];e.splice(o,1),s.push(this.getWalletInput(u,a)),n.push(this.getWalletSourceOutput(u,a));let r=T(n),O=I(n,_(c));if(t<0&&O>=-t||t>0&&r>t){t>0&&i.push(this.getFutureOutput(t,c,a,0)),t<0&&i.push(this.getFutureOutput(O+t,c,a,0));let f=r-(t+800n);i.push(this.getChangeOutput(f,a))}else{let f=this.getWalletLayers([...e],t,a,c,[...n]);s.push(...f.inputs),i.push(...f.outputs),n=f.sourceOutputs}return{inputs:s,outputs:i,sourceOutputs:n}}static swap(e,t,a,c,n,s,i=1){const o=[],u=[];let r=[...new Set(t.map(h=>h.token_data?.category))];if(r.length!=1)throw Error("Future vault UTXOs may only contain a single future token series");let O=r.pop(),f=l(O),b={locktime:0,version:2,inputs:o,outputs:u};a=a.filter(h=>h.token_data?.category==O||!h.token_data);let m=this.getVaultLayers([...t],e,c,f);b.inputs.push(...m.inputs),b.outputs.push(...m.outputs);let P=m.sourceOutputs,v=this.getWalletLayers([...a],BigInt(e),n,f);b.inputs.push(...v.inputs),b.outputs.push(...v.outputs),P.push(...v.sourceOutputs);const k=b.outputs.length-1;if(s){let h=this.getCouponLayer(s,e,c);b.inputs.push(...h.inputs),P.push(...h.sourceOutputs),b.outputs[k].valueSatoshis=b.outputs[k].valueSatoshis+BigInt(s.value)}let p=B(b);if(!p.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(p.errors,null,"  "));const e0=W(p.transaction,i);if(b.outputs[k].valueSatoshis=b.outputs[k].valueSatoshis-e0,p=B(b),!p.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(p.errors,null,"  "));const E=p.transaction,w=G(E,P,{maximumTokenCommitmentLength:40});if(w!==!0&&i>0)throw w;let y=this.vm.verify({sourceOutputs:P,transaction:E}),Y=T(P)-T(E.outputs);Y>5e3&&(y=`Excessive fees ${Y}`),I(P,O)==0n&&(y="Error checking token input");let H=I(P,O)-I(E.outputs,O);return H!==0n&&(y=`Swapping should not create destroy tokens, token difference: ${H}`),{sourceOutputs:P,transaction:E,verify:y}}}const R=2147483648;class N{hash;auth;height;sequence;body;likes;dislikes;ref;error;constructor({hash:e="",auth:t="",height:a=-1,sequence:c=-1,body:n="",likes:s=0,dislikes:i=0,ref:o="",error:u=""}){this.hash=e,this.auth=t,this.height=a,this.sequence=c>R?c-R:c,this.body=n,this.likes=s,this.dislikes=i,this.ref=o,this.error=u}}function V0(d){const e=l(d),a=o0(e).split(" ").pop().substring(2);return J(l(a))}function k0(d,e,t,a){if(!a)return;let c=n0(l(a));if(typeof c=="string")return new N({height:e,hash:t,error:c});if(!c.outputs[0].token)return;if(!c.outputs[0].token.nft)return new N({height:e,hash:t,error:"no nft on first output"});if(!c.outputs[0].token.nft.commitment)return new N({height:e,hash:t,error:"no nft commitment first output"});let n="",s="",i=0,o=0;const u=c.outputs.filter(r=>_(r.lockingBytecode)==d).filter(r=>r.token).filter(r=>r.token?.nft).map(r=>_(r.token?.nft?.commitment));if(u&&u[0])return u[0].slice(0,8)=="6a025630"&&(n=u.map(r=>r.slice(10)).join("")),u[0].slice(0,8)=="6a0256b2"&&(s=u[0].slice(10),i=1),u[0].slice(0,8)=="6a02562d"&&(s=u[0].slice(10),o=1),new N({hash:t,auth:_(c.outputs[0]?.token?.category),body:J(l(n)),height:e,sequence:c.inputs[0]?.sequenceNumber,ref:s,likes:i,dislikes:o})}function y0(d,e){for(var t=[],a=0,c=d.length;a<c;)t.push(d.slice(a,a+=e));return t}const I0=(d,e)=>e<=0&&d>0?-1:e>0&&d>0?Math.sign(d-e):Math.sign(e-d);function M0(d,e,t){const a=_(N0.getLockingBytecode(t)),c=new Map(e.map(o=>[c0(_(q(l(o)))),o]));let n=d.map(o=>k0(a,o.height,o.tx_hash,c.get(o.tx_hash))).filter(o=>o!=null),i=n.filter(o=>o.likes==1).map(o=>o.ref).reduce((o,u)=>o.set(u,(o.get(u)||0)+1),new Map);for(const o of n)o.likes=i.get(o.hash)?i.get(o.hash):0;return n=n.sort((o,u)=>u.height===o.height||u.height<=0&&o.height<=0?Math.sign(o.sequence-u.sequence):I0(o.height,u.height)),n.filter(o=>o.body!="")}class N0{static USER_AGENT=F.name;static PROTOCOL_IDENTIFIER="U3V";static tokenAware=!0;static template=C;static compiler=K(this.template);static vm=M();static getLockingBytecode(e){const t=this.compiler.generateBytecode({data:{bytecode:{channel:X(e)}},scriptId:"channel_lock"});if(!t.success)throw new Error("Failed to generate bytecode, script: , "+JSON.stringify(t,null,"  "));return t.bytecode}static getScriptHash(e,t=!0){return V(this.getLockingBytecode(e),t)}static getAddress(e="",t="bitcoincash"){return t0(this.getLockingBytecode(e),t,this.tokenAware)}static getInputs(e,t,a,c=!1){return t.map(n=>this.getInput(e,n,a,c))}static getInput(e,t,a,c=!1){let n=c?"edit_message":"process_message";const s=a-t.height>=1e3?1e3:0;return{outpointIndex:t.tx_pos,outpointTransactionHash:l(t.tx_hash),sequenceNumber:s,unlockingBytecode:{compiler:this.compiler,script:n,data:{bytecode:{channel:X(e),locktime:g(BigInt(Number(t.value)/10*1e3))}},valueSatoshis:BigInt(t.value),token:t.token_data?{category:l(t.token_data.category),amount:BigInt(t.token_data.amount),nft:t.token_data.nft?{commitment:l(t.token_data.nft.commitment),capability:t.token_data.nft.capability}:void 0}:void 0}}}static getSourceOutputs(e,t){return t.map(a=>this.getSourceOutput(e,a))}static getSourceOutput(e,t){return{outpointIndex:t.tx_pos,outpointTransactionHash:l(t.tx_hash),sequenceNumber:1,unlockingBytecode:Uint8Array.from([]),lockingBytecode:this.getLockingBytecode(e),valueSatoshis:BigInt(t.value)}}static getWalletSourceOutput(e,t){return{lockingBytecode:t?Z({addressIndex:0,hdPrivateKey:t}):Uint8Array.from(Array(33)),valueSatoshis:BigInt(e.value),token:e.token_data?{category:l(e.token_data.category),amount:BigInt(e.token_data.amount),nft:e.token_data.nft?{commitment:l(e.token_data.nft.commitment),capability:e.token_data.nft.capability}:void 0}:void 0}}static getCouponOutputs(e,t){return e.map(a=>this.getCouponOutput(a,t)).filter(a=>a!==void 0)}static getCouponOutput(e,t){let a=Math.floor(e.value/10)*1e3,c=a-e.height<1e3,n=t-e.height<1e3,s=n?e.value*10:e.value;s=c?e.value-1:s;let i=n?1e8:1e7;return i=c?1e7:i,{lockingBytecode:D.getCouponLockingBytecode(i,a),valueSatoshis:BigInt(s)}}static getWalletInputs(e,t,a){return e.map(c=>this.getWalletInput(c,t,a))}static getWalletInput(e,t,a,c=0){let n=t?{compiler:this.compiler,data:{hdKeys:{addressIndex:c,hdPrivateKeys:{wallet:t}}},script:"wallet_unlock",valueSatoshis:BigInt(e.value)}:Uint8Array.from(Array());return n.token=e.token_data?{category:l(e.token_data.category),amount:e.token_data.amount,nft:e.token_data.nft?{commitment:l(e.token_data.nft.commitment),capability:e.token_data.nft.capability}:void 0}:void 0,{outpointIndex:e.tx_pos,outpointTransactionHash:l(e.tx_hash),sequenceNumber:a&&a+R,unlockingBytecode:n}}static getChannelMessageOutputs(e,t,a,c){const n=Q(t);return[...y0(n,32).map(i=>"6a025630"+_(A(i)))].map(i=>({lockingBytecode:this.getLockingBytecode(e),valueSatoshis:BigInt(c),token:{amount:0n,category:l(a.token_data.category),nft:{capability:"mutable",commitment:l(i)}}}))}static getLikeOutput(e,t,a,c){let n="6a0256B2"+_(A(l(t)));return{lockingBytecode:this.getLockingBytecode(e),valueSatoshis:BigInt(c),token:{amount:0n,category:l(a.token_data.category),nft:{capability:"none",commitment:l(n)}}}}static getChangeOutput(e,t,a,c=0){return{lockingBytecode:a?{compiler:this.compiler,data:{hdKeys:{addressIndex:c,hdPublicKeys:{wallet:S(a).hdPublicKey}}},script:"wallet_lock"}:Uint8Array.from(Array(33)),valueSatoshis:t,token:{amount:0n,category:l(e.token_data.category),nft:{capability:"minting",commitment:l(e.token_data?.nft?.commitment)}}}}static clear(e,t,a,c,n,s,i=1){const o=[],u=[],r=[];let O={locktime:n,version:2,inputs:o,outputs:u},f=[a];s&&f.push(...s),O.inputs.push(...this.getInputs(e,t,n)),O.inputs.push(...this.getWalletInputs(f,c)),O.outputs.push(...this.getCouponOutputs(t,n)),r.push(...this.getSourceOutputs(e,t)),r.push(this.getWalletSourceOutput(a,c));let b=T(r),m=a0(O.outputs),P=b-m;return O.outputs.push(this.getChangeOutput(a,P,c)),this.buildAndValidateTransaction(O,r,i)}static post(e,t,a,c,n,s,i,o=1){const u=[],r=[],O=[];let f={locktime:0,version:2,inputs:u,outputs:r},b=[a];i&&b.push(...i),f.inputs.push(...this.getWalletInputs(b,n,s)),f.outputs.push(...this.getChannelMessageOutputs(e,t,a,c)),O.push(this.getWalletSourceOutput(a,n));let P=T(O)-BigInt(f.outputs.length*c);return f.outputs.push(this.getChangeOutput(a,P,n)),this.buildAndValidateTransaction(f,O,o)}static like(e,t,a,c,n,s=1){const i=[],o=[],u=[];let r={locktime:0,version:2,inputs:i,outputs:o},O=[a];r.inputs.push(...this.getWalletInputs(O,n)),r.outputs.push(this.getLikeOutput(e,t,a,c)),u.push(this.getWalletSourceOutput(a,n));let b=T(u)-BigInt(r.outputs.length*c);return r.outputs.push(this.getChangeOutput(a,b,n)),this.buildAndValidateTransaction(r,u,s)}static buildAndValidateTransaction(e,t,a=1){let c=B(e);if(!c.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(c.errors,null,"  "));const n=W(c.transaction,a),s=e.outputs.length-1;if(e.outputs[s].valueSatoshis=e.outputs[s].valueSatoshis-n,c=B(e),!c.success)throw new Error("generate transaction failed!, errors: "+JSON.stringify(c.errors,null,"  "));const i=c.transaction,o=G(i,t,{maximumTokenCommitmentLength:40});if(o!==!0&&a>0)throw o;let u=this.vm.verify({sourceOutputs:t,transaction:i});return{sourceOutputs:t,transaction:i,verify:u}}}export{R0 as C,D as V,V0 as a,N0 as b,S0 as c,M0 as d,L0 as g,F as p};
//# sourceMappingURL=B2gQH3vd.js.map
