import{f as u,a as n,c as Et,t as de}from"./yGPdYsEk.js";import{o as ue,a as _e}from"./BL1kRCRP.js";import{h as Lt,p as Vt,c as o,r as i,s as r,t as w,a as Ft,f as it,j as e,aF as T,aa as d,a9 as Zt,a0 as Wt,as as he}from"./4Ej_4qXs.js";import{d as Gt,s as g}from"./BNpjwQLA.js";import{a as fe,C as Z,b as me,p as pe}from"./DxC2wkOi.js";import{i as x}from"./CyUl1IAL.js";import{e as be,i as ge}from"./PZPIYvej.js";import{s as S,r as ke,c as we}from"./CnJGQRAh.js";import{b as xe,a as ye}from"./R_USggII.js";import{s as ze}from"./DlPNFNxT.js";import{p as Te}from"./BqVfcUFt.js";import{L as Nt,F as Ne,m as Ce,$ as Ee,G as Ct,H as Ae,p as ft,J as mt,s as Se}from"./zIYK9qkZ.js";import{I as He,B as Pe,W as De,T as Me,N as It,a as Ue}from"./DeOyqwJy.js";import{a as qe,b as At}from"./BtgC42a0.js";import{g as Be}from"./gC8E2xLB.js";import{B as Re,C as Oe,D as Le}from"./BbIwgq-g.js";function Ze(v,a,c,N,H,U){var W=v.__className;if(Lt||W!==c||W===void 0){var k=qe(c,N);(!Lt||k!==v.getAttribute("class"))&&(k==null?v.removeAttribute("class"):v.className=k),v.__className=c}return U}const We=8;async function Ie(v,a,c=We){let N=0,H=[];for(;N<a.length;){const U=a.slice(N,N+c);H=[...H,...await Promise.all(U.map(W=>v(W)))],N+=c}return H}async function Ve(v){return await v[0].request("blockchain.transaction.get",v[1],!1)}async function Fe(v,a){return Ie(Ve,a.map(c=>[v,c]))}const Ge="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='15px'%20fill='%23000'%3e%3cpath%20d='M280-120q-33%200-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0%2033-23.5%2056.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160%200h80v-360h-80v360ZM280-720v520-520Z'/%3e%3c/svg%3e",je="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48px'%20viewBox='0%20-960%20960%20960'%20width='48px'%20fill='%23888'%3e%3cpath%20d='M272-120v-512l278-288%2058%2046-52%20242h359v171L767-120H272Zm60-60h397l126-299v-93H482l53-249-203%20214v427Zm0-427v427-427ZM79-120v-512h193v60H139v392h133v60H79Z'/%3e%3c/svg%3e";var Je=u('<img height="32px" class="svelte-1kup2az"/>'),Ke=u('<div style="width:32px"></div>'),Ye=(v,a)=>{d(a,!e(a))},Qe=u('<div> <button class="svelte-1kup2az"> </button></div>'),Xe=(v,a)=>{d(a,!e(a))},$e=u('<div> <button class="svelte-1kup2az"> </button></div>'),ta=u('<div class="error svelte-1kup2az"> </div>'),ea=(v,a)=>{a.likePost(a.hash)},aa=u('<img height="32px" class="svelte-1kup2az"/>'),sa=u('<div style="width:32px"></div>'),oa=u('<div class="container svelte-1kup2az"><div class="auth svelte-1kup2az"><!></div> <div><div class="footer svelte-1kup2az"><div class="fill svelte-1kup2az"></div> <div class="action"></div></div> <!> <div class="footer svelte-1kup2az"><div class="hash svelte-1kup2az"> </div> <div class="fill svelte-1kup2az"></div> <div class="actions svelte-1kup2az"><button class="svelte-1kup2az"><img height="16px" alt="likes"/> </button></div> <div class="timestamp svelte-1kup2az"> </div></div></div> <div class="auth svelte-1kup2az"><!></div></div>');function ia(v,a){Vt(a,!0);let c=T(!1);const N=400;var H=oa(),U=o(H),W=o(U);{var k=_=>{var m=Je();w(L=>{S(m,"src",L),S(m,"alt",a.auth)},[()=>At(a.auth,16)]),n(_,m)},I=_=>{var m=Ke();n(_,m)};x(W,_=>{a.thisAuth?_(I,!1):_(k)})}i(U);var V=r(U,2),q=r(o(V),2);{var vt=_=>{var m=Et(),L=it(m);{var pt=P=>{var $=Qe(),tt=o($),et=r(tt);et.__click=[Ye,c];var D=o(et,!0);i(et),i($),w(()=>{g(tt,`${a.body??""} `),g(D,e(c)?"show less":"show more")}),n(P,$)},bt=(P,$)=>{{var tt=D=>{var j=$e(),dt=o(j),J=r(dt);J.__click=[Xe,c];var gt=o(J,!0);i(J),i(j),w(ut=>{g(dt,`${ut??""} `),g(gt,e(c)?"show less":"show more")},[()=>a.body.substring(0,N)+" ..."]),n(D,j)},et=D=>{var j=de();w(()=>g(j,a.body)),n(D,j)};x(P,D=>{a.body.length>N+20?D(tt):D(et,!1)},$)}};x(L,P=>{a.body.length>N+20&&e(c)?P(pt):P(bt,!1)})}n(_,m)},Q=_=>{var m=ta(),L=o(m,!0);i(m),w(()=>g(L,a.error)),n(_,m)};x(q,_=>{a.error?_(Q,!1):_(vt)})}var B=r(q,2),C=o(B),lt=o(C,!0);i(C);var F=r(C,4),R=o(F);R.__click=[ea,a];var ct=o(R),O=r(ct);i(R),i(F);var X=r(F,2),G=o(X);i(X),i(B),i(V);var f=r(V,2),rt=o(f);{var y=_=>{var m=aa();w(L=>{S(m,"src",L),S(m,"alt",a.auth)},[()=>At(a.auth,16)]),n(_,m)},p=_=>{var m=sa();n(_,m)};x(rt,_=>{a.thisAuth?_(y):_(p,!1)})}i(f),i(H),w(()=>{Ze(V,1,`post ${a.thisAuth?"op":""} `,"svelte-1kup2az"),g(lt,a.hash),S(ct,"src",je),g(O,` ${a.likes??""}`),g(G,`${a.height??""} ■ ${a.sequence??""}`)}),n(v,H),Ft()}Gt(["click"]);var ra=u('<a target="_blank"> </a>'),na=u("<img/>"),va=u('<img alt="Disconnected"/>'),la=(v,a,c)=>a(e(c)),ca=u('<div class="deleteMe svelte-1f5vzoo"><button class="svelte-1f5vzoo"><img height="36px"/></button></div>'),da=u("<!> <!>",1),ua=u('<p style="color: red"> </p>'),_a=(v,a)=>a(),ha=u('<div class="row footer svelte-1f5vzoo"><h2>Create new identity</h2> <button class="svelte-1f5vzoo">New identity 1M sats</button></div>'),fa=u('<div class="row footer svelte-1f5vzoo"><p><a href="/wallet">Deposit funds</a> to create identity</p></div>'),ma=(v,a)=>a(),pa=u('<img height="32px" alt="avatar" class="svelte-1f5vzoo"/>'),ba=u('<div style="font-size:x-small;"> <br/> </div>'),ga=(v,a,c)=>a(e(c)),ka=u('<div class="edit svelte-1f5vzoo"><textarea class="svelte-1f5vzoo"> </textarea> <div class="estimate svelte-1f5vzoo"> </div></div> <div class="send svelte-1f5vzoo"><div class="auth svelte-1f5vzoo"><!> <!></div> <button class="svelte-1f5vzoo">Send</button></div>',1),wa=u("<p>Not connected?</p>"),xa=u('<div class="row footer svelte-1f5vzoo"><!></div>'),ya=(v,a)=>a(1e7),za=(v,a)=>a(1e6),Ta=(v,a)=>a(),Na=u('<div class="row footer svelte-1f5vzoo"><button class="svelte-1f5vzoo">Top up 10M sats</button> <button class="svelte-1f5vzoo">Top up 1M sats</button></div> <div class="row footer svelte-1f5vzoo"><button class="svelte-1f5vzoo">Clear Old Posts</button></div>',1),Ca=u('<div class="box svelte-1f5vzoo"><div class="row header svelte-1f5vzoo"> <sub>■</sub> <div style="flex: 2 2 auto;"></div> <b><a href="/pop/">/pop</a> </b> <div style="flex: 2 2 auto;"></div> <!> <!> <!></div> <div id="chat" class="row content svelte-1f5vzoo"><!></div> <!> <div class="row footer svelte-1f5vzoo"><div style="margin: auto;">Advanced</div> <div><label class="switch svelte-1f5vzoo"><input type="checkbox" class="svelte-1f5vzoo"/> <span class="slider round svelte-1f5vzoo"></span></label></div></div> <!></div>');function Va(v,a){Vt(a,!0);const c=Te.url.hostname=="vox.cash",N=c?"bitcoincash":"bchtest",H=c?"bch.imaginary.cash":"chipnet.bch.ninja",U=c?"https://explorer.salemkode.com/address/":"https://cbch.loping.net/address/",W=Nt('OP_RETURN <"U3V">');let k=T(0),I=T(0),V=T(0n),q=T(""),vt=T(""),Q=T(""),B=T(""),C=T(0),lt=T(0),F=T(!1);const R=Wt(()=>Z.getScriptHash(a.topic)),ct=Wt(()=>Z.getAddress(a.topic,N));let O=T(Zt([])),X,G="",f,rt="",y,p=T(Zt([]));const _=()=>{clearTimeout(X),X=setTimeout(()=>{P(),tt()},1500)},m=async function(t){if(t.method==="blockchain.headers.subscribe"){let s=t.params[0];d(k,s.height,!0)}else t.method==="blockchain.scripthash.subscribe"?t.params[1]!==e(vt)&&(d(vt,t.params[1],!0),d(q,Ct[f.status],!0),_()):console.log(t)},L=function(){let t=document.getElementById("chat");var s=t.scrollHeight;t.scrollTo(0,s)},pt=async function(t){let s=Z.like(a.topic,t,e(p)[0],(Math.round(e(k)/1e3)+10)*10,G),l=ft(mt(s.transaction));await J(l)},bt=async function(){let t=await f.request("blockchain.headers.get_tip");if(t instanceof Error)throw t;d(k,t.height,!0)},P=async function(){let t=await f.request("blockchain.scripthash.listunspent",rt,"include_tokens");if(t instanceof Error)throw t;d(p,t.filter(s=>s.token_data&&s.token_data.nft&&s.token_data.nft.commitment.startsWith(W)),!0),e(p).length>0&&e(p)[0].token_data&&(d(B,e(p)[0].token_data.category,!0),d(I,e(p)[0].value,!0))},$=async function(){let t=await f.request("blockchain.scripthash.listunspent",e(R),"include_tokens");if(t instanceof Error)throw t;let s=t.filter(h=>h.height>0&&e(k)-h.height>1e3),l=Z.clear(a.topic,s,e(p)[0],G,e(k)),b=ft(mt(l.transaction));console.log(b),await J(b)},tt=async function(){let t=await f.request("blockchain.scripthash.listunspent",e(R),"include_tokens");if(t instanceof Error)throw t;d(V,Ae(t),!0);let s=Array.from(new Set(t.map(h=>h.tx_hash))),l=await f.request("blockchain.scripthash.get_history",e(R),e(k)-1500,-1),b=await Fe(f,s);d(O,me(l,b,a.topic),!0),d(O,e(O).map(h=>({thisAuth:e(B)==h.auth,...h})),!0),e(O).slice(-1).length>0?d(C,e(O).slice(-1)[0].height<=0?e(O).slice(-1)[0].sequence+1:0,!0):d(C,0)},et=async function(t){let s=await f.request("blockchain.scripthash.listunspent",e(R),"include_tokens");if(s instanceof Error)throw s;let l=s.filter(z=>z.tx_hash==t.hash),b=Z.clear(a.topic,l,e(p)[0],G,e(k)),h=ft(mt(b.transaction));await J(h)},D=()=>{clearTimeout(X),X=setTimeout(()=>{d(lt,j(e(Q)),!0)},500)},j=function(t){let s=Z.post(a.topic,t,e(p)[0],(Math.round(e(k)/1e3)+10)*10,G,e(C));const l=s.transaction.outputs[s.transaction.outputs.length-1].valueSatoshis;return Number(Se(s.sourceOutputs)-l)},dt=async function(t){let s=(Math.round(e(k)/1e3)+10)*10,l=Z.post(a.topic,t,e(p)[0],s,G,e(C)),b=ft(mt(l.transaction));await J(b),d(Q,"")},J=async function(t){let s=await f.request("blockchain.transaction.broadcast",t);if(d(C,e(C)+1),s instanceof Error)throw d(q,Ct[f.status],!0),s},gt=async function(){await y.sendMax(y.getDepositAddress());let t=Nt('OP_RETURN <"U3V"> <"pseudonymous">');await y.tokenGenesis({cashaddr:y.getTokenDepositAddress(),commitment:t,capability:It.minting,value:1e6})},ut=async function(t){d(I,e(p)[0].value,!0),d(B,e(p)[0].token_data.category,!0);let s=Nt('OP_RETURN <"U3V"> <"pseudonymous">');await y.send(new Ue({cashaddr:y.getTokenDepositAddress(),tokenId:e(B),commitment:s,capability:It.minting,value:e(I)+t})),await P()};ue(async()=>{Pe.StorageProvider=He,y=c?await De.named("vox"):await Me.named("vox"),G=Be(y.mnemonic,y.derivationPath.slice(0,-2),y.isTestnet);let t=Ne(y.getDepositAddress());if(typeof t=="string")throw t;rt=Ce(t.bytecode),f=new Ee(Z.USER_AGENT,"1.4.1",H),await f.connect(),f.on("notification",m),d(q,Ct[f.status],!0),await f.subscribe("blockchain.scripthash.subscribe",e(R)),await f.subscribe("blockchain.scripthash.subscribe",rt),await bt(),await P(),await tt(),L()}),_e(async()=>{await y.provider.disconnect(),await f.disconnect()});var kt=Ca(),wt=o(kt),St=o(wt,!0),Ht=r(St,2),xt=r(Ht,3),jt=r(o(xt));i(xt);var Pt=r(xt,4);{var Jt=t=>{var s=ra(),l=o(s);i(s),w(b=>{S(s,"href",`${U}${e(ct)??""}`),g(l,`${b??""}k sats  `)},[()=>Math.floor(Number(e(V))/1e3).toLocaleString()]),n(t,s)};x(Pt,t=>{e(V)&&t(Jt)})}var Dt=r(Pt,2);Re(Dt,{get template(){return Z.template}});var Kt=r(Dt,2);{var Yt=t=>{var s=na();w(()=>{S(s,"src",Oe),S(s,"alt",e(q))}),n(t,s)},Qt=t=>{var s=va();w(()=>S(s,"src",Le)),n(t,s)};x(Kt,t=>{e(q)=="CONNECTED"?t(Yt):t(Qt,!1)})}i(wt);var yt=r(wt,2),Xt=o(yt);fe(Xt,()=>a.transactions,null,(t,s)=>{var l=Et(),b=it(l);be(b,17,()=>e(O),ge,(h,z)=>{var K=da(),at=it(K);ia(at,ze({likePost:pt},()=>e(z)));var nt=r(at,2);{var E=M=>{var st=ca(),Y=o(st);Y.__click=[la,et,z];var _t=o(Y);i(Y),i(st),w(()=>S(_t,"src",Ge)),n(M,st)};x(nt,M=>{e(F)&&M(E)})}n(h,K)}),n(t,l)},(t,s)=>{var l=ua(),b=o(l,!0);i(l),w(()=>g(b,e(s).message)),n(t,l)}),i(yt);var Mt=r(yt,2);{var $t=t=>{var s=ha(),l=r(o(s),2);l.__click=[_a,gt],i(s),n(t,s)},te=(t,s)=>{{var l=h=>{var z=fa();n(h,z)},b=h=>{var z=xa(),K=o(z);{var at=E=>{var M=ka(),st=it(M),Y=o(st);we(Y),Y.__keyup=[ma,D];var _t=r(Y,2),se=o(_t);i(_t),i(st);var Rt=r(st,2),Tt=o(Rt),Ot=o(Tt);{var oe=A=>{var ot=pa();w(ht=>S(ot,"src",ht),[()=>At(e(B),16)]),n(A,ot)};x(Ot,A=>{e(B)&&A(oe)})}var ie=r(Ot,2);{var re=A=>{var ot=ba(),ht=o(ot,!0),ve=r(ht,2);i(ot),w((le,ce)=>{g(ht,le),g(ve,` ${ce??""}sats`)},[()=>pe(e(p)[0].token_data.nft.commitment),()=>e(I).toLocaleString()]),n(A,ot)};x(ie,A=>{e(p).length>0&&A(re)})}i(Tt);var ne=r(Tt,2);ne.__click=[ga,dt,Q],i(Rt),w(A=>g(se,`${A??""} sats`),[()=>e(lt).toLocaleString()]),ye(Y,()=>e(Q),A=>d(Q,A)),n(E,M)},nt=E=>{var M=wa();n(E,M)};x(K,E=>{e(q)=="CONNECTED"?E(at):E(nt,!1)})}i(z),n(h,z)};x(t,h=>{e(I)<11e5&&e(p).length==0?h(l):h(b,!1)},s)}};x(Mt,t=>{e(I)>1e6&&e(p).length==0?t($t):t(te,!1)})}var zt=r(Mt,2),Ut=r(o(zt),2),qt=o(Ut),Bt=o(qt);ke(Bt),he(2),i(qt),i(Ut),i(zt);var ee=r(zt,2);{var ae=t=>{var s=Et(),l=it(s);{var b=h=>{var z=Na(),K=it(z),at=o(K);at.__click=[ya,ut];var nt=r(at,2);nt.__click=[za,ut],i(K);var E=r(K,2),M=o(E);M.__click=[Ta,$],i(E),n(h,z)};x(l,h=>{e(p).length>0&&h(b)})}n(t,s)};x(ee,t=>{e(F)&&t(ae)})}i(kt),w(t=>{g(St,t),g(Ht,` ${e(C)??""} `),g(jt,`/${a.topic??""}`)},[()=>e(k).toLocaleString()]),xe(Bt,()=>e(F),t=>d(F,t)),n(v,kt),Ft()}Gt(["click","keyup"]);export{Va as C};
//# sourceMappingURL=CLHW9iuO.js.map
