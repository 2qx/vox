import{f as u,a as v,c as Ct,t as ue}from"./yGPdYsEk.js";import{o as _e,a as he}from"./BL1kRCRP.js";import{h as Zt,p as Ft,c as i,r,s as n,t as w,a as Gt,f as it,j as e,aF as T,aa as d,a9 as Wt,a0 as It,as as fe}from"./4Ej_4qXs.js";import{d as jt,s as k}from"./BNpjwQLA.js";import{a as me,C as D,b as pe,p as be}from"./Xb4w2mL0.js";import{i as x}from"./CyUl1IAL.js";import{e as ge,i as ke}from"./PZPIYvej.js";import{s as P,r as we,c as xe}from"./CnJGQRAh.js";import{b as ye,a as ze}from"./R_USggII.js";import{s as Te}from"./DlPNFNxT.js";import{p as Ee}from"./B33TDlao.js";import{L as Et,F as Ne,m as Ce,$ as Ae,G as Nt,H as Se,p as vt,J as ct,s as Pe}from"./zIYK9qkZ.js";import{I as He,B as Me,W as qe,T as Be,N as Vt,a as De}from"./DeOyqwJy.js";import{a as Ue,b as At}from"./BtgC42a0.js";import{g as Re}from"./gC8E2xLB.js";import{B as Oe,C as Le,D as Ze}from"./BbIwgq-g.js";function We(l,a,c,E,H,U){var V=l.__className;if(Zt||V!==c||V===void 0){var g=Ue(c,E);(!Zt||g!==l.getAttribute("class"))&&(g==null?l.removeAttribute("class"):l.className=g),l.__className=c}return U}const Ie=8;async function Ve(l,a,c=Ie){let E=0,H=[];for(;E<a.length;){const U=a.slice(E,E+c);H=[...H,...await Promise.all(U.map(V=>l(V)))],E+=c}return H}async function Fe(l){return await l[0].request("blockchain.transaction.get",l[1],!1)}async function Ge(l,a){return Ve(Fe,a.map(c=>[l,c]))}const je="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='15px'%20fill='%23000'%3e%3cpath%20d='M280-120q-33%200-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0%2033-23.5%2056.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160%200h80v-360h-80v360ZM280-720v520-520Z'/%3e%3c/svg%3e",Je="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48px'%20viewBox='0%20-960%20960%20960'%20width='48px'%20fill='%23888'%3e%3cpath%20d='M272-120v-512l278-288%2058%2046-52%20242h359v171L767-120H272Zm60-60h397l126-299v-93H482l53-249-203%20214v427Zm0-427v427-427ZM79-120v-512h193v60H139v392h133v60H79Z'/%3e%3c/svg%3e";var Ke=u('<img height="32px" class="svelte-1kup2az"/>'),Ye=u('<div style="width:32px"></div>'),Qe=(l,a)=>{d(a,!e(a))},Xe=u('<div> <button class="svelte-1kup2az"> </button></div>'),$e=(l,a)=>{d(a,!e(a))},ta=u('<div> <button class="svelte-1kup2az"> </button></div>'),ea=u('<div class="error svelte-1kup2az"> </div>'),aa=(l,a)=>{a.likePost(a.hash)},sa=u('<img height="32px" class="svelte-1kup2az"/>'),oa=u('<div style="width:32px"></div>'),ia=u('<div class="container svelte-1kup2az"><div class="auth svelte-1kup2az"><!></div> <div><div class="footer svelte-1kup2az"><div class="fill svelte-1kup2az"></div> <div class="action"></div></div> <!> <div class="footer svelte-1kup2az"><div class="hash svelte-1kup2az"> </div> <div class="fill svelte-1kup2az"></div> <div class="actions svelte-1kup2az"><button class="svelte-1kup2az"><img height="16px" alt="likes"/> </button></div> <div class="timestamp svelte-1kup2az"> </div></div></div> <div class="auth svelte-1kup2az"><!></div></div>');function ra(l,a){Ft(a,!0);let c=T(!1);const E=400;var H=ia(),U=i(H),V=i(U);{var g=_=>{var p=Ke();w(W=>{P(p,"src",W),P(p,"alt",a.auth)},[()=>At(a.auth,16)]),v(_,p)},F=_=>{var p=Ye();v(_,p)};x(V,_=>{a.thisAuth?_(F,!1):_(g)})}r(U);var G=n(U,2),R=n(i(G),2);{var dt=_=>{var p=Ct(),W=it(p);{var pt=q=>{var tt=Xe(),st=i(tt),J=n(st);J.__click=[Qe,c];var B=i(J,!0);r(J),r(tt),w(()=>{k(st,`${a.body??""} `),k(B,e(c)?"show less":"show more")}),v(q,tt)},bt=(q,tt)=>{{var st=B=>{var K=ta(),ht=i(K),nt=n(ht);nt.__click=[$e,c];var et=i(nt,!0);r(nt),r(K),w(gt=>{k(ht,`${gt??""} `),k(et,e(c)?"show less":"show more")},[()=>a.body.substring(0,E)+" ..."]),v(B,K)},J=B=>{var K=ue();w(()=>k(K,a.body)),v(B,K)};x(q,B=>{a.body.length>E+20?B(st):B(J,!1)},tt)}};x(W,q=>{a.body.length>E+20&&e(c)?q(pt):q(bt,!1)})}v(_,p)},X=_=>{var p=ea(),W=i(p,!0);r(p),w(()=>k(W,a.error)),v(_,p)};x(R,_=>{a.error?_(X,!1):_(dt)})}var O=n(R,2),N=i(O),ut=i(N,!0);r(N);var j=n(N,4),M=i(j);M.__click=[aa,a];var _t=i(M),L=n(_t);r(M),r(j);var $=n(j,2),Z=i($);r($),r(O),r(G);var h=n(G,2),rt=i(h);{var y=_=>{var p=sa();w(W=>{P(p,"src",W),P(p,"alt",a.auth)},[()=>At(a.auth,16)]),v(_,p)},m=_=>{var p=oa();v(_,p)};x(rt,_=>{a.thisAuth?_(y):_(m,!1)})}r(h),r(H),w(()=>{We(G,1,`post ${a.thisAuth?"op":""} `,"svelte-1kup2az"),k(ut,a.hash),P(_t,"src",Je),k(L,` ${a.likes??""}`),k(Z,`${a.height??""} ■ ${a.sequence??""}`)}),v(l,H),Gt()}jt(["click"]);var na=u('<a target="_blank"> </a>'),la=u("<img/>"),va=u('<img alt="Disconnected"/>'),ca=(l,a,c)=>a(e(c)),da=u('<div class="deleteMe svelte-1f5vzoo"><button class="svelte-1f5vzoo"><img height="36px"/></button></div>'),ua=u("<!> <!>",1),_a=u('<p style="color: red"> </p>'),ha=(l,a)=>a(),fa=u('<div class="row footer svelte-1f5vzoo"><h2>Create new identity</h2> <button class="svelte-1f5vzoo">New identity 1M sats</button></div>'),ma=u('<div class="row footer svelte-1f5vzoo"><p><a href="/wallet">Deposit funds</a> to create identity</p></div>'),pa=(l,a)=>a(),ba=u('<img height="32px" alt="avatar" class="svelte-1f5vzoo"/>'),ga=u('<div style="font-size:x-small;"> <br/> </div>'),ka=(l,a,c)=>a(e(c)),wa=u('<div class="edit svelte-1f5vzoo"><textarea class="svelte-1f5vzoo"> </textarea> <div class="estimate svelte-1f5vzoo"> </div></div> <div class="send svelte-1f5vzoo"><div class="auth svelte-1f5vzoo"><!> <!></div> <button class="svelte-1f5vzoo">Send</button></div>',1),xa=u("<p>Not connected?</p>"),ya=u('<div class="row footer svelte-1f5vzoo"><!></div>'),za=(l,a)=>a(1e7),Ta=(l,a)=>a(1e6),Ea=(l,a)=>a(),Na=(l,a)=>a(),Ca=u('<div class="row footer svelte-1f5vzoo"><button class="svelte-1f5vzoo">Top up 10M sats</button> <button class="svelte-1f5vzoo">Top up 1M sats</button></div> <div class="row footer svelte-1f5vzoo"><button class="svelte-1f5vzoo">Clear Old Posts</button> <button class="svelte-1f5vzoo">Burn Spam</button></div>',1),Aa=u('<div class="box svelte-1f5vzoo"><div class="row header svelte-1f5vzoo"> <sub>■</sub> <div style="flex: 2 2 auto;"></div> <b><a href="/pop/">/pop</a> </b> <div style="flex: 2 2 auto;"></div> <!> <!> <!></div> <div id="chat" class="row content svelte-1f5vzoo"><!></div> <!> <div class="row footer svelte-1f5vzoo"><div style="margin: auto;">Advanced</div> <div><label class="switch svelte-1f5vzoo"><input type="checkbox" class="svelte-1f5vzoo"/> <span class="slider round svelte-1f5vzoo"></span></label></div></div> <!></div>');function Ga(l,a){Ft(a,!0);const c=Ee.url.hostname=="vox.cash",E=c?"bitcoincash":"bchtest",H=c?"bch.imaginary.cash":"chipnet.bch.ninja",U=c?"https://explorer.salemkode.com/address/":"https://cbch.loping.net/address/",V=Et('OP_RETURN <"U3V">');let g=T(0),F=T(0),G=T(0n),R=T(""),dt=T(""),X=T(""),O=T(""),N=T(0),ut=T(0),j=T(!1);const M=It(()=>D.getScriptHash(a.topic)),_t=It(()=>D.getAddress(a.topic,E));let L=T(Wt([])),$,Z="",h,rt="",y,m=T(Wt([]));const _=()=>{clearTimeout($),$=setTimeout(()=>{q(),J()},1500)},p=async function(t){if(t.method==="blockchain.headers.subscribe"){let s=t.params[0];d(g,s.height,!0)}else t.method==="blockchain.scripthash.subscribe"?t.params[1]!==e(dt)&&(d(dt,t.params[1],!0),d(R,Nt[h.status],!0),_()):console.log(t)},W=function(){let t=document.getElementById("chat");var s=t.scrollHeight;t.scrollTo(0,s)},pt=async function(t){let s=D.like(a.topic,t,e(m)[0],(Math.round(e(g)/1e3)+10)*10,Z),o=vt(ct(s.transaction));await et(o)},bt=async function(){let t=await h.request("blockchain.headers.get_tip");if(t instanceof Error)throw t;d(g,t.height,!0)},q=async function(){let t=await h.request("blockchain.scripthash.listunspent",rt,"include_tokens");if(t instanceof Error)throw t;d(m,t.filter(s=>s.token_data&&s.token_data.nft&&s.token_data.nft.commitment.startsWith(V)),!0),e(m).length>0&&e(m)[0].token_data&&(d(O,e(m)[0].token_data.category,!0),d(F,e(m)[0].value,!0))},tt=async function(){let t=await h.request("blockchain.scripthash.listunspent",e(M),"include_tokens");if(t instanceof Error)throw t;let s=t.filter(o=>o.height>0&&e(g)-o.height>1e3);if(s.length>0){let o=D.clear(a.topic,s,e(m)[0],Z,e(g)),f=vt(ct(o.transaction));console.log(f),await et(f)}},st=async function(){let t=await h.request("blockchain.scripthash.listunspent",e(M),"include_tokens");if(t instanceof Error)throw t;let s=t.filter(o=>Math.floor(o.value/10)*1e3-o.height<1e3);if(s.length>0){let o=D.clear(a.topic,s,e(m)[0],Z,e(g)),f=vt(ct(o.transaction));console.log(f),await et(f)}},J=async function(){let t=await h.request("blockchain.scripthash.listunspent",e(M),"include_tokens");if(t instanceof Error)throw t;d(G,Se(t),!0);let s=Array.from(new Set(t.map(b=>b.tx_hash))),o=await h.request("blockchain.scripthash.get_history",e(M),e(g)-1500,-1),f=await Ge(h,s);d(L,pe(o,f,a.topic),!0),d(L,e(L).map(b=>({thisAuth:e(O)==b.auth,...b})),!0),e(L).slice(-1).length>0?d(N,e(L).slice(-1)[0].height<=0?e(L).slice(-1)[0].sequence+1:0,!0):d(N,0)},B=async function(t){let s=await h.request("blockchain.scripthash.listunspent",e(M),"include_tokens");if(s instanceof Error)throw s;let o=s.filter(z=>z.tx_hash==t.hash),f=D.clear(a.topic,o,e(m)[0],Z,e(g)),b=vt(ct(f.transaction));await et(b)},K=()=>{clearTimeout($),$=setTimeout(()=>{d(ut,ht(e(X)),!0)},500)},ht=function(t){if(t.length>0){let s=D.post(a.topic,t,e(m)[0],(Math.round(e(g)/1e3)+10)*10,Z,e(N));const o=s.transaction.outputs[s.transaction.outputs.length-1].valueSatoshis;return Number(Pe(s.sourceOutputs)-o)}else return 0},nt=async function(t){let s=(Math.round(e(g)/1e3)+10)*10,o=D.post(a.topic,t,e(m)[0],s,Z,e(N)),f=vt(ct(o.transaction));await et(f),d(X,"")},et=async function(t){let s=await h.request("blockchain.transaction.broadcast",t);if(d(N,e(N)+1),s instanceof Error)throw d(R,Nt[h.status],!0),s},gt=async function(){await y.sendMax(y.getDepositAddress());let t=Et('OP_RETURN <"U3V"> <"pseudonymous">');await y.tokenGenesis({cashaddr:y.getTokenDepositAddress(),commitment:t,capability:Vt.minting,value:1e6})},St=async function(t){d(F,e(m)[0].value,!0),d(O,e(m)[0].token_data.category,!0);let s=Et('OP_RETURN <"U3V"> <"pseudonymous">');await y.send(new De({cashaddr:y.getTokenDepositAddress(),tokenId:e(O),commitment:s,capability:Vt.minting,value:e(F)+t})),await q()};_e(async()=>{Me.StorageProvider=He,y=c?await qe.named("vox"):await Be.named("vox"),Z=Re(y.mnemonic,y.derivationPath.slice(0,-2),y.isTestnet);let t=Ne(y.getDepositAddress());if(typeof t=="string")throw t;rt=Ce(t.bytecode),h=new Ae(D.USER_AGENT,"1.4.1",H),await h.connect(),h.on("notification",p),d(R,Nt[h.status],!0),await h.subscribe("blockchain.scripthash.subscribe",e(M)),await h.subscribe("blockchain.scripthash.subscribe",rt),await bt(),await q(),await J(),W()}),he(async()=>{await y.provider.disconnect(),await h.disconnect()});var kt=Aa(),wt=i(kt),Pt=i(wt,!0),Ht=n(Pt,2),xt=n(Ht,3),Jt=n(i(xt));r(xt);var Mt=n(xt,4);{var Kt=t=>{var s=na(),o=i(s);r(s),w(f=>{P(s,"href",`${U}${e(_t)??""}`),k(o,`${f??""}k sats  `)},[()=>Math.floor(Number(e(G))/1e3).toLocaleString()]),v(t,s)};x(Mt,t=>{e(G)&&t(Kt)})}var qt=n(Mt,2);Oe(qt,{get template(){return D.template}});var Yt=n(qt,2);{var Qt=t=>{var s=la();w(()=>{P(s,"src",Le),P(s,"alt",e(R))}),v(t,s)},Xt=t=>{var s=va();w(()=>P(s,"src",Ze)),v(t,s)};x(Yt,t=>{e(R)=="CONNECTED"?t(Qt):t(Xt,!1)})}r(wt);var yt=n(wt,2),$t=i(yt);me($t,()=>a.transactions,null,(t,s)=>{var o=Ct(),f=it(o);ge(f,17,()=>e(L),ke,(b,z)=>{var Y=ua(),at=it(Y);ra(at,Te({likePost:pt},()=>e(z)));var lt=n(at,2);{var C=A=>{var I=da(),Q=i(I);Q.__click=[ca,B,z];var ft=i(Q);r(Q),r(I),w(()=>P(ft,"src",je)),v(A,I)};x(lt,A=>{e(j)&&A(C)})}v(b,Y)}),v(t,o)},(t,s)=>{var o=_a(),f=i(o,!0);r(o),w(()=>k(f,e(s).message)),v(t,o)}),r(yt);var Bt=n(yt,2);{var te=t=>{var s=fa(),o=n(i(s),2);o.__click=[ha,gt],r(s),v(t,s)},ee=(t,s)=>{{var o=b=>{var z=ma();v(b,z)},f=b=>{var z=ya(),Y=i(z);{var at=C=>{var A=wa(),I=it(A),Q=i(I);xe(Q),Q.__keyup=[pa,K];var ft=n(Q,2),oe=i(ft);r(ft),r(I);var Ot=n(I,2),Tt=i(Ot),Lt=i(Tt);{var ie=S=>{var ot=ba();w(mt=>P(ot,"src",mt),[()=>At(e(O),16)]),v(S,ot)};x(Lt,S=>{e(O)&&S(ie)})}var re=n(Lt,2);{var ne=S=>{var ot=ga(),mt=i(ot,!0),ve=n(mt,2);r(ot),w((ce,de)=>{k(mt,ce),k(ve,` ${de??""}sats`)},[()=>be(e(m)[0].token_data.nft.commitment),()=>e(F).toLocaleString()]),v(S,ot)};x(re,S=>{e(m).length>0&&S(ne)})}r(Tt);var le=n(Tt,2);le.__click=[ka,nt,X],r(Ot),w(S=>k(oe,`${S??""} sats`),[()=>e(ut).toLocaleString()]),ze(Q,()=>e(X),S=>d(X,S)),v(C,A)},lt=C=>{var A=xa();v(C,A)};x(Y,C=>{e(R)=="CONNECTED"?C(at):C(lt,!1)})}r(z),v(b,z)};x(t,b=>{e(F)<11e5&&e(m).length==0?b(o):b(f,!1)},s)}};x(Bt,t=>{e(F)>1e6&&e(m).length==0?t(te):t(ee,!1)})}var zt=n(Bt,2),Dt=n(i(zt),2),Ut=i(Dt),Rt=i(Ut);we(Rt),fe(2),r(Ut),r(Dt),r(zt);var ae=n(zt,2);{var se=t=>{var s=Ct(),o=it(s);{var f=b=>{var z=Ca(),Y=it(z),at=i(Y);at.__click=[za,St];var lt=n(at,2);lt.__click=[Ta,St],r(Y);var C=n(Y,2),A=i(C);A.__click=[Ea,tt];var I=n(A,2);I.__click=[Na,st],r(C),v(b,z)};x(o,b=>{e(m).length>0&&b(f)})}v(t,s)};x(ae,t=>{e(j)&&t(se)})}r(kt),w(t=>{k(Pt,t),k(Ht,` ${e(N)??""} `),k(Jt,`/${a.topic??""}`)},[()=>e(g).toLocaleString()]),ye(Rt,()=>e(j),t=>d(j,t)),v(l,kt),Gt()}jt(["click","keyup"]);export{Ga as C};
//# sourceMappingURL=BOj_Eb6V.js.map
