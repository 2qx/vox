import{f as u,a as n,c as Tt,t as ae}from"./yGPdYsEk.js";import{o as se,a as ie}from"./BL1kRCRP.js";import{h as Ut,p as qt,c as i,r as o,s as r,t as k,a as Rt,f as vt,j as e,aF as y,aa as l,a9 as Bt,a0 as oe,as as re}from"./4Ej_4qXs.js";import{d as Ot,s as p}from"./BNpjwQLA.js";import{a as ve,C as Q,b as ne,p as le}from"./DxC2wkOi.js";import{i as z}from"./CyUl1IAL.js";import{e as ce,i as de}from"./PZPIYvej.js";import{s as B,r as ue,c as _e}from"./CnJGQRAh.js";import{b as he,a as fe}from"./R_USggII.js";import{s as me}from"./DlPNFNxT.js";import{p as Dt}from"./B9AIFphY.js";import{L as wt,F as pe,m as be,$ as ge,G as xt,H as ke,p as yt,J as zt,s as we}from"./zIYK9qkZ.js";import{I as xe,B as ye,T as ze,W as Te,N as Pt,a as Ne}from"./DeOyqwJy.js";import{a as Ce,b as Nt}from"./BtgC42a0.js";import{g as Ee}from"./gC8E2xLB.js";import{B as Ae,C as Se,D as He}from"./BbIwgq-g.js";function Me(v,a,h,T,H,b){var N=v.__className;if(Ut||N!==h||N===void 0){var R=Ce(h,T);(!Ut||R!==v.getAttribute("class"))&&(R==null?v.removeAttribute("class"):v.className=R),v.__className=h}return b}const Ue=8;async function Be(v,a,h=Ue){let T=0,H=[];for(;T<a.length;){const b=a.slice(T,T+h);H=[...H,...await Promise.all(b.map(N=>v(N)))],T+=h}return H}async function De(v){return await v[0].request("blockchain.transaction.get",v[1],!1)}async function Pe(v,a){return Be(De,a.map(h=>[v,h]))}const qe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='15px'%20fill='%23000'%3e%3cpath%20d='M280-120q-33%200-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0%2033-23.5%2056.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160%200h80v-360h-80v360ZM280-720v520-520Z'/%3e%3c/svg%3e",Re="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48px'%20viewBox='0%20-960%20960%20960'%20width='48px'%20fill='%23888'%3e%3cpath%20d='M272-120v-512l278-288%2058%2046-52%20242h359v171L767-120H272Zm60-60h397l126-299v-93H482l53-249-203%20214v427Zm0-427v427-427ZM79-120v-512h193v60H139v392h133v60H79Z'/%3e%3c/svg%3e";var Oe=u('<img height="32px" class="svelte-1kup2az"/>'),Le=u('<div style="width:32px"></div>'),Ze=(v,a)=>{l(a,!e(a))},We=u('<div> <button class="svelte-1kup2az"> </button></div>'),Ie=(v,a)=>{l(a,!e(a))},Fe=u('<div> <button class="svelte-1kup2az"> </button></div>'),Ve=u('<div class="error svelte-1kup2az"> </div>'),Ge=(v,a)=>{a.likePost(a.hash)},je=u('<img height="32px" class="svelte-1kup2az"/>'),Je=u('<div style="width:32px"></div>'),Ke=u('<div class="container svelte-1kup2az"><div class="auth svelte-1kup2az"><!></div> <div><div class="footer svelte-1kup2az"><div class="fill svelte-1kup2az"></div> <div class="action"></div></div> <!> <div class="footer svelte-1kup2az"><div class="hash svelte-1kup2az"> </div> <div class="fill svelte-1kup2az"></div> <div class="actions svelte-1kup2az"><button class="svelte-1kup2az"><img height="16px" alt="likes"/> </button></div> <div class="timestamp svelte-1kup2az"> </div></div></div> <div class="auth svelte-1kup2az"><!></div></div>');function Ye(v,a){qt(a,!0);let h=y(!1);const T=400;var H=Ke(),b=i(H),N=i(b);{var R=c=>{var _=Oe();k(E=>{B(_,"src",E),B(_,"alt",a.auth)},[()=>Nt(a.auth,16)]),n(c,_)},O=c=>{var _=Le();n(c,_)};z(N,c=>{a.thisAuth?c(O,!1):c(R)})}o(b);var j=r(b,2),L=r(i(j),2);{var Z=c=>{var _=Tt(),E=vt(_);{var nt=V=>{var J=We(),tt=i(J),P=r(tt);P.__click=[Ze,h];var M=i(P,!0);o(P),o(J),k(()=>{p(tt,`${a.body??""} `),p(M,e(h)?"show less":"show more")}),n(V,J)},pt=(V,J)=>{{var tt=M=>{var q=Fe(),et=i(q),K=r(et);K.__click=[Ie,h];var lt=i(K,!0);o(K),o(q),k(ct=>{p(et,`${ct??""} `),p(lt,e(h)?"show less":"show more")},[()=>a.body.substring(0,T)+" ..."]),n(M,q)},P=M=>{var q=ae();k(()=>p(q,a.body)),n(M,q)};z(V,M=>{a.body.length>T+20?M(tt):M(P,!1)},J)}};z(E,V=>{a.body.length>T+20&&e(h)?V(nt):V(pt,!1)})}n(c,_)},D=c=>{var _=Ve(),E=i(_,!0);o(_),k(()=>p(E,a.error)),n(c,_)};z(L,c=>{a.error?c(D,!1):c(Z)})}var ot=r(L,2),W=i(ot),X=i(W,!0);o(W);var C=r(W,4),I=i(C);I.__click=[Ge,a];var F=i(I),f=r(F);o(I),o(C);var $=r(C,2),w=i($);o($),o(ot),o(j);var m=r(j,2),ht=i(m);{var ft=c=>{var _=je();k(E=>{B(_,"src",E),B(_,"alt",a.auth)},[()=>Nt(a.auth,16)]),n(c,_)},mt=c=>{var _=Je();n(c,_)};z(ht,c=>{a.thisAuth?c(ft):c(mt,!1)})}o(m),o(H),k(()=>{Me(j,1,`post ${a.thisAuth?"op":""} `,"svelte-1kup2az"),p(X,a.hash),B(F,"src",Re),p(f,` ${a.likes??""}`),p(w,`${a.height??""} ■ ${a.sequence??""}`)}),n(v,H),Rt()}Ot(["click"]);var Qe=u("<img/>"),Xe=u('<img alt="Disconnected"/>'),$e=(v,a,h)=>a(e(h)),ta=u('<div class="deleteMe svelte-1f5vzoo"><button class="svelte-1f5vzoo"><img height="36px"/></button></div>'),ea=u("<!> <!>",1),aa=u('<p style="color: red"> </p>'),sa=(v,a)=>a(),ia=u('<div class="row footer svelte-1f5vzoo"><h2>Create new identity</h2> <button class="svelte-1f5vzoo">New identity 1M sats</button></div>'),oa=(v,a)=>a(),ra=u('<img height="32px" alt="avatar" class="svelte-1f5vzoo"/>'),va=u('<div style="font-size:x-small;"> <br/> </div>'),na=(v,a,h)=>a(e(h)),la=u('<div class="edit svelte-1f5vzoo"><textarea class="svelte-1f5vzoo"> </textarea> <div class="estimate svelte-1f5vzoo"> </div></div> <div class="send svelte-1f5vzoo"><div class="auth svelte-1f5vzoo"><!> <!></div> <button class="svelte-1f5vzoo">Send</button></div>',1),ca=u("<p>Not connected?</p>"),da=u('<div class="row footer svelte-1f5vzoo"><!></div>'),ua=(v,a)=>a(1e7),_a=(v,a)=>a(1e6),ha=u('<div class="row footer svelte-1f5vzoo"><button class="svelte-1f5vzoo">Top up 10M sats</button> <button class="svelte-1f5vzoo">Top up 1M sats</button></div>'),fa=u('<div class="box svelte-1f5vzoo"><div class="row header svelte-1f5vzoo"> <sub>■</sub> <div style="flex: 2 2 auto;"></div> <b><a href="/pop/">/pop</a> </b> <div style="flex: 2 2 auto;"></div> <!> <!></div> <div id="chat" class="row content svelte-1f5vzoo"><!></div> <!> <div class="row footer svelte-1f5vzoo"><div style="margin: auto;">Advanced</div> <div><label class="switch svelte-1f5vzoo"><input type="checkbox" class="svelte-1f5vzoo"/> <span class="slider round svelte-1f5vzoo"></span></label></div></div> <!></div>');function Ma(v,a){qt(a,!0);const T=Dt.url.hostname=="vox.cash"?"bch.imaginary.cash":"chipnet.bch.ninja",H=wt('OP_RETURN <"U3V">');let b=y(0),N=y(0),R=y(0n),O=y(""),j=y(""),L=y(""),Z=y(""),D=y(0),ot=y(0),W=y(!1);const X=oe(()=>Q.getScriptHash(a.topic));let C=y(Bt([])),I,F="",f,$="",w,m=y(Bt([]));const ht=()=>{clearTimeout(I),I=setTimeout(()=>{E(),nt()},1500)},ft=async function(t){if(t.method==="blockchain.headers.subscribe"){let s=t.params[0];l(b,s.height,!0)}else t.method==="blockchain.scripthash.subscribe"?t.params[1]!==e(j)&&(l(j,t.params[1],!0),l(O,xt[f.status],!0),ht()):console.log(t)},mt=function(){let t=document.getElementById("chat");var s=t.scrollHeight;t.scrollTo(0,s)},c=async function(t){let s=Q.like(a.topic,t,e(m)[0],(Math.round(e(b)/1e3)+10)*10,F),d=yt(zt(s.transaction));await P(d)},_=async function(){let t=await f.request("blockchain.headers.get_tip");if(t instanceof Error)throw t;l(b,t.height,!0)},E=async function(){let t=await f.request("blockchain.scripthash.listunspent",$,"include_tokens");if(t instanceof Error)throw t;l(m,t.filter(s=>s.token_data&&s.token_data.nft&&s.token_data.nft.commitment.startsWith(H)),!0),e(m).length>0&&e(m)[0].token_data&&(l(Z,e(m)[0].token_data.category,!0),l(N,e(m)[0].value,!0))},nt=async function(){let t=await f.request("blockchain.scripthash.listunspent",e(X),"include_tokens");if(t instanceof Error)throw t;l(R,ke(t),!0);let s=Array.from(new Set(t.map(x=>x.tx_hash))),d=await f.request("blockchain.scripthash.get_history",e(X),e(b)-1500,-1),A=await Pe(f,s);l(C,ne(d,A,a.topic),!0),l(C,e(C).map(x=>({thisAuth:e(Z)==x.auth,...x})),!0),e(C).slice(-1).length>0?l(D,e(C).slice(-1)[0].height<=0?e(C).slice(-1)[0].sequence+1:0,!0):l(D,0)},pt=async function(t){let s=await f.request("blockchain.scripthash.listunspent",e(X),"include_tokens");if(s instanceof Error)throw s;let d=s.filter(g=>g.tx_hash==t.hash),A=Q.clear(a.topic,d,e(m)[0],F,e(b)),x=yt(zt(A.transaction));await P(x)},V=()=>{clearTimeout(I),I=setTimeout(()=>{l(ot,J(e(L)),!0)},500)},J=function(t){let s=Q.post(a.topic,t,e(m)[0],(Math.round(e(b)/1e3)+10)*10,F,e(D));const d=s.transaction.outputs[s.transaction.outputs.length-1].valueSatoshis;return Number(we(s.sourceOutputs)-d)},tt=async function(t){let s=Q.post(a.topic,t,e(m)[0],(Math.round(e(b)/1e3)+10)*10,F,e(D)),d=yt(zt(s.transaction));await P(d),l(L,"")},P=async function(t){let s=await f.request("blockchain.transaction.broadcast",t);if(l(D,e(D)+1),s instanceof Error)throw l(O,xt[f.status],!0),s},M=async function(){await w.sendMax(w.getDepositAddress());let t=wt('OP_RETURN <"U3V"> <"pseudonymous">');await w.tokenGenesis({cashaddr:w.getTokenDepositAddress(),commitment:t,capability:Pt.minting,value:1e6})},q=async function(t){l(N,e(m)[0].value,!0),l(Z,e(m)[0].token_data.category,!0);let s=wt('OP_RETURN <"U3V"> <"pseudonymous">');await w.send(new Ne({cashaddr:w.getTokenDepositAddress(),tokenId:e(Z),commitment:s,capability:Pt.minting,value:e(N)+t})),await E()};se(async()=>{const t=Dt.url.hostname!=="vox.cash";ye.StorageProvider=xe,w=t?await ze.named("vox"):await Te.named("vox"),F=Ee(w.mnemonic,w.derivationPath.slice(0,-2),w.isTestnet);let s=pe(w.getDepositAddress());if(typeof s=="string")throw s;$=be(s.bytecode),f=new ge(Q.USER_AGENT,"1.4.1",T),await f.connect(),f.on("notification",ft),l(O,xt[f.status],!0),await f.subscribe("blockchain.scripthash.subscribe",e(X)),await f.subscribe("blockchain.scripthash.subscribe",$),await _(),await E(),await nt(),mt()}),ie(async()=>{await w.provider.disconnect(),await f.disconnect()});var et=fa(),K=i(et),lt=i(K,!0),ct=r(lt,2),bt=r(ct,3),Lt=r(i(bt));o(bt);var Ct=r(bt,3),Et=r(Ct);Ae(Et,{get template(){return Q.template}});var Zt=r(Et,2);{var Wt=t=>{var s=Qe();k(()=>{B(s,"src",Se),B(s,"alt",e(O))}),n(t,s)},It=t=>{var s=Xe();k(()=>B(s,"src",He)),n(t,s)};z(Zt,t=>{e(O)=="CONNECTED"?t(Wt):t(It,!1)})}o(K);var gt=r(K,2),Ft=i(gt);ve(Ft,()=>a.transactions,null,(t,s)=>{var d=Tt(),A=vt(d);ce(A,17,()=>e(C),de,(x,g)=>{var U=ea(),G=vt(U);Ye(G,me({likePost:c},()=>e(g)));var at=r(G,2);{var dt=rt=>{var st=ta(),Y=i(st);Y.__click=[$e,pt,g];var ut=i(Y);o(Y),o(st),k(()=>B(ut,"src",qe)),n(rt,st)};z(at,rt=>{e(W)&&rt(dt)})}n(x,U)}),n(t,d)},(t,s)=>{var d=aa(),A=i(d,!0);o(d),k(()=>p(A,e(s).message)),n(t,d)}),o(gt);var At=r(gt,2);{var Vt=t=>{var s=ia(),d=r(i(s),2);d.__click=[sa,M],o(s),n(t,s)},Gt=t=>{var s=da(),d=i(s);{var A=g=>{var U=la(),G=vt(U),at=i(G);_e(at),at.__keyup=[oa,V];var dt=r(at,2),rt=i(dt);o(dt),o(G);var st=r(G,2),Y=i(st),ut=i(Y);{var Kt=S=>{var it=ra();k(_t=>B(it,"src",_t),[()=>Nt(e(Z),16)]),n(S,it)};z(ut,S=>{e(Z)&&S(Kt)})}var Yt=r(ut,2);{var Qt=S=>{var it=va(),_t=i(it,!0),$t=r(_t,2);o(it),k((te,ee)=>{p(_t,te),p($t,` ${ee??""}sats`)},[()=>le(e(m)[0].token_data.nft.commitment),()=>e(N).toLocaleString()]),n(S,it)};z(Yt,S=>{e(m).length>0&&S(Qt)})}o(Y);var Xt=r(Y,2);Xt.__click=[na,tt,L],o(st),k(S=>p(rt,`${S??""} sats`),[()=>e(ot).toLocaleString()]),fe(at,()=>e(L),S=>l(L,S)),n(g,U)},x=g=>{var U=ca();n(g,U)};z(d,g=>{e(O)=="CONNECTED"?g(A):g(x,!1)})}o(s),n(t,s)};z(At,t=>{e(m).length==0?t(Vt):t(Gt,!1)})}var kt=r(At,2),St=r(i(kt),2),Ht=i(St),Mt=i(Ht);ue(Mt),re(2),o(Ht),o(St),o(kt);var jt=r(kt,2);{var Jt=t=>{var s=Tt(),d=vt(s);{var A=x=>{var g=ha(),U=i(g);U.__click=[ua,q];var G=r(U,2);G.__click=[_a,q],o(g),n(x,g)};z(d,x=>{e(m).length>0&&x(A)})}n(t,s)};z(jt,t=>{e(W)&&t(Jt)})}o(et),k((t,s)=>{p(lt,t),p(ct,` ${e(D)??""} `),p(Lt,`/${a.topic??""}`),p(Ct,` ${s??""} sats   `)},[()=>e(b).toLocaleString(),()=>e(R).toLocaleString()]),he(Mt,()=>e(W),t=>l(W,t)),n(v,et),Rt()}Ot(["click","keyup"]);export{Ma as C};
//# sourceMappingURL=BtjWCY2b.js.map
