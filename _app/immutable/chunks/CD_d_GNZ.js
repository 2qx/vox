import{f as h,a as c,t as $t,c as Tt}from"./yGPdYsEk.js";import{o as te,a as ee}from"./BL1kRCRP.js";import{h as Nt,p as At,c as i,r as o,s as r,t as k,a as St,aF as A,a9 as Ct,j as e,aa as u,a0 as ae,f as et,as as se}from"./4Ej_4qXs.js";import{d as Ht,s as T}from"./BNpjwQLA.js";import{a as ie,C as I,b as oe,p as re}from"./DxC2wkOi.js";import{i as S}from"./CyUl1IAL.js";import{e as ne,i as ve}from"./PZPIYvej.js";import{s as P,r as le,c as ce}from"./CnJGQRAh.js";import{b as de,a as ue}from"./R_USggII.js";import{s as he}from"./DlPNFNxT.js";import{p as Et}from"./BL5gkuxn.js";import{L as ct,F as _e,m as fe,$ as me,G as dt,p as ut,J as ht,s as pe}from"./zIYK9qkZ.js";import{I as ge,B as be,T as we,W as xe,N as zt,a as ke}from"./DeOyqwJy.js";import{a as ye,b as _t}from"./BtgC42a0.js";import{g as Te}from"./gC8E2xLB.js";import{B as Ne,C as Ce,D as Ee}from"./BbIwgq-g.js";function ze(n,s,f,y,B,b){var N=n.__className;if(Nt||N!==f||N===void 0){var p=ye(f,y);(!Nt||p!==n.getAttribute("class"))&&(p==null?n.removeAttribute("class"):n.className=p),n.__className=f}return b}const Ae=8;async function Se(n,s,f=Ae){let y=0,B=[];for(;y<s.length;){const b=s.slice(y,y+f);B=[...B,...await Promise.all(b.map(N=>n(N)))],y+=f}return B}async function He(n){return await n[0].request("blockchain.transaction.get",n[1],!1)}async function Me(n,s){return Se(He,s.map(f=>[n,f]))}const Pe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='15px'%20fill='%23000'%3e%3cpath%20d='M280-120q-33%200-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0%2033-23.5%2056.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160%200h80v-360h-80v360ZM280-720v520-520Z'/%3e%3c/svg%3e",qe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48px'%20viewBox='0%20-960%20960%20960'%20width='48px'%20fill='%23888'%3e%3cpath%20d='M272-120v-512l278-288%2058%2046-52%20242h359v171L767-120H272Zm60-60h397l126-299v-93H482l53-249-203%20214v427Zm0-427v427-427ZM79-120v-512h193v60H139v392h133v60H79Z'/%3e%3c/svg%3e";var Be=h('<img height="32px" class="svelte-5d85ue"/>'),De=h('<div style="width:32px"></div>'),Re=h('<div class="error svelte-5d85ue"> </div>'),Ue=(n,s)=>{s.likePost(s.hash)},Oe=h('<img height="32px" class="svelte-5d85ue"/>'),Ze=h('<div style="width:32px"></div>'),Le=h('<div class="container svelte-5d85ue"><div class="auth svelte-5d85ue"><!></div> <div><div class="footer svelte-5d85ue"><div class="fill svelte-5d85ue"></div> <div class="action"></div></div> <!> <div class="footer svelte-5d85ue"><div class="hash svelte-5d85ue"> </div> <div class="fill svelte-5d85ue"></div> <div class="actions svelte-5d85ue"><button class="svelte-5d85ue"><img height="16px" alt="likes"/> </button></div> <div class="timestamp svelte-5d85ue"> </div></div></div> <div class="auth svelte-5d85ue"><!></div></div>');function Ie(n,s){At(s,!0);var f=Le(),y=i(f),B=i(y);{var b=v=>{var d=Be();k(q=>{P(d,"src",q),P(d,"alt",s.auth)},[()=>_t(s.auth,16)]),c(v,d)},N=v=>{var d=De();c(v,d)};S(B,v=>{s.thisAuth?v(N,!1):v(b)})}o(y);var p=r(y,2),J=r(i(p),2);{var O=v=>{var d=$t();k(()=>T(d,s.body)),c(v,d)},D=v=>{var d=Re(),q=i(d,!0);o(d),k(()=>T(q,s.error)),c(v,d)};S(J,v=>{s.error?v(D,!1):v(O)})}var H=r(J,2),W=i(H),F=i(W,!0);o(W);var R=r(W,4),C=i(R);C.__click=[Ue,s];var K=i(C),Z=r(K);o(C),o(R);var _=r(R,2),Q=i(_);o(_),o(H),o(p);var x=r(p,2),m=i(x);{var at=v=>{var d=Oe();k(q=>{P(d,"src",q),P(d,"alt",s.auth)},[()=>_t(s.auth,16)]),c(v,d)},st=v=>{var d=Ze();c(v,d)};S(m,v=>{s.thisAuth?v(at):v(st,!1)})}o(x),o(f),k(()=>{ze(p,1,`post ${s.thisAuth?"op":""}`,"svelte-5d85ue"),T(F,s.hash),P(K,"src",qe),T(Z,` ${s.likes??""}`),T(Q,`${s.height??""} ■ ${s.sequence??""}`)}),c(n,f),St()}Ht(["click"]);var We=h("<img/>"),Fe=h('<img alt="Disconnected"/>'),Ve=(n,s,f)=>s(e(f)),Ge=h('<div class="deleteMe svelte-1f5vzoo"><button class="svelte-1f5vzoo"><img height="36px"/></button></div>'),je=h("<!> <!>",1),Je=h('<p style="color: red"> </p>'),Ke=(n,s)=>s(),Ye=h('<div class="row footer svelte-1f5vzoo"><h2>Create new identity</h2> <button class="svelte-1f5vzoo">New identity 1M sats</button></div>'),Qe=(n,s)=>s(),Xe=h('<img height="32px" alt="avatar" class="svelte-1f5vzoo"/>'),$e=h('<div style="font-size:x-small;"> <br/> </div>'),ta=(n,s,f)=>s(e(f)),ea=h('<div class="edit svelte-1f5vzoo"><textarea class="svelte-1f5vzoo"> </textarea> <div class="estimate svelte-1f5vzoo"> </div></div> <div class="send svelte-1f5vzoo"><div class="auth svelte-1f5vzoo"><!> <!></div> <button class="svelte-1f5vzoo">Send</button></div>',1),aa=h("<p>Not connected?</p>"),sa=h('<div class="row footer svelte-1f5vzoo"><!></div>'),ia=(n,s)=>s(1e7),oa=(n,s)=>s(1e6),ra=h('<div class="row footer svelte-1f5vzoo"><button class="svelte-1f5vzoo">Top up 10M sats</button> <button class="svelte-1f5vzoo">Top up 1M sats</button></div>'),na=h('<div class="box svelte-1f5vzoo"><div class="row header svelte-1f5vzoo"> <sub>■</sub> <div style="flex: 2 2 auto;"></div> <b><a href="/pop/">/pop</a> </b> <div style="flex: 2 2 auto;"></div> <!> <!></div> <div id="chat" class="row content svelte-1f5vzoo"><!></div> <!> <div class="row footer svelte-1f5vzoo"><div style="margin: auto;">Advanced</div> <div><label class="switch svelte-1f5vzoo"><input type="checkbox" class="svelte-1f5vzoo"/> <span class="slider round svelte-1f5vzoo"></span></label></div></div> <!></div>');function Ta(n,s){At(s,!0);const y=Et.url.hostname=="vox.cash"?"bch.imaginary.cash":"chipnet.bch.ninja",B=ct('OP_RETURN <"U3V">');let b=A(0),N=A(0),p=A(""),J=A(""),O=A(""),D=A(""),H=A(0),W=A(0),F=A(!1);const R=ae(()=>I.getScriptHash(s.topic));let C=A(Ct([])),K,Z="",_,Q="",x,m=A(Ct([]));const at=async function(t){if(t.method==="blockchain.headers.subscribe"){let a=t.params[0];u(b,a.height,!0)}else t.method==="blockchain.scripthash.subscribe"?t.params[1]!==e(J)&&(u(J,t.params[1],!0),u(p,dt[_.status],!0),await ft(),await q(),st()):console.log(t)},st=function(){let t=document.getElementById("chat");var a=t.scrollHeight;t.scrollTo(0,a)},v=async function(t){let a=I.like(s.topic,t,e(m)[0],(Math.round(e(b)/1e3)+10)*10,Z),l=ut(ht(a.transaction));await it(l)},d=async function(){let t=await _.request("blockchain.headers.get_tip");if(t instanceof Error)throw t;u(b,t.height,!0)},q=async function(){let t=await _.request("blockchain.scripthash.listunspent",Q,"include_tokens");if(t instanceof Error)throw t;u(m,t.filter(a=>a.token_data&&a.token_data.nft&&a.token_data.nft.commitment.startsWith(B)),!0),e(m).length>0&&e(m)[0].token_data&&(u(D,e(m)[0].token_data.category,!0),u(N,e(m)[0].value,!0))},ft=async function(){let t=await _.request("blockchain.scripthash.listunspent",e(R),"include_tokens");if(t instanceof Error)throw t;let a=Array.from(new Set(t.map(w=>w.tx_hash))),l=await _.request("blockchain.scripthash.get_history",e(R),e(b)-1500,-1),E=await Me(_,a);u(C,oe(l,E,s.topic),!0),u(C,e(C).map(w=>({thisAuth:e(D)==w.auth,...w})),!0),e(C).slice(-1).length>0?u(H,e(C).slice(-1)[0].height<=0?e(C).slice(-1)[0].sequence+1:0,!0):u(H,0)},Mt=async function(t){let a=await _.request("blockchain.scripthash.listunspent",e(R),"include_tokens");if(a instanceof Error)throw a;let l=a.filter(g=>g.tx_hash==t.hash),E=I.clear(s.topic,l,e(m)[0],Z,e(b)),w=ut(ht(E.transaction));await it(w)},Pt=()=>{clearTimeout(K),K=setTimeout(()=>{u(W,qt(e(O)),!0)},500)},qt=function(t){let a=I.post(s.topic,t,e(m)[0],(Math.round(e(b)/1e3)+10)*10,Z,e(H));const l=a.transaction.outputs[a.transaction.outputs.length-1].valueSatoshis;return Number(pe(a.sourceOutputs)-l)},Bt=async function(t){let a=I.post(s.topic,t,e(m)[0],(Math.round(e(b)/1e3)+10)*10,Z,e(H)),l=ut(ht(a.transaction));await it(l),u(O,"")},it=async function(t){let a=await _.request("blockchain.transaction.broadcast",t);if(u(H,e(H)+1),a instanceof Error)throw u(p,dt[_.status],!0),a},Dt=async function(){let t=ct('OP_RETURN <"U3V"> <"pseudonymous">');await x.tokenGenesis({cashaddr:x.getTokenDepositAddress(),commitment:t,capability:zt.minting,value:1e6})},mt=async function(t){u(N,e(m)[0].value,!0),u(D,e(m)[0].token_data.category,!0);let a=ct('OP_RETURN <"U3V"> <"pseudonymous">');await x.send(new ke({cashaddr:x.getTokenDepositAddress(),tokenId:e(D),commitment:a,capability:zt.minting,value:e(N)+t})),await q()};te(async()=>{const t=Et.url.hostname!=="vox.cash";be.StorageProvider=ge,x=t?await we.named("vox"):await xe.named("vox"),Z=Te(x.mnemonic,x.derivationPath.slice(0,-2),x.isTestnet);let a=_e(x.getDepositAddress());if(typeof a=="string")throw a;Q=fe(a.bytecode),_=new me(I.USER_AGENT,"1.4.1",y),await _.connect(),_.on("notification",at),u(p,dt[_.status],!0),await _.subscribe("blockchain.scripthash.subscribe",e(R)),await d(),await q(),await ft()}),ee(async()=>{await x.provider.disconnect(),await _.disconnect()});var ot=na(),rt=i(ot),pt=i(rt,!0),gt=r(pt,2),nt=r(gt,3),Rt=r(i(nt));o(nt);var bt=r(nt,4);Ne(bt,{get template(){return I.template}});var Ut=r(bt,2);{var Ot=t=>{var a=We();k(()=>{P(a,"src",Ce),P(a,"alt",e(p))}),c(t,a)},Zt=t=>{var a=Fe();k(()=>P(a,"src",Ee)),c(t,a)};S(Ut,t=>{e(p)=="CONNECTED"?t(Ot):t(Zt,!1)})}o(rt);var vt=r(rt,2),Lt=i(vt);ie(Lt,()=>s.transactions,null,(t,a)=>{var l=Tt(),E=et(l);ne(E,17,()=>e(C),ve,(w,g)=>{var M=je(),U=et(M);Ie(U,he({likePost:v},()=>e(g)));var V=r(U,2);{var X=Y=>{var G=Ge(),L=i(G);L.__click=[Ve,Mt,g];var $=i(L);o(L),o(G),k(()=>P($,"src",Pe)),c(Y,G)};S(V,Y=>{e(F)&&Y(X)})}c(w,M)}),c(t,l)},(t,a)=>{var l=Je(),E=i(l,!0);o(l),k(()=>T(E,e(a).message)),c(t,l)}),o(vt);var wt=r(vt,2);{var It=t=>{var a=Ye(),l=r(i(a),2);l.__click=[Ke,Dt],o(a),c(t,a)},Wt=t=>{var a=sa(),l=i(a);{var E=g=>{var M=ea(),U=et(M),V=i(U);ce(V),V.__keyup=[Qe,Pt];var X=r(V,2),Y=i(X);o(X),o(U);var G=r(U,2),L=i(G),$=i(L);{var Gt=z=>{var j=Xe();k(tt=>P(j,"src",tt),[()=>_t(e(D),16)]),c(z,j)};S($,z=>{e(D)&&z(Gt)})}var jt=r($,2);{var Jt=z=>{var j=$e(),tt=i(j,!0),Yt=r(tt,2);o(j),k((Qt,Xt)=>{T(tt,Qt),T(Yt,` ${Xt??""}sats`)},[()=>re(e(m)[0].token_data.nft.commitment),()=>e(N).toLocaleString()]),c(z,j)};S(jt,z=>{e(m).length>0&&z(Jt)})}o(L);var Kt=r(L,2);Kt.__click=[ta,Bt,O],o(G),k(z=>T(Y,`${z??""} sats`),[()=>e(W).toLocaleString()]),ue(V,()=>e(O),z=>u(O,z)),c(g,M)},w=g=>{var M=aa();c(g,M)};S(l,g=>{e(p)=="CONNECTED"?g(E):g(w,!1)})}o(a),c(t,a)};S(wt,t=>{e(m).length==0?t(It):t(Wt,!1)})}var lt=r(wt,2),xt=r(i(lt),2),kt=i(xt),yt=i(kt);le(yt),se(2),o(kt),o(xt),o(lt);var Ft=r(lt,2);{var Vt=t=>{var a=Tt(),l=et(a);{var E=w=>{var g=ra(),M=i(g);M.__click=[ia,mt];var U=r(M,2);U.__click=[oa,mt],o(g),c(w,g)};S(l,w=>{e(m).length>0&&w(E)})}c(t,a)};S(Ft,t=>{e(F)&&t(Vt)})}o(ot),k(t=>{T(pt,t),T(gt,` ${e(H)??""} `),T(Rt,`/${s.topic??""}`)},[()=>e(b).toLocaleString()]),de(yt,()=>e(F),t=>u(F,t)),c(n,ot),St()}Ht(["click","keyup"]);export{Ta as C};
//# sourceMappingURL=CD_d_GNZ.js.map
