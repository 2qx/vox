import{f as u,a as v,c as Nt,t as re}from"./yGPdYsEk.js";import{o as ve,a as ne}from"./BL1kRCRP.js";import{h as Pt,p as Lt,c as i,r as o,s as r,t as k,a as Zt,f as vt,j as e,aF as T,aa as l,a9 as qt,a0 as le,as as ce}from"./4Ej_4qXs.js";import{d as Wt,s as b}from"./BNpjwQLA.js";import{a as de,C as $,b as ue,p as _e}from"./DxC2wkOi.js";import{i as y}from"./CyUl1IAL.js";import{e as he,i as fe}from"./PZPIYvej.js";import{s as D,r as me,c as pe}from"./CnJGQRAh.js";import{b as be,a as ge}from"./R_USggII.js";import{s as ke}from"./DlPNFNxT.js";import{p as Rt}from"./dcNOkr7V.js";import{L as xt,F as we,m as xe,$ as ye,G as yt,H as ze,p as zt,J as Tt,s as Te}from"./zIYK9qkZ.js";import{I as Ne,B as Ce,T as Ee,W as Ae,N as Ot,a as Se}from"./DeOyqwJy.js";import{a as He,b as Ct}from"./BtgC42a0.js";import{g as Me}from"./gC8E2xLB.js";import{B as De,C as Ue,D as Be}from"./BbIwgq-g.js";function Pe(n,a,h,N,H,g){var z=n.__className;if(Pt||z!==h||z===void 0){var q=He(h,N);(!Pt||q!==n.getAttribute("class"))&&(q==null?n.removeAttribute("class"):n.className=q),n.__className=h}return g}const qe=8;async function Re(n,a,h=qe){let N=0,H=[];for(;N<a.length;){const g=a.slice(N,N+h);H=[...H,...await Promise.all(g.map(z=>n(z)))],N+=h}return H}async function Oe(n){return await n[0].request("blockchain.transaction.get",n[1],!1)}async function Le(n,a){return Re(Oe,a.map(h=>[n,h]))}const Ze="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='15px'%20fill='%23000'%3e%3cpath%20d='M280-120q-33%200-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0%2033-23.5%2056.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160%200h80v-360h-80v360ZM280-720v520-520Z'/%3e%3c/svg%3e",We="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48px'%20viewBox='0%20-960%20960%20960'%20width='48px'%20fill='%23888'%3e%3cpath%20d='M272-120v-512l278-288%2058%2046-52%20242h359v171L767-120H272Zm60-60h397l126-299v-93H482l53-249-203%20214v427Zm0-427v427-427ZM79-120v-512h193v60H139v392h133v60H79Z'/%3e%3c/svg%3e";var Ie=u('<img height="32px" class="svelte-1kup2az"/>'),Fe=u('<div style="width:32px"></div>'),Ve=(n,a)=>{l(a,!e(a))},Ge=u('<div> <button class="svelte-1kup2az"> </button></div>'),je=(n,a)=>{l(a,!e(a))},Je=u('<div> <button class="svelte-1kup2az"> </button></div>'),Ke=u('<div class="error svelte-1kup2az"> </div>'),Ye=(n,a)=>{a.likePost(a.hash)},Qe=u('<img height="32px" class="svelte-1kup2az"/>'),Xe=u('<div style="width:32px"></div>'),$e=u('<div class="container svelte-1kup2az"><div class="auth svelte-1kup2az"><!></div> <div><div class="footer svelte-1kup2az"><div class="fill svelte-1kup2az"></div> <div class="action"></div></div> <!> <div class="footer svelte-1kup2az"><div class="hash svelte-1kup2az"> </div> <div class="fill svelte-1kup2az"></div> <div class="actions svelte-1kup2az"><button class="svelte-1kup2az"><img height="16px" alt="likes"/> </button></div> <div class="timestamp svelte-1kup2az"> </div></div></div> <div class="auth svelte-1kup2az"><!></div></div>');function ta(n,a){Lt(a,!0);let h=T(!1);const N=400;var H=$e(),g=i(H),z=i(g);{var q=c=>{var _=Ie();k(E=>{D(_,"src",E),D(_,"alt",a.auth)},[()=>Ct(a.auth,16)]),v(c,_)},R=c=>{var _=Fe();v(c,_)};y(z,c=>{a.thisAuth?c(R,!1):c(q)})}o(g);var J=r(g,2),O=r(i(J),2);{var L=c=>{var _=Nt(),E=vt(_);{var nt=F=>{var K=Ge(),at=i(K),B=r(at);B.__click=[Ve,h];var M=i(B,!0);o(B),o(K),k(()=>{b(at,`${a.body??""} `),b(M,e(h)?"show less":"show more")}),v(F,K)},mt=(F,K)=>{{var at=M=>{var P=Je(),st=i(P),Y=r(st);Y.__click=[je,h];var lt=i(Y,!0);o(Y),o(P),k(ct=>{b(st,`${ct??""} `),b(lt,e(h)?"show less":"show more")},[()=>a.body.substring(0,N)+" ..."]),v(M,P)},B=M=>{var P=re();k(()=>b(P,a.body)),v(M,P)};y(F,M=>{a.body.length>N+20?M(at):M(B,!1)},K)}};y(E,F=>{a.body.length>N+20&&e(h)?F(nt):F(mt,!1)})}v(c,_)},U=c=>{var _=Ke(),E=i(_,!0);o(_),k(()=>b(E,a.error)),v(c,_)};y(O,c=>{a.error?c(U,!1):c(L)})}var rt=r(O,2),Z=i(rt),tt=i(Z,!0);o(Z);var C=r(Z,4),W=i(C);W.__click=[Ye,a];var I=i(W),p=r(I);o(W),o(C);var et=r(C,2),w=i(et);o(et),o(rt),o(J);var f=r(J,2),_t=i(f);{var ht=c=>{var _=Qe();k(E=>{D(_,"src",E),D(_,"alt",a.auth)},[()=>Ct(a.auth,16)]),v(c,_)},ft=c=>{var _=Xe();v(c,_)};y(_t,c=>{a.thisAuth?c(ht):c(ft,!1)})}o(f),o(H),k(()=>{Pe(J,1,`post ${a.thisAuth?"op":""} `,"svelte-1kup2az"),b(tt,a.hash),D(I,"src",We),b(p,` ${a.likes??""}`),b(w,`${a.height??""} ■ ${a.sequence??""}`)}),v(n,H),Zt()}Wt(["click"]);var ea=u("<img/>"),aa=u('<img alt="Disconnected"/>'),sa=(n,a,h)=>a(e(h)),ia=u('<div class="deleteMe svelte-1f5vzoo"><button class="svelte-1f5vzoo"><img height="36px"/></button></div>'),oa=u("<!> <!>",1),ra=u('<p style="color: red"> </p>'),va=(n,a)=>a(),na=u('<div class="row footer svelte-1f5vzoo"><h2>Create new identity</h2> <button class="svelte-1f5vzoo">New identity 1M sats</button></div>'),la=u('<div class="row footer svelte-1f5vzoo"><p><a href="/wallet">Deposit funds</a> to create identity</p></div>'),ca=(n,a)=>a(),da=u('<img height="32px" alt="avatar" class="svelte-1f5vzoo"/>'),ua=u('<div style="font-size:x-small;"> <br/> </div>'),_a=(n,a,h)=>a(e(h)),ha=u('<div class="edit svelte-1f5vzoo"><textarea class="svelte-1f5vzoo"> </textarea> <div class="estimate svelte-1f5vzoo"> </div></div> <div class="send svelte-1f5vzoo"><div class="auth svelte-1f5vzoo"><!> <!></div> <button class="svelte-1f5vzoo">Send</button></div>',1),fa=u("<p>Not connected?</p>"),ma=u('<div class="row footer svelte-1f5vzoo"><!></div>'),pa=(n,a)=>a(1e7),ba=(n,a)=>a(1e6),ga=u('<div class="row footer svelte-1f5vzoo"><button class="svelte-1f5vzoo">Top up 10M sats</button> <button class="svelte-1f5vzoo">Top up 1M sats</button></div>'),ka=u('<div class="box svelte-1f5vzoo"><div class="row header svelte-1f5vzoo"> <sub>■</sub> <div style="flex: 2 2 auto;"></div> <b><a href="/pop/">/pop</a> </b> <div style="flex: 2 2 auto;"></div> <!> <!></div> <div id="chat" class="row content svelte-1f5vzoo"><!></div> <!> <div class="row footer svelte-1f5vzoo"><div style="margin: auto;">Advanced</div> <div><label class="switch svelte-1f5vzoo"><input type="checkbox" class="svelte-1f5vzoo"/> <span class="slider round svelte-1f5vzoo"></span></label></div></div> <!></div>');function qa(n,a){Lt(a,!0);const N=Rt.url.hostname=="vox.cash"?"bch.imaginary.cash":"chipnet.bch.ninja",H=xt('OP_RETURN <"U3V">');let g=T(0),z=T(0),q=T(0n),R=T(""),J=T(""),O=T(""),L=T(""),U=T(0),rt=T(0),Z=T(!1);const tt=le(()=>$.getScriptHash(a.topic));let C=T(qt([])),W,I="",p,et="",w,f=T(qt([]));const _t=()=>{clearTimeout(W),W=setTimeout(()=>{E(),nt()},1500)},ht=async function(t){if(t.method==="blockchain.headers.subscribe"){let s=t.params[0];l(g,s.height,!0)}else t.method==="blockchain.scripthash.subscribe"?t.params[1]!==e(J)&&(l(J,t.params[1],!0),l(R,yt[p.status],!0),_t()):console.log(t)},ft=function(){let t=document.getElementById("chat");var s=t.scrollHeight;t.scrollTo(0,s)},c=async function(t){let s=$.like(a.topic,t,e(f)[0],(Math.round(e(g)/1e3)+10)*10,I),d=zt(Tt(s.transaction));await B(d)},_=async function(){let t=await p.request("blockchain.headers.get_tip");if(t instanceof Error)throw t;l(g,t.height,!0)},E=async function(){let t=await p.request("blockchain.scripthash.listunspent",et,"include_tokens");if(t instanceof Error)throw t;l(f,t.filter(s=>s.token_data&&s.token_data.nft&&s.token_data.nft.commitment.startsWith(H)),!0),e(f).length>0&&e(f)[0].token_data&&(l(L,e(f)[0].token_data.category,!0),l(z,e(f)[0].value,!0))},nt=async function(){let t=await p.request("blockchain.scripthash.listunspent",e(tt),"include_tokens");if(t instanceof Error)throw t;l(q,ze(t),!0);let s=Array.from(new Set(t.map(m=>m.tx_hash))),d=await p.request("blockchain.scripthash.get_history",e(tt),e(g)-1500,-1),A=await Le(p,s);l(C,ue(d,A,a.topic),!0),l(C,e(C).map(m=>({thisAuth:e(L)==m.auth,...m})),!0),e(C).slice(-1).length>0?l(U,e(C).slice(-1)[0].height<=0?e(C).slice(-1)[0].sequence+1:0,!0):l(U,0)},mt=async function(t){let s=await p.request("blockchain.scripthash.listunspent",e(tt),"include_tokens");if(s instanceof Error)throw s;let d=s.filter(x=>x.tx_hash==t.hash),A=$.clear(a.topic,d,e(f)[0],I,e(g)),m=zt(Tt(A.transaction));await B(m)},F=()=>{clearTimeout(W),W=setTimeout(()=>{l(rt,K(e(O)),!0)},500)},K=function(t){let s=$.post(a.topic,t,e(f)[0],(Math.round(e(g)/1e3)+10)*10,I,e(U));const d=s.transaction.outputs[s.transaction.outputs.length-1].valueSatoshis;return Number(Te(s.sourceOutputs)-d)},at=async function(t){let s=$.post(a.topic,t,e(f)[0],(Math.round(e(g)/1e3)+10)*10,I,e(U)),d=zt(Tt(s.transaction));await B(d),l(O,"")},B=async function(t){let s=await p.request("blockchain.transaction.broadcast",t);if(l(U,e(U)+1),s instanceof Error)throw l(R,yt[p.status],!0),s},M=async function(){await w.sendMax(w.getDepositAddress());let t=xt('OP_RETURN <"U3V"> <"pseudonymous">');await w.tokenGenesis({cashaddr:w.getTokenDepositAddress(),commitment:t,capability:Ot.minting,value:1e6})},P=async function(t){l(z,e(f)[0].value,!0),l(L,e(f)[0].token_data.category,!0);let s=xt('OP_RETURN <"U3V"> <"pseudonymous">');await w.send(new Se({cashaddr:w.getTokenDepositAddress(),tokenId:e(L),commitment:s,capability:Ot.minting,value:e(z)+t})),await E()};ve(async()=>{const t=Rt.url.hostname!=="vox.cash";Ce.StorageProvider=Ne,w=t?await Ee.named("vox"):await Ae.named("vox"),I=Me(w.mnemonic,w.derivationPath.slice(0,-2),w.isTestnet);let s=we(w.getDepositAddress());if(typeof s=="string")throw s;et=xe(s.bytecode),p=new ye($.USER_AGENT,"1.4.1",N),await p.connect(),p.on("notification",ht),l(R,yt[p.status],!0),await p.subscribe("blockchain.scripthash.subscribe",e(tt)),await p.subscribe("blockchain.scripthash.subscribe",et),await _(),await E(),await nt(),ft()}),ne(async()=>{await w.provider.disconnect(),await p.disconnect()});var st=ka(),Y=i(st),lt=i(Y,!0),ct=r(lt,2),pt=r(ct,3),It=r(i(pt));o(pt);var Et=r(pt,3),At=r(Et);De(At,{get template(){return $.template}});var Ft=r(At,2);{var Vt=t=>{var s=ea();k(()=>{D(s,"src",Ue),D(s,"alt",e(R))}),v(t,s)},Gt=t=>{var s=aa();k(()=>D(s,"src",Be)),v(t,s)};y(Ft,t=>{e(R)=="CONNECTED"?t(Vt):t(Gt,!1)})}o(Y);var bt=r(Y,2),jt=i(bt);de(jt,()=>a.transactions,null,(t,s)=>{var d=Nt(),A=vt(d);he(A,17,()=>e(C),fe,(m,x)=>{var Q=oa(),it=vt(Q);ta(it,ke({likePost:c},()=>e(x)));var kt=r(it,2);{var V=G=>{var X=ia(),j=i(X);j.__click=[sa,mt,x];var dt=i(j);o(j),o(X),k(()=>D(dt,"src",Ze)),v(G,X)};y(kt,G=>{e(Z)&&G(V)})}v(m,Q)}),v(t,d)},(t,s)=>{var d=ra(),A=i(d,!0);o(d),k(()=>b(A,e(s).message)),v(t,d)}),o(bt);var St=r(bt,2);{var Jt=t=>{var s=na(),d=r(i(s),2);d.__click=[va,M],o(s),v(t,s)},Kt=(t,s)=>{{var d=m=>{var x=la();v(m,x)},A=m=>{var x=ma(),Q=i(x);{var it=V=>{var G=ha(),X=vt(G),j=i(X);pe(j),j.__keyup=[ca,F];var dt=r(j,2),Xt=i(dt);o(dt),o(X);var Ut=r(X,2),wt=i(Ut),Bt=i(wt);{var $t=S=>{var ot=da();k(ut=>D(ot,"src",ut),[()=>Ct(e(L),16)]),v(S,ot)};y(Bt,S=>{e(L)&&S($t)})}var te=r(Bt,2);{var ee=S=>{var ot=ua(),ut=i(ot,!0),se=r(ut,2);o(ot),k((ie,oe)=>{b(ut,ie),b(se,` ${oe??""}sats`)},[()=>_e(e(f)[0].token_data.nft.commitment),()=>e(z).toLocaleString()]),v(S,ot)};y(te,S=>{e(f).length>0&&S(ee)})}o(wt);var ae=r(wt,2);ae.__click=[_a,at,O],o(Ut),k(S=>b(Xt,`${S??""} sats`),[()=>e(rt).toLocaleString()]),ge(j,()=>e(O),S=>l(O,S)),v(V,G)},kt=V=>{var G=fa();v(V,G)};y(Q,V=>{e(R)=="CONNECTED"?V(it):V(kt,!1)})}o(x),v(m,x)};y(t,m=>{e(z)<11e5&&e(f).length==0?m(d):m(A,!1)},s)}};y(St,t=>{e(z)>1e6&&e(f).length==0?t(Jt):t(Kt,!1)})}var gt=r(St,2),Ht=r(i(gt),2),Mt=i(Ht),Dt=i(Mt);me(Dt),ce(2),o(Mt),o(Ht),o(gt);var Yt=r(gt,2);{var Qt=t=>{var s=Nt(),d=vt(s);{var A=m=>{var x=ga(),Q=i(x);Q.__click=[pa,P];var it=r(Q,2);it.__click=[ba,P],o(x),v(m,x)};y(d,m=>{e(f).length>0&&m(A)})}v(t,s)};y(Yt,t=>{e(Z)&&t(Qt)})}o(st),k((t,s)=>{b(lt,t),b(ct,` ${e(U)??""} `),b(It,`/${a.topic??""}`),b(Et,` ${s??""} sats   `)},[()=>e(g).toLocaleString(),()=>e(q).toLocaleString()]),be(Dt,()=>e(Z),t=>l(Z,t)),v(n,st),Zt()}Wt(["click","keyup"]);export{qa as C};
//# sourceMappingURL=B8WbVGxB.js.map
