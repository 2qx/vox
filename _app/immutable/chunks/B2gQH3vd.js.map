{"version":3,"file":"B2gQH3vd.js","sources":["../../../../../../../common/out/constant.js","../../../../../../../common/out/batch.js","../../../../../../../future/out/constant.js","../../../../../../../future/out/util.js","../../../../../../../future/out/auth.js","../../../../../../../future/out/coupon.js","../../../../../../../future/out/vault.js","../../../../../../../future/out/channel.js"],"sourcesContent":["export const DEFAULT_CONCURRENCY = 8;\nconst REGTEST = '127.0.0.1';\nconst CHIPNET_BLACKIE = 'blackie.c3-soft.com:64004';\nconst CHIPNET_NINJA = 'chipnet.bch.ninja';\nconst CHIPNET_BITJSON = 'chipnet.chaingraph.cash';\nconst CHIPNET_U_NAME = 'chipnet.imaginary.cash';\nexport function getDefaultElectrum(isMainnet = true) {\n    return isMainnet ? 'bch.imaginary.cash' : CHIPNET_NINJA;\n}\n//# sourceMappingURL=constant.js.map","import { DEFAULT_CONCURRENCY } from \"./constant.js\";\n/**\n * Same as Promise.all(items.map(item => task(item))), but it waits for\n * the first {batchSize} promises to finish before starting the next batch.\n *\n * @template A\n * @template B\n * @param {function(A): B} task The task to run for each item.\n * @param {A[]} items Arguments to pass to the task for each call.\n * @param {int} batchSize\n * @returns {Promise<B[]>}\n */\nexport async function promiseAllInBatches(task, items, batchSize = DEFAULT_CONCURRENCY) {\n    let position = 0;\n    let results = [];\n    while (position < items.length) {\n        const itemsForBatch = items.slice(position, position + batchSize);\n        results = [...results, ...await Promise.all(itemsForBatch.map((item) => task(item)))];\n        position += batchSize;\n    }\n    return results;\n}\nexport async function getTransactionWrap(args) {\n    let result = await args[0].request('blockchain.transaction.get', args[1], false);\n    return result;\n}\nexport async function getAllTransactions(electrumClient, tx_hashes) {\n    return promiseAllInBatches(getTransactionWrap, tx_hashes.map(tx_hash => [electrumClient, tx_hash]));\n}\nexport async function listUnspentWrap(args) {\n    let unspent = await args[0].request('blockchain.scripthash.listunspent', args[1]);\n    if (unspent instanceof Error)\n        throw unspent;\n    return unspent.map((utxo) => {\n        return {\n            ...utxo,\n            scripthash: args[1]\n        };\n    });\n}\n//# sourceMappingURL=batch.js.map","export const BATON = 'fbc0b001313509454331f23f4b1891a8d9a284421efcc33187f1a1cdd37ccb46';\nexport const TESTNET_BATON = 'fbce0009ccce339e3398688d20fc60fce1c9316182c6680fe65e074e2fa046d2';\nexport const VAULT_SERIES = [3, 4, 5, 6];\nexport const COUPON_SERIES = [-1, 0, 1, 2];\nexport const ELECTRUM_CONCURRENCY = 8;\nexport const CATEGORY_MAP = new Map([\n    ['16dac7ae826ad3913db3b1f0c1db567e3086a7591334c0fd3667ab13e51ae831', 858000],\n    ['0cc1cb6033617c83ba69e158398f7d3097ee9fc538f52075a3a2df0af206b819', 859000],\n    ['ca323c19cf6fc269822c6bfdda13f5c062c67bc3a20dbe73d87c43e1b2baca95', 860000],\n    ['a42742e4188780dbdc6017016e2d49803eedfe0881805d2b19bc0e93fcae96ee', 861000],\n    ['bdaaf2610c0a4ae34c0d7432f39aaaa4b5467d2f8e5255018ea073e1a558a678', 862000],\n    ['89a2430a98bb92b504d6d23182d4b0d3c9455b4d9e9671aeae4b09208f1df584', 863000],\n    ['7face04783f30345a6d48cd7747a7cabf92b6c0523f2e021c238573c691f2438', 864000],\n    ['09dabc81889bd7d1301f7e0620301460bcc0f754ab9b9838b881b72182b1d502', 865000],\n    ['b2a37403c5d97bf6c2e1338c054b6d73eef1543137cea85b6ab9eaeff5a43087', 866000],\n    ['30d336f109876e8a66a6da63ac52c807e85e2bba00204f1b010ef9cd42fd98b7', 867000],\n    ['28afff19a58a8ad529aa5631bc3576e9ab19675e541b28963b61e53055e77942', 868000],\n    ['357ce1027d7f07f6c0c8bb79ccd2e0f2d44e9f2e91a754befc66380cdbaa6449', 869000],\n    ['d861cd6420db1e280764b846bac790cc86c1e7ea93adecb2d1c9b4289eeaa1a8', 870000],\n    ['08cd919b34a789bc07a37c6c68e9d15f105a36010fcb8a8bd017190fff84a6b8', 871000],\n    ['f55d2e61aadc9519d1c0a346cbbc7766a5e871660a3c25b61eb517be200f901c', 872000],\n    ['e9c7dca6f33c7c963bbbb7f72e85d5181d76ad9eb26d8ac7e0765921e6bc7248', 873000],\n    ['a0055c80f357a2e14b203274cbe0f211bd25ad4032deab59dba1187397a23a0f', 874000],\n    ['3c1136e10ba3a3852f1ab3d1bff1727c3b9c7782a8cb84fba5706ffaccfae24c', 875000],\n    ['cdbc9154e80320895be94b616624ea967e6121879476dd285470a297e0f94e6c', 876000],\n    ['5c88fbc5e0a8e828050bf83b3ebfc9b8d151c77079b4079e4f620588c2989ac1', 877000],\n    ['53047c3ecccf16318a8a49376213e7695b81392c18a9a88ade84157ef3c4b793', 878000],\n    ['b49acab285c26cfeac6cd8c3deabf8a04ed9eefd522ce5559342e526a3b35cc9', 879000],\n    ['812006db91178d966c52207b32b46b337e5a6c1c87196e1af36834606205a2bb', 880000],\n    ['31225667a83a30779e44dbb19f4251820ee4e00b13c3b5ae8d00bca2351c3981', 881000],\n    ['5891be47b3b87d848678462eb65f82c3bd2e450693d5f5a6ab5b16ac3b6d8bd2', 882000],\n    ['dde1e93679e85d7c894285fc4cb95a5e717918f56ff405d9a740f2be82a301cb', 883000],\n    ['68931d718e1482c0d1a4ff73daa4cd7e6a1e22ca9e66d552bcb21ae861737115', 884000],\n    ['019fbdca8662a1f6b617e3385c1dd903cde128d5d2d0b270015baacff1949ec0', 885000],\n    ['a4d1892a9a2319c7e23933f98a926b00877556162ca64a3668182d9a388c8d27', 886000],\n    ['e337b4468fd9a737968cd82b09dfd91884220134994949f9e8c1dc70c3471f5b', 887000],\n    ['8385c083c569dcceb6dff0d08b950d35822c4ccd5fa40084071346df677550b4', 888000],\n    ['55727d2dee32dca41f4d31434c28b2324b8d1e06ff26282ff451ea5329f0e153', 889000],\n    ['988fd2522d329f6fc079929e86baadf9e636763b5351296d18aa199b13b4493d', 890000],\n    ['5ec2629236f62393d1d3da47c764553aa7057a83ee60383225d1397573bd9f9f', 891000],\n    ['336a642ace9290d91a1189b576236d9c8c7fffa01eea388a8b3bb635c94a6cc3', 892000],\n    ['edbbb22cda1b04ffa4741c51f35d506002d4dc5b9a36c9cb3aa3fe578303af3f', 893000],\n    ['3753b96d4a6d246c72fe5469e4e79361af59186168ffa26b89f29cf037fc0e3f', 894000],\n    ['ca95807958352f83fec68c5e0bc7ca30e211a7bdeb1801eac4573e9cbc0730a8', 895000],\n    ['30834fbca4bbd8e2bd5c4754395a21b2af24e7759cbc882a9df4dab1e953411a', 896000],\n    ['78687328f1f07a5a58d9d1e70b30cbb854205520e9e1787b2460b0222f3623ff', 897000],\n    ['8b97fc83485dd45ae2122f163de5897eafcdec81dbf779e4153548e24bd556ed', 898000],\n    ['5f1abc1bf36ea45291c0d303f9a63b5c8632687e6b1b224beb3b311fa0685812', 899000],\n    ['4575d242087a5e8a574be521ff8eef4ac1a7ee9a012834821a1272503e2e880a', 900000],\n    ['9c5f32f489b49f56ebe172d5f1a2f9f0ad467d8f05c3af42d9baa1778c04598c', 901000],\n    ['ca17a6b04e5217db5783a96ff8501c37977ef6f54ad67a7496efe9105b34d897', 902000],\n    ['9e405b79a5784a1b4179dba017ea01fa77c5d0b050d0852983ec2a00f88c870b', 903000],\n    ['645d0dbc137e0cfaacd8412b62884f55a0de158ef0e504b3df4058b29caf8786', 904000],\n    ['bae12c5a0b11e9f85e2d1d1d07b0d1a1edf3dba0fa36e48cf73f48a69709240c', 905000],\n    ['448c2a2f5f871d654c7263f315a7bfb875e12f2a39b78decd35d03273acb23bf', 906000],\n    ['7d28d82f8899bb1739dc2645bebf50b7c5e18c92eb6838b42aea02920d8c4cb8', 907000],\n    ['567cca6bfeef85f1958bd11c022c9e41a8fa5a0d2a26e5e1405b1e70805e480d', 908000],\n    ['cda41febe6abe5bd56be403792a357d5adfcfe129d960833d157db50175ea493', 909000],\n    ['7d83793c073bf83162a1d710fe973bfa040cefedd699dca2a6a96243ecc45ef4', 910000],\n    ['46cd3f632d9708bdc95a60eee153be0536fec4d175b4c17702103ac9ba685884', 911000],\n    ['7c81b949b796ba3ec164695c6cc4ca3bcff973df3808ae34162777063fd3c885', 912000],\n    ['61bcab4ddf4d7b172e06f29ff466ce5e275d4476a5dd7d1f8177c63f3b9ddcbe', 913000],\n    ['f7b3c495ff4128b52507c683a04e06955db0356401a16ffe5c88ed3e276fc474', 914000],\n    ['e95ae8fe9541fd93daab84e4a2b70e73edf54b570875ff62e8c68602abe6d5f6', 915000],\n    ['7adc06cea8abb9ebd52753a604404073c54ba17f187660188952864b6f4c93f0', 916000],\n    ['7bb445f53e8b05945e2d64cdb0cf32a633026389813edd978cefd5e278647207', 917000],\n    ['717ffab63d7edfcef357eac158ab52590dd3a6588726f855abd0cee0169708f6', 918000],\n    ['e602521afca264ba6fec44dd61b4b740aba3965488ee06f91ed452a7256a38b6', 919000],\n    ['13117fb7ee0827bbf577772515643dd8052a71981e6f6c4d9001ded23f214fa3', 920000],\n    ['402ec1aa54d4aee881a299c172c4e4e7d275dec797ec24a7f7d5197f68d24b15', 921000],\n    ['426a8a1772efdaff9f5612d77ea9bdb629a7239283e86d32a2c0a1d3709366a3', 922000],\n    ['532dcc825f20b26d5d4bc48338c8605697c60d47f0c325f9bcb3fac4c99a665b', 923000],\n    ['d389e0804e502f284051220656e9f799c456fbd1fa3c422dcbe223cd91d9f139', 924000],\n    ['e8cc1205260eef7652d8eba8136d95cd04f10e74ab43901cf39b5b936cc7acb8', 925000],\n    ['076bec7bd4a15ff4b9bd49d34a2d2096fa158ab97adc697cf6482c0d3c1975c8', 926000],\n    ['1563ee90b05893b7e90340732cb2ab5071ce6f8590feda7b1bcf536f59953e36', 927000],\n    ['10e42bbc6ebed71bbd021ca238b479e3a15e90b295b63b246974bfb598982c4d', 928000],\n    ['79a48064600e68b36ecedcbd5315fff5572576bf038ebbf5d6ddc54b0f411edb', 929000],\n    ['bb85461930db00680ad4e93876f87463e351a9686d98448a7cb8e9d9500a2dcb', 930000],\n    ['2c8d115341c2f0cce4c21034e11308ea17acf612548c211ef56bbd4e993d8eaf', 931000],\n    ['8825efd15c4a3f407c477b52d3e3ccd0d20f79d543dccc178a05a5a6ec4e95e1', 932000],\n    ['6dfd3dd2586671fa49ea35e0b411e711c4b0b2d81ba2dfa9069225290449d2c7', 933000],\n    ['8c21209f83685bc6cbe8adeb809a6a2e4c743a987608a262680d492e12fa3456', 934000],\n    ['8b7f2755c522f06cb3de2a921b236f94e40f40d1e590e2b4a25d709b4a89e9e6', 935000],\n    ['e2f7333f3b20243e58d63dd894b89d9eb8d6a88fd17f86676689f4fc0e30e082', 936000],\n    ['4304b54c8b217d58a7d2c62d3941811a6a6e86e027ea46fc548fdc74107e5928', 937000],\n    ['b675520e9b828c8a16f1acc8f7396c36f67bd616283ffd759e9ad89fc91ab421', 938000],\n    ['9bd91f3c1c255f8a3839287160c2718100a8fbd320906bc7e8fae4b80a9491a7', 939000],\n    ['f05609733ca9699b72bb17ef4dfb9bcd78603d57a2d8ec2879f2bfae1262709e', 940000],\n    ['609c121384f469657fcff4768ea81abc35cbc0664e0c4930a49af34e1b1f117d', 941000],\n    ['fc552c7600bddf806cf70a43db497de0444312e972bbe0e5cc91bc0ca5c27f9c', 942000],\n    ['56ebf2117caf4a7906f0de14198a40bec3243f4ee3e59e59308c7d4ab064adf6', 943000],\n    ['f81ca1e0b315c2ca2f1278ec052bbf2d7cbcbc21dd0146512ef0eca33872c6a3', 944000],\n    ['33226b6126b666635a6c40ab104a3b313248f6422d0ed96493c8068af83df2ce', 945000],\n    ['e5b30ed135b1a8c4884b72c5bbf58357c3095880d2d82faaf55673f574069977', 946000],\n    ['281b06dda54ec91628986ff9881569f9eb66caddb5f2e560dd1fead5fc7af9d5', 947000],\n    ['c49130a6b5e71959a7bba89aa1109357c2b31079976a50e348ee800b670fe3a9', 948000],\n    ['7f2a81b1c67891e4932dd4491e290a32e95db022590e67d601ccf0fa1b6e009d', 949000],\n    ['14a5b06bf5203ce053a7e4101176135d09591956d488c96cf585e813ba9a2026', 950000],\n    ['fd4e8d0419f0db4d29ec2f87ea6d4ab2dd53cdfb4161cec85e7a371ca5e15d21', 951000],\n    ['81fe6b90f20d432c8a132b94afcd05dacfbeef5f0cd81ab7bdb5161b5a799f2d', 952000],\n    ['2473ef8a484a8f9fc301e4564176e18ec763694814191d5a2572aa227d972d9f', 953000],\n    ['c52ae4969cb658fa14dad5e740b4bbb0634d78d54f424583901f3111ef1ab0c1', 954000],\n    ['a416fd7ab1c2b09f93936b85e4e47fbdc0289e330e21a269ab4f5d8ffea53820', 955000],\n    ['4b17351c0b18675a59ab9813486097ee77151df43bd91ec8161dc9fb8f71af42', 956000],\n    ['29b6f97ff15d2335c1fb2edb341606a3a6d0a6a0611a027812e9d280e9325244', 957000],\n    ['fb73bd73fdb0b81c161e6f3b26213f6a8ef678bdb2ab03261f350038a5f167aa', 958000],\n    ['17087e7739a1f2de923939984e489ed96941583655d7599c006fc259a0854208', 959000],\n    ['c487cd1882c8b33e3b7fcdb151b8b597971b432f163a86ffbe36c9b4203a0a9c', 960000],\n    ['1729bbb68107953a8742137249e89db6bc6658987539d70976059700ec1683f3', 961000],\n    ['79e18ce094e4b5c65e7722ffe01cecc1eeab1511af4f50d814f3684e90521dd2', 970000],\n    ['05590cd644d3c9e9e4c28ae9bfd7a3a5ab47d3e230544e109502aa0e58ac2770', 980000],\n    ['6e117ef48d571fa7bb6f4850bc2d532d8417fa240a365e5188967e1f52e3f05c', 990000],\n    ['29db350a88f66124229824e75b753432551f59b972b0175eb7d71e528b9073cb', 1000000],\n    ['f48d7a05100f416d12c775b6f56d11f3b77a609cae677e328c10775534f5ac34', 1010000],\n    ['ca0ee31c809597bfec4afef784f7da59374556e80d8407fba1779c89b5be2e41', 1020000],\n    ['4ba06592954448468547775103229485d001e71d91084375c33b396490cd4b6c', 1030000],\n    ['9877da4c1bac6178b1fe80c21e6a330ae86b3f783ea1915dfbbd7c06d6825861', 1040000],\n    ['00f01ec3711703677bc1b96e4d9391568c7158049ebadf0385dd216d37a0e9c3', 1050000],\n    ['b9024d48f71a3fab09c788563ce0b1bbc113b6b662989283fbd3d541afbf7a1a', 1060000],\n    ['36593517db2ab8f8d6e2520ccbeaa049262f71db4888de10d087883c3a917f91', 1070000],\n    ['58b867bc4e0b3ca7cc296303eaade403975b7a6a0d289bc60e9342bbf92e7bf0', 1080000],\n    ['973cd634204cbac0df4235289d0365a9a375dc5e11a8d2e325e378b264582721', 1090000],\n    ['889cc584b5eea00c13e48258199f066bbeb0e88b6ce65519fe2312f4cf37b40d', 1100000],\n    ['d55621c14ed467198a9c58d92f784479a5aef8f0e7f9bc859d83112360e16480', 1110000],\n    ['39ef8ac95f3ee553f9ee86da8f73d160de9a159eafb5c611de771d2891fcc2e7', 1120000],\n    ['6aac3c903d5e55821ad4fdbd9f9ee3aceb89f91b66b6467034165ab7fb588e70', 1130000],\n    ['2da7a5fcd209f68ad1dbf4c68f6ab3c3c0150682ec525de52ab93135d2b26cf3', 1140000],\n    ['69ff94cc9b14a102f1d6a8df5dc55d86b97907533bac1c2aeab9ec33c045a76a', 1150000],\n    ['d9d7b5d6d71a5fefaba74a25deffff74454064bbd08ddd24f3619b1d27ceff91', 1200000],\n    ['fbc3b05d84ae0972ab3a2028d8980f3a597ab89fe075c1bd6129f3c890d67b0f', 1300000],\n    ['e2170fd75867a4d0b8df24204aea8aebb33a7d699e058a6ab42f0254bca9026b', 1400000],\n    ['e9057952ded4aad0480169d390906ac619e0d6e31614534f1dcb954e222524f1', 1500000],\n    ['08a24b2ca498845e4929a017614252ec674f48641b2119b1ae8411deb424bdf6', 1600000],\n    ['b9fb0b7e67bb69cb4b634ddc0efe4b578eda4fc48c870b2ce398d850bf4a28da', 1700000],\n    ['3cf5fec8745e0dd77c5b622699d95fe9c9955583e1d97974045958a9406f6256', 1800000],\n    ['8848979f5e377eb7aa7d9a4c2c67ab20a7de917409a52ce482a8f9987910f502', 1900000],\n    ['edad1c825338554b83e562aab2c2b220569033a2ccbd970975f3ddda320b70e1', 2000000],\n    ['1654b42288a501e82ad48195d8a15382ad57d0a684caa8a07767b4552166ef3f', 2100000],\n    ['d95d8dab23deeea1119e6ea9a7d2efdde31c1f8d9386c42d7962a5ed2b539d32', 2200000],\n    ['8d672efb35d6e36767cc650ed215955d46fef715421de17d1c15257b9bb89528', 2300000],\n    ['70c090c733864629e0b1674cb81a943bebb47cbeb6a66134430cb9d39b7157b6', 2400000],\n    ['3e22adf69fb684e970cb98eefa386fdbf34656d1c907e58308e5e7f27bf9c9f3', 2500000],\n    ['6df2d7adae18b5270a65d51c2bff426b3c0dae4f23d9efdbdf7dd984e4acc164', 2600000],\n    ['3d3a57df1e7a91939eca1b7d45fb7289ef3e2b9a765eb3621f1f20275361074a', 2700000],\n    ['b8f55be2a6e3d5a57536c8cdf235ffe43a240b06868179d0d427ca64f58a87ba', 2800000],\n    ['03882c71eb1eced84a39fd392df210bb175e6a109bd0c918444b93b67ea8854a', 3000000],\n    ['5e296fd6ce4c63996094f4ddb22441867411a6bcbb732430ad4f4cc6b4fb3480', 4000000]\n]);\nexport const TIMELOCK_MAP = new Map([\n    [858000, '16dac7ae826ad3913db3b1f0c1db567e3086a7591334c0fd3667ab13e51ae831'],\n    [859000, '0cc1cb6033617c83ba69e158398f7d3097ee9fc538f52075a3a2df0af206b819'],\n    [860000, 'ca323c19cf6fc269822c6bfdda13f5c062c67bc3a20dbe73d87c43e1b2baca95'],\n    [861000, 'a42742e4188780dbdc6017016e2d49803eedfe0881805d2b19bc0e93fcae96ee'],\n    [862000, 'bdaaf2610c0a4ae34c0d7432f39aaaa4b5467d2f8e5255018ea073e1a558a678'],\n    [863000, '89a2430a98bb92b504d6d23182d4b0d3c9455b4d9e9671aeae4b09208f1df584'],\n    [864000, '7face04783f30345a6d48cd7747a7cabf92b6c0523f2e021c238573c691f2438'],\n    [865000, '09dabc81889bd7d1301f7e0620301460bcc0f754ab9b9838b881b72182b1d502'],\n    [866000, 'b2a37403c5d97bf6c2e1338c054b6d73eef1543137cea85b6ab9eaeff5a43087'],\n    [867000, '30d336f109876e8a66a6da63ac52c807e85e2bba00204f1b010ef9cd42fd98b7'],\n    [868000, '28afff19a58a8ad529aa5631bc3576e9ab19675e541b28963b61e53055e77942'],\n    [869000, '357ce1027d7f07f6c0c8bb79ccd2e0f2d44e9f2e91a754befc66380cdbaa6449'],\n    [870000, 'd861cd6420db1e280764b846bac790cc86c1e7ea93adecb2d1c9b4289eeaa1a8'],\n    [871000, '08cd919b34a789bc07a37c6c68e9d15f105a36010fcb8a8bd017190fff84a6b8'],\n    [872000, 'f55d2e61aadc9519d1c0a346cbbc7766a5e871660a3c25b61eb517be200f901c'],\n    [873000, 'e9c7dca6f33c7c963bbbb7f72e85d5181d76ad9eb26d8ac7e0765921e6bc7248'],\n    [874000, 'a0055c80f357a2e14b203274cbe0f211bd25ad4032deab59dba1187397a23a0f'],\n    [875000, '3c1136e10ba3a3852f1ab3d1bff1727c3b9c7782a8cb84fba5706ffaccfae24c'],\n    [876000, 'cdbc9154e80320895be94b616624ea967e6121879476dd285470a297e0f94e6c'],\n    [877000, '5c88fbc5e0a8e828050bf83b3ebfc9b8d151c77079b4079e4f620588c2989ac1'],\n    [878000, '53047c3ecccf16318a8a49376213e7695b81392c18a9a88ade84157ef3c4b793'],\n    [879000, 'b49acab285c26cfeac6cd8c3deabf8a04ed9eefd522ce5559342e526a3b35cc9'],\n    [880000, '812006db91178d966c52207b32b46b337e5a6c1c87196e1af36834606205a2bb'],\n    [881000, '31225667a83a30779e44dbb19f4251820ee4e00b13c3b5ae8d00bca2351c3981'],\n    [882000, '5891be47b3b87d848678462eb65f82c3bd2e450693d5f5a6ab5b16ac3b6d8bd2'],\n    [883000, 'dde1e93679e85d7c894285fc4cb95a5e717918f56ff405d9a740f2be82a301cb'],\n    [884000, '68931d718e1482c0d1a4ff73daa4cd7e6a1e22ca9e66d552bcb21ae861737115'],\n    [885000, '019fbdca8662a1f6b617e3385c1dd903cde128d5d2d0b270015baacff1949ec0'],\n    [886000, 'a4d1892a9a2319c7e23933f98a926b00877556162ca64a3668182d9a388c8d27'],\n    [887000, 'e337b4468fd9a737968cd82b09dfd91884220134994949f9e8c1dc70c3471f5b'],\n    [888000, '8385c083c569dcceb6dff0d08b950d35822c4ccd5fa40084071346df677550b4'],\n    [889000, '55727d2dee32dca41f4d31434c28b2324b8d1e06ff26282ff451ea5329f0e153'],\n    [890000, '988fd2522d329f6fc079929e86baadf9e636763b5351296d18aa199b13b4493d'],\n    [891000, '5ec2629236f62393d1d3da47c764553aa7057a83ee60383225d1397573bd9f9f'],\n    [892000, '336a642ace9290d91a1189b576236d9c8c7fffa01eea388a8b3bb635c94a6cc3'],\n    [893000, 'edbbb22cda1b04ffa4741c51f35d506002d4dc5b9a36c9cb3aa3fe578303af3f'],\n    [894000, '3753b96d4a6d246c72fe5469e4e79361af59186168ffa26b89f29cf037fc0e3f'],\n    [895000, 'ca95807958352f83fec68c5e0bc7ca30e211a7bdeb1801eac4573e9cbc0730a8'],\n    [896000, '30834fbca4bbd8e2bd5c4754395a21b2af24e7759cbc882a9df4dab1e953411a'],\n    [897000, '78687328f1f07a5a58d9d1e70b30cbb854205520e9e1787b2460b0222f3623ff'],\n    [898000, '8b97fc83485dd45ae2122f163de5897eafcdec81dbf779e4153548e24bd556ed'],\n    [899000, '5f1abc1bf36ea45291c0d303f9a63b5c8632687e6b1b224beb3b311fa0685812'],\n    [900000, '4575d242087a5e8a574be521ff8eef4ac1a7ee9a012834821a1272503e2e880a'],\n    [901000, '9c5f32f489b49f56ebe172d5f1a2f9f0ad467d8f05c3af42d9baa1778c04598c'],\n    [902000, 'ca17a6b04e5217db5783a96ff8501c37977ef6f54ad67a7496efe9105b34d897'],\n    [903000, '9e405b79a5784a1b4179dba017ea01fa77c5d0b050d0852983ec2a00f88c870b'],\n    [904000, '645d0dbc137e0cfaacd8412b62884f55a0de158ef0e504b3df4058b29caf8786'],\n    [905000, 'bae12c5a0b11e9f85e2d1d1d07b0d1a1edf3dba0fa36e48cf73f48a69709240c'],\n    [906000, '448c2a2f5f871d654c7263f315a7bfb875e12f2a39b78decd35d03273acb23bf'],\n    [907000, '7d28d82f8899bb1739dc2645bebf50b7c5e18c92eb6838b42aea02920d8c4cb8'],\n    [908000, '567cca6bfeef85f1958bd11c022c9e41a8fa5a0d2a26e5e1405b1e70805e480d'],\n    [909000, 'cda41febe6abe5bd56be403792a357d5adfcfe129d960833d157db50175ea493'],\n    [910000, '7d83793c073bf83162a1d710fe973bfa040cefedd699dca2a6a96243ecc45ef4'],\n    [911000, '46cd3f632d9708bdc95a60eee153be0536fec4d175b4c17702103ac9ba685884'],\n    [912000, '7c81b949b796ba3ec164695c6cc4ca3bcff973df3808ae34162777063fd3c885'],\n    [913000, '61bcab4ddf4d7b172e06f29ff466ce5e275d4476a5dd7d1f8177c63f3b9ddcbe'],\n    [914000, 'f7b3c495ff4128b52507c683a04e06955db0356401a16ffe5c88ed3e276fc474'],\n    [915000, 'e95ae8fe9541fd93daab84e4a2b70e73edf54b570875ff62e8c68602abe6d5f6'],\n    [916000, '7adc06cea8abb9ebd52753a604404073c54ba17f187660188952864b6f4c93f0'],\n    [917000, '7bb445f53e8b05945e2d64cdb0cf32a633026389813edd978cefd5e278647207'],\n    [918000, '717ffab63d7edfcef357eac158ab52590dd3a6588726f855abd0cee0169708f6'],\n    [919000, 'e602521afca264ba6fec44dd61b4b740aba3965488ee06f91ed452a7256a38b6'],\n    [920000, '13117fb7ee0827bbf577772515643dd8052a71981e6f6c4d9001ded23f214fa3'],\n    [921000, '402ec1aa54d4aee881a299c172c4e4e7d275dec797ec24a7f7d5197f68d24b15'],\n    [922000, '426a8a1772efdaff9f5612d77ea9bdb629a7239283e86d32a2c0a1d3709366a3'],\n    [923000, '532dcc825f20b26d5d4bc48338c8605697c60d47f0c325f9bcb3fac4c99a665b'],\n    [924000, 'd389e0804e502f284051220656e9f799c456fbd1fa3c422dcbe223cd91d9f139'],\n    [925000, 'e8cc1205260eef7652d8eba8136d95cd04f10e74ab43901cf39b5b936cc7acb8'],\n    [926000, '076bec7bd4a15ff4b9bd49d34a2d2096fa158ab97adc697cf6482c0d3c1975c8'],\n    [927000, '1563ee90b05893b7e90340732cb2ab5071ce6f8590feda7b1bcf536f59953e36'],\n    [928000, '10e42bbc6ebed71bbd021ca238b479e3a15e90b295b63b246974bfb598982c4d'],\n    [929000, '79a48064600e68b36ecedcbd5315fff5572576bf038ebbf5d6ddc54b0f411edb'],\n    [930000, 'bb85461930db00680ad4e93876f87463e351a9686d98448a7cb8e9d9500a2dcb'],\n    [931000, '2c8d115341c2f0cce4c21034e11308ea17acf612548c211ef56bbd4e993d8eaf'],\n    [932000, '8825efd15c4a3f407c477b52d3e3ccd0d20f79d543dccc178a05a5a6ec4e95e1'],\n    [933000, '6dfd3dd2586671fa49ea35e0b411e711c4b0b2d81ba2dfa9069225290449d2c7'],\n    [934000, '8c21209f83685bc6cbe8adeb809a6a2e4c743a987608a262680d492e12fa3456'],\n    [935000, '8b7f2755c522f06cb3de2a921b236f94e40f40d1e590e2b4a25d709b4a89e9e6'],\n    [936000, 'e2f7333f3b20243e58d63dd894b89d9eb8d6a88fd17f86676689f4fc0e30e082'],\n    [937000, '4304b54c8b217d58a7d2c62d3941811a6a6e86e027ea46fc548fdc74107e5928'],\n    [938000, 'b675520e9b828c8a16f1acc8f7396c36f67bd616283ffd759e9ad89fc91ab421'],\n    [939000, '9bd91f3c1c255f8a3839287160c2718100a8fbd320906bc7e8fae4b80a9491a7'],\n    [940000, 'f05609733ca9699b72bb17ef4dfb9bcd78603d57a2d8ec2879f2bfae1262709e'],\n    [941000, '609c121384f469657fcff4768ea81abc35cbc0664e0c4930a49af34e1b1f117d'],\n    [942000, 'fc552c7600bddf806cf70a43db497de0444312e972bbe0e5cc91bc0ca5c27f9c'],\n    [943000, '56ebf2117caf4a7906f0de14198a40bec3243f4ee3e59e59308c7d4ab064adf6'],\n    [944000, 'f81ca1e0b315c2ca2f1278ec052bbf2d7cbcbc21dd0146512ef0eca33872c6a3'],\n    [945000, '33226b6126b666635a6c40ab104a3b313248f6422d0ed96493c8068af83df2ce'],\n    [946000, 'e5b30ed135b1a8c4884b72c5bbf58357c3095880d2d82faaf55673f574069977'],\n    [947000, '281b06dda54ec91628986ff9881569f9eb66caddb5f2e560dd1fead5fc7af9d5'],\n    [948000, 'c49130a6b5e71959a7bba89aa1109357c2b31079976a50e348ee800b670fe3a9'],\n    [949000, '7f2a81b1c67891e4932dd4491e290a32e95db022590e67d601ccf0fa1b6e009d'],\n    [950000, '14a5b06bf5203ce053a7e4101176135d09591956d488c96cf585e813ba9a2026'],\n    [951000, 'fd4e8d0419f0db4d29ec2f87ea6d4ab2dd53cdfb4161cec85e7a371ca5e15d21'],\n    [952000, '81fe6b90f20d432c8a132b94afcd05dacfbeef5f0cd81ab7bdb5161b5a799f2d'],\n    [953000, '2473ef8a484a8f9fc301e4564176e18ec763694814191d5a2572aa227d972d9f'],\n    [954000, 'c52ae4969cb658fa14dad5e740b4bbb0634d78d54f424583901f3111ef1ab0c1'],\n    [955000, 'a416fd7ab1c2b09f93936b85e4e47fbdc0289e330e21a269ab4f5d8ffea53820'],\n    [956000, '4b17351c0b18675a59ab9813486097ee77151df43bd91ec8161dc9fb8f71af42'],\n    [957000, '29b6f97ff15d2335c1fb2edb341606a3a6d0a6a0611a027812e9d280e9325244'],\n    [958000, 'fb73bd73fdb0b81c161e6f3b26213f6a8ef678bdb2ab03261f350038a5f167aa'],\n    [959000, '17087e7739a1f2de923939984e489ed96941583655d7599c006fc259a0854208'],\n    [960000, 'c487cd1882c8b33e3b7fcdb151b8b597971b432f163a86ffbe36c9b4203a0a9c'],\n    [961000, '1729bbb68107953a8742137249e89db6bc6658987539d70976059700ec1683f3'],\n    [970000, '79e18ce094e4b5c65e7722ffe01cecc1eeab1511af4f50d814f3684e90521dd2'],\n    [980000, '05590cd644d3c9e9e4c28ae9bfd7a3a5ab47d3e230544e109502aa0e58ac2770'],\n    [990000, '6e117ef48d571fa7bb6f4850bc2d532d8417fa240a365e5188967e1f52e3f05c'],\n    [1000000, '29db350a88f66124229824e75b753432551f59b972b0175eb7d71e528b9073cb'],\n    [1010000, 'f48d7a05100f416d12c775b6f56d11f3b77a609cae677e328c10775534f5ac34'],\n    [1020000, 'ca0ee31c809597bfec4afef784f7da59374556e80d8407fba1779c89b5be2e41'],\n    [1030000, '4ba06592954448468547775103229485d001e71d91084375c33b396490cd4b6c'],\n    [1040000, '9877da4c1bac6178b1fe80c21e6a330ae86b3f783ea1915dfbbd7c06d6825861'],\n    [1050000, '00f01ec3711703677bc1b96e4d9391568c7158049ebadf0385dd216d37a0e9c3'],\n    [1060000, 'b9024d48f71a3fab09c788563ce0b1bbc113b6b662989283fbd3d541afbf7a1a'],\n    [1070000, '36593517db2ab8f8d6e2520ccbeaa049262f71db4888de10d087883c3a917f91'],\n    [1080000, '58b867bc4e0b3ca7cc296303eaade403975b7a6a0d289bc60e9342bbf92e7bf0'],\n    [1090000, '973cd634204cbac0df4235289d0365a9a375dc5e11a8d2e325e378b264582721'],\n    [1100000, '889cc584b5eea00c13e48258199f066bbeb0e88b6ce65519fe2312f4cf37b40d'],\n    [1110000, 'd55621c14ed467198a9c58d92f784479a5aef8f0e7f9bc859d83112360e16480'],\n    [1120000, '39ef8ac95f3ee553f9ee86da8f73d160de9a159eafb5c611de771d2891fcc2e7'],\n    [1130000, '6aac3c903d5e55821ad4fdbd9f9ee3aceb89f91b66b6467034165ab7fb588e70'],\n    [1140000, '2da7a5fcd209f68ad1dbf4c68f6ab3c3c0150682ec525de52ab93135d2b26cf3'],\n    [1150000, '69ff94cc9b14a102f1d6a8df5dc55d86b97907533bac1c2aeab9ec33c045a76a'],\n    [1200000, 'd9d7b5d6d71a5fefaba74a25deffff74454064bbd08ddd24f3619b1d27ceff91'],\n    [1300000, 'fbc3b05d84ae0972ab3a2028d8980f3a597ab89fe075c1bd6129f3c890d67b0f'],\n    [1400000, 'e2170fd75867a4d0b8df24204aea8aebb33a7d699e058a6ab42f0254bca9026b'],\n    [1500000, 'e9057952ded4aad0480169d390906ac619e0d6e31614534f1dcb954e222524f1'],\n    [1600000, '08a24b2ca498845e4929a017614252ec674f48641b2119b1ae8411deb424bdf6'],\n    [1700000, 'b9fb0b7e67bb69cb4b634ddc0efe4b578eda4fc48c870b2ce398d850bf4a28da'],\n    [1800000, '3cf5fec8745e0dd77c5b622699d95fe9c9955583e1d97974045958a9406f6256'],\n    [1900000, '8848979f5e377eb7aa7d9a4c2c67ab20a7de917409a52ce482a8f9987910f502'],\n    [2000000, 'edad1c825338554b83e562aab2c2b220569033a2ccbd970975f3ddda320b70e1'],\n    [2100000, '1654b42288a501e82ad48195d8a15382ad57d0a684caa8a07767b4552166ef3f'],\n    [2200000, 'd95d8dab23deeea1119e6ea9a7d2efdde31c1f8d9386c42d7962a5ed2b539d32'],\n    [2300000, '8d672efb35d6e36767cc650ed215955d46fef715421de17d1c15257b9bb89528'],\n    [2400000, '70c090c733864629e0b1674cb81a943bebb47cbeb6a66134430cb9d39b7157b6'],\n    [2500000, '3e22adf69fb684e970cb98eefa386fdbf34656d1c907e58308e5e7f27bf9c9f3'],\n    [2600000, '6df2d7adae18b5270a65d51c2bff426b3c0dae4f23d9efdbdf7dd984e4acc164'],\n    [2700000, '3d3a57df1e7a91939eca1b7d45fb7289ef3e2b9a765eb3621f1f20275361074a'],\n    [2800000, 'b8f55be2a6e3d5a57536c8cdf235ffe43a240b06868179d0d427ca64f58a87ba'],\n    [3000000, '03882c71eb1eced84a39fd392df210bb175e6a109bd0c918444b93b67ea8854a'],\n    [4000000, '5e296fd6ce4c63996094f4ddb22441867411a6bcbb732430ad4f4cc6b4fb3480']\n]);\n//# sourceMappingURL=constant.js.map","import { hexToBin, utf8ToBin } from \"@bitauth/libauth\";\nimport { listUnspentWrap, promiseAllInBatches } from \"@unspent/tau\";\nexport function toBin(input) {\n    if (!input)\n        return new Uint8Array(0);\n    const data = input.replace(/^0x/, \"\");\n    const encode = data === input ? utf8ToBin : hexToBin;\n    return encode(data);\n}\nexport function getRates(currentBlock, futureBlock, coupon, principal = 1e8) {\n    if (futureBlock <= currentBlock) {\n        return {\n            spb: Infinity,\n            ytm: Infinity,\n            ypa: Infinity\n        };\n    }\n    // account for swap fee\n    coupon -= 870;\n    return {\n        spb: Math.round(Number((coupon / (futureBlock - currentBlock) / ((principal - coupon) / 1e8)) + Number.EPSILON) * 100) / 100,\n        ytm: Number((coupon / (principal - coupon)) * 1e2),\n        ypa: Number((coupon / (principal - coupon)) * 1e2 * (52596 / (futureBlock - currentBlock))),\n    };\n}\n/**\n     * Return rate information for a given coupon in a localized format\n     *\n     *\n     * @param currentBlock - the current time, in blocks\n     * @param futureBlock - the future time, in blocks\n     * @param coupon - the coupon amount in satoshis\n     * @param principal - amount required to claim coupon\n     */\nexport function getRateLocale(currentBlock, futureBlock, coupon, principal = 1e8) {\n    let rates = getRates(currentBlock, futureBlock, coupon, principal);\n    return {\n        spb: rates.spb.toLocaleString(undefined, {\n            maximumFractionDigits: 0,\n            minimumFractionDigits: 0\n        }),\n        ytm: rates.ytm.toLocaleString(undefined, {\n            maximumFractionDigits: 1,\n            minimumFractionDigits: 1\n        }),\n        ypa: rates.ypa.toLocaleString(undefined, {\n            maximumFractionDigits: 1,\n            minimumFractionDigits: 1\n        }),\n    };\n}\nexport function getFutureBlockDate(currentBlock, futureBlock) {\n    const blocks = futureBlock - currentBlock;\n    var futureDate = new Date();\n    //@ts-ignore\n    futureDate.setTime(futureDate.getTime() + 6E5 * blocks);\n    return futureDate;\n}\nexport function getFutureBlockDateLocale(currentBlock, futureBlock) {\n    var futureDate = getFutureBlockDate(currentBlock, futureBlock);\n    let diff = futureBlock - currentBlock;\n    let options = {};\n    if (diff < 200) {\n        options = {\n            month: 'numeric',\n            day: 'numeric',\n            hour: 'numeric',\n            hourCycle: 'h24'\n        };\n    }\n    else if (diff < 1000) {\n        options = {\n            month: 'numeric',\n            day: 'numeric',\n        };\n    }\n    else if (diff > 200000) {\n        options = {\n            year: 'numeric'\n        };\n    }\n    else if (diff > 50000) {\n        options = {\n            year: 'numeric',\n            month: 'numeric'\n        };\n    }\n    else {\n        options = {\n            month: 'numeric',\n            day: 'numeric',\n            year: 'numeric'\n        };\n    }\n    //@ts-ignore\n    return new Intl.DateTimeFormat(undefined, options).format(futureDate);\n}\nexport async function getAllUnspentCoupons(electrumClient, scriptHashes) {\n    let allUnspent = (await promiseAllInBatches(listUnspentWrap, scriptHashes.map(a => [electrumClient, a]))).flat();\n    var map = new Map();\n    allUnspent.map((obj) => map.set(obj.tx_hash + \":\" + obj.tx_pos, obj));\n    return map;\n}\n//# sourceMappingURL=util.js.map","import template_json from './template.v2.json' with { type: \"json\" };\nimport { getLibauthCompiler } from '@unspent/tau';\nexport default class Future {\n    static compiler = getLibauthCompiler(template_json);\n}\n//# sourceMappingURL=auth.js.map","import template from './template.v2.json' with { type: \"json\" };\nimport packageInfo from '../package.json' with { type: \"json\" };\nimport { bigIntToVmNumber, CashAddressNetworkPrefix, createVirtualMachineBch, encodeDataPush, hash256, hexToBin, lockingBytecodeToCashAddress, } from \"@bitauth/libauth\";\nimport { getScriptHash } from \"@unspent/tau\";\nimport Future from './auth.js';\nexport class Coupon {\n    static USER_AGENT = packageInfo.name;\n    static tokenAware = false;\n    static template = template;\n    static vm = createVirtualMachineBch();\n    static compiler = Future.compiler;\n    amount = 1000000;\n    lock = new Uint8Array(0);\n    static unlockingScript = \"00cc00c694a16900c788c08bc39c\";\n    /**\n     * Return the scripthash for a Coupon\n     *\n     *\n     * @param amount - the threshold amount (sats) to redeem coupon\n     * @param lock - the vault locking bytecode\n     * @param reversed - whether to return the string in reversed (default: true)\n     */\n    static getScriptHash(amount, lock, reversed = true) {\n        return getScriptHash(this.getLockingBytecode(amount, lock), reversed);\n    }\n    /**\n     * Return the address for a Coupon\n     *\n     *\n     * @param amount - the threshold amount (sats) to redeem coupon\n     * @param lock - the vault locking bytecode\n     * @param network - the network prefix\n     */\n    static getAddress(amount, lock, network = CashAddressNetworkPrefix.mainnet) {\n        let lockingBytecode = this.getLockingBytecode(amount, lock);\n        let result = lockingBytecodeToCashAddress({ bytecode: lockingBytecode, prefix: network, tokenSupport: false });\n        if (typeof result === 'string')\n            throw (result);\n        return result.address;\n    }\n    /**\n      * Return the unlockingBytecode for a Coupon\n      *\n      *\n      * @param amount - the threshold amount (sats) to redeem coupon\n      * @param lock - the vault locking bytecode\n      */\n    static getUnlockingBytecode(amount, lock) {\n        const amountVm = encodeDataPush(bigIntToVmNumber(BigInt(amount)));\n        const lockVm = encodeDataPush(lock);\n        const unlockingScript = hexToBin(this.unlockingScript);\n        return new Uint8Array([\n            ...lockVm,\n            ...amountVm,\n            ...unlockingScript\n        ]);\n    }\n    /**\n     * Return the lockingBytecode for a Coupon\n     *\n     *\n     * @param amount - the threshold amount (sats) to redeem coupon\n     * @param lock - the Vault locking bytecode\n     */\n    static getLockingBytecode(amount, lock) {\n        return new Uint8Array([\n            ...hexToBin(\"aa20\"),\n            ...hash256(this.getUnlockingBytecode(amount, lock)),\n            ...hexToBin(\"87\")\n        ]);\n    }\n}\n//# sourceMappingURL=coupon.js.map","import packageInfo from '../package.json' with { type: \"json\" };\nimport { bigIntToVmNumber, binToHex, createVirtualMachineBch, deriveHdPublicKey, generateTransaction, hdPrivateKeyToP2pkhLockingBytecode, hexToBin, verifyTransactionTokens, CashAddressNetworkPrefix, lockingBytecodeToCashAddress } from \"@bitauth/libauth\";\nimport { getTransactionFees, getScriptHash, sumSourceOutputValue, sumSourceOutputTokenAmounts } from '@unspent/tau';\nimport { COUPON_SERIES, VAULT_SERIES } from \"./constant.js\";\nimport template from './template.v2.json' with { type: \"json\" };\nimport { getAllUnspentCoupons, getRates, getRateLocale, getFutureBlockDateLocale } from \"./util.js\";\nimport { Coupon } from './coupon.js';\nimport Future from './auth.js';\nexport class Vault {\n    static USER_AGENT = packageInfo.name;\n    static tokenAware = true;\n    static compiler = Future.compiler;\n    static template = template;\n    static vm = createVirtualMachineBch();\n    locktime = 0;\n    //static unlockingScript = \"c0d3c0d0a06376b17568c0cec0d188c0cdc0c788c0d0c0c693c0d3c0cc939c77\"\n    /**\n     * return the scripthash\n     *\n     * @param time - block time of the vault lock\n     * @param reversed - if the result should be reversed; default (electrumX): true.\n     * @returns the double scripthash as a string.\n     */\n    static getScriptHash(time, reversed = true) {\n        return getScriptHash(this.getLockingBytecode(time), reversed);\n    }\n    /**\n     * Return the token address for a Vault\n     *\n     *\n     * @param time - block time of the vault lock\n     * @param network - cashaddress network prefix\n     */\n    static getAddress(time, network = CashAddressNetworkPrefix.mainnet, tokenSupport = this.tokenAware) {\n        let lockingBytecode = this.getLockingBytecode(time);\n        let result = lockingBytecodeToCashAddress({ bytecode: lockingBytecode, prefix: network, tokenSupport: tokenSupport });\n        if (typeof result === 'string')\n            throw (result);\n        return result.address;\n    }\n    /**\n     * Return the coupon for a Vault at specified amount\n     *\n     *\n     * @param amount - the threshold amount (sats) to redeem coupon\n     * @param time - block time of the vault lock\n     */\n    static getCouponAddress(amount, time, network = CashAddressNetworkPrefix.mainnet) {\n        return Coupon.getAddress(amount, this.getLockingBytecode(time), network);\n    }\n    /**\n     * Return the coupon for a Vault at specified amount\n     *\n     *\n     * @param amount - the threshold amount (sats) to redeem coupon\n     * @param time - block time of the vault lock\n     */\n    static getCouponScriptHash(amount, time) {\n        return Coupon.getScriptHash(amount, this.getLockingBytecode(time));\n    }\n    /**\n     * Return the coupon for a Vault at specified amount\n     *\n     *\n     * @param amount - the threshold amount (sats) to redeem coupon\n     * @param time - block time of the vault lock\n     */\n    static getCouponLockingBytecode(amount, time) {\n        return Coupon.getLockingBytecode(amount, this.getLockingBytecode(time));\n    }\n    /**\n     * Return the unlockingBytecode for a Vault\n     *\n     *\n     * @param time - block time of the vault lock\n     */\n    static getUnlockingBytecode(time) {\n        const bytecodeResult = this.compiler.generateBytecode({\n            data: {\n                \"bytecode\": {\n                    \"locktime\": bigIntToVmNumber(BigInt(time)),\n                }\n            },\n            scriptId: 'vault_unlock',\n        });\n        if (!bytecodeResult.success) {\n            /* c8 ignore next */\n            throw new Error('Failed to generate bytecode, script: FutureChan, ' + JSON.stringify(bytecodeResult, null, '  '));\n        }\n        return bytecodeResult.bytecode.slice(1);\n    }\n    /**\n     * Return the lockingBytecode for a Vault\n     *\n     *\n     * @param time - block time of the vault lock\n     */\n    static getLockingBytecode(time) {\n        const bytecodeResult = this.compiler.generateBytecode({\n            data: {\n                \"bytecode\": {\n                    \"locktime\": bigIntToVmNumber(BigInt(time)),\n                }\n            },\n            scriptId: 'vault_lock',\n        });\n        if (!bytecodeResult.success) {\n            /* c8 ignore next */\n            throw new Error('Failed to generate bytecode, script: , ' + JSON.stringify(bytecodeResult, null, '  '));\n        }\n        return bytecodeResult.bytecode;\n    }\n    /**\n     * Return an array of staggered block times\n     *\n     *\n     * @param startTime - block time of the vault lock\n     * @param series - power of 10 to stagger the times\n     * @param limit - length of the array to return\n     */\n    static getSeriesTimes(startTime, series = 3, limit = 10) {\n        const step = Math.pow(10, series);\n        const next = startTime - (startTime % step) + step;\n        //@ts-ignore\n        return Array.from({ length: limit }, (e, i) => next + (step * i));\n    }\n    static getAllCouponSeries(startTime, seriesTimes) {\n        if (!seriesTimes)\n            seriesTimes = VAULT_SERIES.map(e => this.getSeriesTimes(startTime - 1000, e, e == 6 ? 4 : undefined)).flat();\n        seriesTimes = [...new Set(seriesTimes)];\n        let amounts = COUPON_SERIES.map(c => Math.pow(10, c) * 1e8);\n        let coupons = amounts.map(amount => seriesTimes.map((time) => {\n            let scripthash = Coupon.getScriptHash(amount, this.getLockingBytecode(time));\n            return {\n                locktime: time,\n                placement: amount,\n                order: Math.log10(amount / 1e8),\n                scripthash: scripthash,\n                lockingBytecode: binToHex(Coupon.getLockingBytecode(amount, this.getLockingBytecode(time)))\n            };\n        })).flat();\n        var map = new Map();\n        coupons.forEach(obj => map.set(obj.scripthash, obj));\n        return map;\n    }\n    /**\n     * Return an array coupons for vaults in a series\n     *\n     *\n     * @param electrumClient - an v4 electrum-cash client\n     * @param height - the height after which to list coupons.\n     * @param locktime - filter to coupons for a single series\n     */\n    static async getAllCouponUtxos(electrumClient, height) {\n        let couponSeries = Vault.getAllCouponSeries(height);\n        let allCoupons = await getAllUnspentCoupons(electrumClient, [...couponSeries.keys()]);\n        allCoupons.forEach((value, key, map) => {\n            let cData = couponSeries.get(value.scripthash);\n            if (cData) {\n                map.set(key, {\n                    ...value,\n                    ...getRates(height, cData.locktime, Number(value.value), cData.placement),\n                    locale: getRateLocale(height, cData.locktime, Number(value.value), cData.placement),\n                    ...cData,\n                    dateLocale: getFutureBlockDateLocale(height, cData.locktime)\n                });\n            }\n        });\n        return Array.from(allCoupons.values()).sort((a, b) => b.spb - a.spb);\n    }\n    static getSourceOutput(utxo, time) {\n        return {\n            lockingBytecode: this.getLockingBytecode(time),\n            valueSatoshis: BigInt(utxo.value),\n            token: {\n                category: hexToBin(utxo.token_data.category),\n                amount: BigInt(utxo.token_data?.amount)\n            }\n        };\n    }\n    static getCouponSourceOutput(utxo, amount, time) {\n        return {\n            lockingBytecode: this.getCouponLockingBytecode(amount, time),\n            valueSatoshis: BigInt(utxo.value)\n        };\n    }\n    static getInput(utxo, time) {\n        return {\n            outpointIndex: utxo.tx_pos,\n            outpointTransactionHash: hexToBin(utxo.tx_hash),\n            sequenceNumber: 0,\n            unlockingBytecode: {\n                compiler: this.compiler,\n                script: 'vault_unlock',\n                data: {\n                    \"bytecode\": {\n                        \"locktime\": bigIntToVmNumber(BigInt(time)),\n                    }\n                },\n                valueSatoshis: BigInt(utxo.value),\n                token: utxo.token_data ? {\n                    category: hexToBin(utxo.token_data.category),\n                    amount: BigInt(utxo.token_data.amount),\n                    nft: utxo.token_data.nft ? {\n                        commitment: hexToBin(utxo.token_data.nft.commitment),\n                        capability: utxo.token_data.nft.capability,\n                    } : undefined\n                } : undefined\n            },\n        };\n    }\n    static getCouponInput(utxo, amount, time) {\n        return {\n            outpointIndex: utxo.tx_pos,\n            outpointTransactionHash: hexToBin(utxo.tx_hash),\n            sequenceNumber: 0,\n            unlockingBytecode: {\n                data: {\n                    \"bytecode\": {\n                        \"amount\": bigIntToVmNumber(BigInt(amount)),\n                        \"lock\": this.getLockingBytecode(time),\n                    }\n                },\n                compiler: this.compiler,\n                script: 'coupon_unlock',\n                valueSatoshis: BigInt(utxo.value),\n            },\n        };\n    }\n    static getOutput(utxo, amount, time) {\n        return {\n            lockingBytecode: {\n                compiler: this.compiler,\n                data: {\n                    \"bytecode\": {\n                        \"locktime\": bigIntToVmNumber(BigInt(time)),\n                    }\n                },\n                script: 'vault_lock'\n            },\n            valueSatoshis: BigInt(utxo.value) + amount,\n            token: {\n                category: hexToBin(utxo.token_data.category),\n                amount: BigInt(utxo.token_data?.amount) - BigInt(amount)\n            }\n        };\n    }\n    static getWalletSourceOutput(utxo, key) {\n        const lockingBytecode = key ? hdPrivateKeyToP2pkhLockingBytecode({\n            addressIndex: 0,\n            hdPrivateKey: key\n        }) : Uint8Array.from(Array(33));\n        return {\n            lockingBytecode: lockingBytecode,\n            valueSatoshis: BigInt(utxo.value),\n            token: utxo.token_data ? {\n                category: hexToBin(utxo.token_data.category),\n                amount: BigInt(utxo.token_data?.amount)\n            } : undefined\n        };\n    }\n    static getWalletInput(utxo, privateKey, addressIndex = 0) {\n        let unlockingData = privateKey ? {\n            compiler: this.compiler,\n            data: {\n                hdKeys: {\n                    addressIndex: addressIndex,\n                    hdPrivateKeys: {\n                        'wallet': privateKey\n                    },\n                }\n            },\n            script: 'wallet_unlock',\n            valueSatoshis: BigInt(utxo.value),\n        } : Uint8Array.from(Array());\n        if (utxo.token_data) {\n            // @ts-ignore\n            unlockingData.token = {\n                amount: BigInt(utxo.token_data.amount),\n                category: hexToBin(utxo.token_data.category)\n            };\n        }\n        return {\n            outpointIndex: utxo.tx_pos,\n            outpointTransactionHash: hexToBin(utxo.tx_hash),\n            sequenceNumber: 0,\n            unlockingBytecode: unlockingData,\n        };\n    }\n    static getFutureOutput(amount, category, privateKey, addressIndex = 0) {\n        const lockingBytecode = privateKey ? {\n            compiler: this.compiler,\n            data: {\n                hdKeys: {\n                    addressIndex: addressIndex,\n                    hdPublicKeys: {\n                        'wallet': deriveHdPublicKey(privateKey).hdPublicKey\n                    },\n                },\n            },\n            script: 'wallet_lock'\n        } : Uint8Array.from(Array(33));\n        return {\n            lockingBytecode: lockingBytecode,\n            valueSatoshis: 800n,\n            token: {\n                category: category,\n                amount: amount\n            }\n        };\n    }\n    static getChangeOutput(amount, privateKey, addressIndex = 0) {\n        const lockingBytecode = privateKey ? {\n            compiler: this.compiler,\n            data: {\n                hdKeys: {\n                    addressIndex: addressIndex,\n                    hdPublicKeys: {\n                        'wallet': deriveHdPublicKey(privateKey).hdPublicKey\n                    },\n                },\n            },\n            script: 'wallet_lock'\n        } : Uint8Array.from(Array(33));\n        return {\n            lockingBytecode: lockingBytecode,\n            valueSatoshis: amount\n        };\n    }\n    static getVaultLayers(utxos, amount, time, category, sourceOutputs = []) {\n        let inputs = [];\n        let outputs = [];\n        utxos = utxos.filter(u => u.token_data?.category == binToHex(category));\n        if (amount < 0)\n            utxos = utxos.filter(u => u.value > 800);\n        if (utxos.length == 0)\n            throw Error(\"no vault utxos left, maximum recursion depth reached.\");\n        const randomIdx = Math.floor(Math.random() * utxos.length);\n        const randomUtxo = utxos[randomIdx];\n        // remove the random utxo in place\n        utxos.splice(randomIdx, 1);\n        // Try to satisfy the swap with another utxos\n        inputs.push(this.getInput(randomUtxo, time));\n        sourceOutputs.push(this.getSourceOutput(randomUtxo, time));\n        if (\n        // Redeeming FBch for Bch and this thread can satisfy the swap\n        (amount < 0 && -(randomUtxo?.value) < amount) ||\n            (amount > 0 && (BigInt(randomUtxo?.token_data?.amount) > amount))) {\n            outputs.push(this.getOutput(randomUtxo, BigInt(amount), time));\n        }\n        else {\n            if (amount < 0 && amount < -(randomUtxo?.value - 800)) {\n                // liquidate sats on this utxo \n                outputs.push(this.getOutput(randomUtxo, -BigInt(randomUtxo?.value - 800), time));\n                amount += randomUtxo?.value - 800;\n            }\n            // and try again\n            let nextTry = this.getVaultLayers([...utxos], amount, category, [...sourceOutputs]);\n            inputs.push(...nextTry.inputs);\n            outputs.push(...nextTry.outputs);\n            sourceOutputs = nextTry.sourceOutputs;\n        }\n        return { inputs, outputs, sourceOutputs };\n    }\n    static getCouponLayer(utxo, amount, time, sourceOutputs = []) {\n        let inputs = [];\n        let outputs = [];\n        // Try to satisfy the swap with another utxos\n        inputs.push(this.getCouponInput(utxo, amount, time));\n        sourceOutputs.push(this.getCouponSourceOutput(utxo, amount, time));\n        return { inputs, outputs, sourceOutputs };\n    }\n    static getWalletLayers(utxos, amount, privateKey, category, sourceOutputs = []) {\n        let inputs = [];\n        let outputs = [];\n        // Only use straight sat utxos if placing Bch\n        if (amount > 0)\n            utxos = utxos.filter(u => !u.token_data);\n        if (amount < 0)\n            utxos = utxos.filter(u => u.token_data?.category == binToHex(category));\n        if (utxos.length == 0)\n            throw Error(\"no wallet utxos left, maximum recursion depth reached.\");\n        // get a random utxo.\n        const randomIdx = Math.floor(Math.random() * utxos.length);\n        const randomUtxo = utxos[randomIdx];\n        // remove the random utxo in place\n        utxos.splice(randomIdx, 1);\n        // spend the utxo\n        inputs.push(this.getWalletInput(randomUtxo, privateKey));\n        sourceOutputs.push(this.getWalletSourceOutput(randomUtxo, privateKey));\n        let sumSats = sumSourceOutputValue(sourceOutputs);\n        let sumWSats = sumSourceOutputTokenAmounts(sourceOutputs, binToHex(category));\n        if (\n        // Redeeming WBch for Bch, and token amount is sufficient\n        (amount < 0 && sumWSats >= -amount) ||\n            // Or if placing Bch for WBch, and utxo value is sufficient\n            (amount > 0 && sumSats > amount)) {\n            // This utxo finally satisfied the swap \n            // There is FBch placed\n            if (amount > 0) {\n                outputs.push(this.getFutureOutput(amount, category, privateKey, 0));\n            }\n            if (amount < 0) {\n                outputs.push(this.getFutureOutput(sumWSats + amount, category, privateKey, 0));\n            }\n            let satsOut = (sumSats) - (amount + 800n);\n            outputs.push(this.getChangeOutput(satsOut, privateKey));\n        }\n        // Liquidate this utxo and try again\n        else {\n            let nextTry = this.getWalletLayers([...utxos], amount, privateKey, category, [...sourceOutputs]);\n            inputs.push(...nextTry.inputs);\n            outputs.push(...nextTry.outputs);\n            sourceOutputs = nextTry.sourceOutputs;\n        }\n        return { inputs, outputs, sourceOutputs };\n    }\n    /**\n     * Place (+) or redeem (-) some amount of Future Bch.\n     *\n     * @param amount     - amount to swap (satoshis), negative to redeem.\n     * @param contractUtxo - all contract outputs to use as input.\n     * @param walletUtxos - wallet outputs to use as input.\n     * @param time - The block time of the future series to swap.\n     * @param privateKey - private key to sign transaction wallet inputs.\n     * @param fee - transaction fee to pay (per byte).\n     *\n     * @throws {Error} if transaction generation fails.\n     * @returns a transaction template.\n     */\n    static swap(amount, contractUtxos, walletUtxos, time, privateKey, couponUtxo, fee = 1) {\n        const inputs = [];\n        const outputs = [];\n        let unique = [...new Set(contractUtxos.map(u => u.token_data?.category))];\n        if (unique.length != 1)\n            throw Error(\"Future vault UTXOs may only contain a single future token series\");\n        let category = unique.pop();\n        let fbchCat = hexToBin(category);\n        let config = {\n            locktime: 0,\n            version: 2,\n            inputs,\n            outputs\n        };\n        // Don't use wallet utxos with other tokens for the swap\n        walletUtxos = walletUtxos.filter(u => u.token_data?.category == category || !u.token_data);\n        let vaultLayers = this.getVaultLayers([...contractUtxos], amount, time, fbchCat);\n        config.inputs.push(...vaultLayers.inputs);\n        config.outputs.push(...vaultLayers.outputs);\n        let sourceOutputs = vaultLayers.sourceOutputs;\n        let walletLayers = this.getWalletLayers([...walletUtxos], BigInt(amount), privateKey, fbchCat);\n        config.inputs.push(...walletLayers.inputs);\n        config.outputs.push(...walletLayers.outputs);\n        sourceOutputs.push(...walletLayers.sourceOutputs);\n        const lastOutputIdx = config.outputs.length - 1;\n        if (couponUtxo) {\n            let couponLayer = this.getCouponLayer(couponUtxo, amount, time);\n            config.inputs.push(...couponLayer.inputs);\n            // no output back\n            sourceOutputs.push(...couponLayer.sourceOutputs);\n            config.outputs[lastOutputIdx].valueSatoshis = config.outputs[lastOutputIdx].valueSatoshis + BigInt(couponUtxo.value);\n        }\n        let result = generateTransaction(config);\n        if (!result.success)\n            throw new Error('generate transaction failed!, errors: ' + JSON.stringify(result.errors, null, '  '));\n        const estimatedFee = getTransactionFees(result.transaction, fee);\n        config.outputs[lastOutputIdx].valueSatoshis = config.outputs[lastOutputIdx].valueSatoshis - estimatedFee;\n        result = generateTransaction(config);\n        if (!result.success)\n            throw new Error('generate transaction failed!, errors: ' + JSON.stringify(result.errors, null, '  '));\n        const transaction = result.transaction;\n        const tokenValidationResult = verifyTransactionTokens(transaction, sourceOutputs, { maximumTokenCommitmentLength: 40 });\n        if (tokenValidationResult !== true && fee > 0)\n            throw tokenValidationResult;\n        let verify = this.vm.verify({\n            sourceOutputs: sourceOutputs,\n            transaction: transaction,\n        });\n        let feeEstimate = sumSourceOutputValue(sourceOutputs) - sumSourceOutputValue(transaction.outputs);\n        if (feeEstimate > 5000)\n            verify = `Excessive fees ${feeEstimate}`;\n        if (sumSourceOutputTokenAmounts(sourceOutputs, category) == 0n)\n            verify = `Error checking token input`;\n        let tokenDiff = sumSourceOutputTokenAmounts(sourceOutputs, category) -\n            sumSourceOutputTokenAmounts(transaction.outputs, category);\n        if (tokenDiff !== 0n)\n            verify = `Swapping should not create destroy tokens, token difference: ${tokenDiff}`;\n        return {\n            sourceOutputs: sourceOutputs,\n            transaction: transaction,\n            verify: verify\n        };\n    }\n}\n//# sourceMappingURL=vault.js.map","import template from './template.v2.json' with { type: \"json\" };\nimport packageInfo from '../package.json' with { type: \"json\" };\nimport { bigIntToVmNumber, binToHex, binToUtf8, createVirtualMachineBch, deriveHdPublicKey, disassembleBytecodeBch, generateTransaction, hdPrivateKeyToP2pkhLockingBytecode, hexToBin, swapEndianness, verifyTransactionTokens, hash256, decodeTransactionBch, utf8ToBin, encodeDataPush } from \"@bitauth/libauth\";\nimport { getTransactionFees, getAddress, getLibauthCompiler, getScriptHash, sumSourceOutputValue, sumOutputValue } from '@unspent/tau';\nimport { Vault } from './vault.js';\nimport { toBin } from './util.js';\nconst BIP68_MASK = 2147483648;\nexport class Post {\n    hash;\n    auth;\n    height;\n    sequence;\n    body;\n    likes;\n    dislikes;\n    ref;\n    error;\n    constructor({ hash = \"\", auth = \"\", height = -1, sequence = -1, body = \"\", likes = 0, dislikes = 0, ref = \"\", error = \"\" }) {\n        this.hash = hash;\n        this.auth = auth;\n        this.height = height;\n        this.sequence = sequence > BIP68_MASK ? sequence - BIP68_MASK : sequence;\n        this.body = body;\n        this.likes = likes;\n        this.dislikes = dislikes;\n        this.ref = ref;\n        this.error = error;\n    }\n}\nexport function parseUsername(commitment) {\n    const commitmentBin = hexToBin(commitment);\n    const commitmentAsm = disassembleBytecodeBch(commitmentBin);\n    const unameHex = commitmentAsm.split(\" \").pop().substring(2);\n    return binToUtf8(hexToBin(unameHex));\n}\nfunction parsePostTransaction(channelLock, height, hash, transaction) {\n    if (!transaction)\n        return;\n    let tx = decodeTransactionBch(hexToBin(transaction));\n    if (typeof tx == \"string\")\n        return new Post({ height: height, hash: hash, error: tx });\n    if (!tx.outputs[0].token)\n        return;\n    if (!tx.outputs[0].token.nft)\n        return new Post({ height: height, hash: hash, error: \"no nft on first output\" });\n    if (!tx.outputs[0].token.nft.commitment)\n        return new Post({ height: height, hash: hash, error: \"no nft commitment first output\" });\n    let body = \"\";\n    let ref = \"\";\n    let like = 0;\n    let dislike = 0;\n    const code = tx.outputs\n        .filter(o => binToHex(o.lockingBytecode) == channelLock)\n        .filter(o => o.token)\n        .filter(o => o.token?.nft)\n        .map(o => {\n        return binToHex(o.token?.nft?.commitment);\n    });\n    if (!code)\n        return;\n    if (!code[0])\n        return;\n    // V0\n    if (code[0].slice(0, 8) == \"6a025630\")\n        body = code.map(c => c.slice(10)).join(\"\");\n    // V+\n    if (code[0].slice(0, 8) == \"6a0256b2\") {\n        ref = code[0].slice(10);\n        like = 1;\n    }\n    // V-\n    if (code[0].slice(0, 8) == \"6a02562d\") {\n        ref = code[0].slice(10);\n        dislike = 1;\n    }\n    return new Post({\n        hash: hash,\n        auth: binToHex(tx.outputs[0]?.token?.category),\n        body: binToUtf8(hexToBin(body)),\n        height: height,\n        sequence: tx.inputs[0]?.sequenceNumber,\n        ref: ref,\n        likes: like,\n        dislikes: dislike,\n    });\n}\nfunction chunks(arr, len) {\n    var chunks = [], i = 0, n = arr.length;\n    while (i < n) {\n        chunks.push(arr.slice(i, i += len));\n    }\n    return chunks;\n}\nconst blockSort = (a, b) => {\n    if (b <= 0 && a > 0) {\n        return -1;\n    }\n    else if (b > 0 && a > 0) {\n        return Math.sign(a - b);\n    }\n    else {\n        return Math.sign(b - a);\n    }\n};\n/**\n * Build a list of top level posts given a list of transactions\n *\n * @param prefix - cashaddress prefix.\n * @throws {Error} if transaction generation fails.\n * @returns a cashaddress.\n */\nexport function buildChannel(history, transactions, channel) {\n    const channelLock = binToHex(Channel.getLockingBytecode(channel));\n    // build a map of transactions by hash\n    const transactionMap = new Map(transactions.map(tx => [swapEndianness(binToHex(hash256(hexToBin(tx)))), tx]));\n    // Assuming a sorted list of transactions by block height\n    let posts = history\n        .map(h => {\n        return parsePostTransaction(channelLock, h.height, h.tx_hash, transactionMap.get(h.tx_hash));\n    })\n        .filter(p => p != undefined);\n    let likeOccurances = posts.filter(p => p.likes == 1).map(p => { return p.ref; });\n    let likes = likeOccurances.reduce((acc, e) => acc.set(e, (acc.get(e) || 0) + 1), new Map());\n    for (const post of posts) {\n        post.likes = likes.get(post.hash) ? likes.get(post.hash) : 0;\n    }\n    posts = posts.sort((a, b) => {\n        if (b.height === a.height) {\n            return Math.sign(a.sequence - b.sequence);\n        }\n        else if (b.height <= 0 && a.height <= 0) {\n            return Math.sign(a.sequence - b.sequence);\n        }\n        else\n            return blockSort(a.height, b.height);\n    });\n    return posts.filter(p => p.body != \"\");\n}\nexport class Channel {\n    static USER_AGENT = packageInfo.name;\n    static PROTOCOL_IDENTIFIER = \"U3V\";\n    static tokenAware = true;\n    static template = template;\n    static compiler = getLibauthCompiler(this.template);\n    static vm = createVirtualMachineBch();\n    static getLockingBytecode(channel) {\n        const lockingBytecodeResult = this.compiler.generateBytecode({\n            data: {\n                \"bytecode\": {\n                    \"channel\": toBin(channel)\n                }\n            },\n            scriptId: 'channel_lock',\n        });\n        if (!lockingBytecodeResult.success) {\n            /* c8 ignore next */\n            throw new Error('Failed to generate bytecode, script: , ' + JSON.stringify(lockingBytecodeResult, null, '  '));\n        }\n        return lockingBytecodeResult.bytecode;\n    }\n    static getScriptHash(channel, reversed = true) {\n        return getScriptHash(this.getLockingBytecode(channel), reversed);\n    }\n    /**\n     * Get cashaddress\n     *\n     * @param prefix - cashaddress prefix.\n     * @throws {Error} if transaction generation fails.\n     * @returns a cashaddress.\n     */\n    static getAddress(channel = \"\", prefix = \"bitcoincash\") {\n        return getAddress(this.getLockingBytecode(channel), prefix, this.tokenAware);\n    }\n    static getInputs(channel, utxos, now, edit = false) {\n        return utxos.map(u => this.getInput(channel, u, now, edit));\n    }\n    static getInput(channel, utxo, now, edit = false) {\n        let scriptId = edit ? 'edit_message' : 'process_message';\n        const sequence = (now - utxo.height) >= 1000 ? 1000 : 0;\n        return {\n            outpointIndex: utxo.tx_pos,\n            outpointTransactionHash: hexToBin(utxo.tx_hash),\n            // \n            sequenceNumber: sequence,\n            unlockingBytecode: {\n                compiler: this.compiler,\n                script: scriptId,\n                data: {\n                    \"bytecode\": {\n                        \"channel\": toBin(channel),\n                        \"locktime\": bigIntToVmNumber(BigInt((Number(utxo.value) / 10) * 1000))\n                    }\n                },\n                valueSatoshis: BigInt(utxo.value),\n                token: utxo.token_data ? {\n                    category: hexToBin(utxo.token_data.category),\n                    amount: BigInt(utxo.token_data.amount),\n                    nft: utxo.token_data.nft ? {\n                        commitment: hexToBin(utxo.token_data.nft.commitment),\n                        capability: utxo.token_data.nft.capability,\n                    } : undefined\n                } : undefined\n            },\n        };\n    }\n    static getSourceOutputs(channel, utxos) {\n        return utxos.map(u => this.getSourceOutput(channel, u));\n    }\n    static getSourceOutput(channel, utxo) {\n        return {\n            outpointIndex: utxo.tx_pos,\n            outpointTransactionHash: hexToBin(utxo.tx_hash),\n            // \n            sequenceNumber: 1,\n            unlockingBytecode: Uint8Array.from([]),\n            lockingBytecode: this.getLockingBytecode(channel),\n            valueSatoshis: BigInt(utxo.value),\n        };\n    }\n    static getWalletSourceOutput(utxo, key) {\n        const lockingBytecode = key ? hdPrivateKeyToP2pkhLockingBytecode({\n            addressIndex: 0,\n            hdPrivateKey: key\n        }) : Uint8Array.from(Array(33));\n        return {\n            lockingBytecode: lockingBytecode,\n            valueSatoshis: BigInt(utxo.value),\n            token: utxo.token_data ? {\n                category: hexToBin(utxo.token_data.category),\n                amount: BigInt(utxo.token_data.amount),\n                nft: utxo.token_data.nft ? {\n                    commitment: hexToBin(utxo.token_data.nft.commitment),\n                    capability: utxo.token_data.nft.capability,\n                } : undefined\n            } : undefined\n        };\n    }\n    static getCouponOutputs(utxos, now) {\n        return utxos.map(u => this.getCouponOutput(u, now)).filter(u => u !== undefined);\n    }\n    static getCouponOutput(utxo, now) {\n        let futureTime = Math.floor(utxo.value / 10) * 1000;\n        // if the utxo was underfunded, clear it without generating a coupon.\n        let isSpam = ((futureTime - utxo.height) < 1000);\n        let isPremature = (now - utxo.height) < 1000;\n        let outputValue = isPremature ? utxo.value * 10 : utxo.value;\n        // A non matching output value indicates the message is spam\n        outputValue = isSpam ? utxo.value - 1 : outputValue;\n        let couponThreshold = isPremature ? 100_000_000 : 10_000_000;\n        couponThreshold = isSpam ? 10_000_000 : couponThreshold;\n        let bytecode = Vault.getCouponLockingBytecode(couponThreshold, futureTime);\n        return {\n            lockingBytecode: bytecode,\n            valueSatoshis: BigInt(outputValue),\n        };\n    }\n    static getWalletInputs(utxos, key, sequence) {\n        return utxos.map((u) => this.getWalletInput(u, key, sequence));\n    }\n    static getWalletInput(utxo, privateKey, sequence, addressIndex = 0) {\n        let unlockingData = privateKey ? {\n            compiler: this.compiler,\n            data: {\n                hdKeys: {\n                    addressIndex: addressIndex,\n                    hdPrivateKeys: {\n                        'wallet': privateKey\n                    },\n                }\n            },\n            script: 'wallet_unlock',\n            valueSatoshis: BigInt(utxo.value),\n        } : Uint8Array.from(Array());\n        //@ts-ignore\n        unlockingData.token = utxo.token_data ? {\n            category: hexToBin(utxo.token_data.category),\n            amount: utxo.token_data.amount,\n            nft: utxo.token_data.nft ? {\n                commitment: hexToBin(utxo.token_data.nft.commitment),\n                capability: utxo.token_data.nft.capability,\n            } : undefined\n        } : undefined;\n        return {\n            outpointIndex: utxo.tx_pos,\n            outpointTransactionHash: hexToBin(utxo.tx_hash),\n            sequenceNumber: sequence ? sequence + BIP68_MASK : sequence,\n            unlockingBytecode: unlockingData,\n        };\n    }\n    static getChannelMessageOutputs(channel, message, auth, couponValue) {\n        const binaryMessage = utf8ToBin(message);\n        let chunked = [...chunks(binaryMessage, 32).map((m) => \"6a025630\" + binToHex(encodeDataPush(m)))];\n        return chunked.map((m) => {\n            return {\n                lockingBytecode: this.getLockingBytecode(channel),\n                valueSatoshis: BigInt(couponValue),\n                token: {\n                    amount: 0n,\n                    category: hexToBin(auth.token_data.category),\n                    nft: {\n                        capability: 'mutable',\n                        commitment: hexToBin(m)\n                    }\n                }\n            };\n        });\n    }\n    static getLikeOutput(channel, postId, auth, couponValue) {\n        let m = \"6a0256B2\" + binToHex(encodeDataPush(hexToBin(postId)));\n        return {\n            lockingBytecode: this.getLockingBytecode(channel),\n            valueSatoshis: BigInt(couponValue),\n            token: {\n                amount: 0n,\n                category: hexToBin(auth.token_data.category),\n                nft: {\n                    capability: 'none',\n                    commitment: hexToBin(m)\n                }\n            }\n        };\n    }\n    static getChangeOutput(auth, changeAmount, privateKey, addressIndex = 0) {\n        const lockingBytecode = privateKey ? {\n            compiler: this.compiler,\n            data: {\n                hdKeys: {\n                    addressIndex: addressIndex,\n                    hdPublicKeys: {\n                        'wallet': deriveHdPublicKey(privateKey).hdPublicKey\n                    },\n                },\n            },\n            script: 'wallet_lock'\n        } : Uint8Array.from(Array(33));\n        return {\n            lockingBytecode: lockingBytecode,\n            valueSatoshis: changeAmount,\n            token: {\n                amount: 0n,\n                category: hexToBin(auth.token_data.category),\n                nft: {\n                    capability: \"minting\",\n                    commitment: hexToBin(auth.token_data?.nft?.commitment)\n                }\n            }\n        };\n    }\n    /**\n     * Clear a channel message.\n     *\n     * Messages may be cleared based on different conditions:\n     *\n     * 1. Messages that are older than 1000 blocks can be turned into 10M coupons\n     * 1. Messages that are not older than 1000 blocks can be into 100M coupons\n     * 1. Messages that were insufficiently funded may be taken at will without generating a coupon.\n     *\n     * @param channel - channel identifier.\n     * @param utxos - utxos held by the channel to drop.\n     * @param auth - utxo paying transaction fees.\n     * @param key - private key to sign transaction wallet inputs.\n     * @param now - current timestamp, in blocks.\n     * @param extraUtxos - wallet utxos for extra fees.\n     * @param fee - network fee to pay, default 1 sat per byte.\n     *\n     * @throws {Error} if transaction generation fails.\n     * @returns a transaction template.\n     */\n    static clear(channel, utxos, auth, key, now, extraUtxos, fee = 1) {\n        const inputs = [];\n        const outputs = [];\n        const sourceOutputs = [];\n        let config = {\n            locktime: now,\n            version: 2,\n            inputs,\n            outputs\n        };\n        let walletUtxos = [auth];\n        if (extraUtxos)\n            walletUtxos.push(...extraUtxos);\n        config.inputs.push(...this.getInputs(channel, utxos, now));\n        config.inputs.push(...this.getWalletInputs(walletUtxos, key));\n        config.outputs.push(...this.getCouponOutputs(utxos, now));\n        sourceOutputs.push(...this.getSourceOutputs(channel, utxos));\n        sourceOutputs.push(this.getWalletSourceOutput(auth, key));\n        let valueIn = sumSourceOutputValue(sourceOutputs);\n        let valueOut = sumOutputValue(config.outputs);\n        let change = valueIn - valueOut;\n        config.outputs.push(this.getChangeOutput(auth, change, key));\n        return this.buildAndValidateTransaction(config, sourceOutputs, fee);\n    }\n    /**\n     * Create (or edit) a post.\n     *\n     * @param channel - channel identifier.\n     * @param message - full post message.\n     * @param auth - utxo paying transaction fees.\n     * @param couponAmount - amount to pay message (per commitment).\n     * @param key - private key to sign transaction wallet inputs.\n     * @param prevUtxos - post utxos to edit.\n     * @param fee - network fee to pay, default 1 sat per byte.\n     *\n     * @throws {Error} if transaction generation fails.\n     * @returns a transaction template.\n     */\n    static post(channel, message, auth, couponAmount, key, sequence, prevUtxos, fee = 1) {\n        const inputs = [];\n        const outputs = [];\n        const sourceOutputs = [];\n        let config = {\n            locktime: 0,\n            version: 2,\n            inputs,\n            outputs\n        };\n        let walletUtxos = [auth];\n        if (prevUtxos)\n            walletUtxos.push(...prevUtxos);\n        config.inputs.push(...this.getWalletInputs(walletUtxos, key, sequence));\n        config.outputs.push(...this.getChannelMessageOutputs(channel, message, auth, couponAmount));\n        sourceOutputs.push(this.getWalletSourceOutput(auth, key));\n        let valueIn = sumSourceOutputValue(sourceOutputs);\n        let change = valueIn - BigInt(config.outputs.length * couponAmount);\n        config.outputs.push(this.getChangeOutput(auth, change, key));\n        return this.buildAndValidateTransaction(config, sourceOutputs, fee);\n    }\n    /**\n    * Like a post.\n    *\n    * @param channel - channel identifier.\n    * @param postId - transaction id of the post being liked.\n    * @param auth - utxo paying transaction fees.\n    * @param couponAmount - amount to pay message (per commitment).\n    * @param key - private key to sign transaction wallet inputs.\n    * @param fee - network fee to pay, default 1 sat per byte.\n    *\n    * @throws {Error} if transaction generation fails.\n    * @returns a transaction template.\n    */\n    static like(channel, postId, auth, couponAmount, key, fee = 1) {\n        const inputs = [];\n        const outputs = [];\n        const sourceOutputs = [];\n        let config = {\n            locktime: 0,\n            version: 2,\n            inputs,\n            outputs\n        };\n        let walletUtxos = [auth];\n        config.inputs.push(...this.getWalletInputs(walletUtxos, key));\n        config.outputs.push(this.getLikeOutput(channel, postId, auth, couponAmount));\n        sourceOutputs.push(this.getWalletSourceOutput(auth, key));\n        let valueIn = sumSourceOutputValue(sourceOutputs);\n        let change = valueIn - BigInt(config.outputs.length * couponAmount);\n        config.outputs.push(this.getChangeOutput(auth, change, key));\n        return this.buildAndValidateTransaction(config, sourceOutputs, fee);\n    }\n    static buildAndValidateTransaction(config, sourceOutputs, fee = 1) {\n        let result = generateTransaction(config);\n        if (!result.success)\n            throw new Error('generate transaction failed!, errors: ' + JSON.stringify(result.errors, null, '  '));\n        const estimatedFee = getTransactionFees(result.transaction, fee);\n        const lastIdx = config.outputs.length - 1;\n        config.outputs[lastIdx].valueSatoshis = config.outputs[lastIdx].valueSatoshis - estimatedFee;\n        result = generateTransaction(config);\n        if (!result.success)\n            throw new Error('generate transaction failed!, errors: ' + JSON.stringify(result.errors, null, '  '));\n        const transaction = result.transaction;\n        const tokenValidationResult = verifyTransactionTokens(transaction, sourceOutputs, { maximumTokenCommitmentLength: 40 });\n        if (tokenValidationResult !== true && fee > 0)\n            throw tokenValidationResult;\n        let verify = this.vm.verify({\n            sourceOutputs: sourceOutputs,\n            transaction: transaction,\n        });\n        return {\n            sourceOutputs: sourceOutputs,\n            transaction: transaction,\n            verify: verify\n        };\n    }\n}\n//# sourceMappingURL=channel.js.map"],"names":["DEFAULT_CONCURRENCY","CHIPNET_NINJA","getDefaultElectrum","isMainnet","promiseAllInBatches","task","items","batchSize","position","results","itemsForBatch","item","getTransactionWrap","args","getAllTransactions","electrumClient","tx_hashes","tx_hash","listUnspentWrap","unspent","utxo","VAULT_SERIES","COUPON_SERIES","CATEGORY_MAP","toBin","input","data","utf8ToBin","hexToBin","getRates","currentBlock","futureBlock","coupon","principal","getRateLocale","rates","getFutureBlockDate","blocks","futureDate","getFutureBlockDateLocale","diff","options","getAllUnspentCoupons","scriptHashes","allUnspent","a","map","obj","Future","getLibauthCompiler","template_json","Coupon","packageInfo","template","createVirtualMachineBch","amount","lock","reversed","getScriptHash","network","CashAddressNetworkPrefix","lockingBytecode","result","lockingBytecodeToCashAddress","amountVm","encodeDataPush","bigIntToVmNumber","lockVm","unlockingScript","hash256","Vault","time","tokenSupport","bytecodeResult","startTime","series","limit","step","next","e","seriesTimes","coupons","c","scripthash","binToHex","height","couponSeries","allCoupons","value","key","cData","b","hdPrivateKeyToP2pkhLockingBytecode","privateKey","addressIndex","unlockingData","category","deriveHdPublicKey","utxos","sourceOutputs","inputs","outputs","u","randomIdx","randomUtxo","nextTry","sumSats","sumSourceOutputValue","sumWSats","sumSourceOutputTokenAmounts","satsOut","contractUtxos","walletUtxos","couponUtxo","fee","unique","fbchCat","config","vaultLayers","walletLayers","lastOutputIdx","couponLayer","generateTransaction","estimatedFee","getTransactionFees","transaction","tokenValidationResult","verifyTransactionTokens","verify","feeEstimate","tokenDiff","BIP68_MASK","Post","hash","auth","sequence","body","likes","dislikes","ref","error","parseUsername","commitment","commitmentBin","unameHex","disassembleBytecodeBch","binToUtf8","parsePostTransaction","channelLock","tx","decodeTransactionBch","like","dislike","code","o","chunks","arr","len","i","n","blockSort","buildChannel","history","transactions","channel","Channel","transactionMap","swapEndianness","posts","h","p","acc","post","lockingBytecodeResult","prefix","getAddress","now","edit","scriptId","futureTime","isSpam","isPremature","outputValue","couponThreshold","message","couponValue","binaryMessage","m","postId","changeAmount","extraUtxos","valueIn","valueOut","sumOutputValue","change","couponAmount","prevUtxos","lastIdx"],"mappings":"oRAAO,MAAMA,GAAsB,EAG7BC,GAAgB,oBAGf,SAASC,GAAmBC,EAAY,GAAM,CACjD,OAAOA,EAAY,qBAAuBF,EAC9C,CCIO,eAAeG,EAAoBC,EAAMC,EAAOC,EAAYP,GAAqB,CACpF,IAAIQ,EAAW,EACXC,EAAU,CAAE,EAChB,KAAOD,EAAWF,EAAM,QAAQ,CAC5B,MAAMI,EAAgBJ,EAAM,MAAME,EAAUA,EAAWD,CAAS,EAChEE,EAAU,CAAC,GAAGA,EAAS,GAAG,MAAM,QAAQ,IAAIC,EAAc,IAAKC,GAASN,EAAKM,CAAI,CAAC,CAAC,CAAC,EACpFH,GAAYD,CACpB,CACI,OAAOE,CACX,CACO,eAAeG,GAAmBC,EAAM,CAE3C,OADa,MAAMA,EAAK,CAAC,EAAE,QAAQ,6BAA8BA,EAAK,CAAC,EAAG,EAAK,CAEnF,CACO,eAAeC,GAAmBC,EAAgBC,EAAW,CAChE,OAAOZ,EAAoBQ,GAAoBI,EAAU,IAAIC,GAAW,CAACF,EAAgBE,CAAO,CAAC,CAAC,CACtG,CACO,eAAeC,GAAgBL,EAAM,CACxC,IAAIM,EAAU,MAAMN,EAAK,CAAC,EAAE,QAAQ,oCAAqCA,EAAK,CAAC,CAAC,EAChF,GAAIM,aAAmB,MACnB,MAAMA,EACV,OAAOA,EAAQ,IAAKC,IACT,CACH,GAAGA,EACH,WAAYP,EAAK,CAAC,CACrB,EACJ,CACL,sjtBCrCaQ,GAAe,CAAC,EAAG,EAAG,EAAG,CAAC,EAC1BC,GAAgB,CAAC,GAAI,EAAG,EAAG,CAAC,EAE5BC,GAAe,IAAI,IAAI,CAChC,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,IAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,IAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,IAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,IAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,GAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,IAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,IAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,IAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,IAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,IAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,IAAM,EAC3E,CAAC,mEAAoE,KAAM,EAC3E,CAAC,mEAAoE,IAAM,EAC3E,CAAC,mEAAoE,IAAM,EAC3E,CAAC,mEAAoE,IAAM,EAC3E,CAAC,mEAAoE,GAAO,EAC5E,CAAC,mEAAoE,KAAO,EAC5E,CAAC,mEAAoE,KAAO,EAC5E,CAAC,mEAAoE,KAAO,EAC5E,CAAC,mEAAoE,KAAO,EAC5E,CAAC,mEAAoE,KAAO,EAC5E,CAAC,mEAAoE,KAAO,EAC5E,CAAC,mEAAoE,KAAO,EAC5E,CAAC,mEAAoE,KAAO,EAC5E,CAAC,mEAAoE,KAAO,EAC5E,CAAC,mEAAoE,IAAO,EAC5E,CAAC,mEAAoE,KAAO,E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"}