import{f as _,a as c,t as te,c as Nt}from"./yGPdYsEk.js";import{o as ee,a as ae}from"./BL1kRCRP.js";import{h as Ct,p as Mt,c as o,r as i,s as r,t as w,a as St,aF as A,a9 as Et,j as e,aa as u,a0 as se,f as et,as as oe}from"./4Ej_4qXs.js";import{d as Ht,s as T}from"./BNpjwQLA.js";import{a as ie,C as I,b as re,p as ne}from"./DxC2wkOi.js";import{i as M}from"./CyUl1IAL.js";import{e as ve,i as le}from"./PZPIYvej.js";import{s as D,r as ce,c as de}from"./CnJGQRAh.js";import{b as ue,a as he}from"./R_USggII.js";import{s as _e}from"./DlPNFNxT.js";import{p as zt}from"./B87m8dyy.js";import{L as dt,F as fe,m as me,$ as pe,G as ut,p as ht,J as _t,s as be}from"./zIYK9qkZ.js";import{I as ge,B as xe,T as ke,W as we,N as At,a as ye}from"./DeOyqwJy.js";import{a as Te,b as ft}from"./BtgC42a0.js";import{g as Ne}from"./gC8E2xLB.js";import{B as Ce,C as Ee,D as ze}from"./BbIwgq-g.js";function Ae(n,s,f,y,P,x){var N=n.__className;if(Ct||N!==f||N===void 0){var p=Te(f,y);(!Ct||p!==n.getAttribute("class"))&&(p==null?n.removeAttribute("class"):n.className=p),n.__className=f}return x}const Me=8;async function Se(n,s,f=Me){let y=0,P=[];for(;y<s.length;){const x=s.slice(y,y+f);P=[...P,...await Promise.all(x.map(N=>n(N)))],y+=f}return P}async function He(n){return await n[0].request("blockchain.transaction.get",n[1],!1)}async function De(n,s){return Se(He,s.map(f=>[n,f]))}const Pe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='15px'%20fill='%23000'%3e%3cpath%20d='M280-120q-33%200-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0%2033-23.5%2056.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160%200h80v-360h-80v360ZM280-720v520-520Z'/%3e%3c/svg%3e",qe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48px'%20viewBox='0%20-960%20960%20960'%20width='48px'%20fill='%23888'%3e%3cpath%20d='M272-120v-512l278-288%2058%2046-52%20242h359v171L767-120H272Zm60-60h397l126-299v-93H482l53-249-203%20214v427Zm0-427v427-427ZM79-120v-512h193v60H139v392h133v60H79Z'/%3e%3c/svg%3e";var Be=_('<img height="32px" class="svelte-1obxkap"/>'),Ue=_('<div style="width:32px"></div>'),Re=_('<div class="error svelte-1obxkap"> </div>'),Oe=(n,s)=>{s.likePost(s.hash)},Ze=_('<img height="32px" class="svelte-1obxkap"/>'),Le=_('<div style="width:32px"></div>'),We=_('<div class="container svelte-1obxkap"><div class="auth svelte-1obxkap"><!></div> <div><div class="footer svelte-1obxkap"><div class="fill svelte-1obxkap"></div> <div class="action"></div></div> <!> <div class="footer svelte-1obxkap"><div class="hash svelte-1obxkap"> </div> <div class="fill svelte-1obxkap"></div> <div class="actions svelte-1obxkap"><button class="svelte-1obxkap"><img height="16px" alt="likes"/> </button></div> <div class="timestamp svelte-1obxkap"> </div></div></div> <div class="auth svelte-1obxkap"><!></div></div>');function Ie(n,s){Mt(s,!0);var f=We(),y=o(f),P=o(y);{var x=v=>{var d=Be();w(L=>{D(d,"src",L),D(d,"alt",s.auth)},[()=>ft(s.auth,16)]),c(v,d)},N=v=>{var d=Ue();c(v,d)};M(P,v=>{s.thisAuth?v(N,!1):v(x)})}i(y);var p=r(y,2),K=r(o(p),2);{var R=v=>{var d=te();w(()=>T(d,s.body)),c(v,d)},q=v=>{var d=Re(),L=o(d,!0);i(d),w(()=>T(L,s.error)),c(v,d)};M(K,v=>{s.error?v(q,!1):v(R)})}var S=r(K,2),F=o(S),V=o(F,!0);i(F);var B=r(F,4),C=o(B);C.__click=[Oe,s];var O=o(C),Z=r(O);i(C),i(B);var h=r(B,2),Y=o(h);i(h),i(S),i(p);var b=r(p,2),m=o(b);{var at=v=>{var d=Ze();w(L=>{D(d,"src",L),D(d,"alt",s.auth)},[()=>ft(s.auth,16)]),c(v,d)},st=v=>{var d=Le();c(v,d)};M(m,v=>{s.thisAuth?v(at):v(st,!1)})}i(b),i(f),w(()=>{Ae(p,1,`post ${s.thisAuth?"op":""}`,"svelte-1obxkap"),T(V,s.hash),D(O,"src",qe),T(Z,` ${s.likes??""}`),T(Y,`${s.height??""} ■ ${s.sequence??""}`)}),c(n,f),St()}Ht(["click"]);var Fe=_("<img/>"),Ve=_('<img alt="Disconnected"/>'),Ge=(n,s,f)=>s(e(f)),je=_('<div class="deleteMe svelte-1f5vzoo"><button class="svelte-1f5vzoo"><img height="36px"/></button></div>'),Je=_("<!> <!>",1),Ke=_('<p style="color: red"> </p>'),Ye=(n,s)=>s(),Qe=_('<div class="row footer svelte-1f5vzoo"><h2>Create new identity</h2> <button class="svelte-1f5vzoo">New identity 1M sats</button></div>'),Xe=(n,s)=>s(),$e=_('<img height="32px" alt="avatar" class="svelte-1f5vzoo"/>'),ta=_('<div style="font-size:x-small;"> <br/> </div>'),ea=(n,s,f)=>s(e(f)),aa=_('<div class="edit svelte-1f5vzoo"><textarea class="svelte-1f5vzoo"> </textarea> <div class="estimate svelte-1f5vzoo"> </div></div> <div class="send svelte-1f5vzoo"><div class="auth svelte-1f5vzoo"><!> <!></div> <button class="svelte-1f5vzoo">Send</button></div>',1),sa=_("<p>Not connected?</p>"),oa=_('<div class="row footer svelte-1f5vzoo"><!></div>'),ia=(n,s)=>s(1e7),ra=(n,s)=>s(1e6),na=_('<div class="row footer svelte-1f5vzoo"><button class="svelte-1f5vzoo">Top up 10M sats</button> <button class="svelte-1f5vzoo">Top up 1M sats</button></div>'),va=_('<div class="box svelte-1f5vzoo"><div class="row header svelte-1f5vzoo"> <sub>■</sub> <div style="flex: 2 2 auto;"></div> <b><a href="/pop/">/pop</a> </b> <div style="flex: 2 2 auto;"></div> <!> <!></div> <div id="chat" class="row content svelte-1f5vzoo"><!></div> <!> <div class="row footer svelte-1f5vzoo"><div style="margin: auto;">Advanced</div> <div><label class="switch svelte-1f5vzoo"><input type="checkbox" class="svelte-1f5vzoo"/> <span class="slider round svelte-1f5vzoo"></span></label></div></div> <!></div>');function Na(n,s){Mt(s,!0);const y=zt.url.hostname=="vox.cash"?"bch.imaginary.cash":"chipnet.bch.ninja",P=dt('OP_RETURN <"U3V">');let x=A(0),N=A(0),p=A(""),K=A(""),R=A(""),q=A(""),S=A(0),F=A(0),V=A(!1);const B=se(()=>I.getScriptHash(s.topic));let C=A(Et([])),O,Z="",h,Y="",b,m=A(Et([]));const at=()=>{clearTimeout(O),O=setTimeout(()=>{ot(),mt()},1500)},st=async function(t){if(t.method==="blockchain.headers.subscribe"){let a=t.params[0];u(x,a.height,!0)}else t.method==="blockchain.scripthash.subscribe"?t.params[1]!==e(K)&&(u(K,t.params[1],!0),u(p,ut[h.status],!0),at()):console.log(t)},v=function(){let t=document.getElementById("chat");var a=t.scrollHeight;t.scrollTo(0,a)},d=async function(t){let a=I.like(s.topic,t,e(m)[0],(Math.round(e(x)/1e3)+10)*10,Z),l=ht(_t(a.transaction));await it(l)},L=async function(){let t=await h.request("blockchain.headers.get_tip");if(t instanceof Error)throw t;u(x,t.height,!0)},ot=async function(){let t=await h.request("blockchain.scripthash.listunspent",Y,"include_tokens");if(t instanceof Error)throw t;u(m,t.filter(a=>a.token_data&&a.token_data.nft&&a.token_data.nft.commitment.startsWith(P)),!0),e(m).length>0&&e(m)[0].token_data&&(u(q,e(m)[0].token_data.category,!0),u(N,e(m)[0].value,!0))},mt=async function(){let t=await h.request("blockchain.scripthash.listunspent",e(B),"include_tokens");if(t instanceof Error)throw t;let a=Array.from(new Set(t.map(k=>k.tx_hash))),l=await h.request("blockchain.scripthash.get_history",e(B),e(x)-1500,-1),E=await De(h,a);u(C,re(l,E,s.topic),!0),u(C,e(C).map(k=>({thisAuth:e(q)==k.auth,...k})),!0),e(C).slice(-1).length>0?u(S,e(C).slice(-1)[0].height<=0?e(C).slice(-1)[0].sequence+1:0,!0):u(S,0)},Dt=async function(t){let a=await h.request("blockchain.scripthash.listunspent",e(B),"include_tokens");if(a instanceof Error)throw a;let l=a.filter(g=>g.tx_hash==t.hash),E=I.clear(s.topic,l,e(m)[0],Z,e(x)),k=ht(_t(E.transaction));await it(k)},Pt=()=>{clearTimeout(O),O=setTimeout(()=>{u(F,qt(e(R)),!0)},500)},qt=function(t){let a=I.post(s.topic,t,e(m)[0],(Math.round(e(x)/1e3)+10)*10,Z,e(S));const l=a.transaction.outputs[a.transaction.outputs.length-1].valueSatoshis;return Number(be(a.sourceOutputs)-l)},Bt=async function(t){let a=I.post(s.topic,t,e(m)[0],(Math.round(e(x)/1e3)+10)*10,Z,e(S)),l=ht(_t(a.transaction));await it(l),u(R,"")},it=async function(t){let a=await h.request("blockchain.transaction.broadcast",t);if(u(S,e(S)+1),a instanceof Error)throw u(p,ut[h.status],!0),a},Ut=async function(){await b.sendMax(b.getDepositAddress());let t=dt('OP_RETURN <"U3V"> <"pseudonymous">');await b.tokenGenesis({cashaddr:b.getTokenDepositAddress(),commitment:t,capability:At.minting,value:1e6})},pt=async function(t){u(N,e(m)[0].value,!0),u(q,e(m)[0].token_data.category,!0);let a=dt('OP_RETURN <"U3V"> <"pseudonymous">');await b.send(new ye({cashaddr:b.getTokenDepositAddress(),tokenId:e(q),commitment:a,capability:At.minting,value:e(N)+t})),await ot()};ee(async()=>{const t=zt.url.hostname!=="vox.cash";xe.StorageProvider=ge,b=t?await ke.named("vox"):await we.named("vox"),Z=Ne(b.mnemonic,b.derivationPath.slice(0,-2),b.isTestnet);let a=fe(b.getDepositAddress());if(typeof a=="string")throw a;Y=me(a.bytecode),h=new pe(I.USER_AGENT,"1.4.1",y),await h.connect(),h.on("notification",st),u(p,ut[h.status],!0),await h.subscribe("blockchain.scripthash.subscribe",e(B)),await h.subscribe("blockchain.scripthash.subscribe",Y),await L(),await ot(),await mt(),v()}),ae(async()=>{await b.provider.disconnect(),await h.disconnect()});var rt=va(),nt=o(rt),bt=o(nt,!0),gt=r(bt,2),vt=r(gt,3),Rt=r(o(vt));i(vt);var xt=r(vt,4);Ce(xt,{get template(){return I.template}});var Ot=r(xt,2);{var Zt=t=>{var a=Fe();w(()=>{D(a,"src",Ee),D(a,"alt",e(p))}),c(t,a)},Lt=t=>{var a=Ve();w(()=>D(a,"src",ze)),c(t,a)};M(Ot,t=>{e(p)=="CONNECTED"?t(Zt):t(Lt,!1)})}i(nt);var lt=r(nt,2),Wt=o(lt);ie(Wt,()=>s.transactions,null,(t,a)=>{var l=Nt(),E=et(l);ve(E,17,()=>e(C),le,(k,g)=>{var H=Je(),U=et(H);Ie(U,_e({likePost:d},()=>e(g)));var G=r(U,2);{var X=Q=>{var j=je(),W=o(j);W.__click=[Ge,Dt,g];var $=o(W);i(W),i(j),w(()=>D($,"src",Pe)),c(Q,j)};M(G,Q=>{e(V)&&Q(X)})}c(k,H)}),c(t,l)},(t,a)=>{var l=Ke(),E=o(l,!0);i(l),w(()=>T(E,e(a).message)),c(t,l)}),i(lt);var kt=r(lt,2);{var It=t=>{var a=Qe(),l=r(o(a),2);l.__click=[Ye,Ut],i(a),c(t,a)},Ft=t=>{var a=oa(),l=o(a);{var E=g=>{var H=aa(),U=et(H),G=o(U);de(G),G.__keyup=[Xe,Pt];var X=r(G,2),Q=o(X);i(X),i(U);var j=r(U,2),W=o(j),$=o(W);{var jt=z=>{var J=$e();w(tt=>D(J,"src",tt),[()=>ft(e(q),16)]),c(z,J)};M($,z=>{e(q)&&z(jt)})}var Jt=r($,2);{var Kt=z=>{var J=ta(),tt=o(J,!0),Qt=r(tt,2);i(J),w((Xt,$t)=>{T(tt,Xt),T(Qt,` ${$t??""}sats`)},[()=>ne(e(m)[0].token_data.nft.commitment),()=>e(N).toLocaleString()]),c(z,J)};M(Jt,z=>{e(m).length>0&&z(Kt)})}i(W);var Yt=r(W,2);Yt.__click=[ea,Bt,R],i(j),w(z=>T(Q,`${z??""} sats`),[()=>e(F).toLocaleString()]),he(G,()=>e(R),z=>u(R,z)),c(g,H)},k=g=>{var H=sa();c(g,H)};M(l,g=>{e(p)=="CONNECTED"?g(E):g(k,!1)})}i(a),c(t,a)};M(kt,t=>{e(m).length==0?t(It):t(Ft,!1)})}var ct=r(kt,2),wt=r(o(ct),2),yt=o(wt),Tt=o(yt);ce(Tt),oe(2),i(yt),i(wt),i(ct);var Vt=r(ct,2);{var Gt=t=>{var a=Nt(),l=et(a);{var E=k=>{var g=na(),H=o(g);H.__click=[ia,pt];var U=r(H,2);U.__click=[ra,pt],i(g),c(k,g)};M(l,k=>{e(m).length>0&&k(E)})}c(t,a)};M(Vt,t=>{e(V)&&t(Gt)})}i(rt),w(t=>{T(bt,t),T(gt,` ${e(S)??""} `),T(Rt,`/${s.topic??""}`)},[()=>e(x).toLocaleString()]),ue(Tt,()=>e(V),t=>u(V,t)),c(n,rt),St()}Ht(["click","keyup"]);export{Na as C};
//# sourceMappingURL=DLtCB2Dh.js.map
